import{FileLoader,Loader}from"three";import opentype from"../libs/opentype.module.js";class TTFLoader extends Loader{constructor(e){super(e),this.reversed=!1}load(e,t,o,n){const s=this,a=new FileLoader(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,(function(o){try{t(s.parse(o))}catch(t){n?n(t):console.error(t),s.manager.itemError(e)}}),o,n)}parse(e){function t(e){const t=[];let o;e.forEach((function(e){"m"===e.type.toLowerCase()?(o=[e],t.push(o)):"z"!==e.type.toLowerCase()&&o.push(e)}));const n=[];return t.forEach((function(e){const t={type:"m",x:e[e.length-1].x,y:e[e.length-1].y};n.push(t);for(let t=e.length-1;t>0;t--){const o=e[t],s={type:o.type};void 0!==o.x2&&void 0!==o.y2?(s.x1=o.x2,s.y1=o.y2,s.x2=o.x1,s.y2=o.y1):void 0!==o.x1&&void 0!==o.y1&&(s.x1=o.x1,s.y1=o.y1),s.x=e[t-1].x,s.y=e[t-1].y,n.push(s)}})),n}return function(e,o){const n=Math.round,s={},a=1e5/(72*(e.unitsPerEm||2048)),r=e.encoding.cmap.glyphIndexMap,i=Object.keys(r);for(let d=0;d<i.length;d++){const y=i[d],h=e.glyphs.glyphs[r[y]];if(void 0!==y){const e={ha:n(h.advanceWidth*a),x_min:n(h.xMin*a),x_max:n(h.xMax*a),o:""};o&&(h.path.commands=t(h.path.commands)),h.path.commands.forEach((function(t){"c"===t.type.toLowerCase()&&(t.type="b"),e.o+=t.type.toLowerCase()+" ",void 0!==t.x&&void 0!==t.y&&(e.o+=n(t.x*a)+" "+n(t.y*a)+" "),void 0!==t.x1&&void 0!==t.y1&&(e.o+=n(t.x1*a)+" "+n(t.y1*a)+" "),void 0!==t.x2&&void 0!==t.y2&&(e.o+=n(t.x2*a)+" "+n(t.y2*a)+" ")})),s[String.fromCodePoint(h.unicode)]=e}}return{glyphs:s,familyName:e.getEnglishName("fullName"),ascender:n(e.ascender*a),descender:n(e.descender*a),underlinePosition:e.tables.post.underlinePosition,underlineThickness:e.tables.post.underlineThickness,boundingBox:{xMin:e.tables.head.xMin,xMax:e.tables.head.xMax,yMin:e.tables.head.yMin,yMax:e.tables.head.yMax},resolution:1e3,original_font_information:e.tables.name}}(opentype.parse(e),this.reversed)}}export{TTFLoader};