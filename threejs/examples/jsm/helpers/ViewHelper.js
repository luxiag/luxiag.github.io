import{BoxGeometry,CanvasTexture,Color,Euler,Mesh,MeshBasicMaterial,Object3D,OrthographicCamera,Quaternion,Raycaster,Sprite,SpriteMaterial,Vector2,Vector3,Vector4}from"three";class ViewHelper extends Object3D{constructor(e,t){super(),this.isViewHelper=!0,this.animating=!1,this.center=new Vector3;const a=new Color("#ff3653"),i=new Color("#8adb00"),o=new Color("#2c8fff"),s=[],r=new Raycaster,n=new Vector2,p=new Object3D,l=new OrthographicCamera(-2,2,2,-2,0,4);l.position.set(0,0,2);const c=new BoxGeometry(.8,.05,.05).translate(.4,0,0),h=new Mesh(c,k(a)),u=new Mesh(c,k(i)),d=new Mesh(c,k(o));u.rotation.z=Math.PI/2,d.rotation.y=-Math.PI/2,this.add(h),this.add(d),this.add(u);const m=new Sprite(F(a,"X"));m.userData.type="posX";const w=new Sprite(F(i,"Y"));w.userData.type="posY";const y=new Sprite(F(o,"Z"));y.userData.type="posZ";const f=new Sprite(F(a));f.userData.type="negX";const g=new Sprite(F(i));g.userData.type="negY";const M=new Sprite(F(o));M.userData.type="negZ",m.position.x=1,w.position.y=1,y.position.z=1,f.position.x=-1,f.scale.setScalar(.8),g.position.y=-1,g.scale.setScalar(.8),M.position.z=-1,M.scale.setScalar(.8),this.add(m),this.add(w),this.add(y),this.add(f),this.add(g),this.add(M),s.push(m),s.push(w),s.push(y),s.push(f),s.push(g),s.push(M);const x=new Vector3,S=128,V=2*Math.PI;this.render=function(a){this.quaternion.copy(e.quaternion).invert(),this.updateMatrixWorld(),x.set(0,0,1),x.applyQuaternion(e.quaternion),x.x>=0?(m.material.opacity=1,f.material.opacity=.5):(m.material.opacity=.5,f.material.opacity=1),x.y>=0?(w.material.opacity=1,g.material.opacity=.5):(w.material.opacity=.5,g.material.opacity=1),x.z>=0?(y.material.opacity=1,M.material.opacity=.5):(y.material.opacity=.5,M.material.opacity=1);const i=t.offsetWidth-S;a.clearDepth(),a.getViewport(P),a.setViewport(i,0,S,S),a.render(this,l),a.setViewport(P.x,P.y,P.z,P.w)};const b=new Vector3,E=new Quaternion,C=new Quaternion,D=new Quaternion,P=new Vector4;let I=0;function k(e){return new MeshBasicMaterial({color:e,toneMapped:!1})}function F(e,t=null){const a=document.createElement("canvas");a.width=64,a.height=64;const i=a.getContext("2d");i.beginPath(),i.arc(32,32,16,0,2*Math.PI),i.closePath(),i.fillStyle=e.getStyle(),i.fill(),null!==t&&(i.font="24px Arial",i.textAlign="center",i.fillStyle="#000000",i.fillText(t,32,41));const o=new CanvasTexture(a);return new SpriteMaterial({map:o,toneMapped:!1})}this.handleClick=function(a){if(!0===this.animating)return!1;const i=t.getBoundingClientRect(),o=i.left+(t.offsetWidth-S),c=i.top+(t.offsetHeight-S);n.x=(a.clientX-o)/(i.width-o)*2-1,n.y=-(a.clientY-c)/(i.bottom-c)*2+1,r.setFromCamera(n,l);const h=r.intersectObjects(s);return h.length>0&&(function(t,a){switch(t.userData.type){case"posX":b.set(1,0,0),E.setFromEuler(new Euler(0,.5*Math.PI,0));break;case"posY":b.set(0,1,0),E.setFromEuler(new Euler(.5*-Math.PI,0,0));break;case"posZ":b.set(0,0,1),E.setFromEuler(new Euler);break;case"negX":b.set(-1,0,0),E.setFromEuler(new Euler(0,.5*-Math.PI,0));break;case"negY":b.set(0,-1,0),E.setFromEuler(new Euler(.5*Math.PI,0,0));break;case"negZ":b.set(0,0,-1),E.setFromEuler(new Euler(0,Math.PI,0));break;default:console.error("ViewHelper: Invalid axis.")}I=e.position.distanceTo(a),b.multiplyScalar(I).add(a),p.position.copy(a),p.lookAt(e.position),C.copy(p.quaternion),p.lookAt(b),D.copy(p.quaternion)}(h[0].object,this.center),this.animating=!0,!0)},this.update=function(t){const a=t*V;C.rotateTowards(D,a),e.position.set(0,0,1).applyQuaternion(C).multiplyScalar(I).add(this.center),e.quaternion.rotateTowards(E,a),0===C.angleTo(D)&&(this.animating=!1)},this.dispose=function(){c.dispose(),h.material.dispose(),u.material.dispose(),d.material.dispose(),m.material.map.dispose(),w.material.map.dispose(),y.material.map.dispose(),f.material.map.dispose(),g.material.map.dispose(),M.material.map.dispose(),m.material.dispose(),w.material.dispose(),y.material.dispose(),f.material.dispose(),g.material.dispose(),M.material.dispose()}}}export{ViewHelper};