import{BufferAttribute,BufferGeometry,Color,DynamicDrawUsage,Matrix4,Mesh,MeshStandardMaterial,Vector3}from"three";function TubePainter(){const r=3e6,a=new BufferAttribute(new Float32Array(r),3);a.usage=DynamicDrawUsage;const t=new BufferAttribute(new Float32Array(r),3);t.usage=DynamicDrawUsage;const e=new BufferAttribute(new Float32Array(r),3);e.usage=DynamicDrawUsage;const o=new BufferGeometry;o.setAttribute("position",a),o.setAttribute("normal",t),o.setAttribute("color",e),o.drawRange.count=0;const n=new MeshStandardMaterial({vertexColors:!0}),y=new Mesh(o,n);y.frustumCulled=!1;const c=new Vector3,u=new Vector3,i=new Vector3,p=new Vector3,s=new Color(16777215);let d=1;const l=new Vector3(0,1,0),f=new Vector3,A=new Vector3,w=new Matrix4,M=new Matrix4;let g=0;return{mesh:y,moveTo:function(r){f.copy(r),w.lookAt(A,f,l),A.copy(r),M.copy(w)},lineTo:function(r){f.copy(r),w.lookAt(A,f,l),function(r,n,y,l){if(0===r.distanceToSquared(n))return;let f=o.drawRange.count;const A=function(r){const a=2*Math.PI,t=[],e=.01*r;for(let r=0;r<10;r++){const o=r/10*a;t.push(new Vector3(Math.sin(o)*e,Math.cos(o)*e,0))}return t}(d);for(let o=0,d=A.length;o<d;o++){const w=A[o],M=A[(o+1)%d];c.copy(w).applyMatrix4(l).add(n),u.copy(M).applyMatrix4(l).add(n),i.copy(M).applyMatrix4(y).add(r),p.copy(w).applyMatrix4(y).add(r),c.toArray(a.array,3*(f+0)),u.toArray(a.array,3*(f+1)),p.toArray(a.array,3*(f+2)),u.toArray(a.array,3*(f+3)),i.toArray(a.array,3*(f+4)),p.toArray(a.array,3*(f+5)),c.copy(w).applyMatrix4(l).normalize(),u.copy(M).applyMatrix4(l).normalize(),i.copy(M).applyMatrix4(y).normalize(),p.copy(w).applyMatrix4(y).normalize(),c.toArray(t.array,3*(f+0)),u.toArray(t.array,3*(f+1)),p.toArray(t.array,3*(f+2)),u.toArray(t.array,3*(f+3)),i.toArray(t.array,3*(f+4)),p.toArray(t.array,3*(f+5)),s.toArray(e.array,3*(f+0)),s.toArray(e.array,3*(f+1)),s.toArray(e.array,3*(f+2)),s.toArray(e.array,3*(f+3)),s.toArray(e.array,3*(f+4)),s.toArray(e.array,3*(f+5)),f+=6}o.drawRange.count=f}(f,A,w,M),A.copy(f),M.copy(w)},setSize:function(r){d=r},update:function(){const r=g,n=o.drawRange.count;r!==n&&(a.updateRange.offset=3*r,a.updateRange.count=3*(n-r),a.needsUpdate=!0,t.updateRange.offset=3*r,t.updateRange.count=3*(n-r),t.needsUpdate=!0,e.updateRange.offset=3*r,e.updateRange.count=3*(n-r),e.needsUpdate=!0,g=o.drawRange.count)}}}export{TubePainter};