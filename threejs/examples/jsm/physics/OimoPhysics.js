import*as OIMO from"../libs/OimoPhysics/index.js";async function OimoPhysics(){const e=new OIMO.World(2,new OIMO.Vec3(0,-9.8,0)),n=[],o=new WeakMap;let t=0;return setInterval((function(){const i=performance.now();t>0&&e.step(1/60),t=i;for(let e=0,t=n.length;e<t;e++){const t=n[e];if(t.isInstancedMesh){const e=t.instanceMatrix.array,n=o.get(t);for(let o=0;o<n.length;o++){const t=n[o];compose(t.getPosition(),t.getOrientation(),e,16*o)}t.instanceMatrix.needsUpdate=!0,t.computeBoundingSphere()}else if(t.isMesh){const e=o.get(t);t.position.copy(e.getPosition()),t.quaternion.copy(e.getOrientation())}}}),1e3/60),{addMesh:function(t,i=0){const s=function(e){const n=e.parameters;if("BoxGeometry"===e.type){const e=void 0!==n.width?n.width/2:.5,o=void 0!==n.height?n.height/2:.5,t=void 0!==n.depth?n.depth/2:.5;return new OIMO.OBoxGeometry(new OIMO.Vec3(e,o,t))}if("SphereGeometry"===e.type||"IcosahedronGeometry"===e.type){const e=void 0!==n.radius?n.radius:1;return new OIMO.OSphereGeometry(e)}return null}(t.geometry);null!==s&&(t.isInstancedMesh?function(t,i,s){const O=t.instanceMatrix.array,c=[];for(let n=0;n<t.count;n++){const o=16*n,t=new OIMO.ShapeConfig;t.geometry=s;const d=new OIMO.RigidBodyConfig;d.type=0===i?OIMO.RigidBodyType.STATIC:OIMO.RigidBodyType.DYNAMIC,d.position=new OIMO.Vec3(O[o+12],O[o+13],O[o+14]);const r=new OIMO.RigidBody(d);r.addShape(new OIMO.Shape(t)),e.addRigidBody(r),c.push(r)}i>0&&(n.push(t),o.set(t,c))}(t,i,s):t.isMesh&&function(t,i,s){const O=new OIMO.ShapeConfig;O.geometry=s;const c=new OIMO.RigidBodyConfig;c.type=0===i?OIMO.RigidBodyType.STATIC:OIMO.RigidBodyType.DYNAMIC,c.position=new OIMO.Vec3(t.position.x,t.position.y,t.position.z);const d=new OIMO.RigidBody(c);d.addShape(new OIMO.Shape(O)),e.addRigidBody(d),i>0&&(n.push(t),o.set(t,d))}(t,i,s))},setMeshPosition:function(e,n,t=0){e.isInstancedMesh?o.get(e)[t].setPosition(new OIMO.Vec3(n.x,n.y,n.z)):e.isMesh&&o.get(e).setPosition(new OIMO.Vec3(n.x,n.y,n.z))}}}function compose(e,n,o,t){const i=n.x,s=n.y,O=n.z,c=n.w,d=i+i,r=s+s,p=O+O,y=i*d,a=i*r,M=i*p,h=s*r,I=s*p,g=O*p,u=c*d,w=c*r,f=c*p;o[t+0]=1-(h+g),o[t+1]=a+f,o[t+2]=M-w,o[t+3]=0,o[t+4]=a-f,o[t+5]=1-(y+g),o[t+6]=I+u,o[t+7]=0,o[t+8]=M+w,o[t+9]=I-u,o[t+10]=1-(y+h),o[t+11]=0,o[t+12]=e.x,o[t+13]=e.y,o[t+14]=e.z,o[t+15]=1}export{OimoPhysics};