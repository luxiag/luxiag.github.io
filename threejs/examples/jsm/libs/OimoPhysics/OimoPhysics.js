var oimo=oimo||{};oimo.collision||(oimo.collision={}),oimo.collision.broadphase||(oimo.collision.broadphase={}),oimo.collision.broadphase.BroadPhase=class{constructor(t){this._type=t,this._numProxies=0,this._proxyList=null,this._proxyListLast=null,this._proxyPairList=null,this._incremental=!1,this._testCount=0,this._proxyPairPool=null,this._idCount=0,this._convexSweep=new oimo.collision.broadphase._BroadPhase.ConvexSweepGeometry,this._aabb=new oimo.collision.broadphase._BroadPhase.AabbGeometry,this.identity=new oimo.common.Transform,this.zero=new oimo.common.Vec3,this.rayCastHit=new oimo.collision.geometry.RayCastHit}createProxy(t,i){return null}destroyProxy(t){}moveProxy(t,i,o){}isOverlapping(t,i){return t._aabbMinX<i._aabbMaxX&&t._aabbMaxX>i._aabbMinX&&t._aabbMinY<i._aabbMaxY&&t._aabbMaxY>i._aabbMinY&&t._aabbMinZ<i._aabbMaxZ&&t._aabbMaxZ>i._aabbMinZ}collectPairs(){}getProxyPairList(){return this._proxyPairList}isIncremental(){return this._incremental}getTestCount(){return this._testCount}rayCast(t,i,o){}convexCast(t,i,o,s){}aabbTest(t,i){}},oimo.collision.geometry||(oimo.collision.geometry={}),oimo.collision.geometry.Geometry=class{constructor(t){this._type=t,this._volume=0}_updateMass(){}_computeAabb(t,i){}_rayCastLocal(t,i,o,s,a,n,e){return!1}getType(){return this._type}getVolume(){return this._volume}rayCast(t,i,o,s){let a,n,e,r,_,l,h,c,m,b,x,p;if(a=t.x,n=t.y,e=t.z,r=i.x,_=i.y,l=i.z,a-=o._positionX,n-=o._positionY,e-=o._positionZ,r-=o._positionX,_-=o._positionY,l-=o._positionZ,h=o._rotation00*a+o._rotation10*n+o._rotation20*e,c=o._rotation01*a+o._rotation11*n+o._rotation21*e,m=o._rotation02*a+o._rotation12*n+o._rotation22*e,a=h,n=c,e=m,b=o._rotation00*r+o._rotation10*_+o._rotation20*l,x=o._rotation01*r+o._rotation11*_+o._rotation21*l,p=o._rotation02*r+o._rotation12*_+o._rotation22*l,r=b,_=x,l=p,this._rayCastLocal(a,n,e,r,_,l,s)){let t,i,a,n,e,r,_=s.position;t=_.x,i=_.y,a=_.z;let l,h,c,m,b,x,p=s.normal;n=p.x,e=p.y,r=p.z,l=o._rotation00*t+o._rotation01*i+o._rotation02*a,h=o._rotation10*t+o._rotation11*i+o._rotation12*a,c=o._rotation20*t+o._rotation21*i+o._rotation22*a,t=l,i=h,a=c,m=o._rotation00*n+o._rotation01*e+o._rotation02*r,b=o._rotation10*n+o._rotation11*e+o._rotation12*r,x=o._rotation20*n+o._rotation21*e+o._rotation22*r,n=m,e=b,r=x,t+=o._positionX,i+=o._positionY,a+=o._positionZ;let f=s.position;f.x=t,f.y=i,f.z=a;let u=s.normal;return u.x=n,u.y=e,u.z=r,!0}return!1}},oimo.collision.geometry.ConvexGeometry=class extends oimo.collision.geometry.Geometry{constructor(t){super(t),this._gjkMargin=oimo.common.Setting.defaultGJKMargin,this._useGjkRayCast=!1}getGjkMergin(){return this._gjkMargin}setGjkMergin(t){t<0&&(t=0),this._gjkMargin=t}computeLocalSupportingVertex(t,i){}rayCast(t,i,o,s){return this._useGjkRayCast?oimo.collision.narrowphase.detector.gjkepa.GjkEpa.instance.rayCast(this,o,t,i,s):super.rayCast(t,i,o,s)}},oimo.collision.broadphase._BroadPhase||(oimo.collision.broadphase._BroadPhase={}),oimo.collision.broadphase._BroadPhase.ConvexSweepGeometry=class extends oimo.collision.geometry.ConvexGeometry{constructor(){super(-1)}init(t,i,o){let s,a,n,e,r,_,l,h,c;this.c=t,s=o.x,a=o.y,n=o.z,l=i._rotation00*s+i._rotation10*a+i._rotation20*n,h=i._rotation01*s+i._rotation11*a+i._rotation21*n,c=i._rotation02*s+i._rotation12*a+i._rotation22*n,e=l,r=h,_=c,this.localTranslation=new oimo.common.Vec3;let m=this.localTranslation;m.x=e,m.y=r,m.z=_,this._gjkMargin=t._gjkMargin}computeLocalSupportingVertex(t,i){this.c.computeLocalSupportingVertex(t,i);let o=this.localTranslation;if(t.x*o.x+t.y*o.y+t.z*o.z>0){let t=this.localTranslation;i.x+=t.x,i.y+=t.y,i.z+=t.z}}},oimo.collision.broadphase._BroadPhase.AabbGeometry=class extends oimo.collision.geometry.ConvexGeometry{constructor(){super(-1),this.min=new oimo.common.Vec3,this.max=new oimo.common.Vec3}computeLocalSupportingVertex(t,i){i.x=t.x>0?this.max.x:this.min.x,i.y=t.y>0?this.max.y:this.min.y,i.z=t.z>0?this.max.z:this.min.z}},oimo.collision.broadphase.BroadPhaseProxyCallback=class{constructor(){}process(t){}},oimo.collision.broadphase.BroadPhaseType=class{},oimo.collision.broadphase.Proxy=class{constructor(t,i){this.userData=t,this._id=i,this._prev=null,this._next=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}getId(){return this._id}getFatAabb(){let t=new oimo.collision.geometry.Aabb;return t._minX=this._aabbMinX,t._minY=this._aabbMinY,t._minZ=this._aabbMinZ,t._maxX=this._aabbMaxX,t._maxY=this._aabbMaxY,t._maxZ=this._aabbMaxZ,t}getFatAabbTo(t){t._minX=this._aabbMinX,t._minY=this._aabbMinY,t._minZ=this._aabbMinZ,t._maxX=this._aabbMaxX,t._maxY=this._aabbMaxY,t._maxZ=this._aabbMaxZ}},oimo.collision.broadphase.ProxyPair=class{constructor(){this._p1=null,this._p2=null}getProxy1(){return this._p1}getProxy2(){return this._p2}getNext(){return this._next}},oimo.collision.broadphase.bruteforce||(oimo.collision.broadphase.bruteforce={}),oimo.collision.broadphase.bruteforce.BruteForceBroadPhase=class extends oimo.collision.broadphase.BroadPhase{constructor(){super(1),this._incremental=!1}createProxy(t,i){let o=new oimo.collision.broadphase.Proxy(t,this._idCount++);return this._numProxies++,null==this._proxyList?(this._proxyList=o,this._proxyListLast=o):(this._proxyListLast._next=o,o._prev=this._proxyListLast,this._proxyListLast=o),o._aabbMinX=i._minX,o._aabbMinY=i._minY,o._aabbMinZ=i._minZ,o._aabbMaxX=i._maxX,o._aabbMaxY=i._maxY,o._aabbMaxZ=i._maxZ,o}destroyProxy(t){this._numProxies--;let i=t._prev,o=t._next;null!=i&&(i._next=o),null!=o&&(o._prev=i),t==this._proxyList&&(this._proxyList=this._proxyList._next),t==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),t._next=null,t._prev=null,t.userData=null}moveProxy(t,i,o){t._aabbMinX=i._minX,t._aabbMinY=i._minY,t._aabbMinZ=i._minZ,t._aabbMaxX=i._maxX,t._aabbMaxY=i._maxY,t._aabbMaxZ=i._maxZ}collectPairs(){let t=this._proxyPairList;if(null!=t){for(;t._p1=null,t._p2=null,t=t._next,null!=t;);this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}this._testCount=0;let i=this._proxyList;for(;null!=i;){let t=i._next,o=i._next;for(;null!=o;){let t=o._next;if(this._testCount++,i._aabbMinX<o._aabbMaxX&&i._aabbMaxX>o._aabbMinX&&i._aabbMinY<o._aabbMaxY&&i._aabbMaxY>o._aabbMinY&&i._aabbMinZ<o._aabbMaxZ&&i._aabbMaxZ>o._aabbMinZ){let t=this._proxyPairPool;null!=t?(this._proxyPairPool=t._next,t._next=null):t=new oimo.collision.broadphase.ProxyPair;let s=t;null==this._proxyPairList||(s._next=this._proxyPairList),this._proxyPairList=s,s._p1=i,s._p2=o}o=t}i=t}}rayCast(t,i,o){let s,a,n,e,r,_;s=t.x,a=t.y,n=t.z,e=i.x,r=i.y,_=i.z;let l=this._proxyList;for(;null!=l;){let t,i=l._next,h=s,c=a,m=n,b=e,x=r,p=_,f=l._aabbMinX,u=l._aabbMinY,v=l._aabbMinZ,X=l._aabbMaxX,y=l._aabbMaxY,g=l._aabbMaxZ;if(f>(h>b?h:b)||X<(h<b?h:b)||u>(c>x?c:x)||y<(c<x?c:x)||v>(m>p?m:p)||g<(m<p?m:p))t=!1;else{let i,o,s=b-h,a=x-c,n=p-m,e=s<0?-s:s,r=a<0?-a:a,_=n<0?-n:n,l=.5*(X-f),d=.5*(y-u),Y=.5*(g-v),z=h-.5*(X+f),Z=c-.5*(y+u),M=m-.5*(g+v),I=Z*n-M*a;if((I<0?-I:I)-(d*_+Y*r)>0)o=!0;else{let t=M*s-z*n;o=(t<0?-t:t)-(Y*e+l*_)>0}if(o)i=!0;else{let t=z*a-Z*s;i=(t<0?-t:t)-(l*r+d*e)>0}t=!i}t&&o.process(l),l=i}}convexCast(t,i,o,s){let a=this._proxyList;for(;null!=a;){let n=a._next,e=this._aabb.min;e.x=a._aabbMinX,e.y=a._aabbMinY,e.z=a._aabbMinZ;let r=this._aabb.max;r.x=a._aabbMaxX,r.y=a._aabbMaxY,r.z=a._aabbMaxZ,this._convexSweep.init(t,i,o);let _=oimo.collision.narrowphase.detector.gjkepa.GjkEpa.instance;0==_.computeClosestPointsImpl(this._convexSweep,this._aabb,i,this.identity,null,!1)&&_.distance<=0&&s.process(a),a=n}}aabbTest(t,i){let o=this._proxyList;for(;null!=o;){let s=o._next;t._minX<o._aabbMaxX&&t._maxX>o._aabbMinX&&t._minY<o._aabbMaxY&&t._maxY>o._aabbMinY&&t._minZ<o._aabbMaxZ&&t._maxZ>o._aabbMinZ&&i.process(o),o=s}}},oimo.collision.broadphase.bvh||(oimo.collision.broadphase.bvh={}),oimo.collision.broadphase.bvh.BvhBroadPhase=class extends oimo.collision.broadphase.BroadPhase{constructor(){super(2),this._incremental=!0,this._tree=new oimo.collision.broadphase.bvh.BvhTree,this.movedProxies=new Array(1024),this.numMovedProxies=0}collide(t,i){this._testCount++;let o=0==t._height,s=0==i._height;if(t==i){if(o)return;return this.collide(t._children[0],i),void this.collide(t._children[1],i)}if(t._aabbMinX<i._aabbMaxX&&t._aabbMaxX>i._aabbMinX&&t._aabbMinY<i._aabbMaxY&&t._aabbMaxY>i._aabbMinY&&t._aabbMinZ<i._aabbMaxZ&&t._aabbMaxZ>i._aabbMinZ){if(o&&s){let o=this._proxyPairPool;null!=o?(this._proxyPairPool=o._next,o._next=null):o=new oimo.collision.broadphase.ProxyPair;let s=o;return null==this._proxyPairList||(s._next=this._proxyPairList),this._proxyPairList=s,s._p1=t._proxy,void(s._p2=i._proxy)}s||t._height>i._height?(this.collide(t._children[0],i),this.collide(t._children[1],i)):(this.collide(i._children[0],t),this.collide(i._children[1],t))}}rayCastRecursive(t,i,o,s,a,n,e,r){let _,l=i,h=o,c=s,m=a,b=n,x=e,p=t._aabbMinX,f=t._aabbMinY,u=t._aabbMinZ,v=t._aabbMaxX,X=t._aabbMaxY,y=t._aabbMaxZ;if(p>(l>m?l:m)||v<(l<m?l:m)||f>(h>b?h:b)||X<(h<b?h:b)||u>(c>x?c:x)||y<(c<x?c:x))_=!1;else{let t,i,o=m-l,s=b-h,a=x-c,n=o<0?-o:o,e=s<0?-s:s,r=a<0?-a:a,g=.5*(v-p),d=.5*(X-f),Y=.5*(y-u),z=l-.5*(v+p),Z=h-.5*(X+f),M=c-.5*(y+u),I=Z*a-M*s;if((I<0?-I:I)-(d*r+Y*e)>0)i=!0;else{let t=M*o-z*a;i=(t<0?-t:t)-(Y*n+g*r)>0}if(i)t=!0;else{let i=z*s-Z*o;t=(i<0?-i:i)-(g*e+d*n)>0}_=!t}_&&(0!=t._height?(this.rayCastRecursive(t._children[0],i,o,s,a,n,e,r),this.rayCastRecursive(t._children[1],i,o,s,a,n,e,r)):r.process(t._proxy))}convexCastRecursive(t,i,o,s,a){let n=this._aabb.min;n.x=t._aabbMinX,n.y=t._aabbMinY,n.z=t._aabbMinZ;let e=this._aabb.max;e.x=t._aabbMaxX,e.y=t._aabbMaxY,e.z=t._aabbMaxZ,this._convexSweep.init(i,o,s);let r=oimo.collision.narrowphase.detector.gjkepa.GjkEpa.instance;0==r.computeClosestPointsImpl(this._convexSweep,this._aabb,o,this.identity,null,!1)&&r.distance<=0&&(0!=t._height?(this.convexCastRecursive(t._children[0],i,o,s,a),this.convexCastRecursive(t._children[1],i,o,s,a)):a.process(t._proxy))}aabbTestRecursive(t,i,o){t._aabbMinX<i._maxX&&t._aabbMaxX>i._minX&&t._aabbMinY<i._maxY&&t._aabbMaxY>i._minY&&t._aabbMinZ<i._maxZ&&t._aabbMaxZ>i._minZ&&(0!=t._height?(this.aabbTestRecursive(t._children[0],i,o),this.aabbTestRecursive(t._children[1],i,o)):o.process(t._proxy))}createProxy(t,i){let o=new oimo.collision.broadphase.bvh.BvhProxy(t,this._idCount++);this._numProxies++,null==this._proxyList?(this._proxyList=o,this._proxyListLast=o):(this._proxyListLast._next=o,o._prev=this._proxyListLast,this._proxyListLast=o),o._aabbMinX=i._minX,o._aabbMinY=i._minY,o._aabbMinZ=i._minZ,o._aabbMaxX=i._maxX,o._aabbMaxY=i._maxY,o._aabbMaxZ=i._maxZ;let s=oimo.common.Setting.bvhProxyPadding;o._aabbMinX-=s,o._aabbMinY-=s,o._aabbMinZ-=s,o._aabbMaxX+=s,o._aabbMaxY+=s,o._aabbMaxZ+=s;let a=this._tree,n=a._nodePool;null!=n?(a._nodePool=n._next,n._next=null):n=new oimo.collision.broadphase.bvh.BvhNode;let e=n;if(e._proxy=o,o._leaf=e,e._aabbMinX=o._aabbMinX,e._aabbMinY=o._aabbMinY,e._aabbMinZ=o._aabbMinZ,e._aabbMaxX=o._aabbMaxX,e._aabbMaxY=o._aabbMaxY,e._aabbMaxZ=o._aabbMaxZ,a._numLeaves++,null==a.leafList?(a.leafList=e,a.leafListLast=e):(a.leafListLast._nextLeaf=e,e._prevLeaf=a.leafListLast,a.leafListLast=e),null==a._root)a._root=e;else{let t=a._root;for(;t._height>0;){let i=a._strategy._decideInsertion(t,e);if(-1==i)break;t=t._children[i]}let i=t._parent,o=a._nodePool;null!=o?(a._nodePool=o._next,o._next=null):o=new oimo.collision.broadphase.bvh.BvhNode;let s=o;if(null==i)a._root=s;else{let o=t._childIndex;i._children[o]=s,s._parent=i,s._childIndex=o}let n=t._childIndex;s._children[n]=t,t._parent=s,t._childIndex=n;let r=1^t._childIndex;for(s._children[r]=e,e._parent=s,e._childIndex=r;null!=s;){if(a._strategy._balancingEnabled&&s._height>=2){let t=s._parent,i=s._children[0],o=s._children[1],n=i._height-o._height,e=s._childIndex;if(n>1){let o=i._children[0],n=i._children[1];if(o._height>n._height){i._children[1]=s,s._parent=i,s._childIndex=1,s._children[0]=n,n._parent=s,n._childIndex=0;let t=i._children[0],o=i._children[1];i._aabbMinX=t._aabbMinX<o._aabbMinX?t._aabbMinX:o._aabbMinX,i._aabbMinY=t._aabbMinY<o._aabbMinY?t._aabbMinY:o._aabbMinY,i._aabbMinZ=t._aabbMinZ<o._aabbMinZ?t._aabbMinZ:o._aabbMinZ,i._aabbMaxX=t._aabbMaxX>o._aabbMaxX?t._aabbMaxX:o._aabbMaxX,i._aabbMaxY=t._aabbMaxY>o._aabbMaxY?t._aabbMaxY:o._aabbMaxY,i._aabbMaxZ=t._aabbMaxZ>o._aabbMaxZ?t._aabbMaxZ:o._aabbMaxZ;let a=i._children[0]._height,e=i._children[1]._height;i._height=(a>e?a:e)+1;let r=s._children[0],_=s._children[1];s._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,s._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,s._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,s._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,s._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,s._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=s._children[0]._height,h=s._children[1]._height;s._height=(l>h?l:h)+1}else{i._children[0]=s,s._parent=i,s._childIndex=0,s._children[0]=o,o._parent=s,o._childIndex=0;let t=i._children[0],a=i._children[1];i._aabbMinX=t._aabbMinX<a._aabbMinX?t._aabbMinX:a._aabbMinX,i._aabbMinY=t._aabbMinY<a._aabbMinY?t._aabbMinY:a._aabbMinY,i._aabbMinZ=t._aabbMinZ<a._aabbMinZ?t._aabbMinZ:a._aabbMinZ,i._aabbMaxX=t._aabbMaxX>a._aabbMaxX?t._aabbMaxX:a._aabbMaxX,i._aabbMaxY=t._aabbMaxY>a._aabbMaxY?t._aabbMaxY:a._aabbMaxY,i._aabbMaxZ=t._aabbMaxZ>a._aabbMaxZ?t._aabbMaxZ:a._aabbMaxZ;let n=i._children[0]._height,e=i._children[1]._height;i._height=(n>e?n:e)+1;let r=s._children[0],_=s._children[1];s._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,s._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,s._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,s._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,s._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,s._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=s._children[0]._height,h=s._children[1]._height;s._height=(l>h?l:h)+1}null!=t?(t._children[e]=i,i._parent=t,i._childIndex=e):(a._root=i,i._parent=null),s=i}else if(n<-1){let i=o._children[0],n=o._children[1];if(i._height>n._height){o._children[1]=s,s._parent=o,s._childIndex=1,s._children[1]=n,n._parent=s,n._childIndex=1;let t=o._children[0],i=o._children[1];o._aabbMinX=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,o._aabbMinY=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,o._aabbMinZ=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,o._aabbMaxX=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,o._aabbMaxY=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,o._aabbMaxZ=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let a=o._children[0]._height,e=o._children[1]._height;o._height=(a>e?a:e)+1;let r=s._children[0],_=s._children[1];s._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,s._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,s._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,s._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,s._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,s._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=s._children[0]._height,h=s._children[1]._height;s._height=(l>h?l:h)+1}else{o._children[0]=s,s._parent=o,s._childIndex=0,s._children[1]=i,i._parent=s,i._childIndex=1;let t=o._children[0],a=o._children[1];o._aabbMinX=t._aabbMinX<a._aabbMinX?t._aabbMinX:a._aabbMinX,o._aabbMinY=t._aabbMinY<a._aabbMinY?t._aabbMinY:a._aabbMinY,o._aabbMinZ=t._aabbMinZ<a._aabbMinZ?t._aabbMinZ:a._aabbMinZ,o._aabbMaxX=t._aabbMaxX>a._aabbMaxX?t._aabbMaxX:a._aabbMaxX,o._aabbMaxY=t._aabbMaxY>a._aabbMaxY?t._aabbMaxY:a._aabbMaxY,o._aabbMaxZ=t._aabbMaxZ>a._aabbMaxZ?t._aabbMaxZ:a._aabbMaxZ;let n=o._children[0]._height,e=o._children[1]._height;o._height=(n>e?n:e)+1;let r=s._children[0],_=s._children[1];s._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,s._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,s._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,s._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,s._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,s._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=s._children[0]._height,h=s._children[1]._height;s._height=(l>h?l:h)+1}null!=t?(t._children[e]=o,o._parent=t,o._childIndex=e):(a._root=o,o._parent=null),s=o}}let t=s._children[0]._height,i=s._children[1]._height;s._height=(t>i?t:i)+1;let o=s._children[0],n=s._children[1];s._aabbMinX=o._aabbMinX<n._aabbMinX?o._aabbMinX:n._aabbMinX,s._aabbMinY=o._aabbMinY<n._aabbMinY?o._aabbMinY:n._aabbMinY,s._aabbMinZ=o._aabbMinZ<n._aabbMinZ?o._aabbMinZ:n._aabbMinZ,s._aabbMaxX=o._aabbMaxX>n._aabbMaxX?o._aabbMaxX:n._aabbMaxX,s._aabbMaxY=o._aabbMaxY>n._aabbMaxY?o._aabbMaxY:n._aabbMaxY,s._aabbMaxZ=o._aabbMaxZ>n._aabbMaxZ?o._aabbMaxZ:n._aabbMaxZ,s=s._parent}}if(!o._moved){if(o._moved=!0,this.movedProxies.length==this.numMovedProxies){let t=new Array(this.numMovedProxies<<1),i=0,o=this.numMovedProxies;for(;i<o;){let o=i++;t[o]=this.movedProxies[o],this.movedProxies[o]=null}this.movedProxies=t}this.movedProxies[this.numMovedProxies++]=o}return o}destroyProxy(t){this._numProxies--;let i=t._prev,o=t._next;null!=i&&(i._next=o),null!=o&&(o._prev=i),t==this._proxyList&&(this._proxyList=this._proxyList._next),t==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),t._next=null,t._prev=null;let s=t,a=this._tree,n=s._leaf;a._numLeaves--;let e=n._prevLeaf,r=n._nextLeaf;if(null!=e&&(e._nextLeaf=r),null!=r&&(r._prevLeaf=e),n==a.leafList&&(a.leafList=a.leafList._nextLeaf),n==a.leafListLast&&(a.leafListLast=a.leafListLast._prevLeaf),n._nextLeaf=null,n._prevLeaf=null,a._root==n)a._root=null;else{let t=n._parent,i=t._children[1^n._childIndex],o=t._parent;if(null==o)i._parent=null,i._childIndex=0,a._root=i,t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=a._nodePool,a._nodePool=t;else{i._parent=o;let s=t._childIndex;o._children[s]=i,i._parent=o,i._childIndex=s,t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=a._nodePool,a._nodePool=t;let n=o;for(;null!=n;){if(a._strategy._balancingEnabled&&n._height>=2){let t=n._parent,i=n._children[0],o=n._children[1],s=i._height-o._height,e=n._childIndex;if(s>1){let o=i._children[0],s=i._children[1];if(o._height>s._height){i._children[1]=n,n._parent=i,n._childIndex=1,n._children[0]=s,s._parent=n,s._childIndex=0;let t=i._children[0],o=i._children[1];i._aabbMinX=t._aabbMinX<o._aabbMinX?t._aabbMinX:o._aabbMinX,i._aabbMinY=t._aabbMinY<o._aabbMinY?t._aabbMinY:o._aabbMinY,i._aabbMinZ=t._aabbMinZ<o._aabbMinZ?t._aabbMinZ:o._aabbMinZ,i._aabbMaxX=t._aabbMaxX>o._aabbMaxX?t._aabbMaxX:o._aabbMaxX,i._aabbMaxY=t._aabbMaxY>o._aabbMaxY?t._aabbMaxY:o._aabbMaxY,i._aabbMaxZ=t._aabbMaxZ>o._aabbMaxZ?t._aabbMaxZ:o._aabbMaxZ;let a=i._children[0]._height,e=i._children[1]._height;i._height=(a>e?a:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=n._children[0]._height,h=n._children[1]._height;n._height=(l>h?l:h)+1}else{i._children[0]=n,n._parent=i,n._childIndex=0,n._children[0]=o,o._parent=n,o._childIndex=0;let t=i._children[0],s=i._children[1];i._aabbMinX=t._aabbMinX<s._aabbMinX?t._aabbMinX:s._aabbMinX,i._aabbMinY=t._aabbMinY<s._aabbMinY?t._aabbMinY:s._aabbMinY,i._aabbMinZ=t._aabbMinZ<s._aabbMinZ?t._aabbMinZ:s._aabbMinZ,i._aabbMaxX=t._aabbMaxX>s._aabbMaxX?t._aabbMaxX:s._aabbMaxX,i._aabbMaxY=t._aabbMaxY>s._aabbMaxY?t._aabbMaxY:s._aabbMaxY,i._aabbMaxZ=t._aabbMaxZ>s._aabbMaxZ?t._aabbMaxZ:s._aabbMaxZ;let a=i._children[0]._height,e=i._children[1]._height;i._height=(a>e?a:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=n._children[0]._height,h=n._children[1]._height;n._height=(l>h?l:h)+1}null!=t?(t._children[e]=i,i._parent=t,i._childIndex=e):(a._root=i,i._parent=null),n=i}else if(s<-1){let i=o._children[0],s=o._children[1];if(i._height>s._height){o._children[1]=n,n._parent=o,n._childIndex=1,n._children[1]=s,s._parent=n,s._childIndex=1;let t=o._children[0],i=o._children[1];o._aabbMinX=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,o._aabbMinY=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,o._aabbMinZ=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,o._aabbMaxX=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,o._aabbMaxY=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,o._aabbMaxZ=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let a=o._children[0]._height,e=o._children[1]._height;o._height=(a>e?a:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=n._children[0]._height,h=n._children[1]._height;n._height=(l>h?l:h)+1}else{o._children[0]=n,n._parent=o,n._childIndex=0,n._children[1]=i,i._parent=n,i._childIndex=1;let t=o._children[0],s=o._children[1];o._aabbMinX=t._aabbMinX<s._aabbMinX?t._aabbMinX:s._aabbMinX,o._aabbMinY=t._aabbMinY<s._aabbMinY?t._aabbMinY:s._aabbMinY,o._aabbMinZ=t._aabbMinZ<s._aabbMinZ?t._aabbMinZ:s._aabbMinZ,o._aabbMaxX=t._aabbMaxX>s._aabbMaxX?t._aabbMaxX:s._aabbMaxX,o._aabbMaxY=t._aabbMaxY>s._aabbMaxY?t._aabbMaxY:s._aabbMaxY,o._aabbMaxZ=t._aabbMaxZ>s._aabbMaxZ?t._aabbMaxZ:s._aabbMaxZ;let a=o._children[0]._height,e=o._children[1]._height;o._height=(a>e?a:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=n._children[0]._height,h=n._children[1]._height;n._height=(l>h?l:h)+1}null!=t?(t._children[e]=o,o._parent=t,o._childIndex=e):(a._root=o,o._parent=null),n=o}}let t=n._children[0]._height,i=n._children[1]._height;n._height=(t>i?t:i)+1;let o=n._children[0],s=n._children[1];n._aabbMinX=o._aabbMinX<s._aabbMinX?o._aabbMinX:s._aabbMinX,n._aabbMinY=o._aabbMinY<s._aabbMinY?o._aabbMinY:s._aabbMinY,n._aabbMinZ=o._aabbMinZ<s._aabbMinZ?o._aabbMinZ:s._aabbMinZ,n._aabbMaxX=o._aabbMaxX>s._aabbMaxX?o._aabbMaxX:s._aabbMaxX,n._aabbMaxY=o._aabbMaxY>s._aabbMaxY?o._aabbMaxY:s._aabbMaxY,n._aabbMaxZ=o._aabbMaxZ>s._aabbMaxZ?o._aabbMaxZ:s._aabbMaxZ,n=n._parent}}}s._leaf=null,n._next=null,n._childIndex=0,n._children[0]=null,n._children[1]=null,n._childIndex=0,n._parent=null,n._height=0,n._proxy=null,n._next=a._nodePool,a._nodePool=n,s.userData=null,s._next=null,s._prev=null,s._moved&&(s._moved=!1)}moveProxy(t,i,o){let s=t;if(s._aabbMinX<=i._minX&&s._aabbMaxX>=i._maxX&&s._aabbMinY<=i._minY&&s._aabbMaxY>=i._maxY&&s._aabbMinZ<=i._minZ&&s._aabbMaxZ>=i._maxZ)return;s._aabbMinX=i._minX,s._aabbMinY=i._minY,s._aabbMinZ=i._minZ,s._aabbMaxX=i._maxX,s._aabbMaxY=i._maxY,s._aabbMaxZ=i._maxZ;let a=oimo.common.Setting.bvhProxyPadding;if(s._aabbMinX-=a,s._aabbMinY-=a,s._aabbMinZ-=a,s._aabbMaxX+=a,s._aabbMaxY+=a,s._aabbMaxZ+=a,null!=o){let t,i,a,n,e,r,_,l,h,c,m,b;n=0,e=0,r=0,t=o.x,i=o.y,a=o.z,_=n<t?n:t,l=e<i?e:i,h=r<a?r:a,c=n>t?n:t,m=e>i?e:i,b=r>a?r:a,s._aabbMinX+=_,s._aabbMinY+=l,s._aabbMinZ+=h,s._aabbMaxX+=c,s._aabbMaxY+=m,s._aabbMaxZ+=b}if(!s._moved){if(s._moved=!0,this.movedProxies.length==this.numMovedProxies){let t=new Array(this.numMovedProxies<<1),i=0,o=this.numMovedProxies;for(;i<o;){let o=i++;t[o]=this.movedProxies[o],this.movedProxies[o]=null}this.movedProxies=t}this.movedProxies[this.numMovedProxies++]=s}}collectPairs(){let t=this._proxyPairList;if(null!=t){for(;t._p1=null,t._p2=null,t=t._next,null!=t;);this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}if(this._testCount=0,this._numProxies<2)return;let i=this.numMovedProxies/this._numProxies<oimo.common.Setting.bvhIncrementalCollisionThreshold,o=0,s=this.numMovedProxies;for(;o<s;){let t=o++,s=this.movedProxies[t];if(s._moved){let t=this._tree,o=s._leaf;t._numLeaves--;let a=o._prevLeaf,n=o._nextLeaf;if(null!=a&&(a._nextLeaf=n),null!=n&&(n._prevLeaf=a),o==t.leafList&&(t.leafList=t.leafList._nextLeaf),o==t.leafListLast&&(t.leafListLast=t.leafListLast._prevLeaf),o._nextLeaf=null,o._prevLeaf=null,t._root==o)t._root=null;else{let i=o._parent,s=i._children[1^o._childIndex],a=i._parent;if(null==a)s._parent=null,s._childIndex=0,t._root=s,i._next=null,i._childIndex=0,i._children[0]=null,i._children[1]=null,i._childIndex=0,i._parent=null,i._height=0,i._proxy=null,i._next=t._nodePool,t._nodePool=i;else{s._parent=a;let o=i._childIndex;a._children[o]=s,s._parent=a,s._childIndex=o,i._next=null,i._childIndex=0,i._children[0]=null,i._children[1]=null,i._childIndex=0,i._parent=null,i._height=0,i._proxy=null,i._next=t._nodePool,t._nodePool=i;let n=a;for(;null!=n;){if(t._strategy._balancingEnabled&&n._height>=2){let i=n._parent,o=n._children[0],s=n._children[1],a=o._height-s._height,e=n._childIndex;if(a>1){let s=o._children[0],a=o._children[1];if(s._height>a._height){o._children[1]=n,n._parent=o,n._childIndex=1,n._children[0]=a,a._parent=n,a._childIndex=0;let t=o._children[0],i=o._children[1];o._aabbMinX=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,o._aabbMinY=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,o._aabbMinZ=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,o._aabbMaxX=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,o._aabbMaxY=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,o._aabbMaxZ=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let s=o._children[0]._height,e=o._children[1]._height;o._height=(s>e?s:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=n._children[0]._height,h=n._children[1]._height;n._height=(l>h?l:h)+1}else{o._children[0]=n,n._parent=o,n._childIndex=0,n._children[0]=s,s._parent=n,s._childIndex=0;let t=o._children[0],i=o._children[1];o._aabbMinX=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,o._aabbMinY=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,o._aabbMinZ=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,o._aabbMaxX=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,o._aabbMaxY=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,o._aabbMaxZ=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let a=o._children[0]._height,e=o._children[1]._height;o._height=(a>e?a:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=n._children[0]._height,h=n._children[1]._height;n._height=(l>h?l:h)+1}null!=i?(i._children[e]=o,o._parent=i,o._childIndex=e):(t._root=o,o._parent=null),n=o}else if(a<-1){let o=s._children[0],a=s._children[1];if(o._height>a._height){s._children[1]=n,n._parent=s,n._childIndex=1,n._children[1]=a,a._parent=n,a._childIndex=1;let t=s._children[0],i=s._children[1];s._aabbMinX=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,s._aabbMinY=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,s._aabbMinZ=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,s._aabbMaxX=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,s._aabbMaxY=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,s._aabbMaxZ=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let o=s._children[0]._height,e=s._children[1]._height;s._height=(o>e?o:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=n._children[0]._height,h=n._children[1]._height;n._height=(l>h?l:h)+1}else{s._children[0]=n,n._parent=s,n._childIndex=0,n._children[1]=o,o._parent=n,o._childIndex=1;let t=s._children[0],i=s._children[1];s._aabbMinX=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,s._aabbMinY=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,s._aabbMinZ=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,s._aabbMaxX=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,s._aabbMaxY=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,s._aabbMaxZ=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let a=s._children[0]._height,e=s._children[1]._height;s._height=(a>e?a:e)+1;let r=n._children[0],_=n._children[1];n._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,n._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,n._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,n._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,n._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,n._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=n._children[0]._height,h=n._children[1]._height;n._height=(l>h?l:h)+1}null!=i?(i._children[e]=s,s._parent=i,s._childIndex=e):(t._root=s,s._parent=null),n=s}}let i=n._children[0]._height,o=n._children[1]._height;n._height=(i>o?i:o)+1;let s=n._children[0],a=n._children[1];n._aabbMinX=s._aabbMinX<a._aabbMinX?s._aabbMinX:a._aabbMinX,n._aabbMinY=s._aabbMinY<a._aabbMinY?s._aabbMinY:a._aabbMinY,n._aabbMinZ=s._aabbMinZ<a._aabbMinZ?s._aabbMinZ:a._aabbMinZ,n._aabbMaxX=s._aabbMaxX>a._aabbMaxX?s._aabbMaxX:a._aabbMaxX,n._aabbMaxY=s._aabbMaxY>a._aabbMaxY?s._aabbMaxY:a._aabbMaxY,n._aabbMaxZ=s._aabbMaxZ>a._aabbMaxZ?s._aabbMaxZ:a._aabbMaxZ,n=n._parent}}}s._leaf=null,o._next=null,o._childIndex=0,o._children[0]=null,o._children[1]=null,o._childIndex=0,o._parent=null,o._height=0,o._proxy=null,o._next=t._nodePool,t._nodePool=o;let e=this._tree,r=e._nodePool;null!=r?(e._nodePool=r._next,r._next=null):r=new oimo.collision.broadphase.bvh.BvhNode;let _=r;if(_._proxy=s,s._leaf=_,_._aabbMinX=s._aabbMinX,_._aabbMinY=s._aabbMinY,_._aabbMinZ=s._aabbMinZ,_._aabbMaxX=s._aabbMaxX,_._aabbMaxY=s._aabbMaxY,_._aabbMaxZ=s._aabbMaxZ,e._numLeaves++,null==e.leafList?(e.leafList=_,e.leafListLast=_):(e.leafListLast._nextLeaf=_,_._prevLeaf=e.leafListLast,e.leafListLast=_),null==e._root)e._root=_;else{let t=e._root;for(;t._height>0;){let i=e._strategy._decideInsertion(t,_);if(-1==i)break;t=t._children[i]}let i=t._parent,o=e._nodePool;null!=o?(e._nodePool=o._next,o._next=null):o=new oimo.collision.broadphase.bvh.BvhNode;let s=o;if(null==i)e._root=s;else{let o=t._childIndex;i._children[o]=s,s._parent=i,s._childIndex=o}let a=t._childIndex;s._children[a]=t,t._parent=s,t._childIndex=a;let n=1^t._childIndex;for(s._children[n]=_,_._parent=s,_._childIndex=n;null!=s;){if(e._strategy._balancingEnabled&&s._height>=2){let t=s._parent,i=s._children[0],o=s._children[1],a=i._height-o._height,n=s._childIndex;if(a>1){let o=i._children[0],a=i._children[1];if(o._height>a._height){i._children[1]=s,s._parent=i,s._childIndex=1,s._children[0]=a,a._parent=s,a._childIndex=0;let t=i._children[0],o=i._children[1];i._aabbMinX=t._aabbMinX<o._aabbMinX?t._aabbMinX:o._aabbMinX,i._aabbMinY=t._aabbMinY<o._aabbMinY?t._aabbMinY:o._aabbMinY,i._aabbMinZ=t._aabbMinZ<o._aabbMinZ?t._aabbMinZ:o._aabbMinZ,i._aabbMaxX=t._aabbMaxX>o._aabbMaxX?t._aabbMaxX:o._aabbMaxX,i._aabbMaxY=t._aabbMaxY>o._aabbMaxY?t._aabbMaxY:o._aabbMaxY,i._aabbMaxZ=t._aabbMaxZ>o._aabbMaxZ?t._aabbMaxZ:o._aabbMaxZ;let n=i._children[0]._height,e=i._children[1]._height;i._height=(n>e?n:e)+1;let r=s._children[0],_=s._children[1];s._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,s._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,s._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,s._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,s._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,s._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=s._children[0]._height,h=s._children[1]._height;s._height=(l>h?l:h)+1}else{i._children[0]=s,s._parent=i,s._childIndex=0,s._children[0]=o,o._parent=s,o._childIndex=0;let t=i._children[0],a=i._children[1];i._aabbMinX=t._aabbMinX<a._aabbMinX?t._aabbMinX:a._aabbMinX,i._aabbMinY=t._aabbMinY<a._aabbMinY?t._aabbMinY:a._aabbMinY,i._aabbMinZ=t._aabbMinZ<a._aabbMinZ?t._aabbMinZ:a._aabbMinZ,i._aabbMaxX=t._aabbMaxX>a._aabbMaxX?t._aabbMaxX:a._aabbMaxX,i._aabbMaxY=t._aabbMaxY>a._aabbMaxY?t._aabbMaxY:a._aabbMaxY,i._aabbMaxZ=t._aabbMaxZ>a._aabbMaxZ?t._aabbMaxZ:a._aabbMaxZ;let n=i._children[0]._height,e=i._children[1]._height;i._height=(n>e?n:e)+1;let r=s._children[0],_=s._children[1];s._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,s._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,s._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,s._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,s._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,s._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=s._children[0]._height,h=s._children[1]._height;s._height=(l>h?l:h)+1}null!=t?(t._children[n]=i,i._parent=t,i._childIndex=n):(e._root=i,i._parent=null),s=i}else if(a<-1){let i=o._children[0],a=o._children[1];if(i._height>a._height){o._children[1]=s,s._parent=o,s._childIndex=1,s._children[1]=a,a._parent=s,a._childIndex=1;let t=o._children[0],i=o._children[1];o._aabbMinX=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,o._aabbMinY=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,o._aabbMinZ=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,o._aabbMaxX=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,o._aabbMaxY=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,o._aabbMaxZ=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let n=o._children[0]._height,e=o._children[1]._height;o._height=(n>e?n:e)+1;let r=s._children[0],_=s._children[1];s._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,s._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,s._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,s._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,s._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,s._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=s._children[0]._height,h=s._children[1]._height;s._height=(l>h?l:h)+1}else{o._children[0]=s,s._parent=o,s._childIndex=0,s._children[1]=i,i._parent=s,i._childIndex=1;let t=o._children[0],a=o._children[1];o._aabbMinX=t._aabbMinX<a._aabbMinX?t._aabbMinX:a._aabbMinX,o._aabbMinY=t._aabbMinY<a._aabbMinY?t._aabbMinY:a._aabbMinY,o._aabbMinZ=t._aabbMinZ<a._aabbMinZ?t._aabbMinZ:a._aabbMinZ,o._aabbMaxX=t._aabbMaxX>a._aabbMaxX?t._aabbMaxX:a._aabbMaxX,o._aabbMaxY=t._aabbMaxY>a._aabbMaxY?t._aabbMaxY:a._aabbMaxY,o._aabbMaxZ=t._aabbMaxZ>a._aabbMaxZ?t._aabbMaxZ:a._aabbMaxZ;let n=o._children[0]._height,e=o._children[1]._height;o._height=(n>e?n:e)+1;let r=s._children[0],_=s._children[1];s._aabbMinX=r._aabbMinX<_._aabbMinX?r._aabbMinX:_._aabbMinX,s._aabbMinY=r._aabbMinY<_._aabbMinY?r._aabbMinY:_._aabbMinY,s._aabbMinZ=r._aabbMinZ<_._aabbMinZ?r._aabbMinZ:_._aabbMinZ,s._aabbMaxX=r._aabbMaxX>_._aabbMaxX?r._aabbMaxX:_._aabbMaxX,s._aabbMaxY=r._aabbMaxY>_._aabbMaxY?r._aabbMaxY:_._aabbMaxY,s._aabbMaxZ=r._aabbMaxZ>_._aabbMaxZ?r._aabbMaxZ:_._aabbMaxZ;let l=s._children[0]._height,h=s._children[1]._height;s._height=(l>h?l:h)+1}null!=t?(t._children[n]=o,o._parent=t,o._childIndex=n):(e._root=o,o._parent=null),s=o}}let t=s._children[0]._height,i=s._children[1]._height;s._height=(t>i?t:i)+1;let o=s._children[0],a=s._children[1];s._aabbMinX=o._aabbMinX<a._aabbMinX?o._aabbMinX:a._aabbMinX,s._aabbMinY=o._aabbMinY<a._aabbMinY?o._aabbMinY:a._aabbMinY,s._aabbMinZ=o._aabbMinZ<a._aabbMinZ?o._aabbMinZ:a._aabbMinZ,s._aabbMaxX=o._aabbMaxX>a._aabbMaxX?o._aabbMaxX:a._aabbMaxX,s._aabbMaxY=o._aabbMaxY>a._aabbMaxY?o._aabbMaxY:a._aabbMaxY,s._aabbMaxZ=o._aabbMaxZ>a._aabbMaxZ?o._aabbMaxZ:a._aabbMaxZ,s=s._parent}}i&&this.collide(this._tree._root,s._leaf),s._moved=!1}this.movedProxies[t]=null}i||this.collide(this._tree._root,this._tree._root),this.numMovedProxies=0}rayCast(t,i,o){if(null==this._tree._root)return;let s,a,n,e,r,_;s=t.x,a=t.y,n=t.z,e=i.x,r=i.y,_=i.z,this.rayCastRecursive(this._tree._root,s,a,n,e,r,_,o)}convexCast(t,i,o,s){null!=this._tree._root&&this.convexCastRecursive(this._tree._root,t,i,o,s)}aabbTest(t,i){null!=this._tree._root&&this.aabbTestRecursive(this._tree._root,t,i)}getTreeBalance(){return this._tree._getBalance()}},oimo.collision.broadphase.bvh.BvhInsertionStrategy=class{},oimo.collision.broadphase.bvh.BvhNode=class{constructor(){this._next=null,this._prevLeaf=null,this._nextLeaf=null,this._children=new Array(2),this._childIndex=0,this._parent=null,this._height=0,this._proxy=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}},oimo.collision.broadphase.bvh.BvhProxy=class extends oimo.collision.broadphase.Proxy{constructor(t,i){super(t,i),this._leaf=null,this._moved=!1}},oimo.collision.broadphase.bvh.BvhStrategy=class{constructor(){this._insertionStrategy=0,this._balancingEnabled=!1}_decideInsertion(t,i){switch(this._insertionStrategy){case 0:let o,s,a;o=i._aabbMinX+i._aabbMaxX,s=i._aabbMinY+i._aabbMaxY,a=i._aabbMinZ+i._aabbMaxZ;let n,e,r,_,l,h,c=t._children[0],m=t._children[1];return n=c._aabbMinX+c._aabbMaxX,e=c._aabbMinY+c._aabbMaxY,r=c._aabbMinZ+c._aabbMaxZ,_=m._aabbMinX+m._aabbMaxX,l=m._aabbMinY+m._aabbMaxY,h=m._aabbMinZ+m._aabbMaxZ,n-=o,e-=s,r-=a,_-=o,l-=s,h-=a,n*n+e*e+r*r<_*_+l*l+h*h?0:1;case 1:let b,x,p,f,u,v,X=t._children[0],y=t._children[1],g=t._aabbMaxY-t._aabbMinY,d=t._aabbMaxZ-t._aabbMinZ;b=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,x=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,p=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,f=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,u=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,v=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let Y,z,Z=u-x,M=v-p,I=2*((f-b)*(Z+M)+Z*M),V=2*I,L=2*(I-2*((t._aabbMaxX-t._aabbMinX)*(g+d)+g*d));if(b=X._aabbMinX<i._aabbMinX?X._aabbMinX:i._aabbMinX,x=X._aabbMinY<i._aabbMinY?X._aabbMinY:i._aabbMinY,p=X._aabbMinZ<i._aabbMinZ?X._aabbMinZ:i._aabbMinZ,f=X._aabbMaxX>i._aabbMaxX?X._aabbMaxX:i._aabbMaxX,u=X._aabbMaxY>i._aabbMaxY?X._aabbMaxY:i._aabbMaxY,v=X._aabbMaxZ>i._aabbMaxZ?X._aabbMaxZ:i._aabbMaxZ,0==X._height){let t=u-x,i=v-p;Y=L+2*((f-b)*(t+i)+t*i)}else{let t=u-x,i=v-p,o=X._aabbMaxY-X._aabbMinY,s=X._aabbMaxZ-X._aabbMinZ;Y=L+(2*((f-b)*(t+i)+t*i)-2*((X._aabbMaxX-X._aabbMinX)*(o+s)+o*s))}if(b=y._aabbMinX<i._aabbMinX?y._aabbMinX:i._aabbMinX,x=y._aabbMinY<i._aabbMinY?y._aabbMinY:i._aabbMinY,p=y._aabbMinZ<i._aabbMinZ?y._aabbMinZ:i._aabbMinZ,f=y._aabbMaxX>i._aabbMaxX?y._aabbMaxX:i._aabbMaxX,u=y._aabbMaxY>i._aabbMaxY?y._aabbMaxY:i._aabbMaxY,v=y._aabbMaxZ>i._aabbMaxZ?y._aabbMaxZ:i._aabbMaxZ,0==y._height){let t=u-x,i=v-p;z=L+2*((f-b)*(t+i)+t*i)}else{let t=u-x,i=v-p,o=y._aabbMaxY-y._aabbMinY,s=y._aabbMaxZ-y._aabbMinZ;z=L+(2*((f-b)*(t+i)+t*i)-2*((y._aabbMaxX-y._aabbMinX)*(o+s)+o*s))}return V<Y?V<z?-1:1:Y<z?0:1;default:return console.log("src/oimo/collision/broadphase/bvh/BvhStrategy.hx:37:","invalid BVH insertion strategy: "+this._insertionStrategy),-1}}_splitLeaves(t,i,o){let s,a,n,e=1/(o-i);s=0,a=0,n=0;let r,_,l,h=i;for(;h<o;){let i=t[h++];i._tmpX=i._aabbMaxX+i._aabbMinX,i._tmpY=i._aabbMaxY+i._aabbMinY,i._tmpZ=i._aabbMaxZ+i._aabbMinZ,s+=i._tmpX,a+=i._tmpY,n+=i._tmpZ}s*=e,a*=e,n*=e,r=0,_=0,l=0;let c=i;for(;c<o;){let i,o,e,h=t[c++];i=h._tmpX-s,o=h._tmpY-a,e=h._tmpZ-n,i*=i,o*=o,e*=e,r+=i,_+=o,l+=e}let m=_,b=l,x=i,p=o-1;if(r>m)if(r>b){let i=s;for(;;){for(;!(t[x]._tmpX<=i);)++x;for(;!(t[p]._tmpX>=i);)--p;if(x>=p)break;let o=t[x];t[x]=t[p],t[p]=o,++x,--p}}else{let i=n;for(;;){for(;!(t[x]._tmpZ<=i);)++x;for(;!(t[p]._tmpZ>=i);)--p;if(x>=p)break;let o=t[x];t[x]=t[p],t[p]=o,++x,--p}}else if(m>b){let i=a;for(;;){for(;!(t[x]._tmpY<=i);)++x;for(;!(t[p]._tmpY>=i);)--p;if(x>=p)break;let o=t[x];t[x]=t[p],t[p]=o,++x,--p}}else{let i=n;for(;;){for(;!(t[x]._tmpZ<=i);)++x;for(;!(t[p]._tmpZ>=i);)--p;if(x>=p)break;let o=t[x];t[x]=t[p],t[p]=o,++x,--p}}return x}},oimo.collision.broadphase.bvh.BvhTree=class{constructor(){this._root=null,this._numLeaves=0,this._strategy=new oimo.collision.broadphase.bvh.BvhStrategy,this._nodePool=null,this.leafList=null,this.leafListLast=null,this.tmp=new Array(1024)}_print(t,i){if(null==i&&(i=""),null!=t)if(0==t._height)console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:39:",i+t._proxy._id);else{let o,s,a,n;if(this._print(t._children[0],i+"  "),s=t._aabbMaxX-t._aabbMinX,a=t._aabbMaxY-t._aabbMinY,n=t._aabbMaxZ-t._aabbMinZ,s*(a+n)+a*n>0){let i,s,a;i=t._aabbMaxX-t._aabbMinX,s=t._aabbMaxY-t._aabbMinY,a=t._aabbMaxZ-t._aabbMinZ,o=(1e3*(i*(s+a)+s*a)+.5|0)/1e3}else{let i,s,a;i=t._aabbMaxX-t._aabbMinX,s=t._aabbMaxY-t._aabbMinY,a=t._aabbMaxZ-t._aabbMinZ,o=(1e3*(i*(s+a)+s*a)-.5|0)/1e3}console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:42:",i+"#"+t._height+", "+o),this._print(t._children[1],i+"  ")}}_getBalance(){return this.getBalanceRecursive(this._root)}deleteRecursive(t){if(0==t._height){let i=t._prevLeaf,o=t._nextLeaf;return null!=i&&(i._nextLeaf=o),null!=o&&(o._prevLeaf=i),t==this.leafList&&(this.leafList=this.leafList._nextLeaf),t==this.leafListLast&&(this.leafListLast=this.leafListLast._prevLeaf),t._nextLeaf=null,t._prevLeaf=null,t._proxy._leaf=null,t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,void(this._nodePool=t)}this.deleteRecursive(t._children[0]),this.deleteRecursive(t._children[1]),t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t}decomposeRecursive(t){if(0==t._height)return t._childIndex=0,void(t._parent=null);this.decomposeRecursive(t._children[0]),this.decomposeRecursive(t._children[1]),t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t}buildTopDownRecursive(t,i,o){if(o-i==1){let o=t[i],s=o._proxy;return o._aabbMinX=s._aabbMinX,o._aabbMinY=s._aabbMinY,o._aabbMinZ=s._aabbMinZ,o._aabbMaxX=s._aabbMaxX,o._aabbMaxY=s._aabbMaxY,o._aabbMaxZ=s._aabbMaxZ,o}let s=this._strategy._splitLeaves(t,i,o),a=this.buildTopDownRecursive(t,i,s),n=this.buildTopDownRecursive(t,s,o),e=this._nodePool;null!=e?(this._nodePool=e._next,e._next=null):e=new oimo.collision.broadphase.bvh.BvhNode;let r=e;r._children[0]=a,a._parent=r,a._childIndex=0,r._children[1]=n,n._parent=r,n._childIndex=1;let _=r._children[0],l=r._children[1];r._aabbMinX=_._aabbMinX<l._aabbMinX?_._aabbMinX:l._aabbMinX,r._aabbMinY=_._aabbMinY<l._aabbMinY?_._aabbMinY:l._aabbMinY,r._aabbMinZ=_._aabbMinZ<l._aabbMinZ?_._aabbMinZ:l._aabbMinZ,r._aabbMaxX=_._aabbMaxX>l._aabbMaxX?_._aabbMaxX:l._aabbMaxX,r._aabbMaxY=_._aabbMaxY>l._aabbMaxY?_._aabbMaxY:l._aabbMaxY,r._aabbMaxZ=_._aabbMaxZ>l._aabbMaxZ?_._aabbMaxZ:l._aabbMaxZ;let h=r._children[0]._height,c=r._children[1]._height;return r._height=(h>c?h:c)+1,r}getBalanceRecursive(t){if(null==t||0==t._height)return 0;let i=t._children[0]._height-t._children[1]._height;return i<0&&(i=-i),i+this.getBalanceRecursive(t._children[0])+this.getBalanceRecursive(t._children[1])}},oimo.collision.geometry.Aabb=class{constructor(){this._minX=0,this._minY=0,this._minZ=0,this._maxX=0,this._maxY=0,this._maxZ=0}init(t,i){return this._minX=t.x,this._minY=t.y,this._minZ=t.z,this._maxX=i.x,this._maxY=i.y,this._maxZ=i.z,this}getMin(){let t=new oimo.common.Vec3;return t.x=this._minX,t.y=this._minY,t.z=this._minZ,t}getMinTo(t){t.x=this._minX,t.y=this._minY,t.z=this._minZ}setMin(t){return this._minX=t.x,this._minY=t.y,this._minZ=t.z,this}getMax(){let t=new oimo.common.Vec3;return t.x=this._maxX,t.y=this._maxY,t.z=this._maxZ,t}getMaxTo(t){t.x=this._maxX,t.y=this._maxY,t.z=this._maxZ}setMax(t){return this._maxX=t.x,this._maxY=t.y,this._maxZ=t.z,this}getCenter(){let t,i,o,s=new oimo.common.Vec3;return t=this._minX+this._maxX,i=this._minY+this._maxY,o=this._minZ+this._maxZ,t*=.5,i*=.5,o*=.5,s.x=t,s.y=i,s.z=o,s}getCenterTo(t){let i,o,s;i=this._minX+this._maxX,o=this._minY+this._maxY,s=this._minZ+this._maxZ,i*=.5,o*=.5,s*=.5,t.x=i,t.y=o,t.z=s}getExtents(){let t,i,o,s=new oimo.common.Vec3;return t=this._maxX-this._minX,i=this._maxY-this._minY,o=this._maxZ-this._minZ,t*=.5,i*=.5,o*=.5,s.x=t,s.y=i,s.z=o,s}getExtentsTo(t){let i,o,s;i=this._maxX-this._minX,o=this._maxY-this._minY,s=this._maxZ-this._minZ,i*=.5,o*=.5,s*=.5,t.x=i,t.y=o,t.z=s}combine(t){return this._minX=this._minX<t._minX?this._minX:t._minX,this._minY=this._minY<t._minY?this._minY:t._minY,this._minZ=this._minZ<t._minZ?this._minZ:t._minZ,this._maxX=this._maxX>t._maxX?this._maxX:t._maxX,this._maxY=this._maxY>t._maxY?this._maxY:t._maxY,this._maxZ=this._maxZ>t._maxZ?this._maxZ:t._maxZ,this}combined(t){let i=new oimo.collision.geometry.Aabb;return i._minX=this._minX<t._minX?this._minX:t._minX,i._minY=this._minY<t._minY?this._minY:t._minY,i._minZ=this._minZ<t._minZ?this._minZ:t._minZ,i._maxX=this._maxX>t._maxX?this._maxX:t._maxX,i._maxY=this._maxY>t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ>t._maxZ?this._maxZ:t._maxZ,i}overlap(t){return this._minX<t._maxX&&this._maxX>t._minX&&this._minY<t._maxY&&this._maxY>t._minY&&this._minZ<t._maxZ&&this._maxZ>t._minZ}getIntersection(t){let i=new oimo.collision.geometry.Aabb;return i._minX=this._minX>t._minX?this._minX:t._minX,i._minY=this._minY>t._minY?this._minY:t._minY,i._minZ=this._minZ>t._minZ?this._minZ:t._minZ,i._maxX=this._maxX<t._maxX?this._maxX:t._maxX,i._maxY=this._maxY<t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ<t._maxZ?this._maxZ:t._maxZ,i}getIntersectionTo(t,i){i._minX=this._minX>t._minX?this._minX:t._minX,i._minY=this._minY>t._minY?this._minY:t._minY,i._minZ=this._minZ>t._minZ?this._minZ:t._minZ,i._maxX=this._maxX<t._maxX?this._maxX:t._maxX,i._maxY=this._maxY<t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ<t._maxZ?this._maxZ:t._maxZ}copyFrom(t){return this._minX=t._minX,this._minY=t._minY,this._minZ=t._minZ,this._maxX=t._maxX,this._maxY=t._maxY,this._maxZ=t._maxZ,this}clone(){let t=new oimo.collision.geometry.Aabb;return t._minX=this._minX,t._minY=this._minY,t._minZ=this._minZ,t._maxX=this._maxX,t._maxY=this._maxY,t._maxZ=this._maxZ,t}},oimo.collision.geometry.BoxGeometry=class extends oimo.collision.geometry.ConvexGeometry{constructor(t){super(1),this._halfExtentsX=t.x,this._halfExtentsY=t.y,this._halfExtentsZ=t.z,this._halfAxisXX=t.x,this._halfAxisXY=0,this._halfAxisXZ=0,this._halfAxisYX=0,this._halfAxisYY=t.y,this._halfAxisYZ=0,this._halfAxisZX=0,this._halfAxisZY=0,this._halfAxisZZ=t.z,this._updateMass();let i=t.x<t.y?t.z<t.x?t.z:t.x:t.z<t.y?t.z:t.y;this._gjkMargin>.2*i&&(this._gjkMargin=.2*i)}getHalfExtents(){let t=new oimo.common.Vec3;return t.x=this._halfExtentsX,t.y=this._halfExtentsY,t.z=this._halfExtentsZ,t}getHalfExtentsTo(t){t.x=this._halfExtentsX,t.y=this._halfExtentsY,t.z=this._halfExtentsZ}_updateMass(){let t,i,o;this._volume=this._halfExtentsX*this._halfExtentsY*this._halfExtentsZ*8,t=this._halfExtentsX*this._halfExtentsX,i=this._halfExtentsY*this._halfExtentsY,o=this._halfExtentsZ*this._halfExtentsZ,this._inertiaCoeff00=.3333333333333333*(i+o),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(o+t),this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(t+i)}_computeAabb(t,i){let o,s,a,n,e,r,_,l,h,c,m,b,x,p,f,u,v,X,y,g,d;c=i._rotation00*this._halfAxisXX+i._rotation01*this._halfAxisXY+i._rotation02*this._halfAxisXZ,m=i._rotation10*this._halfAxisXX+i._rotation11*this._halfAxisXY+i._rotation12*this._halfAxisXZ,b=i._rotation20*this._halfAxisXX+i._rotation21*this._halfAxisXY+i._rotation22*this._halfAxisXZ,o=c,s=m,a=b,x=i._rotation00*this._halfAxisYX+i._rotation01*this._halfAxisYY+i._rotation02*this._halfAxisYZ,p=i._rotation10*this._halfAxisYX+i._rotation11*this._halfAxisYY+i._rotation12*this._halfAxisYZ,f=i._rotation20*this._halfAxisYX+i._rotation21*this._halfAxisYY+i._rotation22*this._halfAxisYZ,n=x,e=p,r=f,u=i._rotation00*this._halfAxisZX+i._rotation01*this._halfAxisZY+i._rotation02*this._halfAxisZZ,v=i._rotation10*this._halfAxisZX+i._rotation11*this._halfAxisZY+i._rotation12*this._halfAxisZZ,X=i._rotation20*this._halfAxisZX+i._rotation21*this._halfAxisZY+i._rotation22*this._halfAxisZZ,_=u,l=v,h=X,o<0&&(o=-o),s<0&&(s=-s),a<0&&(a=-a),n<0&&(n=-n),e<0&&(e=-e),r<0&&(r=-r),_<0&&(_=-_),l<0&&(l=-l),h<0&&(h=-h),y=o+n,g=s+e,d=a+r,y+=_,g+=l,d+=h,t._minX=i._positionX-y,t._minY=i._positionY-g,t._minZ=i._positionZ-d,t._maxX=i._positionX+y,t._maxY=i._positionY+g,t._maxZ=i._positionZ+d}computeLocalSupportingVertex(t,i){let o,s,a,n,e,r;o=this._gjkMargin,s=this._gjkMargin,a=this._gjkMargin,o<this._halfExtentsX||(o=this._halfExtentsX),s<this._halfExtentsY||(s=this._halfExtentsY),a<this._halfExtentsZ||(a=this._halfExtentsZ),n=this._halfExtentsX-o,e=this._halfExtentsY-s,r=this._halfExtentsZ-a,i.x=t.x>0?n:-n,i.y=t.y>0?e:-e,i.z=t.z>0?r:-r}_rayCastLocal(t,i,o,s,a,n,e){let r=this._halfExtentsX,_=this._halfExtentsY,l=this._halfExtentsZ,h=s-t,c=a-i,m=n-o,b=0,x=0,p=0,f=1,u=1,v=1;if(h>-1e-6&&h<1e-6){if(t<=-r||t>=r)return!1}else{let i=1/h,o=(-r-t)*i,s=(r-t)*i;if(o>s){let t=o;o=s,s=t}o>0&&(b=o),s<1&&(f=s)}if(c>-1e-6&&c<1e-6){if(i<=-_||i>=_)return!1}else{let t=1/c,o=(-_-i)*t,s=(_-i)*t;if(o>s){let t=o;o=s,s=t}o>0&&(x=o),s<1&&(u=s)}if(m>-1e-6&&m<1e-6){if(o<=-l||o>=l)return!1}else{let t=1/m,i=(-l-o)*t,s=(l-o)*t;if(i>s){let t=i;i=s,s=t}i>0&&(p=i),s<1&&(v=s)}if(b>=1||x>=1||p>=1||f<=0||u<=0||v<=0)return!1;let X=b,y=f,g=0;if(x>X&&(X=x,g=1),p>X&&(X=p,g=2),u<y&&(y=u),v<y&&(y=v),X>y)return!1;if(0==X)return!1;switch(g){case 0:e.normal.init(h>0?-1:1,0,0);break;case 1:e.normal.init(0,c>0?-1:1,0);break;case 2:e.normal.init(0,0,m>0?-1:1)}return e.position.init(t+X*h,i+X*c,o+X*m),e.fraction=X,!0}},oimo.collision.geometry.CapsuleGeometry=class extends oimo.collision.geometry.ConvexGeometry{constructor(t,i){super(4),this._radius=t,this._halfHeight=i,this._gjkMargin=this._radius,this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){let t=this._radius*this._radius,i=this._halfHeight*this._halfHeight,o=6.28318530717958*t*this._halfHeight,s=3.14159265358979*t*this._radius*4/3;this._volume=o+s;let a=0==this._volume?0:1/this._volume,n=a*(o*(.25*t+i/3)+s*(.4*t+this._halfHeight*this._radius*.75+i));this._inertiaCoeff00=n,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=a*(o*t*.5+s*t*.4),this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=n}_computeAabb(t,i){let o,s,a,n,e,r;o=this._radius,s=this._radius,a=this._radius,n=i._rotation01,e=i._rotation11,r=i._rotation21,n<0&&(n=-n),e<0&&(e=-e),r<0&&(r=-r),n*=this._halfHeight,e*=this._halfHeight,r*=this._halfHeight,o+=n,s+=e,a+=r,t._minX=i._positionX-o,t._minY=i._positionY-s,t._minZ=i._positionZ-a,t._maxX=i._positionX+o,t._maxY=i._positionY+s,t._maxZ=i._positionZ+a}computeLocalSupportingVertex(t,i){t.y>0?i.init(0,this._halfHeight,0):i.init(0,-this._halfHeight,0)}_rayCastLocal(t,i,o,s,a,n,e){let r,_=this._halfHeight,l=s-t,h=n-o,c=0,m=l*l+h*h,b=t*l+o*h,x=t*t+o*o-this._radius*this._radius,p=b*b-m*x;if(p<0)return!1;if(m>0){let t=Math.sqrt(p);if(c=(-b-t)/m,r=(-b+t)/m,c>=1||r<=0)return!1}else{if(x>=0)return!1;c=0}let f,u,v,X,y,g,d,Y,z,Z,M=i+(a-i)*c;if(M>-_&&M<_){if(c>0){f=c;let i=e.normal.init(t+l*f,0,o+h*f),s=Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z);return s>0&&(s=1/s),i.x*=s,i.y*=s,i.z*=s,e.position.init(t+f*l,M,o+f*h),e.fraction=f,!0}return!1}if(u=0,v=M<0?-_:_,X=0,y=t-0,g=i-v,d=o-0,Y=s-t,z=a-i,Z=n-o,m=Y*Y+z*z+Z*Z,b=y*Y+g*z+d*Z,x=y*y+g*g+d*d-this._radius*this._radius,p=b*b-m*x,p<0)return!1;let I,V,L,w,k,B,A=(-b-Math.sqrt(p))/m;if(A<0||A>1)return!1;I=y+Y*A,V=g+z*A,L=d+Z*A;let P=I*I+V*V+L*L;P>0&&(P=1/Math.sqrt(P)),w=I*P,k=V*P,B=L*P,I+=0,V+=v,L+=0;let S=e.position;S.x=I,S.y=V,S.z=L;let T=e.normal;return T.x=w,T.y=k,T.z=B,e.fraction=A,!0}},oimo.collision.geometry.ConeGeometry=class extends oimo.collision.geometry.ConvexGeometry{constructor(t,i){super(3),this._radius=t,this._halfHeight=i,this.sinTheta=t/Math.sqrt(t*t+4*i*i),this.cosTheta=2*i/Math.sqrt(t*t+4*i*i),this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){let t=this._radius*this._radius,i=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*t*this._halfHeight*2/3,this._inertiaCoeff00=.05*(3*t+2*i),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3*t,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.05*(3*t+2*i)}_computeAabb(t,i){let o,s,a,n,e,r,_,l,h,c,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z;o=i._rotation01,s=i._rotation11,a=i._rotation21,n=o*o,e=s*s,r=a*a,c=Math.sqrt(1-n),m=Math.sqrt(1-e),b=Math.sqrt(1-r),c*=this._radius,m*=this._radius,b*=this._radius,_=o*this._halfHeight,l=s*this._halfHeight,h=a*this._halfHeight,x=-_,p=-l,f=-h,x-=c,p-=m,f-=b,u=-_,v=-l,X=-h,u+=c,v+=m,X+=b,y=x>u?x:u,g=p>v?p:v,d=f>X?f:X,y>_||(y=_),g>l||(g=l),d>h||(d=h),Y=x<u?x:u,z=p<v?p:v,Z=f<X?f:X,Y<_||(Y=_),z<l||(z=l),Z<h||(Z=h),t._minX=i._positionX+Y,t._minY=i._positionY+z,t._minZ=i._positionZ+Z,t._maxX=i._positionX+y,t._maxY=i._positionY+g,t._maxZ=i._positionZ+d}computeLocalSupportingVertex(t,i){let o=t.x,s=t.y,a=t.z;if(s>0&&s*s>this.sinTheta*this.sinTheta*(o*o+s*s+a*a))return i.init(0,this._halfHeight-this._gjkMargin/this.sinTheta,0),void(i.y<0&&(i.y=0));let n=t.x,e=t.z,r=n*n+e*e,_=2*this._halfHeight,l=(_-this._gjkMargin)/_*this._radius-this._gjkMargin/this.cosTheta;l<0&&(l=0);let h=r>0?l/Math.sqrt(r):0,c=this._halfHeight-this._gjkMargin;c<0&&(c=0),i.x=n*h,i.y=-c,i.z=e*h}_rayCastLocal(t,i,o,s,a,n,e){let r,_=this._halfHeight,l=s-t,h=a-i,c=n-o,m=0,b=1;if(h>-1e-6&&h<1e-6){if(i<=-_||i>=_)return!1}else{let t=1/h,o=(-_-i)*t,s=(_-i)*t;if(o>s){let t=o;o=s,s=t}o>0&&(m=o),s<1&&(b=s)}if(m>=1||b<=0)return!1;let x=0,p=0;r=i-_;let f,u=this.cosTheta*this.cosTheta,v=u*(l*l+h*h+c*c)-h*h,X=u*(t*l+r*h+o*c)-r*h,y=u*(t*t+r*r+o*o)-r*r,g=X*X-v*y;if(0!=v){if(g<0)return!1;let t=Math.sqrt(g);if(v<0){if(h>0){if(x=0,p=(-X+t)/v,p<=0)return!1}else if(x=(-X-t)/v,p=1,x>=1)return!1}else if(x=(-X-t)/v,p=(-X+t)/v,x>=1||p<=0)return!1}else{let t=-y/(2*X);if(X>0){if(x=0,p=t,t<=0)return!1}else if(x=t,p=1,t>=1)return!1}if(r+=_,p<=m||b<=x)return!1;if(x<m){if(f=m,0==f)return!1;e.normal.init(0,h>0?-1:1,0)}else{if(f=x,0==f)return!1;let i=e.normal.init(t+l*f,0,o+c*f),s=Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z);s>0&&(s=1/s),i.x*=s,i.y*=s,i.z*=s;let a=this.cosTheta;i.x*=a,i.y*=a,i.z*=a,e.normal.y+=this.sinTheta}return e.position.init(t+f*l,r+f*h,o+f*c),e.fraction=f,!0}},oimo.collision.geometry.ConvexHullGeometry=class extends oimo.collision.geometry.ConvexGeometry{constructor(t){super(5),this._numVertices=t.length,this._vertices=new Array(this._numVertices),this._tmpVertices=new Array(this._numVertices);let i=0,o=this._numVertices;for(;i<o;){let o=i++;this._vertices[o]=t[o],this._tmpVertices[o]=new oimo.common.Vec3}this._useGjkRayCast=!0,this._updateMass()}getVertices(){return this._vertices}_updateMass(){this._volume=1,this._inertiaCoeff00=1,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=1,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=1;let t=this._vertices[0].x,i=this._vertices[0].y,o=this._vertices[0].z,s=this._vertices[0].x,a=this._vertices[0].y,n=this._vertices[0].z,e=1,r=this._numVertices;for(;e<r;){let r=e++,_=this._vertices[r].x,l=this._vertices[r].y,h=this._vertices[r].z;_<t?t=_:_>s&&(s=_),l<i?i=l:l>a&&(a=l),h<o?o=h:h>n&&(n=h)}let _=s-t,l=a-i,h=n-o;this._volume=_*l*h;let c=.25*((t+s)*(t+s)+(i+a)*(i+a)+(o+n)*(o+n));_=_*_*.25,l=l*l*.25,h=h*h*.25,this._inertiaCoeff00=.3333333333333333*(l+h)+c,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(h+_)+c,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(_+l)+c}_computeAabb(t,i){let o,s,a,n,e,r,_,l,h,c,m,b;_=this._gjkMargin,l=this._gjkMargin,h=this._gjkMargin;let x,p,f,u,v,X,y=this._vertices[0];c=y.x,m=y.y,b=y.z,u=i._rotation00*c+i._rotation01*m+i._rotation02*b,v=i._rotation10*c+i._rotation11*m+i._rotation12*b,X=i._rotation20*c+i._rotation21*m+i._rotation22*b,x=u,p=v,f=X,x+=i._positionX,p+=i._positionY,f+=i._positionZ,o=x,s=p,a=f,n=x,e=p,r=f;let g=1,d=this._numVertices;for(;g<d;){let t,_,l,h=this._vertices[g++];c=h.x,m=h.y,b=h.z,t=i._rotation00*c+i._rotation01*m+i._rotation02*b,_=i._rotation10*c+i._rotation11*m+i._rotation12*b,l=i._rotation20*c+i._rotation21*m+i._rotation22*b,x=t,p=_,f=l,x+=i._positionX,p+=i._positionY,f+=i._positionZ,o<x||(o=x),s<p||(s=p),a<f||(a=f),n>x||(n=x),e>p||(e=p),r>f||(r=f)}t._minX=o-_,t._minY=s-l,t._minZ=a-h,t._maxX=n+_,t._maxY=e+l,t._maxZ=r+h}computeLocalSupportingVertex(t,i){let o=this._vertices[0],s=o.x*t.x+o.y*t.y+o.z*t.z,a=0,n=1,e=this._numVertices;for(;n<e;){let i=n++,o=this._vertices[i],e=o.x*t.x+o.y*t.y+o.z*t.z;e>s&&(s=e,a=i)}let r=this._vertices[a];i.x=r.x,i.y=r.y,i.z=r.z}},oimo.collision.geometry.CylinderGeometry=class extends oimo.collision.geometry.ConvexGeometry{constructor(t,i){super(2),this._radius=t,this._halfHeight=i,this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){let t=this._radius*this._radius,i=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*t*this._halfHeight*2,this._inertiaCoeff00=.08333333333333333*(3*t+i),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.5*t,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.08333333333333333*(3*t+i)}_computeAabb(t,i){let o,s,a,n,e,r,_,l,h,c,m,b,x,p,f;o=i._rotation01,s=i._rotation11,a=i._rotation21,o<0&&(o=-o),s<0&&(s=-s),a<0&&(a=-a),n=o*o,e=s*s,r=a*a,c=Math.sqrt(1-n),m=Math.sqrt(1-e),b=Math.sqrt(1-r),c*=this._radius,m*=this._radius,b*=this._radius,_=o*this._halfHeight,l=s*this._halfHeight,h=a*this._halfHeight,x=c+_,p=m+l,f=b+h,t._minX=i._positionX-x,t._minY=i._positionY-p,t._minZ=i._positionZ-f,t._maxX=i._positionX+x,t._maxY=i._positionY+p,t._maxZ=i._positionZ+f}computeLocalSupportingVertex(t,i){let o=t.x,s=t.z,a=o*o+s*s,n=this._radius-this._gjkMargin;n<0&&(n=0);let e=a>0?n/Math.sqrt(a):0,r=this._halfHeight-this._gjkMargin;r<0&&(r=0),i.x=o*e,i.y=t.y>0?r:-r,i.z=s*e}_rayCastLocal(t,i,o,s,a,n,e){let r=this._halfHeight,_=s-t,l=a-i,h=n-o,c=0,m=1;if(l>-1e-6&&l<1e-6){if(i<=-r||i>=r)return!1}else{let t=1/l,o=(-r-i)*t,s=(r-i)*t;if(o>s){let t=o;o=s,s=t}o>0&&(c=o),s<1&&(m=s)}if(c>=1||m<=0)return!1;let b,x,p=0,f=_*_+h*h,u=t*_+o*h,v=t*t+o*o-this._radius*this._radius,X=u*u-f*v;if(X<0)return!1;if(f>0){let t=Math.sqrt(X);if(p=(-u-t)/f,b=(-u+t)/f,p>=1||b<=0)return!1}else{if(v>=0)return!1;p=0,b=1}if(b<=c||m<=p)return!1;if(p<c){if(x=c,0==x)return!1;e.normal.init(0,l>0?-1:1,0)}else{if(x=p,0==x)return!1;let i=e.normal.init(t+_*x,0,o+h*x),s=Math.sqrt(i.x*i.x+i.y*i.y+i.z*i.z);s>0&&(s=1/s),i.x*=s,i.y*=s,i.z*=s}return e.position.init(t+x*_,i+x*l,o+x*h),e.fraction=x,!0}},oimo.collision.geometry.GeometryType=class{},oimo.collision.geometry.RayCastHit=class{constructor(){this.position=new oimo.common.Vec3,this.normal=new oimo.common.Vec3,this.fraction=0}},oimo.collision.geometry.SphereGeometry=class extends oimo.collision.geometry.ConvexGeometry{constructor(t){super(0),this._radius=t,this._gjkMargin=this._radius,this._updateMass()}getRadius(){return this._radius}_updateMass(){this._volume=4.188790204786386*this._radius*this._radius*this._radius,this._inertiaCoeff00=.4*this._radius*this._radius,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.4*this._radius*this._radius,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.4*this._radius*this._radius}_computeAabb(t,i){let o,s,a;o=this._radius,s=this._radius,a=this._radius,t._minX=i._positionX-o,t._minY=i._positionY-s,t._minZ=i._positionZ-a,t._maxX=i._positionX+o,t._maxY=i._positionY+s,t._maxZ=i._positionZ+a}computeLocalSupportingVertex(t,i){i.zero()}_rayCastLocal(t,i,o,s,a,n,e){let r,_,l;r=s-t,_=a-i,l=n-o;let h=r*r+_*_+l*l,c=t*r+i*_+o*l,m=c*c-h*(t*t+i*i+o*o-this._radius*this._radius);if(m<0)return!1;let b,x,p,f,u,v,X=(-c-Math.sqrt(m))/h;if(X<0||X>1)return!1;b=t+r*X,x=i+_*X,p=o+l*X;let y=b*b+x*x+p*p;y>0&&(y=1/Math.sqrt(y)),f=b*y,u=x*y,v=p*y;let g=e.position;g.x=b,g.y=x,g.z=p;let d=e.normal;return d.x=f,d.y=u,d.z=v,e.fraction=X,!0}},oimo.collision.narrowphase||(oimo.collision.narrowphase={}),oimo.collision.narrowphase.CollisionMatrix=class{constructor(){this.detectors=new Array(8),this.detectors[0]=new Array(8),this.detectors[1]=new Array(8),this.detectors[2]=new Array(8),this.detectors[3]=new Array(8),this.detectors[4]=new Array(8),this.detectors[5]=new Array(8);let t=new oimo.collision.narrowphase.detector.GjkEpaDetector;this.detectors[0][0]=new oimo.collision.narrowphase.detector.SphereSphereDetector,this.detectors[0][1]=new oimo.collision.narrowphase.detector.SphereBoxDetector(!1),this.detectors[0][2]=t,this.detectors[0][3]=t,this.detectors[0][4]=new oimo.collision.narrowphase.detector.SphereCapsuleDetector(!1),this.detectors[0][5]=t,this.detectors[1][0]=new oimo.collision.narrowphase.detector.SphereBoxDetector(!0),this.detectors[1][1]=new oimo.collision.narrowphase.detector.BoxBoxDetector,this.detectors[1][2]=t,this.detectors[1][3]=t,this.detectors[1][4]=t,this.detectors[1][5]=t,this.detectors[2][0]=t,this.detectors[2][1]=t,this.detectors[2][2]=t,this.detectors[2][3]=t,this.detectors[2][4]=t,this.detectors[2][5]=t,this.detectors[3][0]=t,this.detectors[3][1]=t,this.detectors[3][2]=t,this.detectors[3][3]=t,this.detectors[3][4]=t,this.detectors[3][5]=t,this.detectors[4][0]=new oimo.collision.narrowphase.detector.SphereCapsuleDetector(!0),this.detectors[4][1]=t,this.detectors[4][2]=t,this.detectors[4][3]=t,this.detectors[4][4]=new oimo.collision.narrowphase.detector.CapsuleCapsuleDetector,this.detectors[4][5]=t,this.detectors[5][0]=t,this.detectors[5][1]=t,this.detectors[5][2]=t,this.detectors[5][3]=t,this.detectors[5][4]=t,this.detectors[5][5]=t}getDetector(t,i){return this.detectors[t][i]}},oimo.collision.narrowphase.DetectorResult=class{constructor(){this.numPoints=0,this.normal=new oimo.common.Vec3,this.points=new Array(oimo.common.Setting.maxManifoldPoints),this.incremental=!1;let t=0,i=oimo.common.Setting.maxManifoldPoints;for(;t<i;)this.points[t++]=new oimo.collision.narrowphase.DetectorResultPoint}getMaxDepth(){let t=0,i=0,o=this.numPoints;for(;i<o;){let o=i++;this.points[o].depth>t&&(t=this.points[o].depth)}return t}clear(){this.numPoints=0;let t=0,i=this.points;for(;t<i.length;){let o=i[t];++t,o.position1.zero(),o.position2.zero(),o.depth=0,o.id=0}this.normal.zero()}},oimo.collision.narrowphase.DetectorResultPoint=class{constructor(){this.position1=new oimo.common.Vec3,this.position2=new oimo.common.Vec3,this.depth=0,this.id=0}},oimo.collision.narrowphase.detector||(oimo.collision.narrowphase.detector={}),oimo.collision.narrowphase.detector.Detector=class{constructor(t){this.swapped=t}setNormal(t,i,o,s){let a=t.normal;if(a.x=i,a.y=o,a.z=s,this.swapped){let i=t.normal;i.x=-i.x,i.y=-i.y,i.z=-i.z}}addPoint(t,i,o,s,a,n,e,r,_){let l=t.points[t.numPoints++];if(l.depth=r,l.id=_,this.swapped){let t=l.position1;t.x=a,t.y=n,t.z=e;let r=l.position2;r.x=i,r.y=o,r.z=s}else{let t=l.position1;t.x=i,t.y=o,t.z=s;let r=l.position2;r.x=a,r.y=n,r.z=e}}detectImpl(t,i,o,s,a,n){}detect(t,i,o,s,a,n){t.numPoints=0;let e=0,r=t.points;for(;e<r.length;){let t=r[e];++e,t.position1.zero(),t.position2.zero(),t.depth=0,t.id=0}t.normal.zero(),this.swapped?this.detectImpl(t,o,i,a,s,n):this.detectImpl(t,i,o,s,a,n)}},oimo.collision.narrowphase.detector.BoxBoxDetector=class extends oimo.collision.narrowphase.detector.Detector{constructor(){super(!1),this.clipper=new oimo.collision.narrowphase.detector._BoxBoxDetector.FaceClipper}detectImpl(t,i,o,s,a,n){let e,r,_,l,h,c,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A=i,P=o;t.incremental=!1,e=s._positionX,r=s._positionY,_=s._positionZ,l=a._positionX,h=a._positionY,c=a._positionZ,m=l-e,b=h-r,x=c-_,p=s._rotation00,f=s._rotation10,u=s._rotation20,v=s._rotation01,X=s._rotation11,y=s._rotation21,g=s._rotation02,d=s._rotation12,Y=s._rotation22,z=a._rotation00,Z=a._rotation10,M=a._rotation20,I=a._rotation01,V=a._rotation11,L=a._rotation21,w=a._rotation02,k=a._rotation12,B=a._rotation22;let S,T,C,j,R,q,E,D,F,N,W,G,J,O,H,U,Q,K,$=A._halfExtentsX,tt=A._halfExtentsY,it=A._halfExtentsZ,ot=P._halfExtentsX,st=P._halfExtentsY,at=P._halfExtentsZ;S=p*$,T=f*$,C=u*$,j=v*tt,R=X*tt,q=y*tt,E=g*it,D=d*it,F=Y*it,N=z*ot,W=Z*ot,G=M*ot,J=I*st,O=V*st,H=L*st,U=w*at,Q=k*at,K=B*at;let nt,et,rt,_t=Infinity,lt=-1,ht=0;nt=0,et=0,rt=0;let ct=$,mt=p*N+f*W+u*G,bt=p*J+f*O+u*H,xt=p*U+f*Q+u*K;mt<0&&(mt=-mt),bt<0&&(bt=-bt),xt<0&&(xt=-xt);let pt=mt+bt+xt,ft=p*m+f*b+u*x,ut=ct+pt,vt=ft<0,Xt=vt?-ft:ft;if(!(Xt<ut))return;{let t=ut-Xt;t<Infinity&&(_t=t,lt=0,nt=p,et=f,rt=u,ht=vt?-1:1)}ct=tt;let yt=v*N+X*W+y*G,gt=v*J+X*O+y*H,dt=v*U+X*Q+y*K;yt<0&&(yt=-yt),gt<0&&(gt=-gt),dt<0&&(dt=-dt),pt=yt+gt+dt,ft=v*m+X*b+y*x;let Yt=ct+pt,zt=ft<0,Zt=zt?-ft:ft;if(!(Zt<Yt))return;{let t=Yt-Zt;t<_t&&(_t=t,lt=1,nt=v,et=X,rt=y,ht=zt?-1:1)}ct=it;let Mt=g*N+d*W+Y*G,It=g*J+d*O+Y*H,Vt=g*U+d*Q+Y*K;Mt<0&&(Mt=-Mt),It<0&&(It=-It),Vt<0&&(Vt=-Vt),pt=Mt+It+Vt,ft=g*m+d*b+Y*x;let Lt=ct+pt,wt=ft<0,kt=wt?-ft:ft;if(!(kt<Lt))return;{let t=Lt-kt;t<_t&&(_t=t,lt=2,nt=g,et=d,rt=Y,ht=wt?-1:1)}_t>oimo.common.Setting.linearSlop?_t-=oimo.common.Setting.linearSlop:_t=0;let Bt=z*S+Z*T+M*C,At=z*j+Z*R+M*q,Pt=z*E+Z*D+M*F;Bt<0&&(Bt=-Bt),At<0&&(At=-At),Pt<0&&(Pt=-Pt),ct=Bt+At+Pt,pt=ot,ft=z*m+Z*b+M*x;let St=ct+pt,Tt=ft<0,Ct=Tt?-ft:ft;if(!(Ct<St))return;{let t=St-Ct;t<_t&&(_t=t,lt=3,nt=z,et=Z,rt=M,ht=Tt?-1:1)}let jt=I*S+V*T+L*C,Rt=I*j+V*R+L*q,qt=I*E+V*D+L*F;jt<0&&(jt=-jt),Rt<0&&(Rt=-Rt),qt<0&&(qt=-qt),ct=jt+Rt+qt,pt=st,ft=I*m+V*b+L*x;let Et=ct+pt,Dt=ft<0,Ft=Dt?-ft:ft;if(!(Ft<Et))return;{let t=Et-Ft;t<_t&&(_t=t,lt=4,nt=I,et=V,rt=L,ht=Dt?-1:1)}let Nt=w*S+k*T+B*C,Wt=w*j+k*R+B*q,Gt=w*E+k*D+B*F;Nt<0&&(Nt=-Nt),Wt<0&&(Wt=-Wt),Gt<0&&(Gt=-Gt),ct=Nt+Wt+Gt,pt=at,ft=w*m+k*b+B*x;let Jt,Ot,Ht,Ut,Qt,Kt,$t,ti,ii,oi,si,ai,ni,ei,ri,_i,li,hi,ci,mi,bi,xi=ct+pt,pi=ft<0,fi=pi?-ft:ft;if(!(fi<xi))return;{let t=xi-fi;t<_t&&(_t=t,lt=5,nt=w,et=k,rt=B,ht=pi?-1:1)}if(_t>oimo.common.Setting.linearSlop?_t-=oimo.common.Setting.linearSlop:_t=0,Jt=f*M-u*Z,Ot=u*z-p*M,Ht=p*Z-f*z,0!=Jt||0!=Ot||0!=Ht){let t=Jt*Jt+Ot*Ot+Ht*Ht;t>0&&(t=1/Math.sqrt(t)),Jt*=t,Ot*=t,Ht*=t;let i=Jt*j+Ot*R+Ht*q,o=Jt*E+Ot*D+Ht*F;i<0&&(i=-i),o<0&&(o=-o),ct=i+o;let s=Jt*J+Ot*O+Ht*H,a=Jt*U+Ot*Q+Ht*K;s<0&&(s=-s),a<0&&(a=-a),pt=s+a,ft=Jt*m+Ot*b+Ht*x;let n=ct+pt,e=ft<0,r=e?-ft:ft;if(!(r<n))return;{let t=n-r;t<_t&&(_t=t,lt=6,nt=Jt,et=Ot,rt=Ht,ht=e?-1:1)}}if(Jt=f*L-u*V,Ot=u*I-p*L,Ht=p*V-f*I,0!=Jt||0!=Ot||0!=Ht){let t=Jt*Jt+Ot*Ot+Ht*Ht;t>0&&(t=1/Math.sqrt(t)),Jt*=t,Ot*=t,Ht*=t;let i=Jt*j+Ot*R+Ht*q,o=Jt*E+Ot*D+Ht*F;i<0&&(i=-i),o<0&&(o=-o),ct=i+o;let s=Jt*N+Ot*W+Ht*G,a=Jt*U+Ot*Q+Ht*K;s<0&&(s=-s),a<0&&(a=-a),pt=s+a,ft=Jt*m+Ot*b+Ht*x;let n=ct+pt,e=ft<0,r=e?-ft:ft;if(!(r<n))return;{let t=n-r;t<_t&&(_t=t,lt=7,nt=Jt,et=Ot,rt=Ht,ht=e?-1:1)}}if(Jt=f*B-u*k,Ot=u*w-p*B,Ht=p*k-f*w,0!=Jt||0!=Ot||0!=Ht){let t=Jt*Jt+Ot*Ot+Ht*Ht;t>0&&(t=1/Math.sqrt(t)),Jt*=t,Ot*=t,Ht*=t;let i=Jt*j+Ot*R+Ht*q,o=Jt*E+Ot*D+Ht*F;i<0&&(i=-i),o<0&&(o=-o),ct=i+o;let s=Jt*N+Ot*W+Ht*G,a=Jt*J+Ot*O+Ht*H;s<0&&(s=-s),a<0&&(a=-a),pt=s+a,ft=Jt*m+Ot*b+Ht*x;let n=ct+pt,e=ft<0,r=e?-ft:ft;if(!(r<n))return;{let t=n-r;t<_t&&(_t=t,lt=8,nt=Jt,et=Ot,rt=Ht,ht=e?-1:1)}}if(Jt=X*M-y*Z,Ot=y*z-v*M,Ht=v*Z-X*z,0!=Jt||0!=Ot||0!=Ht){let t=Jt*Jt+Ot*Ot+Ht*Ht;t>0&&(t=1/Math.sqrt(t)),Jt*=t,Ot*=t,Ht*=t;let i=Jt*S+Ot*T+Ht*C,o=Jt*E+Ot*D+Ht*F;i<0&&(i=-i),o<0&&(o=-o),ct=i+o;let s=Jt*J+Ot*O+Ht*H,a=Jt*U+Ot*Q+Ht*K;s<0&&(s=-s),a<0&&(a=-a),pt=s+a,ft=Jt*m+Ot*b+Ht*x;let n=ct+pt,e=ft<0,r=e?-ft:ft;if(!(r<n))return;{let t=n-r;t<_t&&(_t=t,lt=9,nt=Jt,et=Ot,rt=Ht,ht=e?-1:1)}}if(Jt=X*L-y*V,Ot=y*I-v*L,Ht=v*V-X*I,0!=Jt||0!=Ot||0!=Ht){let t=Jt*Jt+Ot*Ot+Ht*Ht;t>0&&(t=1/Math.sqrt(t)),Jt*=t,Ot*=t,Ht*=t;let i=Jt*S+Ot*T+Ht*C,o=Jt*E+Ot*D+Ht*F;i<0&&(i=-i),o<0&&(o=-o),ct=i+o;let s=Jt*N+Ot*W+Ht*G,a=Jt*U+Ot*Q+Ht*K;s<0&&(s=-s),a<0&&(a=-a),pt=s+a,ft=Jt*m+Ot*b+Ht*x;let n=ct+pt,e=ft<0,r=e?-ft:ft;if(!(r<n))return;{let t=n-r;t<_t&&(_t=t,lt=10,nt=Jt,et=Ot,rt=Ht,ht=e?-1:1)}}if(Jt=X*B-y*k,Ot=y*w-v*B,Ht=v*k-X*w,0!=Jt||0!=Ot||0!=Ht){let t=Jt*Jt+Ot*Ot+Ht*Ht;t>0&&(t=1/Math.sqrt(t)),Jt*=t,Ot*=t,Ht*=t;let i=Jt*S+Ot*T+Ht*C,o=Jt*E+Ot*D+Ht*F;i<0&&(i=-i),o<0&&(o=-o),ct=i+o;let s=Jt*N+Ot*W+Ht*G,a=Jt*J+Ot*O+Ht*H;s<0&&(s=-s),a<0&&(a=-a),pt=s+a,ft=Jt*m+Ot*b+Ht*x;let n=ct+pt,e=ft<0,r=e?-ft:ft;if(!(r<n))return;{let t=n-r;t<_t&&(_t=t,lt=11,nt=Jt,et=Ot,rt=Ht,ht=e?-1:1)}}if(Jt=d*M-Y*Z,Ot=Y*z-g*M,Ht=g*Z-d*z,0!=Jt||0!=Ot||0!=Ht){let t=Jt*Jt+Ot*Ot+Ht*Ht;t>0&&(t=1/Math.sqrt(t)),Jt*=t,Ot*=t,Ht*=t;let i=Jt*S+Ot*T+Ht*C,o=Jt*j+Ot*R+Ht*q;i<0&&(i=-i),o<0&&(o=-o),ct=i+o;let s=Jt*J+Ot*O+Ht*H,a=Jt*U+Ot*Q+Ht*K;s<0&&(s=-s),a<0&&(a=-a),pt=s+a,ft=Jt*m+Ot*b+Ht*x;let n=ct+pt,e=ft<0,r=e?-ft:ft;if(!(r<n))return;{let t=n-r;t<_t&&(_t=t,lt=12,nt=Jt,et=Ot,rt=Ht,ht=e?-1:1)}}if(Jt=d*L-Y*V,Ot=Y*I-g*L,Ht=g*V-d*I,0!=Jt||0!=Ot||0!=Ht){let t=Jt*Jt+Ot*Ot+Ht*Ht;t>0&&(t=1/Math.sqrt(t)),Jt*=t,Ot*=t,Ht*=t;let i=Jt*S+Ot*T+Ht*C,o=Jt*j+Ot*R+Ht*q;i<0&&(i=-i),o<0&&(o=-o),ct=i+o;let s=Jt*N+Ot*W+Ht*G,a=Jt*U+Ot*Q+Ht*K;s<0&&(s=-s),a<0&&(a=-a),pt=s+a,ft=Jt*m+Ot*b+Ht*x;let n=ct+pt,e=ft<0,r=e?-ft:ft;if(!(r<n))return;{let t=n-r;t<_t&&(_t=t,lt=13,nt=Jt,et=Ot,rt=Ht,ht=e?-1:1)}}if(Jt=d*B-Y*k,Ot=Y*w-g*B,Ht=g*k-d*w,0!=Jt||0!=Ot||0!=Ht){let t=Jt*Jt+Ot*Ot+Ht*Ht;t>0&&(t=1/Math.sqrt(t)),Jt*=t,Ot*=t,Ht*=t;let i=Jt*S+Ot*T+Ht*C,o=Jt*j+Ot*R+Ht*q;i<0&&(i=-i),o<0&&(o=-o),ct=i+o;let s=Jt*N+Ot*W+Ht*G,a=Jt*J+Ot*O+Ht*H;s<0&&(s=-s),a<0&&(a=-a),pt=s+a,ft=Jt*m+Ot*b+Ht*x;let n=ct+pt,e=ft<0,r=e?-ft:ft;if(!(r<n))return;{let t=n-r;t<_t&&(_t=t,lt=14,nt=Jt,et=Ot,rt=Ht,ht=e?-1:1)}}if(lt>=6){nt*=ht,et*=ht,rt*=ht;let i,o,s,a,n,m,b,x,A,P,$,tt,it,ot,st,at=(lt-6)/3|0,ct=lt-6-3*at;switch(at){case 0:b=p,x=f,A=u;let t=E*nt+D*et+F*rt>0;j*nt+R*et+q*rt>0?t?(i=j+E,o=R+D,s=q+F):(i=j-E,o=R-D,s=q-F):t?(i=E-j,o=D-R,s=F-q):(i=j+E,o=R+D,s=q+F,i=-i,o=-o,s=-s);break;case 1:b=v,x=X,A=y;let a=E*nt+D*et+F*rt>0;S*nt+T*et+C*rt>0?a?(i=S+E,o=T+D,s=C+F):(i=S-E,o=T-D,s=C-F):a?(i=E-S,o=D-T,s=F-C):(i=S+E,o=T+D,s=C+F,i=-i,o=-o,s=-s);break;default:b=g,x=d,A=Y;let n=j*nt+R*et+q*rt>0;S*nt+T*et+C*rt>0?n?(i=S+j,o=T+R,s=C+q):(i=S-j,o=T-R,s=C-q):n?(i=j-S,o=R-T,s=q-C):(i=S+j,o=T+R,s=C+q,i=-i,o=-o,s=-s)}switch(i=e+i,o=r+o,s=_+s,ct){case 0:P=z,$=Z,tt=M;let t=U*nt+Q*et+K*rt>0;J*nt+O*et+H*rt>0?t?(a=J+U,n=O+Q,m=H+K):(a=J-U,n=O-Q,m=H-K):t?(a=U-J,n=Q-O,m=K-H):(a=J+U,n=O+Q,m=H+K,a=-a,n=-n,m=-m);break;case 1:P=I,$=V,tt=L;let i=U*nt+Q*et+K*rt>0;N*nt+W*et+G*rt>0?i?(a=N+U,n=W+Q,m=G+K):(a=N-U,n=W-Q,m=G-K):i?(a=U-N,n=Q-W,m=K-G):(a=N+U,n=W+Q,m=G+K,a=-a,n=-n,m=-m);break;default:P=w,$=k,tt=B;let o=J*nt+O*et+H*rt>0;N*nt+W*et+G*rt>0?o?(a=N+J,n=W+O,m=G+H):(a=N-J,n=W-O,m=G-H):o?(a=J-N,n=O-W,m=H-G):(a=N+J,n=W+O,m=G+H,a=-a,n=-n,m=-m)}a=l-a,n=h-n,m=c-m,it=i-a,ot=o-n,st=s-m;let mt,bt,xt,pt,ft,ut,vt,Xt,yt,gt=b*P+x*$+A*tt,dt=b*it+x*ot+A*st,Yt=P*it+$*ot+tt*st,zt=1/(1-gt*gt),Zt=(gt*Yt-dt)*zt,Mt=(Yt-gt*dt)*zt;return mt=i+b*Zt,bt=o+x*Zt,xt=s+A*Zt,pt=a+P*Mt,ft=n+$*Mt,ut=m+tt*Mt,vt=-nt,Xt=-et,yt=-rt,this.setNormal(t,vt,Xt,yt),void this.addPoint(t,mt,bt,xt,pt,ft,ut,_t,4)}switch(lt>=3?(ht=-ht,m=-m,b=-b,x=-x,$=ot,tt=st,it=at,e=l,r=h,_=c,Ut=p,Qt=f,Kt=u,p=z,f=Z,u=M,z=Ut,Z=Qt,M=Kt,Ut=v,Qt=X,Kt=y,v=I,X=V,y=L,I=Ut,V=Qt,L=Kt,Ut=g,Qt=d,Kt=Y,g=w,d=k,Y=B,w=Ut,k=Qt,B=Kt,Ut=S,Qt=T,Kt=C,S=N,T=W,C=G,N=Ut,W=Qt,G=Kt,Ut=j,Qt=R,Kt=q,j=J,R=O,q=H,J=Ut,O=Qt,H=Kt,Ut=E,Qt=D,Kt=F,E=U,D=Q,F=K,U=Ut,Q=Qt,K=Kt,lt-=3,$t=!0):$t=!1,lt){case 0:ti=S,ii=T,oi=C,si=p,ai=f,ni=u,ei=v,ri=X,_i=y,li=g,hi=d,ci=Y,mi=tt,bi=it;break;case 1:ti=j,ii=R,oi=q,si=v,ai=X,ni=y,ei=g,ri=d,_i=Y,li=p,hi=f,ci=u,mi=it,bi=$;break;default:ti=E,ii=D,oi=F,si=g,ai=d,ni=Y,ei=p,ri=f,_i=u,li=v,hi=X,ci=y,mi=$,bi=tt}if(ht<0){ti=-ti,ii=-ii,oi=-oi,si=-si,ai=-ai,ni=-ni,Ut=ei,Qt=ri,Kt=_i,ei=li,ri=hi,_i=ci,li=Ut,hi=Qt,ci=Kt;let t=mi;mi=bi,bi=t}ti+=e,ii+=r,oi+=_;let ui,vi,Xi,yi,gi,di,Yi,zi,Zi,Mi,Ii,Vi,Li=1,wi=0,ki=si*z+ai*Z+ni*M;switch(ki<Li&&(Li=ki,wi=0),-ki<Li&&(Li=-ki,wi=1),ki=si*I+ai*V+ni*L,ki<Li&&(Li=ki,wi=2),-ki<Li&&(Li=-ki,wi=3),ki=si*w+ai*k+ni*B,ki<Li&&(Li=ki,wi=4),-ki<Li&&(wi=5),wi){case 0:ui=N+J,vi=W+O,Xi=G+H,ui+=U,vi+=Q,Xi+=K,yi=N-J,gi=W-O,di=G-H,yi+=U,gi+=Q,di+=K,Yi=N-J,zi=W-O,Zi=G-H,Yi-=U,zi-=Q,Zi-=K,Mi=N+J,Ii=W+O,Vi=G+H,Mi-=U,Ii-=Q,Vi-=K;break;case 1:ui=J-N,vi=O-W,Xi=H-G,ui+=U,vi+=Q,Xi+=K,yi=J-N,gi=O-W,di=H-G,yi-=U,gi-=Q,di-=K,Yi=N+J,zi=W+O,Zi=G+H,Yi=-Yi,zi=-zi,Zi=-Zi,Yi-=U,zi-=Q,Zi-=K,Mi=N+J,Ii=W+O,Vi=G+H,Mi=-Mi,Ii=-Ii,Vi=-Vi,Mi+=U,Ii+=Q,Vi+=K;break;case 2:ui=N+J,vi=W+O,Xi=G+H,ui+=U,vi+=Q,Xi+=K,yi=N+J,gi=W+O,di=G+H,yi-=U,gi-=Q,di-=K,Yi=J-N,zi=O-W,Zi=H-G,Yi-=U,zi-=Q,Zi-=K,Mi=J-N,Ii=O-W,Vi=H-G,Mi+=U,Ii+=Q,Vi+=K;break;case 3:ui=N-J,vi=W-O,Xi=G-H,ui+=U,vi+=Q,Xi+=K,yi=N+J,gi=W+O,di=G+H,yi=-yi,gi=-gi,di=-di,yi+=U,gi+=Q,di+=K,Yi=N+J,zi=W+O,Zi=G+H,Yi=-Yi,zi=-zi,Zi=-Zi,Yi-=U,zi-=Q,Zi-=K,Mi=N-J,Ii=W-O,Vi=G-H,Mi-=U,Ii-=Q,Vi-=K;break;case 4:ui=N+J,vi=W+O,Xi=G+H,ui+=U,vi+=Q,Xi+=K,yi=J-N,gi=O-W,di=H-G,yi+=U,gi+=Q,di+=K,Yi=N+J,zi=W+O,Zi=G+H,Yi=-Yi,zi=-zi,Zi=-Zi,Yi+=U,zi+=Q,Zi+=K,Mi=N-J,Ii=W-O,Vi=G-H,Mi+=U,Ii+=Q,Vi+=K;break;default:ui=N+J,vi=W+O,Xi=G+H,ui-=U,vi-=Q,Xi-=K,yi=N-J,gi=W-O,di=G-H,yi-=U,gi-=Q,di-=K,Yi=N+J,zi=W+O,Zi=G+H,Yi=-Yi,zi=-zi,Zi=-Zi,Yi-=U,zi-=Q,Zi-=K,Mi=J-N,Ii=O-W,Vi=H-G,Mi-=U,Ii-=Q,Vi-=K}ui+=m,vi+=b,Xi+=x,yi+=m,gi+=b,di+=x,Yi+=m,zi+=b,Zi+=x,Mi+=m,Ii+=b,Vi+=x;let Bi=this.clipper;Bi.w=mi,Bi.h=bi,Bi.numVertices=0,Bi.numTmpVertices=0;let Ai=this.clipper,Pi=Ai.vertices[Ai.numVertices++];Pi.x=ui*ei+vi*ri+Xi*_i,Pi.y=ui*li+vi*hi+Xi*ci,Pi.wx=ui,Pi.wy=vi,Pi.wz=Xi;let Si=this.clipper,Ti=Si.vertices[Si.numVertices++];Ti.x=yi*ei+gi*ri+di*_i,Ti.y=yi*li+gi*hi+di*ci,Ti.wx=yi,Ti.wy=gi,Ti.wz=di;let Ci=this.clipper,ji=Ci.vertices[Ci.numVertices++];ji.x=Yi*ei+zi*ri+Zi*_i,ji.y=Yi*li+zi*hi+Zi*ci,ji.wx=Yi,ji.wy=zi,ji.wz=Zi;let Ri,qi,Ei,Di=this.clipper,Fi=Di.vertices[Di.numVertices++];Fi.x=Mi*ei+Ii*ri+Vi*_i,Fi.y=Mi*li+Ii*hi+Vi*ci,Fi.wx=Mi,Fi.wy=Ii,Fi.wz=Vi,this.clipper.clip(),this.clipper.reduce(),$t?(Ri=si,qi=ai,Ei=ni):(Ri=-si,qi=-ai,Ei=-ni),this.setNormal(t,Ri,qi,Ei);let Ni=0,Wi=this.clipper.numVertices;for(;Ni<Wi;){let i,o,s,a,n,l,h=Ni++,c=this.clipper.vertices[h];i=c.wx,o=c.wy,s=c.wz,i+=e,o+=r,s+=_,a=ti-i,n=ii-o,l=oi-s;let m,b,x,p=a*si+n*ai+l*ni;m=i+si*p,b=o+ai*p,x=s+ni*p,p>-oimo.common.Setting.contactPersistenceThreshold&&($t?this.addPoint(t,i,o,s,m,b,x,p,h):this.addPoint(t,m,b,x,i,o,s,p,h))}}},oimo.collision.narrowphase.detector._BoxBoxDetector||(oimo.collision.narrowphase.detector._BoxBoxDetector={}),oimo.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex=class{constructor(){this.x=0,this.y=0,this.wx=0,this.wy=0,this.wz=0}},oimo.collision.narrowphase.detector._BoxBoxDetector.FaceClipper=class{constructor(){this.w=0,this.h=0,this.numVertices=0,this.numTmpVertices=0,this.vertices=new Array(8),this.tmpVertices=new Array(8),this.vertices[0]=new oimo.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[0]=new oimo.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[1]=new oimo.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[1]=new oimo.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[2]=new oimo.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[2]=new oimo.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[3]=new oimo.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[3]=new oimo.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[4]=new oimo.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[4]=new oimo.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[5]=new oimo.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[5]=new oimo.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[6]=new oimo.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[6]=new oimo.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[7]=new oimo.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[7]=new oimo.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex}clip(){let t=0,i=this.numVertices;for(;t<i;){let i=t++,o=this.vertices[i],s=this.vertices[(i+1)%this.numVertices],a=this.w+o.x,n=this.w+s.x;if(a>0&&n>0){let t=this.tmpVertices[this.numTmpVertices++];t.x=o.x,t.y=o.y,t.wx=o.wx,t.wy=o.wy,t.wz=o.wz}else if(a>0&&n<=0){let t=this.tmpVertices[this.numTmpVertices++];t.x=o.x,t.y=o.y,t.wx=o.wx,t.wy=o.wy,t.wz=o.wz;let i=a/(a-n),e=this.tmpVertices[this.numTmpVertices++];e.x=o.x+(s.x-o.x)*i,e.y=o.y+(s.y-o.y)*i,e.wx=o.wx+(s.wx-o.wx)*i,e.wy=o.wy+(s.wy-o.wy)*i,e.wz=o.wz+(s.wz-o.wz)*i}else if(a<=0&&n>0){let t=a/(a-n),i=this.tmpVertices[this.numTmpVertices++];i.x=o.x+(s.x-o.x)*t,i.y=o.y+(s.y-o.y)*t,i.wx=o.wx+(s.wx-o.wx)*t,i.wy=o.wy+(s.wy-o.wy)*t,i.wz=o.wz+(s.wz-o.wz)*t}}let o=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=o,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;let s=0,a=this.numVertices;for(;s<a;){let t=s++,i=this.vertices[t],o=this.vertices[(t+1)%this.numVertices],a=this.w-i.x,n=this.w-o.x;if(a>0&&n>0){let t=this.tmpVertices[this.numTmpVertices++];t.x=i.x,t.y=i.y,t.wx=i.wx,t.wy=i.wy,t.wz=i.wz}else if(a>0&&n<=0){let t=this.tmpVertices[this.numTmpVertices++];t.x=i.x,t.y=i.y,t.wx=i.wx,t.wy=i.wy,t.wz=i.wz;let s=a/(a-n),e=this.tmpVertices[this.numTmpVertices++];e.x=i.x+(o.x-i.x)*s,e.y=i.y+(o.y-i.y)*s,e.wx=i.wx+(o.wx-i.wx)*s,e.wy=i.wy+(o.wy-i.wy)*s,e.wz=i.wz+(o.wz-i.wz)*s}else if(a<=0&&n>0){let t=a/(a-n),s=this.tmpVertices[this.numTmpVertices++];s.x=i.x+(o.x-i.x)*t,s.y=i.y+(o.y-i.y)*t,s.wx=i.wx+(o.wx-i.wx)*t,s.wy=i.wy+(o.wy-i.wy)*t,s.wz=i.wz+(o.wz-i.wz)*t}}let n=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=n,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;let e=0,r=this.numVertices;for(;e<r;){let t=e++,i=this.vertices[t],o=this.vertices[(t+1)%this.numVertices],s=this.h+i.y,a=this.h+o.y;if(s>0&&a>0){let t=this.tmpVertices[this.numTmpVertices++];t.x=i.x,t.y=i.y,t.wx=i.wx,t.wy=i.wy,t.wz=i.wz}else if(s>0&&a<=0){let t=this.tmpVertices[this.numTmpVertices++];t.x=i.x,t.y=i.y,t.wx=i.wx,t.wy=i.wy,t.wz=i.wz;let n=s/(s-a),e=this.tmpVertices[this.numTmpVertices++];e.x=i.x+(o.x-i.x)*n,e.y=i.y+(o.y-i.y)*n,e.wx=i.wx+(o.wx-i.wx)*n,e.wy=i.wy+(o.wy-i.wy)*n,e.wz=i.wz+(o.wz-i.wz)*n}else if(s<=0&&a>0){let t=s/(s-a),n=this.tmpVertices[this.numTmpVertices++];n.x=i.x+(o.x-i.x)*t,n.y=i.y+(o.y-i.y)*t,n.wx=i.wx+(o.wx-i.wx)*t,n.wy=i.wy+(o.wy-i.wy)*t,n.wz=i.wz+(o.wz-i.wz)*t}}let _=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=_,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;let l=0,h=this.numVertices;for(;l<h;){let t=l++,i=this.vertices[t],o=this.vertices[(t+1)%this.numVertices],s=this.h-i.y,a=this.h-o.y;if(s>0&&a>0){let t=this.tmpVertices[this.numTmpVertices++];t.x=i.x,t.y=i.y,t.wx=i.wx,t.wy=i.wy,t.wz=i.wz}else if(s>0&&a<=0){let t=this.tmpVertices[this.numTmpVertices++];t.x=i.x,t.y=i.y,t.wx=i.wx,t.wy=i.wy,t.wz=i.wz;let n=s/(s-a),e=this.tmpVertices[this.numTmpVertices++];e.x=i.x+(o.x-i.x)*n,e.y=i.y+(o.y-i.y)*n,e.wx=i.wx+(o.wx-i.wx)*n,e.wy=i.wy+(o.wy-i.wy)*n,e.wz=i.wz+(o.wz-i.wz)*n}else if(s<=0&&a>0){let t=s/(s-a),n=this.tmpVertices[this.numTmpVertices++];n.x=i.x+(o.x-i.x)*t,n.y=i.y+(o.y-i.y)*t,n.wx=i.wx+(o.wx-i.wx)*t,n.wy=i.wy+(o.wy-i.wy)*t,n.wz=i.wz+(o.wz-i.wz)*t}}let c=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=c,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}reduce(){if(this.numVertices<4)return;let t=-Infinity,i=Infinity,o=-Infinity,s=Infinity,a=null,n=null,e=null,r=null,_=0,l=this.numVertices;for(;_<l;){let l=this.vertices[_++],h=1*l.x+1*l.y,c=-1*l.x+1*l.y;h>t&&(t=h,a=l),h<i&&(i=h,n=l),c>o&&(o=c,e=l),c<s&&(s=c,r=l)}let h=this.tmpVertices[this.numTmpVertices++];h.x=a.x,h.y=a.y,h.wx=a.wx,h.wy=a.wy,h.wz=a.wz;let c=this.tmpVertices[this.numTmpVertices++];c.x=e.x,c.y=e.y,c.wx=e.wx,c.wy=e.wy,c.wz=e.wz;let m=this.tmpVertices[this.numTmpVertices++];m.x=n.x,m.y=n.y,m.wx=n.wx,m.wy=n.wy,m.wz=n.wz;let b=this.tmpVertices[this.numTmpVertices++];b.x=r.x,b.y=r.y,b.wx=r.wx,b.wy=r.wy,b.wz=r.wz;let x=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=x,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}},oimo.collision.narrowphase.detector.BoxBoxDetectorMacro=class{},oimo.collision.narrowphase.detector.CachedDetectorData=class{constructor(){}_clear(){null!=this._gjkCache&&this._gjkCache.clear()}},oimo.collision.narrowphase.detector.CapsuleCapsuleDetector=class extends oimo.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,i,o,s,a,n){let e,r,_,l,h,c,m=i,b=o;t.incremental=!1,e=s._rotation01,r=s._rotation11,_=s._rotation21,l=a._rotation01,h=a._rotation11,c=a._rotation21;let x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A,P,S=m._halfHeight,T=b._halfHeight,C=m._radius,j=b._radius;x=s._positionX+e*-S,p=s._positionY+r*-S,f=s._positionZ+_*-S,u=s._positionX+e*S,v=s._positionY+r*S,X=s._positionZ+_*S,y=a._positionX+l*-T,g=a._positionY+h*-T,d=a._positionZ+c*-T,Y=a._positionX+l*T,z=a._positionY+h*T,Z=a._positionZ+c*T,M=x-y,I=p-g,V=f-d,L=u-x,w=v-p,k=X-f,B=Y-y,A=z-g,P=Z-d;let R,q,E,D,F,N,W,G,J,O,H,U=-(M*L+I*w+V*k),Q=M*B+I*A+V*P,K=S*S*4,$=L*B+w*A+k*P,tt=T*T*4;if(0==K&&0==tt)R=0,q=0;else if(0==K)R=0,q=Q<0?0:Q>tt?1:Q/tt;else if(0==tt)q=0,R=U<0?0:U>K?1:U/K;else{let t=K*tt-$*$;0==t?R=0:(R=$*Q+tt*U,R<0?R=0:R>t?R=1:R/=t),q=R*$+Q,q<0?(q=0,R=U<0?0:U>K?1:U/K):q>tt?(q=1,R=$+U,R<0?R=0:R>K?R=1:R/=K):q/=tt}E=x+L*R,D=p+w*R,F=f+k*R,N=y+B*q,W=g+A*q,G=d+P*q,J=E-N,O=D-W,H=F-G;let it=J*J+O*O+H*H;if(it>=(C+j)*(C+j))return;let ot,st,at,nt,et,rt,_t,lt,ht,ct=Math.sqrt(it);ct>0?(ot=J*(1/ct),st=O*(1/ct),at=H*(1/ct)):(ot=1,st=0,at=0),this.setNormal(t,ot,st,at),nt=E+ot*-C,et=D+st*-C,rt=F+at*-C,_t=N+ot*j,lt=W+st*j,ht=G+at*j,this.addPoint(t,nt,et,rt,_t,lt,ht,C+j-ct,0)}},oimo.collision.narrowphase.detector.GjkEpaDetector=class extends oimo.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,i,o,s,a,n){let e,r,_,l,h,c,m=oimo.collision.narrowphase.detector.gjkepa.GjkEpa.instance,b=i,x=o,p=m.computeClosestPointsImpl(b,x,s,a,oimo.common.Setting.enableGJKCaching?n:null,!0);if(t.incremental=!0,p!=oimo.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED)return void console.log("src/oimo/collision/narrowphase/detector/GjkEpaDetector.hx:28:","GJK/EPA failed: status="+p);if(m.distance>b._gjkMargin+x._gjkMargin)return;let f=m.closestPoint1;e=f.x,r=f.y,_=f.z;let u,v,X,y=m.closestPoint2;if(l=y.x,h=y.y,c=y.z,u=e-l,v=r-h,X=_-c,u*u+v*v+X*X==0)return;m.distance<0&&(u=-u,v=-v,X=-X);let g=u*u+v*v+X*X;g>0&&(g=1/Math.sqrt(g)),u*=g,v*=g,X*=g,this.setNormal(t,u,v,X),e+=u*-b._gjkMargin,r+=v*-b._gjkMargin,_+=X*-b._gjkMargin,l+=u*x._gjkMargin,h+=v*x._gjkMargin,c+=X*x._gjkMargin,this.addPoint(t,e,r,_,l,h,c,b._gjkMargin+x._gjkMargin-m.distance,0)}},oimo.collision.narrowphase.detector.SphereBoxDetector=class extends oimo.collision.narrowphase.detector.Detector{constructor(t){super(t)}detectImpl(t,i,o,s,a,n){let e,r,_,l,h,c,m=o;t.incremental=!1,e=m._halfExtentsX,r=m._halfExtentsY,_=m._halfExtentsZ,l=-e,h=-r,c=-_;let b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V=i._radius;if(b=s._positionX-a._positionX,x=s._positionY-a._positionY,p=s._positionZ-a._positionZ,X=a._rotation00*b+a._rotation10*x+a._rotation20*p,y=a._rotation01*b+a._rotation11*x+a._rotation21*p,g=a._rotation02*b+a._rotation12*x+a._rotation22*p,f=X,u=y,v=g,l<f&&e>f&&h<u&&r>u&&c<v&&_>v){let i,o,n,l,h,c;i=f<0?-f:f,o=u<0?-u:u,n=v<0?-v:v,i=e-i,o=r-o,n=_-n;let m,b,x,p,X,y,g,d,Y,z,Z,M,I,L,w,k,B,A,P,S,T,C,j,R,q,E,D,F,N=i,W=o,G=n;return N<W?N<G?(f>0?(l=1,h=0,c=0):(l=-1,h=0,c=0),b=0,x=1,p=1,m=N):(v>0?(l=0,h=0,c=1):(l=0,h=0,c=-1),b=1,x=1,p=0,m=G):W<G?(u>0?(l=0,h=1,c=0):(l=0,h=-1,c=0),b=1,x=0,p=1,m=W):(v>0?(l=0,h=0,c=1):(l=0,h=0,c=-1),b=1,x=1,p=0,m=G),X=b*f,y=x*u,g=p*v,d=l*e,Y=h*r,z=c*_,d+=X,Y+=y,z+=g,B=a._rotation00*d+a._rotation01*Y+a._rotation02*z,A=a._rotation10*d+a._rotation11*Y+a._rotation12*z,P=a._rotation20*d+a._rotation21*Y+a._rotation22*z,Z=B,M=A,I=P,S=a._rotation00*l+a._rotation01*h+a._rotation02*c,T=a._rotation10*l+a._rotation11*h+a._rotation12*c,C=a._rotation20*l+a._rotation21*h+a._rotation22*c,L=S,w=T,k=C,this.setNormal(t,L,w,k),j=s._positionX+L*-V,R=s._positionY+w*-V,q=s._positionZ+k*-V,E=a._positionX+Z,D=a._positionY+M,F=a._positionZ+I,void this.addPoint(t,j,R,q,E,D,F,m,0)}e-=1e-9,r-=1e-9,_-=1e-9,l+=1e-9,h+=1e-9,c+=1e-9,d=f<e?f:e,Y=u<r?u:r,z=v<_?v:_,d>l||(d=l),Y>h||(Y=h),z>c||(z=c),Z=f-d,M=u-Y,I=v-z;let L,w,k,B,A,P,S,T,C,j,R,q,E,D,F,N=Z*Z+M*M+I*I;if(N>=V*V)return;N=Math.sqrt(N),S=a._rotation00*d+a._rotation01*Y+a._rotation02*z,T=a._rotation10*d+a._rotation11*Y+a._rotation12*z,C=a._rotation20*d+a._rotation21*Y+a._rotation22*z,L=S,w=T,k=C,j=a._rotation00*Z+a._rotation01*M+a._rotation02*I,R=a._rotation10*Z+a._rotation11*M+a._rotation12*I,q=a._rotation20*Z+a._rotation21*M+a._rotation22*I,B=j,A=R,P=q;let W,G,J,O,H,U,Q=B*B+A*A+P*P;Q>0&&(Q=1/Math.sqrt(Q)),E=B*Q,D=A*Q,F=P*Q,this.setNormal(t,E,D,F),W=s._positionX+E*-V,G=s._positionY+D*-V,J=s._positionZ+F*-V,O=a._positionX+L,H=a._positionY+w,U=a._positionZ+k,this.addPoint(t,W,G,J,O,H,U,V-N,0)}},oimo.collision.narrowphase.detector.SphereCapsuleDetector=class extends oimo.collision.narrowphase.detector.Detector{constructor(t){super(t)}detectImpl(t,i,o,s,a,n){let e=o;t.incremental=!1;let r,_,l,h,c,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z=e._halfHeight,M=i._radius,I=e._radius;r=a._rotation01,_=a._rotation11,l=a._rotation21,h=s._positionX,c=s._positionY,m=s._positionZ,b=a._positionX+r*-Z,x=a._positionY+_*-Z,p=a._positionZ+l*-Z,f=a._positionX+r*Z,u=a._positionY+_*Z,v=a._positionZ+l*Z,X=h-b,y=c-x,g=m-p,d=f-b,Y=u-x,z=v-p;let V,L,w,k,B,A,P=Z*Z*4,S=X*d+y*Y+g*z;S<0?S=0:S>P?S=1:S/=P,V=b+d*S,L=x+Y*S,w=p+z*S,k=h-V,B=c-L,A=m-w;let T=k*k+B*B+A*A;if(T>=(M+I)*(M+I))return;let C,j,R,q,E,D,F,N,W,G=Math.sqrt(T);G>0?(C=k*(1/G),j=B*(1/G),R=A*(1/G)):(C=1,j=0,R=0),this.setNormal(t,C,j,R),q=h+C*-M,E=c+j*-M,D=m+R*-M,F=V+C*I,N=L+j*I,W=w+R*I,this.addPoint(t,q,E,D,F,N,W,M+I-G,0)}},oimo.collision.narrowphase.detector.SphereSphereDetector=class extends oimo.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,i,o,s,a,n){let e,r,_;t.incremental=!1,e=s._positionX-a._positionX,r=s._positionY-a._positionY,_=s._positionZ-a._positionZ;let l=i._radius,h=o._radius,c=e*e+r*r+_*_;if(c>=(l+h)*(l+h))return;let m,b,x,p,f,u,v,X,y,g=Math.sqrt(c);g>0?(m=e*(1/g),b=r*(1/g),x=_*(1/g)):(m=1,b=0,x=0),this.setNormal(t,m,b,x),p=s._positionX+m*-l,f=s._positionY+b*-l,u=s._positionZ+x*-l,v=a._positionX+m*h,X=a._positionY+b*h,y=a._positionZ+x*h,this.addPoint(t,p,f,u,v,X,y,l+h-g,0)}},oimo.collision.narrowphase.detector.gjkepa||(oimo.collision.narrowphase.detector.gjkepa={}),oimo.collision.narrowphase.detector.gjkepa.EpaPolyhedron=class{constructor(){this._vertices=new Array(oimo.common.Setting.maxEPAVertices),this._center=new oimo.common.Vec3,this._numVertices=0,this._triangleList=null,this._triangleListLast=null,this._numTriangles=0,this._trianglePool=null,this._vertexPool=null}dumpHoleEdge(t){}validate(){let t=this._triangleList;for(;null!=t;){if(t._vertices[0]._tmpEdgeLoopOuterTriangle=null,t._vertices[0]._tmpEdgeLoopNext=null,-1==t._adjacentPairIndex[0])return this._status=2,!1;if(null==t._adjacentTriangles[0])return this._status=3,!1;if(t._vertices[1]._tmpEdgeLoopOuterTriangle=null,t._vertices[1]._tmpEdgeLoopNext=null,-1==t._adjacentPairIndex[1])return this._status=2,!1;if(null==t._adjacentTriangles[1])return this._status=3,!1;if(t._vertices[2]._tmpEdgeLoopOuterTriangle=null,t._vertices[2]._tmpEdgeLoopNext=null,-1==t._adjacentPairIndex[2])return this._status=2,!1;if(null==t._adjacentTriangles[2])return this._status=3,!1;t=t._next}return!0}findEdgeLoop(t,i,o){if(i._tmpDfsId==t)return;i._tmpDfsId=t;let s=i.tmp;s.x=o.x,s.y=o.y,s.z=o.z;let a=i._vertices[0].v;s.x-=a.x,s.y-=a.y,s.z-=a.z;let n=i.tmp,e=i._normal;if(i._tmpDfsVisible=n.x*e.x+n.y*e.y+n.z*e.z>0,!i._tmpDfsVisible)return void(this._status=6);let r=0;for(;r<3;){let s=r++,a=i._adjacentTriangles[s];if(null==a)continue;let n=a.tmp;n.x=o.x,n.y=o.y,n.z=o.z;let e=a._vertices[0].v;n.x-=e.x,n.y-=e.y,n.z-=e.z;let _=a.tmp,l=a._normal;if(a._tmpDfsVisible=_.x*l.x+_.y*l.y+_.z*l.z>0,a._tmpDfsVisible)this.findEdgeLoop(t,a,o);else{let t=i._vertices[s];t._tmpEdgeLoopNext=i._vertices[i._nextIndex[s]],t._tmpEdgeLoopOuterTriangle=a}}let _=i._adjacentTriangles[0];if(null!=_){let t=i._adjacentPairIndex[0];_._adjacentTriangles[t]=null,_._adjacentPairIndex[t]=-1,i._adjacentTriangles[0]=null,i._adjacentPairIndex[0]=-1}let l=i._adjacentTriangles[1];if(null!=l){let t=i._adjacentPairIndex[1];l._adjacentTriangles[t]=null,l._adjacentPairIndex[t]=-1,i._adjacentTriangles[1]=null,i._adjacentPairIndex[1]=-1}let h=i._adjacentTriangles[2];if(null!=h){let t=i._adjacentPairIndex[2];h._adjacentTriangles[t]=null,h._adjacentPairIndex[t]=-1,i._adjacentTriangles[2]=null,i._adjacentPairIndex[2]=-1}this._numTriangles--;let c=i._prev,m=i._next;null!=c&&(c._next=m),null!=m&&(m._prev=c),i==this._triangleList&&(this._triangleList=this._triangleList._next),i==this._triangleListLast&&(this._triangleListLast=this._triangleListLast._prev),i._next=null,i._prev=null,i.removeReferences(),i._next=this._trianglePool,this._trianglePool=i}_init(t,i,o,s){this._status=0,this._numVertices=4,this._vertices[0]=t,this._vertices[1]=i,this._vertices[2]=o,this._vertices[3]=s;let a=this._center,n=t.v;a.x=n.x,a.y=n.y,a.z=n.z;let e=i.v;a.x+=e.x,a.y+=e.y,a.z+=e.z;let r=o.v;a.x+=r.x,a.y+=r.y,a.z+=r.z;let _=s.v;a.x+=_.x,a.y+=_.y,a.z+=_.z,a.x*=.25,a.y*=.25,a.z*=.25;let l=this._trianglePool;null!=l?(this._trianglePool=l._next,l._next=null):l=new oimo.collision.narrowphase.detector.gjkepa.EpaTriangle;let h=l,c=this._trianglePool;null!=c?(this._trianglePool=c._next,c._next=null):c=new oimo.collision.narrowphase.detector.gjkepa.EpaTriangle;let m=c,b=this._trianglePool;null!=b?(this._trianglePool=b._next,b._next=null):b=new oimo.collision.narrowphase.detector.gjkepa.EpaTriangle;let x=b,p=this._trianglePool;null!=p?(this._trianglePool=p._next,p._next=null):p=new oimo.collision.narrowphase.detector.gjkepa.EpaTriangle;let f=p;return h.init(t,i,o,this._center,!0)||(this._status=1),m.init(t,i,s,this._center,!0)||(this._status=1),x.init(t,o,s,this._center,!0)||(this._status=1),f.init(i,o,s,this._center,!0)||(this._status=1),h.setAdjacentTriangle(m)||(this._status=1),h.setAdjacentTriangle(x)||(this._status=1),h.setAdjacentTriangle(f)||(this._status=1),m.setAdjacentTriangle(x)||(this._status=1),m.setAdjacentTriangle(f)||(this._status=1),x.setAdjacentTriangle(f)||(this._status=1),this._numTriangles++,null==this._triangleList?(this._triangleList=h,this._triangleListLast=h):(this._triangleListLast._next=h,h._prev=this._triangleListLast,this._triangleListLast=h),this._numTriangles++,null==this._triangleList?(this._triangleList=m,this._triangleListLast=m):(this._triangleListLast._next=m,m._prev=this._triangleListLast,this._triangleListLast=m),this._numTriangles++,null==this._triangleList?(this._triangleList=x,this._triangleListLast=x):(this._triangleListLast._next=x,x._prev=this._triangleListLast,this._triangleListLast=x),this._numTriangles++,null==this._triangleList?(this._triangleList=f,this._triangleListLast=f):(this._triangleListLast._next=f,f._prev=this._triangleListLast,this._triangleListLast=f),0==this._status}_addVertex(t,i){this._vertices[this._numVertices++]=t;let o=i._vertices[0];if(this.findEdgeLoop(this._numVertices,i,t.v),0!=this._status)return!1;let s=o,a=null,n=null;for(;;){if(null==s._tmpEdgeLoopNext)return this._dumpAsObjModel(),this._status=4,!1;if(null==s._tmpEdgeLoopOuterTriangle)return this._status=5,!1;let i=this._trianglePool;null!=i?(this._trianglePool=i._next,i._next=null):i=new oimo.collision.narrowphase.detector.gjkepa.EpaTriangle;let e=i;if(null==n&&(n=e),e.init(s,s._tmpEdgeLoopNext,t,this._center,!1)||(this._status=1),0!=this._status)return!1;if(this._numTriangles++,null==this._triangleList?(this._triangleList=e,this._triangleListLast=e):(this._triangleListLast._next=e,e._prev=this._triangleListLast,this._triangleListLast=e),e.setAdjacentTriangle(s._tmpEdgeLoopOuterTriangle)||(this._status=1),null!=a&&(e.setAdjacentTriangle(a)||(this._status=1)),a=e,s=s._tmpEdgeLoopNext,s==o)break}return a.setAdjacentTriangle(n)||(this._status=1),0==this._status&&this.validate()}_dumpAsObjModel(){}},oimo.collision.narrowphase.detector.gjkepa.EpaPolyhedronState=class{},oimo.collision.narrowphase.detector.gjkepa.EpaTriangle=class{constructor(){this.id=++oimo.collision.narrowphase.detector.gjkepa.EpaTriangle.count,this._next=null,this._prev=null,this._normal=new oimo.common.Vec3,this._distanceSq=0,this._tmpDfsId=0,this._tmpDfsVisible=!1,this._vertices=new Array(3),this._adjacentTriangles=new Array(3),this._adjacentPairIndex=new Array(3),this.tmp=new oimo.common.Vec3,this._nextIndex=new Array(3),this._nextIndex[0]=1,this._nextIndex[1]=2,this._nextIndex[2]=0}init(t,i,o,s,a){let n,e,r,_,l,h,c,m,b,x,p,f;null==a&&(a=!1);let u=t.v;n=u.x,e=u.y,r=u.z;let v=i.v;_=v.x,l=v.y,h=v.z;let X,y,g,d,Y,z,Z,M,I,V,L,w,k=o.v;c=k.x,m=k.y,b=k.z,x=s.x,p=s.y,f=s.z,X=_-n,y=l-e,g=h-r,d=c-n,Y=m-e,z=b-r,Z=n-x,M=e-p,I=r-f,V=y*z-g*Y,L=g*d-X*z,w=X*Y-y*d;let B=!1;if(Z*V+M*L+I*w<0)if(a){let t=i;i=o,o=t,V*=-1,L*=-1,w*=-1}else B=!0;this._vertices[0]=t,this._vertices[1]=i,this._vertices[2]=o;let A=this._normal;A.x=V,A.y=L,A.z=w;let P,S,T,C,j,R,q,E,D,F,N,W,G,J,O,H,U,Q,K,$,tt,it,ot,st,at,nt,et,rt,_t,lt,ht=t.v,ct=i.v,mt=o.v,bt=this.tmp;P=ht.x,S=ht.y,T=ht.z,C=ct.x,j=ct.y,R=ct.z,q=mt.x,E=mt.y,D=mt.z,F=C-P,N=j-S,W=R-T,G=q-C,J=E-j,O=D-R,H=P-q,U=S-E,Q=T-D,K=N*O-W*J,$=W*G-F*O,tt=F*J-N*G,it=N*tt-W*$,ot=W*K-F*tt,st=F*$-N*K,at=J*tt-O*$,nt=O*K-G*tt,et=G*$-J*K,rt=U*tt-Q*$,_t=Q*K-H*tt,lt=H*$-U*K;let xt,pt,ft,ut=-1;if(xt=0,pt=0,ft=0,P*it+S*ot+T*st<0){let t,i,o,s,a,n,e,r,_;t=ht.x,i=ht.y,o=ht.z,s=ct.x,a=ct.y,n=ct.z,e=s-t,r=a-i,_=n-o;let l=e*t+r*i+_*o;if(l=-l/(e*e+r*r+_*_),l<0)bt.x=t,bt.y=i,bt.z=o;else if(l>1)bt.x=s,bt.y=a,bt.z=n;else{let s,a,n;s=t+e*l,a=i+r*l,n=o+_*l,bt.x=s,bt.y=a,bt.z=n}ut=bt.x*bt.x+bt.y*bt.y+bt.z*bt.z,xt=bt.x,pt=bt.y,ft=bt.z}if(C*at+j*nt+R*et<0){let t,i,o,s,a,n,e,r,_;t=ct.x,i=ct.y,o=ct.z,s=mt.x,a=mt.y,n=mt.z,e=s-t,r=a-i,_=n-o;let l=e*t+r*i+_*o;if(l=-l/(e*e+r*r+_*_),l<0)bt.x=t,bt.y=i,bt.z=o;else if(l>1)bt.x=s,bt.y=a,bt.z=n;else{let s,a,n;s=t+e*l,a=i+r*l,n=o+_*l,bt.x=s,bt.y=a,bt.z=n}let h=bt.x*bt.x+bt.y*bt.y+bt.z*bt.z;(ut<0||h<ut)&&(ut=h,xt=bt.x,pt=bt.y,ft=bt.z)}if(q*rt+E*_t+D*lt<0){let t,i,o,s,a,n,e,r,_;t=ht.x,i=ht.y,o=ht.z,s=mt.x,a=mt.y,n=mt.z,e=s-t,r=a-i,_=n-o;let l=e*t+r*i+_*o;if(l=-l/(e*e+r*r+_*_),l<0)bt.x=t,bt.y=i,bt.z=o;else if(l>1)bt.x=s,bt.y=a,bt.z=n;else{let s,a,n;s=t+e*l,a=i+r*l,n=o+_*l,bt.x=s,bt.y=a,bt.z=n}let h=bt.x*bt.x+bt.y*bt.y+bt.z*bt.z;(ut<0||h<ut)&&(ut=h,xt=bt.x,pt=bt.y,ft=bt.z)}if(ut>0)bt.x=xt,bt.y=pt,bt.z=ft;else{let t=K*K+$*$+tt*tt;t>0&&(t=1/Math.sqrt(t)),K*=t,$*=t,tt*=t;let i=K*K+$*$+tt*tt;i=(P*K+S*$+T*tt)/i,xt=K*i,pt=$*i,ft=tt*i,bt.x=xt,bt.y=pt,bt.z=ft}let vt=this.tmp;return this._distanceSq=vt.x*vt.x+vt.y*vt.y+vt.z*vt.z,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=-1,this._adjacentPairIndex[1]=-1,this._adjacentPairIndex[2]=-1,!B}setAdjacentTriangle(t){let i=0;return this._vertices[0]==t._vertices[this._nextIndex[0]]&&this._vertices[this._nextIndex[0]]==t._vertices[0]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=0,i=1),this._vertices[0]==t._vertices[this._nextIndex[1]]&&this._vertices[this._nextIndex[0]]==t._vertices[1]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=0,++i),this._vertices[0]==t._vertices[this._nextIndex[2]]&&this._vertices[this._nextIndex[0]]==t._vertices[2]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=0,++i),this._vertices[1]==t._vertices[this._nextIndex[0]]&&this._vertices[this._nextIndex[1]]==t._vertices[0]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=1,++i),this._vertices[1]==t._vertices[this._nextIndex[1]]&&this._vertices[this._nextIndex[1]]==t._vertices[1]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=1,++i),this._vertices[1]==t._vertices[this._nextIndex[2]]&&this._vertices[this._nextIndex[1]]==t._vertices[2]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=1,++i),this._vertices[2]==t._vertices[this._nextIndex[0]]&&this._vertices[this._nextIndex[2]]==t._vertices[0]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=2,++i),this._vertices[2]==t._vertices[this._nextIndex[1]]&&this._vertices[this._nextIndex[2]]==t._vertices[1]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=2,++i),this._vertices[2]==t._vertices[this._nextIndex[2]]&&this._vertices[this._nextIndex[2]]==t._vertices[2]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=2,++i),1==i}removeAdjacentTriangles(){let t=this._adjacentTriangles[0];if(null!=t){let i=this._adjacentPairIndex[0];t._adjacentTriangles[i]=null,t._adjacentPairIndex[i]=-1,this._adjacentTriangles[0]=null,this._adjacentPairIndex[0]=-1}let i=this._adjacentTriangles[1];if(null!=i){let t=this._adjacentPairIndex[1];i._adjacentTriangles[t]=null,i._adjacentPairIndex[t]=-1,this._adjacentTriangles[1]=null,this._adjacentPairIndex[1]=-1}let o=this._adjacentTriangles[2];if(null!=o){let t=this._adjacentPairIndex[2];o._adjacentTriangles[t]=null,o._adjacentPairIndex[t]=-1,this._adjacentTriangles[2]=null,this._adjacentPairIndex[2]=-1}}removeReferences(){this._next=null,this._prev=null,this._tmpDfsId=0,this._tmpDfsVisible=!1,this._distanceSq=0,this._vertices[0]=null,this._vertices[1]=null,this._vertices[2]=null,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=0,this._adjacentPairIndex[1]=0,this._adjacentPairIndex[2]=0}dump(){}},oimo.collision.narrowphase.detector.gjkepa.EpaVertex=class{constructor(){this.randId=1e5*Math.random()|0,this.v=new oimo.common.Vec3,this.w1=new oimo.common.Vec3,this.w2=new oimo.common.Vec3}init(t,i,o){let s=this.v;s.x=t.x,s.y=t.y,s.z=t.z;let a=this.w1;a.x=i.x,a.y=i.y,a.z=i.z;let n=this.w2;return n.x=o.x,n.y=o.y,n.z=o.z,this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null,this}removeReferences(){this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null}},oimo.collision.narrowphase.detector.gjkepa.GjkCache=class{constructor(){this.prevClosestDir=new oimo.common.Vec3}clear(){this.prevClosestDir.zero()}},oimo.common||(oimo.common={}),oimo.common.Vec3=class{constructor(t,i,o){null==o&&(o=0),null==i&&(i=0),null==t&&(t=0),this.x=t,this.y=i,this.z=o,oimo.common.Vec3.numCreations++}init(t,i,o){return this.x=t,this.y=i,this.z=o,this}zero(){return this.x=0,this.y=0,this.z=0,this}add(t){return new oimo.common.Vec3(this.x+t.x,this.y+t.y,this.z+t.z)}add3(t,i,o){return new oimo.common.Vec3(this.x+t,this.y+i,this.z+o)}addScaled(t,i){return new oimo.common.Vec3(this.x+t.x*i,this.y+t.y*i,this.z+t.z*i)}sub(t){return new oimo.common.Vec3(this.x-t.x,this.y-t.y,this.z-t.z)}sub3(t,i,o){return new oimo.common.Vec3(this.x-t,this.y-i,this.z-o)}scale(t){return new oimo.common.Vec3(this.x*t,this.y*t,this.z*t)}scale3(t,i,o){return new oimo.common.Vec3(this.x*t,this.y*i,this.z*o)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return new oimo.common.Vec3(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}addEq(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}add3Eq(t,i,o){return this.x+=t,this.y+=i,this.z+=o,this}addScaledEq(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}subEq(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}sub3Eq(t,i,o){return this.x-=t,this.y-=i,this.z-=o,this}scaleEq(t){return this.x*=t,this.y*=t,this.z*=t,this}scale3Eq(t,i,o){return this.x*=t,this.y*=i,this.z*=o,this}crossEq(t){let i=this.z*t.x-this.x*t.z,o=this.x*t.y-this.y*t.x;return this.x=this.y*t.z-this.z*t.y,this.y=i,this.z=o,this}mulMat3(t){return new oimo.common.Vec3(this.x*t.e00+this.y*t.e01+this.z*t.e02,this.x*t.e10+this.y*t.e11+this.z*t.e12,this.x*t.e20+this.y*t.e21+this.z*t.e22)}mulMat4(t){return new oimo.common.Vec3(this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03,this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13,this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23)}mulTransform(t){let i,o,s,a,n,e;i=this.x,o=this.y,s=this.z,a=t._rotation00*i+t._rotation01*o+t._rotation02*s,n=t._rotation10*i+t._rotation11*o+t._rotation12*s,e=t._rotation20*i+t._rotation21*o+t._rotation22*s,i=a,o=n,s=e,i+=t._positionX,o+=t._positionY,s+=t._positionZ;let r=new oimo.common.Vec3;return r.x=i,r.y=o,r.z=s,r}mulMat3Eq(t){let i=this.x*t.e10+this.y*t.e11+this.z*t.e12,o=this.x*t.e20+this.y*t.e21+this.z*t.e22;return this.x=this.x*t.e00+this.y*t.e01+this.z*t.e02,this.y=i,this.z=o,this}mulMat4Eq(t){let i=this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13,o=this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23;return this.x=this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03,this.y=i,this.z=o,this}mulTransformEq(t){let i,o,s,a,n,e;return i=this.x,o=this.y,s=this.z,a=t._rotation00*i+t._rotation01*o+t._rotation02*s,n=t._rotation10*i+t._rotation11*o+t._rotation12*s,e=t._rotation20*i+t._rotation21*o+t._rotation22*s,i=a,o=n,s=e,i+=t._positionX,o+=t._positionY,s+=t._positionZ,this.x=i,this.y=o,this.z=s,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}normalized(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t>0&&(t=1/t),new oimo.common.Vec3(this.x*t,this.y*t,this.z*t)}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t>0&&(t=1/t),this.x*=t,this.y*=t,this.z*=t,this}negate(){return new oimo.common.Vec3(-this.x,-this.y,-this.z)}negateEq(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}clone(){return new oimo.common.Vec3(this.x,this.y,this.z)}toString(){return"Vec3["+(this.x>0?(1e7*this.x+.5|0)/1e7:(1e7*this.x-.5|0)/1e7)+", "+(this.y>0?(1e7*this.y+.5|0)/1e7:(1e7*this.y-.5|0)/1e7)+", "+(this.z>0?(1e7*this.z+.5|0)/1e7:(1e7*this.z-.5|0)/1e7)+"]"}},oimo.common.Transform=class{constructor(){this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1}identity(){return this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1,this}getPosition(){let t=new oimo.common.Vec3;return t.x=this._positionX,t.y=this._positionY,t.z=this._positionZ,t}getPositionTo(t){t.x=this._positionX,t.y=this._positionY,t.z=this._positionZ}setPosition(t){return this._positionX=t.x,this._positionY=t.y,this._positionZ=t.z,this}translate(t){let i,o,s;i=t.x,o=t.y,s=t.z,this._positionX+=i,this._positionY+=o,this._positionZ+=s}getRotation(){let t=new oimo.common.Mat3;return t.e00=this._rotation00,t.e01=this._rotation01,t.e02=this._rotation02,t.e10=this._rotation10,t.e11=this._rotation11,t.e12=this._rotation12,t.e20=this._rotation20,t.e21=this._rotation21,t.e22=this._rotation22,t}getRotationTo(t){t.e00=this._rotation00,t.e01=this._rotation01,t.e02=this._rotation02,t.e10=this._rotation10,t.e11=this._rotation11,t.e12=this._rotation12,t.e20=this._rotation20,t.e21=this._rotation21,t.e22=this._rotation22}setRotation(t){return this._rotation00=t.e00,this._rotation01=t.e01,this._rotation02=t.e02,this._rotation10=t.e10,this._rotation11=t.e11,this._rotation12=t.e12,this._rotation20=t.e20,this._rotation21=t.e21,this._rotation22=t.e22,this}setRotationXyz(t){let i,o,s;i=t.x,o=t.y,s=t.z;let a=Math.sin(i),n=Math.sin(o),e=Math.sin(s),r=Math.cos(i),_=Math.cos(o),l=Math.cos(s);this._rotation00=_*l,this._rotation01=-_*e,this._rotation02=n,this._rotation10=r*e+l*a*n,this._rotation11=r*l-a*n*e,this._rotation12=-_*a,this._rotation20=a*e-r*l*n,this._rotation21=l*a+r*n*e,this._rotation22=r*_}rotate(t){let i,o,s,a,n,e,r,_,l,h,c,m,b,x,p,f,u,v;i=t.e00,o=t.e01,s=t.e02,a=t.e10,n=t.e11,e=t.e12,r=t.e20,_=t.e21,l=t.e22,h=i*this._rotation00+o*this._rotation10+s*this._rotation20,c=i*this._rotation01+o*this._rotation11+s*this._rotation21,m=i*this._rotation02+o*this._rotation12+s*this._rotation22,b=a*this._rotation00+n*this._rotation10+e*this._rotation20,x=a*this._rotation01+n*this._rotation11+e*this._rotation21,p=a*this._rotation02+n*this._rotation12+e*this._rotation22,f=r*this._rotation00+_*this._rotation10+l*this._rotation20,u=r*this._rotation01+_*this._rotation11+l*this._rotation21,v=r*this._rotation02+_*this._rotation12+l*this._rotation22,this._rotation00=h,this._rotation01=c,this._rotation02=m,this._rotation10=b,this._rotation11=x,this._rotation12=p,this._rotation20=f,this._rotation21=u,this._rotation22=v}rotateXyz(t){let i,o,s,a,n,e,r,_,l,h,c,m;i=t.x,o=t.y,s=t.z;let b,x,p,f,u,v,X,y,g,d=Math.sin(i),Y=Math.sin(o),z=Math.sin(s),Z=Math.cos(i),M=Math.cos(o),I=Math.cos(s);a=M*I,n=-M*z,e=Y,r=Z*z+I*d*Y,_=Z*I-d*Y*z,l=-M*d,h=d*z-Z*I*Y,c=I*d+Z*Y*z,m=Z*M,b=a*this._rotation00+n*this._rotation10+e*this._rotation20,x=a*this._rotation01+n*this._rotation11+e*this._rotation21,p=a*this._rotation02+n*this._rotation12+e*this._rotation22,f=r*this._rotation00+_*this._rotation10+l*this._rotation20,u=r*this._rotation01+_*this._rotation11+l*this._rotation21,v=r*this._rotation02+_*this._rotation12+l*this._rotation22,X=h*this._rotation00+c*this._rotation10+m*this._rotation20,y=h*this._rotation01+c*this._rotation11+m*this._rotation21,g=h*this._rotation02+c*this._rotation12+m*this._rotation22,this._rotation00=b,this._rotation01=x,this._rotation02=p,this._rotation10=f,this._rotation11=u,this._rotation12=v,this._rotation20=X,this._rotation21=y,this._rotation22=g}getOrientation(){let t,i,o,s,a,n=new oimo.common.Quat,e=this._rotation00,r=this._rotation11,_=this._rotation22,l=e+r+_;return l>0?(a=Math.sqrt(l+1),s=.5*a,a=.5/a,t=(this._rotation21-this._rotation12)*a,i=(this._rotation02-this._rotation20)*a,o=(this._rotation10-this._rotation01)*a):e>r?e>_?(a=Math.sqrt(e-r-_+1),t=.5*a,a=.5/a,i=(this._rotation01+this._rotation10)*a,o=(this._rotation02+this._rotation20)*a,s=(this._rotation21-this._rotation12)*a):(a=Math.sqrt(_-e-r+1),o=.5*a,a=.5/a,t=(this._rotation02+this._rotation20)*a,i=(this._rotation12+this._rotation21)*a,s=(this._rotation10-this._rotation01)*a):r>_?(a=Math.sqrt(r-_-e+1),i=.5*a,a=.5/a,t=(this._rotation01+this._rotation10)*a,o=(this._rotation12+this._rotation21)*a,s=(this._rotation02-this._rotation20)*a):(a=Math.sqrt(_-e-r+1),o=.5*a,a=.5/a,t=(this._rotation02+this._rotation20)*a,i=(this._rotation12+this._rotation21)*a,s=(this._rotation10-this._rotation01)*a),n.x=t,n.y=i,n.z=o,n.w=s,n}getOrientationTo(t){let i,o,s,a,n,e=this._rotation00,r=this._rotation11,_=this._rotation22,l=e+r+_;l>0?(n=Math.sqrt(l+1),a=.5*n,n=.5/n,i=(this._rotation21-this._rotation12)*n,o=(this._rotation02-this._rotation20)*n,s=(this._rotation10-this._rotation01)*n):e>r?e>_?(n=Math.sqrt(e-r-_+1),i=.5*n,n=.5/n,o=(this._rotation01+this._rotation10)*n,s=(this._rotation02+this._rotation20)*n,a=(this._rotation21-this._rotation12)*n):(n=Math.sqrt(_-e-r+1),s=.5*n,n=.5/n,i=(this._rotation02+this._rotation20)*n,o=(this._rotation12+this._rotation21)*n,a=(this._rotation10-this._rotation01)*n):r>_?(n=Math.sqrt(r-_-e+1),o=.5*n,n=.5/n,i=(this._rotation01+this._rotation10)*n,s=(this._rotation12+this._rotation21)*n,a=(this._rotation02-this._rotation20)*n):(n=Math.sqrt(_-e-r+1),s=.5*n,n=.5/n,i=(this._rotation02+this._rotation20)*n,o=(this._rotation12+this._rotation21)*n,a=(this._rotation10-this._rotation01)*n),t.x=i,t.y=o,t.z=s,t.w=a}setOrientation(t){let i,o,s,a;i=t.x,o=t.y,s=t.z,a=t.w;let n=2*i,e=2*o,r=2*s,_=i*n,l=o*e,h=s*r,c=i*e,m=o*r,b=i*r,x=a*n,p=a*e,f=a*r;return this._rotation00=1-l-h,this._rotation01=c-f,this._rotation02=b+p,this._rotation10=c+f,this._rotation11=1-_-h,this._rotation12=m-x,this._rotation20=b-p,this._rotation21=m+x,this._rotation22=1-_-l,this}clone(){let t=new oimo.common.Transform;return t._positionX=this._positionX,t._positionY=this._positionY,t._positionZ=this._positionZ,t._rotation00=this._rotation00,t._rotation01=this._rotation01,t._rotation02=this._rotation02,t._rotation10=this._rotation10,t._rotation11=this._rotation11,t._rotation12=this._rotation12,t._rotation20=this._rotation20,t._rotation21=this._rotation21,t._rotation22=this._rotation22,t}copyFrom(t){return this._positionX=t._positionX,this._positionY=t._positionY,this._positionZ=t._positionZ,this._rotation00=t._rotation00,this._rotation01=t._rotation01,this._rotation02=t._rotation02,this._rotation10=t._rotation10,this._rotation11=t._rotation11,this._rotation12=t._rotation12,this._rotation20=t._rotation20,this._rotation21=t._rotation21,this._rotation22=t._rotation22,this}},oimo.common.Setting=class{},oimo.collision.narrowphase.detector.gjkepa.GjkEpa=class{constructor(){this.s=new Array(4),this.w1=new Array(4),this.w2=new Array(4),this.baseDirs=new Array(3),this.baseDirs[0]=new oimo.common.Vec3(1,0,0),this.baseDirs[1]=new oimo.common.Vec3(0,1,0),this.baseDirs[2]=new oimo.common.Vec3(0,0,1),this.tl1=new oimo.common.Vec3,this.tl2=new oimo.common.Vec3,this.rayX=new oimo.common.Vec3,this.rayR=new oimo.common.Vec3,this.tempTransform=new oimo.common.Transform,this.s[0]=new oimo.common.Vec3,this.w1[0]=new oimo.common.Vec3,this.w2[0]=new oimo.common.Vec3,this.s[1]=new oimo.common.Vec3,this.w1[1]=new oimo.common.Vec3,this.w2[1]=new oimo.common.Vec3,this.s[2]=new oimo.common.Vec3,this.w1[2]=new oimo.common.Vec3,this.w2[2]=new oimo.common.Vec3,this.s[3]=new oimo.common.Vec3,this.w1[3]=new oimo.common.Vec3,this.w2[3]=new oimo.common.Vec3,this.dir=new oimo.common.Vec3,this.closest=new oimo.common.Vec3,this.closestPoint1=new oimo.common.Vec3,this.closestPoint2=new oimo.common.Vec3,this.polyhedron=new oimo.collision.narrowphase.detector.gjkepa.EpaPolyhedron}computeClosestPointsImpl(t,i,o,s,a,n){this.c1=t,this.c2=i,this.tf1=o,this.tf2=s;let e=this.s,r=this.w1,_=this.w2,l=this.closest,h=this.dir;if(null!=a?(null==a._gjkCache&&(a._gjkCache=new oimo.collision.narrowphase.detector.gjkepa.GjkCache),this.loadCache(a._gjkCache)):h.zero(),h.x*h.x+h.y*h.y+h.z*h.z==0){let t,i,a;t=s._positionX-o._positionX,i=s._positionY-o._positionY,a=s._positionZ-o._positionZ,h.x=t,h.y=i,h.z=a,h.x*h.x+h.y*h.y+h.z*h.z<1e-6&&h.init(1,0,0)}this.simplexSize=0,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let c=this.s[this.simplexSize],m=this.w1[this.simplexSize];c.x=m.x,c.y=m.y,c.z=m.z;let b=this.w2[this.simplexSize];c.x-=b.x,c.y-=b.y,c.z-=b.z,this.simplexSize=1;let x=0;for(;x<40;){let c=0;switch(this.simplexSize){case 1:let t=e[0];l.x=t.x,l.y=t.y,l.z=t.z,c=1;break;case 2:let i,o,s,a,n,r,_=e[0];i=_.x,o=_.y,s=_.z;let h,m,b,x=e[1];a=x.x,n=x.y,r=x.z,h=a-i,m=n-o,b=r-s;let p=h*i+m*o+b*s;if(p=-p/(h*h+m*m+b*b),p<0)l.x=i,l.y=o,l.z=s,c=1;else if(p>1)l.x=a,l.y=n,l.z=r,c=2;else{let t,a,n;t=i+h*p,a=o+m*p,n=s+b*p,l.x=t,l.y=a,l.z=n,c=3}break;case 3:let f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A,P,S,T,C,j,R,q,E,D,F,N,W,G=e[0],J=e[1],O=e[2];f=G.x,u=G.y,v=G.z,X=J.x,y=J.y,g=J.z,d=O.x,Y=O.y,z=O.z,Z=X-f,M=y-u,I=g-v,V=d-X,L=Y-y,w=z-g,k=f-d,B=u-Y,A=v-z,P=M*w-I*L,S=I*V-Z*w,T=Z*L-M*V,C=M*T-I*S,j=I*P-Z*T,R=Z*S-M*P,q=L*T-w*S,E=w*P-V*T,D=V*S-L*P,F=B*T-A*S,N=A*P-k*T,W=k*S-B*P;let H,U,Q,K=-1,$=0;if(H=0,U=0,Q=0,f*C+u*j+v*R<0){let t,i,o,s,a,n,e,r,_;t=G.x,i=G.y,o=G.z,s=J.x,a=J.y,n=J.z,e=s-t,r=a-i,_=n-o;let h,c=e*t+r*i+_*o;if(c=-c/(e*e+r*r+_*_),c<0)l.x=t,l.y=i,l.z=o,h=1;else if(c>1)l.x=s,l.y=a,l.z=n,h=2;else{let s,a,n;s=t+e*c,a=i+r*c,n=o+_*c,l.x=s,l.y=a,l.z=n,h=3}$=h,K=l.x*l.x+l.y*l.y+l.z*l.z,H=l.x,U=l.y,Q=l.z}if(X*q+y*E+g*D<0){let t,i,o,s,a,n,e,r,_;t=J.x,i=J.y,o=J.z,s=O.x,a=O.y,n=O.z,e=s-t,r=a-i,_=n-o;let h,c=e*t+r*i+_*o;if(c=-c/(e*e+r*r+_*_),c<0)l.x=t,l.y=i,l.z=o,h=1;else if(c>1)l.x=s,l.y=a,l.z=n,h=2;else{let s,a,n;s=t+e*c,a=i+r*c,n=o+_*c,l.x=s,l.y=a,l.z=n,h=3}let m=l.x*l.x+l.y*l.y+l.z*l.z;(K<0||m<K)&&($=h<<1,K=m,H=l.x,U=l.y,Q=l.z)}if(d*F+Y*N+z*W<0){let t,i,o,s,a,n,e,r,_;t=G.x,i=G.y,o=G.z,s=O.x,a=O.y,n=O.z,e=s-t,r=a-i,_=n-o;let h,c=e*t+r*i+_*o;if(c=-c/(e*e+r*r+_*_),c<0)l.x=t,l.y=i,l.z=o,h=1;else if(c>1)l.x=s,l.y=a,l.z=n,h=2;else{let s,a,n;s=t+e*c,a=i+r*c,n=o+_*c,l.x=s,l.y=a,l.z=n,h=3}let m=l.x*l.x+l.y*l.y+l.z*l.z;(K<0||m<K)&&($=1&h|(2&h)<<1,K=m,H=l.x,U=l.y,Q=l.z)}if(K>0)l.x=H,l.y=U,l.z=Q,c=$;else{let t=P*P+S*S+T*T;t>0&&(t=1/Math.sqrt(t)),P*=t,S*=t,T*=t;let i=P*P+S*S+T*T;i=(f*P+u*S+v*T)/i,H=P*i,U=S*i,Q=T*i,l.x=H,l.y=U,l.z=Q,c=7}break;case 4:let tt,it,ot,st,at,nt,et,rt,_t,lt,ht,ct,mt,bt,xt,pt,ft,ut,vt,Xt,yt,gt,dt,Yt,zt,Zt,Mt,It,Vt,Lt,wt,kt,Bt,At,Pt,St,Tt,Ct,jt,Rt=e[0],qt=e[1],Et=e[2],Dt=e[3];tt=Rt.x,it=Rt.y,ot=Rt.z,st=qt.x,at=qt.y,nt=qt.z,et=Et.x,rt=Et.y,_t=Et.z,lt=Dt.x,ht=Dt.y,ct=Dt.z,mt=st-tt,bt=at-it,xt=nt-ot,pt=et-tt,ft=rt-it,ut=_t-ot,vt=lt-tt,Xt=ht-it,yt=ct-ot,gt=et-st,dt=rt-at,Yt=_t-nt,zt=lt-st,Zt=ht-at,Mt=ct-nt,It=bt*ut-xt*ft,Vt=xt*pt-mt*ut,Lt=mt*ft-bt*pt,wt=ft*yt-ut*Xt,kt=ut*vt-pt*yt,Bt=pt*Xt-ft*vt,At=Xt*xt-yt*bt,Pt=yt*mt-vt*xt,St=vt*bt-Xt*mt,Tt=Zt*Yt-Mt*dt,Ct=Mt*gt-zt*Yt,jt=zt*dt-Zt*gt;let Ft,Nt,Wt,Gt=mt*Tt+bt*Ct+xt*jt>0?1:-1,Jt=-1,Ot=0;if(Ft=0,Nt=0,Wt=0,(tt*It+it*Vt+ot*Lt)*Gt<0){let t,i,o,s,a,n,e,r,_,h,c,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w;t=Rt.x,i=Rt.y,o=Rt.z,s=qt.x,a=qt.y,n=qt.z,e=Et.x,r=Et.y,_=Et.z,h=s-t,c=a-i,m=n-o,b=e-s,x=r-a,p=_-n,f=t-e,u=i-r,v=o-_,X=c*p-m*x,y=m*b-h*p,g=h*x-c*b,d=c*g-m*y,Y=m*X-h*g,z=h*y-c*X,Z=x*g-p*y,M=p*X-b*g,I=b*y-x*X,V=u*g-v*y,L=v*X-f*g,w=f*y-u*X;let k,B,A,P,S=-1,T=0;if(k=0,B=0,A=0,t*d+i*Y+o*z<0){let t,i,o,s,a,n,e,r,_;t=Rt.x,i=Rt.y,o=Rt.z,s=qt.x,a=qt.y,n=qt.z,e=s-t,r=a-i,_=n-o;let h,c=e*t+r*i+_*o;if(c=-c/(e*e+r*r+_*_),c<0)l.x=t,l.y=i,l.z=o,h=1;else if(c>1)l.x=s,l.y=a,l.z=n,h=2;else{let s,a,n;s=t+e*c,a=i+r*c,n=o+_*c,l.x=s,l.y=a,l.z=n,h=3}T=h,S=l.x*l.x+l.y*l.y+l.z*l.z,k=l.x,B=l.y,A=l.z}if(s*Z+a*M+n*I<0){let t,i,o,s,a,n,e,r,_;t=qt.x,i=qt.y,o=qt.z,s=Et.x,a=Et.y,n=Et.z,e=s-t,r=a-i,_=n-o;let h,c=e*t+r*i+_*o;if(c=-c/(e*e+r*r+_*_),c<0)l.x=t,l.y=i,l.z=o,h=1;else if(c>1)l.x=s,l.y=a,l.z=n,h=2;else{let s,a,n;s=t+e*c,a=i+r*c,n=o+_*c,l.x=s,l.y=a,l.z=n,h=3}let m=l.x*l.x+l.y*l.y+l.z*l.z;(S<0||m<S)&&(T=h<<1,S=m,k=l.x,B=l.y,A=l.z)}if(e*V+r*L+_*w<0){let t,i,o,s,a,n,e,r,_;t=Rt.x,i=Rt.y,o=Rt.z,s=Et.x,a=Et.y,n=Et.z,e=s-t,r=a-i,_=n-o;let h,c=e*t+r*i+_*o;if(c=-c/(e*e+r*r+_*_),c<0)l.x=t,l.y=i,l.z=o,h=1;else if(c>1)l.x=s,l.y=a,l.z=n,h=2;else{let s,a,n;s=t+e*c,a=i+r*c,n=o+_*c,l.x=s,l.y=a,l.z=n,h=3}let m=l.x*l.x+l.y*l.y+l.z*l.z;(S<0||m<S)&&(T=1&h|(2&h)<<1,S=m,k=l.x,B=l.y,A=l.z)}if(S>0)l.x=k,l.y=B,l.z=A,P=T;else{let s=X*X+y*y+g*g;s>0&&(s=1/Math.sqrt(s)),X*=s,y*=s,g*=s;let a=X*X+y*y+g*g;a=(t*X+i*y+o*g)/a,k=X*a,B=y*a,A=g*a,l.x=k,l.y=B,l.z=A,P=7}Ot=P,Jt=l.x*l.x+l.y*l.y+l.z*l.z,Ft=l.x,Nt=l.y,Wt=l.z}if((tt*wt+it*kt+ot*Bt)*Gt<0){let t,i,o,s,a,n,e,r,_,h,c,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w;t=Rt.x,i=Rt.y,o=Rt.z,s=Et.x,a=Et.y,n=Et.z,e=Dt.x,r=Dt.y,_=Dt.z,h=s-t,c=a-i,m=n-o,b=e-s,x=r-a,p=_-n,f=t-e,u=i-r,v=o-_,X=c*p-m*x,y=m*b-h*p,g=h*x-c*b,d=c*g-m*y,Y=m*X-h*g,z=h*y-c*X,Z=x*g-p*y,M=p*X-b*g,I=b*y-x*X,V=u*g-v*y,L=v*X-f*g,w=f*y-u*X;let k,B,A,P,S=-1,T=0;if(k=0,B=0,A=0,t*d+i*Y+o*z<0){let t,i,o,s,a,n,e,r,_;t=Rt.x,i=Rt.y,o=Rt.z,s=Et.x,a=Et.y,n=Et.z,e=s-t,r=a-i,_=n-o;let h,c=e*t+r*i+_*o;if(c=-c/(e*e+r*r+_*_),c<0)l.x=t,l.y=i,l.z=o,h=1;else if(c>1)l.x=s,l.y=a,l.z=n,h=2;else{let s,a,n;s=t+e*c,a=i+r*c,n=o+_*c,l.x=s,l.y=a,l.z=n,h=3}T=h,S=l.x*l.x+l.y*l.y+l.z*l.z,k=l.x,B=l.y,A=l.z}if(s*Z+a*M+n*I<0){let t,i,o,s,a,n,e,r,_;t=Et.x,i=Et.y,o=Et.z,s=Dt.x,a=Dt.y,n=Dt.z,e=s-t,r=a-i,_=n-o;let h,c=e*t+r*i+_*o;if(c=-c/(e*e+r*r+_*_),c<0)l.x=t,l.y=i,l.z=o,h=1;else if(c>1)l.x=s,l.y=a,l.z=n,h=2;else{let s,a,n;s=t+e*c,a=i+r*c,n=o+_*c,l.x=s,l.y=a,l.z=n,h=3}let m=l.x*l.x+l.y*l.y+l.z*l.z;(S<0||m<S)&&(T=h<<1,S=m,k=l.x,B=l.y,A=l.z)}if(e*V+r*L+_*w<0){let t,i,o,s,a,n,e,r,_;t=Rt.x,i=Rt.y,o=Rt.z,s=Dt.x,a=Dt.y,n=Dt.z,e=s-t,r=a-i,_=n-o;let h,c=e*t+r*i+_*o;if(c=-c/(e*e+r*r+_*_),c<0)l.x=t,l.y=i,l.z=o,h=1;else if(c>1)l.x=s,l.y=a,l.z=n,h=2;else{let s,a,n;s=t+e*c,a=i+r*c,n=o+_*c,l.x=s,l.y=a,l.z=n,h=3}let m=l.x*l.x+l.y*l.y+l.z*l.z;(S<0||m<S)&&(T=1&h|(2&h)<<1,S=m,k=l.x,B=l.y,A=l.z)}if(S>0)l.x=k,l.y=B,l.z=A,P=T;else{let s=X*X+y*y+g*g;s>0&&(s=1/Math.sqrt(s)),X*=s,y*=s,g*=s;let a=X*X+y*y+g*g;a=(t*X+i*y+o*g)/a,k=X*a,B=y*a,A=g*a,l.x=k,l.y=B,l.z=A,P=7}let C=l.x*l.x+l.y*l.y+l.z*l.z;(Jt<0||C<Jt)&&(Ot=1&P|(6&P)<<1,Jt=C,Ft=l.x,Nt=l.y,Wt=l.z)}if((tt*At+it*Pt+ot*St)*Gt<0){let t,i,o,s,a,n,e,r,_,h,c,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w;t=Rt.x,i=Rt.y,o=Rt.z,s=qt.x,a=qt.y,n=qt.z,e=Dt.x,r=Dt.y,_=Dt.z,h=s-t,c=a-i,m=n-o,b=e-s,x=r-a,p=_-n,f=t-e,u=i-r,v=o-_,X=c*p-m*x,y=m*b-h*p,g=h*x-c*b,d=c*g-m*y,Y=m*X-h*g,z=h*y-c*X,Z=x*g-p*y,M=p*X-b*g,I=b*y-x*X,V=u*g-v*y,L=v*X-f*g,w=f*y-u*X;let k,B,A,P,S=-1,T=0;if(k=0,B=0,A=0,t*d+i*Y+o*z<0){let t,i,o,s,a,n,e,r,_;t=Rt.x,i=Rt.y,o=Rt.z,s=qt.x,a=qt.y,n=qt.z,e=s-t,r=a-i,_=n-o;let h,c=e*t+r*i+_*o;if(c=-c/(e*e+r*r+_*_),c<0)l.x=t,l.y=i,l.z=o,h=1;else if(c>1)l.x=s,l.y=a,l.z=n,h=2;else{let s,a,n;s=t+e*c,a=i+r*c,n=o+_*c,l.x=s,l.y=a,l.z=n,h=3}T=h,S=l.x*l.x+l.y*l.y+l.z*l.z,k=l.x,B=l.y,A=l.z}if(s*Z+a*M+n*I<0){let t,i,o,s,a,n,e,r,_;t=qt.x,i=qt.y,o=qt.z,s=Dt.x,a=Dt.y,n=Dt.z,e=s-t,r=a-i,_=n-o;let h,c=e*t+r*i+_*o;if(c=-c/(e*e+r*r+_*_),c<0)l.x=t,l.y=i,l.z=o,h=1;else if(c>1)l.x=s,l.y=a,l.z=n,h=2;else{let s,a,n;s=t+e*c,a=i+r*c,n=o+_*c,l.x=s,l.y=a,l.z=n,h=3}let m=l.x*l.x+l.y*l.y+l.z*l.z;(S<0||m<S)&&(T=h<<1,S=m,k=l.x,B=l.y,A=l.z)}if(e*V+r*L+_*w<0){let t,i,o,s,a,n,e,r,_;t=Rt.x,i=Rt.y,o=Rt.z,s=Dt.x,a=Dt.y,n=Dt.z,e=s-t,r=a-i,_=n-o;let h,c=e*t+r*i+_*o;if(c=-c/(e*e+r*r+_*_),c<0)l.x=t,l.y=i,l.z=o,h=1;else if(c>1)l.x=s,l.y=a,l.z=n,h=2;else{let s,a,n;s=t+e*c,a=i+r*c,n=o+_*c,l.x=s,l.y=a,l.z=n,h=3}let m=l.x*l.x+l.y*l.y+l.z*l.z;(S<0||m<S)&&(T=1&h|(2&h)<<1,S=m,k=l.x,B=l.y,A=l.z)}if(S>0)l.x=k,l.y=B,l.z=A,P=T;else{let s=X*X+y*y+g*g;s>0&&(s=1/Math.sqrt(s)),X*=s,y*=s,g*=s;let a=X*X+y*y+g*g;a=(t*X+i*y+o*g)/a,k=X*a,B=y*a,A=g*a,l.x=k,l.y=B,l.z=A,P=7}let C=l.x*l.x+l.y*l.y+l.z*l.z;(Jt<0||C<Jt)&&(Ot=3&P|(4&P)<<1,Jt=C,Ft=l.x,Nt=l.y,Wt=l.z)}if((st*Tt+at*Ct+nt*jt)*Gt<0){let t,i,o,s,a,n,e,r,_,h,c,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w;t=qt.x,i=qt.y,o=qt.z,s=Et.x,a=Et.y,n=Et.z,e=Dt.x,r=Dt.y,_=Dt.z,h=s-t,c=a-i,m=n-o,b=e-s,x=r-a,p=_-n,f=t-e,u=i-r,v=o-_,X=c*p-m*x,y=m*b-h*p,g=h*x-c*b,d=c*g-m*y,Y=m*X-h*g,z=h*y-c*X,Z=x*g-p*y,M=p*X-b*g,I=b*y-x*X,V=u*g-v*y,L=v*X-f*g,w=f*y-u*X;let k,B,A,P,S=-1,T=0;if(k=0,B=0,A=0,t*d+i*Y+o*z<0){let t,i,o,s,a,n,e,r,_;t=qt.x,i=qt.y,o=qt.z,s=Et.x,a=Et.y,n=Et.z,e=s-t,r=a-i,_=n-o;let h,c=e*t+r*i+_*o;if(c=-c/(e*e+r*r+_*_),c<0)l.x=t,l.y=i,l.z=o,h=1;else if(c>1)l.x=s,l.y=a,l.z=n,h=2;else{let s,a,n;s=t+e*c,a=i+r*c,n=o+_*c,l.x=s,l.y=a,l.z=n,h=3}T=h,S=l.x*l.x+l.y*l.y+l.z*l.z,k=l.x,B=l.y,A=l.z}if(s*Z+a*M+n*I<0){let t,i,o,s,a,n,e,r,_;t=Et.x,i=Et.y,o=Et.z,s=Dt.x,a=Dt.y,n=Dt.z,e=s-t,r=a-i,_=n-o;let h,c=e*t+r*i+_*o;if(c=-c/(e*e+r*r+_*_),c<0)l.x=t,l.y=i,l.z=o,h=1;else if(c>1)l.x=s,l.y=a,l.z=n,h=2;else{let s,a,n;s=t+e*c,a=i+r*c,n=o+_*c,l.x=s,l.y=a,l.z=n,h=3}let m=l.x*l.x+l.y*l.y+l.z*l.z;(S<0||m<S)&&(T=h<<1,S=m,k=l.x,B=l.y,A=l.z)}if(e*V+r*L+_*w<0){let t,i,o,s,a,n,e,r,_;t=qt.x,i=qt.y,o=qt.z,s=Dt.x,a=Dt.y,n=Dt.z,e=s-t,r=a-i,_=n-o;let h,c=e*t+r*i+_*o;if(c=-c/(e*e+r*r+_*_),c<0)l.x=t,l.y=i,l.z=o,h=1;else if(c>1)l.x=s,l.y=a,l.z=n,h=2;else{let s,a,n;s=t+e*c,a=i+r*c,n=o+_*c,l.x=s,l.y=a,l.z=n,h=3}let m=l.x*l.x+l.y*l.y+l.z*l.z;(S<0||m<S)&&(T=1&h|(2&h)<<1,S=m,k=l.x,B=l.y,A=l.z)}if(S>0)l.x=k,l.y=B,l.z=A,P=T;else{let s=X*X+y*y+g*g;s>0&&(s=1/Math.sqrt(s)),X*=s,y*=s,g*=s;let a=X*X+y*y+g*g;a=(t*X+i*y+o*g)/a,k=X*a,B=y*a,A=g*a,l.x=k,l.y=B,l.z=A,P=7}let C=l.x*l.x+l.y*l.y+l.z*l.z;(Jt<0||C<Jt)&&(Ot=P<<1,Jt=C,Ft=l.x,Nt=l.y,Wt=l.z)}Jt>0?(l.x=Ft,l.y=Nt,l.z=Wt,c=Ot):(l.zero(),c=15)}if(l.x*l.x+l.y*l.y+l.z*l.z<1e-8){if(!n)return this.distance=0,0;switch(this.simplexSize){case 1:this.pointToTetrahedron();break;case 2:this.lineToTetrahedron();break;case 3:this.triangleToTetrahedron()}if(4==this.simplexSize){let a=this.computeDepth(t,i,o,s,e,r,_);return 0!=a?(this.distance=0,a):(this.distance=-this.depth,0)}return this.distance=0,1}this.shrinkSimplex(c),h.x=l.x,h.y=l.y,h.z=l.z,h.x=-h.x,h.y=-h.y,h.z=-h.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let m=this.s[this.simplexSize],b=this.w1[this.simplexSize];m.x=b.x,m.y=b.y,m.z=b.z;let p=this.w2[this.simplexSize];if(m.x-=p.x,m.y-=p.y,m.z-=p.z,h.x*h.x+h.y*h.y+h.z*h.z<1e-8)throw new Error("!?");let f=e[this.simplexSize];if(f.x*h.x+f.y*h.y+f.z*h.z-(l.x*h.x+l.y*h.y+l.z*h.z)<1e-8)return this.interpolateClosestPoints(),this.distance=Math.sqrt(l.x*l.x+l.y*l.y+l.z*l.z),null!=a&&null!=a._gjkCache&&this.saveCache(a._gjkCache),0;this.simplexSize++,++x}return 2}convexCastImpl(t,i,o,s,a,n,e){this.c1=t,this.c2=i,this.tf1=o,this.tf2=s;let r,_,l,h=this.s,c=this.closest,m=this.dir;if(r=s._positionX-o._positionX,_=s._positionY-o._positionY,l=s._positionZ-o._positionZ,m.x=r,m.y=_,m.z=l,m.x*m.x+m.y*m.y+m.z*m.z<1e-6&&m.init(1,0,0),this.simplexSize=0,null!=this.c1)this.computeWitnessPoint1(!0);else{let t=this.w1[this.simplexSize];t.x=this.tf1._positionX,t.y=this.tf1._positionY,t.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);let b=this.s[this.simplexSize],x=this.w1[this.simplexSize];b.x=x.x,b.y=x.y,b.z=x.z;let p=this.w2[this.simplexSize];b.x-=p.x,b.y-=p.y,b.z-=p.z,this.simplexSize=1;let f=0,u=0,v=this.rayX,X=this.rayR;for(v.zero(),X.x=n.x,X.y=n.y,X.z=n.z,X.x-=a.x,X.y-=a.y,X.z-=a.z;f<40;){let t=0;switch(this.simplexSize){case 1:let i=h[0];c.x=i.x,c.y=i.y,c.z=i.z,t=1;break;case 2:let o,s,a,n,e,r,_=h[0];o=_.x,s=_.y,a=_.z;let l,m,b,x=h[1];n=x.x,e=x.y,r=x.z,l=n-o,m=e-s,b=r-a;let p=l*o+m*s+b*a;if(p=-p/(l*l+m*m+b*b),p<0)c.x=o,c.y=s,c.z=a,t=1;else if(p>1)c.x=n,c.y=e,c.z=r,t=2;else{let i,n,e;i=o+l*p,n=s+m*p,e=a+b*p,c.x=i,c.y=n,c.z=e,t=3}break;case 3:let f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A,P,S,T,C,j,R,q,E,D,F,N,W,G=h[0],J=h[1],O=h[2];f=G.x,u=G.y,v=G.z,X=J.x,y=J.y,g=J.z,d=O.x,Y=O.y,z=O.z,Z=X-f,M=y-u,I=g-v,V=d-X,L=Y-y,w=z-g,k=f-d,B=u-Y,A=v-z,P=M*w-I*L,S=I*V-Z*w,T=Z*L-M*V,C=M*T-I*S,j=I*P-Z*T,R=Z*S-M*P,q=L*T-w*S,E=w*P-V*T,D=V*S-L*P,F=B*T-A*S,N=A*P-k*T,W=k*S-B*P;let H,U,Q,K=-1,$=0;if(H=0,U=0,Q=0,f*C+u*j+v*R<0){let t,i,o,s,a,n,e,r,_;t=G.x,i=G.y,o=G.z,s=J.x,a=J.y,n=J.z,e=s-t,r=a-i,_=n-o;let l,h=e*t+r*i+_*o;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=o,l=1;else if(h>1)c.x=s,c.y=a,c.z=n,l=2;else{let s,a,n;s=t+e*h,a=i+r*h,n=o+_*h,c.x=s,c.y=a,c.z=n,l=3}$=l,K=c.x*c.x+c.y*c.y+c.z*c.z,H=c.x,U=c.y,Q=c.z}if(X*q+y*E+g*D<0){let t,i,o,s,a,n,e,r,_;t=J.x,i=J.y,o=J.z,s=O.x,a=O.y,n=O.z,e=s-t,r=a-i,_=n-o;let l,h=e*t+r*i+_*o;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=o,l=1;else if(h>1)c.x=s,c.y=a,c.z=n,l=2;else{let s,a,n;s=t+e*h,a=i+r*h,n=o+_*h,c.x=s,c.y=a,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(K<0||m<K)&&($=l<<1,K=m,H=c.x,U=c.y,Q=c.z)}if(d*F+Y*N+z*W<0){let t,i,o,s,a,n,e,r,_;t=G.x,i=G.y,o=G.z,s=O.x,a=O.y,n=O.z,e=s-t,r=a-i,_=n-o;let l,h=e*t+r*i+_*o;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=o,l=1;else if(h>1)c.x=s,c.y=a,c.z=n,l=2;else{let s,a,n;s=t+e*h,a=i+r*h,n=o+_*h,c.x=s,c.y=a,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(K<0||m<K)&&($=1&l|(2&l)<<1,K=m,H=c.x,U=c.y,Q=c.z)}if(K>0)c.x=H,c.y=U,c.z=Q,t=$;else{let i=P*P+S*S+T*T;i>0&&(i=1/Math.sqrt(i)),P*=i,S*=i,T*=i;let o=P*P+S*S+T*T;o=(f*P+u*S+v*T)/o,H=P*o,U=S*o,Q=T*o,c.x=H,c.y=U,c.z=Q,t=7}break;case 4:let tt,it,ot,st,at,nt,et,rt,_t,lt,ht,ct,mt,bt,xt,pt,ft,ut,vt,Xt,yt,gt,dt,Yt,zt,Zt,Mt,It,Vt,Lt,wt,kt,Bt,At,Pt,St,Tt,Ct,jt,Rt=h[0],qt=h[1],Et=h[2],Dt=h[3];tt=Rt.x,it=Rt.y,ot=Rt.z,st=qt.x,at=qt.y,nt=qt.z,et=Et.x,rt=Et.y,_t=Et.z,lt=Dt.x,ht=Dt.y,ct=Dt.z,mt=st-tt,bt=at-it,xt=nt-ot,pt=et-tt,ft=rt-it,ut=_t-ot,vt=lt-tt,Xt=ht-it,yt=ct-ot,gt=et-st,dt=rt-at,Yt=_t-nt,zt=lt-st,Zt=ht-at,Mt=ct-nt,It=bt*ut-xt*ft,Vt=xt*pt-mt*ut,Lt=mt*ft-bt*pt,wt=ft*yt-ut*Xt,kt=ut*vt-pt*yt,Bt=pt*Xt-ft*vt,At=Xt*xt-yt*bt,Pt=yt*mt-vt*xt,St=vt*bt-Xt*mt,Tt=Zt*Yt-Mt*dt,Ct=Mt*gt-zt*Yt,jt=zt*dt-Zt*gt;let Ft,Nt,Wt,Gt=mt*Tt+bt*Ct+xt*jt>0?1:-1,Jt=-1,Ot=0;if(Ft=0,Nt=0,Wt=0,(tt*It+it*Vt+ot*Lt)*Gt<0){let t,i,o,s,a,n,e,r,_,l,h,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w;t=Rt.x,i=Rt.y,o=Rt.z,s=qt.x,a=qt.y,n=qt.z,e=Et.x,r=Et.y,_=Et.z,l=s-t,h=a-i,m=n-o,b=e-s,x=r-a,p=_-n,f=t-e,u=i-r,v=o-_,X=h*p-m*x,y=m*b-l*p,g=l*x-h*b,d=h*g-m*y,Y=m*X-l*g,z=l*y-h*X,Z=x*g-p*y,M=p*X-b*g,I=b*y-x*X,V=u*g-v*y,L=v*X-f*g,w=f*y-u*X;let k,B,A,P,S=-1,T=0;if(k=0,B=0,A=0,t*d+i*Y+o*z<0){let t,i,o,s,a,n,e,r,_;t=Rt.x,i=Rt.y,o=Rt.z,s=qt.x,a=qt.y,n=qt.z,e=s-t,r=a-i,_=n-o;let l,h=e*t+r*i+_*o;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=o,l=1;else if(h>1)c.x=s,c.y=a,c.z=n,l=2;else{let s,a,n;s=t+e*h,a=i+r*h,n=o+_*h,c.x=s,c.y=a,c.z=n,l=3}T=l,S=c.x*c.x+c.y*c.y+c.z*c.z,k=c.x,B=c.y,A=c.z}if(s*Z+a*M+n*I<0){let t,i,o,s,a,n,e,r,_;t=qt.x,i=qt.y,o=qt.z,s=Et.x,a=Et.y,n=Et.z,e=s-t,r=a-i,_=n-o;let l,h=e*t+r*i+_*o;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=o,l=1;else if(h>1)c.x=s,c.y=a,c.z=n,l=2;else{let s,a,n;s=t+e*h,a=i+r*h,n=o+_*h,c.x=s,c.y=a,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(S<0||m<S)&&(T=l<<1,S=m,k=c.x,B=c.y,A=c.z)}if(e*V+r*L+_*w<0){let t,i,o,s,a,n,e,r,_;t=Rt.x,i=Rt.y,o=Rt.z,s=Et.x,a=Et.y,n=Et.z,e=s-t,r=a-i,_=n-o;let l,h=e*t+r*i+_*o;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=o,l=1;else if(h>1)c.x=s,c.y=a,c.z=n,l=2;else{let s,a,n;s=t+e*h,a=i+r*h,n=o+_*h,c.x=s,c.y=a,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(S<0||m<S)&&(T=1&l|(2&l)<<1,S=m,k=c.x,B=c.y,A=c.z)}if(S>0)c.x=k,c.y=B,c.z=A,P=T;else{let s=X*X+y*y+g*g;s>0&&(s=1/Math.sqrt(s)),X*=s,y*=s,g*=s;let a=X*X+y*y+g*g;a=(t*X+i*y+o*g)/a,k=X*a,B=y*a,A=g*a,c.x=k,c.y=B,c.z=A,P=7}Ot=P,Jt=c.x*c.x+c.y*c.y+c.z*c.z,Ft=c.x,Nt=c.y,Wt=c.z}if((tt*wt+it*kt+ot*Bt)*Gt<0){let t,i,o,s,a,n,e,r,_,l,h,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w;t=Rt.x,i=Rt.y,o=Rt.z,s=Et.x,a=Et.y,n=Et.z,e=Dt.x,r=Dt.y,_=Dt.z,l=s-t,h=a-i,m=n-o,b=e-s,x=r-a,p=_-n,f=t-e,u=i-r,v=o-_,X=h*p-m*x,y=m*b-l*p,g=l*x-h*b,d=h*g-m*y,Y=m*X-l*g,z=l*y-h*X,Z=x*g-p*y,M=p*X-b*g,I=b*y-x*X,V=u*g-v*y,L=v*X-f*g,w=f*y-u*X;let k,B,A,P,S=-1,T=0;if(k=0,B=0,A=0,t*d+i*Y+o*z<0){let t,i,o,s,a,n,e,r,_;t=Rt.x,i=Rt.y,o=Rt.z,s=Et.x,a=Et.y,n=Et.z,e=s-t,r=a-i,_=n-o;let l,h=e*t+r*i+_*o;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=o,l=1;else if(h>1)c.x=s,c.y=a,c.z=n,l=2;else{let s,a,n;s=t+e*h,a=i+r*h,n=o+_*h,c.x=s,c.y=a,c.z=n,l=3}T=l,S=c.x*c.x+c.y*c.y+c.z*c.z,k=c.x,B=c.y,A=c.z}if(s*Z+a*M+n*I<0){let t,i,o,s,a,n,e,r,_;t=Et.x,i=Et.y,o=Et.z,s=Dt.x,a=Dt.y,n=Dt.z,e=s-t,r=a-i,_=n-o;let l,h=e*t+r*i+_*o;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=o,l=1;else if(h>1)c.x=s,c.y=a,c.z=n,l=2;else{let s,a,n;s=t+e*h,a=i+r*h,n=o+_*h,c.x=s,c.y=a,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(S<0||m<S)&&(T=l<<1,S=m,k=c.x,B=c.y,A=c.z)}if(e*V+r*L+_*w<0){let t,i,o,s,a,n,e,r,_;t=Rt.x,i=Rt.y,o=Rt.z,s=Dt.x,a=Dt.y,n=Dt.z,e=s-t,r=a-i,_=n-o;let l,h=e*t+r*i+_*o;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=o,l=1;else if(h>1)c.x=s,c.y=a,c.z=n,l=2;else{let s,a,n;s=t+e*h,a=i+r*h,n=o+_*h,c.x=s,c.y=a,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(S<0||m<S)&&(T=1&l|(2&l)<<1,S=m,k=c.x,B=c.y,A=c.z)}if(S>0)c.x=k,c.y=B,c.z=A,P=T;else{let s=X*X+y*y+g*g;s>0&&(s=1/Math.sqrt(s)),X*=s,y*=s,g*=s;let a=X*X+y*y+g*g;a=(t*X+i*y+o*g)/a,k=X*a,B=y*a,A=g*a,c.x=k,c.y=B,c.z=A,P=7}let C=c.x*c.x+c.y*c.y+c.z*c.z;(Jt<0||C<Jt)&&(Ot=1&P|(6&P)<<1,Jt=C,Ft=c.x,Nt=c.y,Wt=c.z)}if((tt*At+it*Pt+ot*St)*Gt<0){let t,i,o,s,a,n,e,r,_,l,h,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w;t=Rt.x,i=Rt.y,o=Rt.z,s=qt.x,a=qt.y,n=qt.z,e=Dt.x,r=Dt.y,_=Dt.z,l=s-t,h=a-i,m=n-o,b=e-s,x=r-a,p=_-n,f=t-e,u=i-r,v=o-_,X=h*p-m*x,y=m*b-l*p,g=l*x-h*b,d=h*g-m*y,Y=m*X-l*g,z=l*y-h*X,Z=x*g-p*y,M=p*X-b*g,I=b*y-x*X,V=u*g-v*y,L=v*X-f*g,w=f*y-u*X;let k,B,A,P,S=-1,T=0;if(k=0,B=0,A=0,t*d+i*Y+o*z<0){let t,i,o,s,a,n,e,r,_;t=Rt.x,i=Rt.y,o=Rt.z,s=qt.x,a=qt.y,n=qt.z,e=s-t,r=a-i,_=n-o;let l,h=e*t+r*i+_*o;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=o,l=1;else if(h>1)c.x=s,c.y=a,c.z=n,l=2;else{let s,a,n;s=t+e*h,a=i+r*h,n=o+_*h,c.x=s,c.y=a,c.z=n,l=3}T=l,S=c.x*c.x+c.y*c.y+c.z*c.z,k=c.x,B=c.y,A=c.z}if(s*Z+a*M+n*I<0){let t,i,o,s,a,n,e,r,_;t=qt.x,i=qt.y,o=qt.z,s=Dt.x,a=Dt.y,n=Dt.z,e=s-t,r=a-i,_=n-o;let l,h=e*t+r*i+_*o;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=o,l=1;else if(h>1)c.x=s,c.y=a,c.z=n,l=2;else{let s,a,n;s=t+e*h,a=i+r*h,n=o+_*h,c.x=s,c.y=a,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(S<0||m<S)&&(T=l<<1,S=m,k=c.x,B=c.y,A=c.z)}if(e*V+r*L+_*w<0){let t,i,o,s,a,n,e,r,_;t=Rt.x,i=Rt.y,o=Rt.z,s=Dt.x,a=Dt.y,n=Dt.z,e=s-t,r=a-i,_=n-o;let l,h=e*t+r*i+_*o;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=o,l=1;else if(h>1)c.x=s,c.y=a,c.z=n,l=2;else{let s,a,n;s=t+e*h,a=i+r*h,n=o+_*h,c.x=s,c.y=a,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(S<0||m<S)&&(T=1&l|(2&l)<<1,S=m,k=c.x,B=c.y,A=c.z)}if(S>0)c.x=k,c.y=B,c.z=A,P=T;else{let s=X*X+y*y+g*g;s>0&&(s=1/Math.sqrt(s)),X*=s,y*=s,g*=s;let a=X*X+y*y+g*g;a=(t*X+i*y+o*g)/a,k=X*a,B=y*a,A=g*a,c.x=k,c.y=B,c.z=A,P=7}let C=c.x*c.x+c.y*c.y+c.z*c.z;(Jt<0||C<Jt)&&(Ot=3&P|(4&P)<<1,Jt=C,Ft=c.x,Nt=c.y,Wt=c.z)}if((st*Tt+at*Ct+nt*jt)*Gt<0){let t,i,o,s,a,n,e,r,_,l,h,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w;t=qt.x,i=qt.y,o=qt.z,s=Et.x,a=Et.y,n=Et.z,e=Dt.x,r=Dt.y,_=Dt.z,l=s-t,h=a-i,m=n-o,b=e-s,x=r-a,p=_-n,f=t-e,u=i-r,v=o-_,X=h*p-m*x,y=m*b-l*p,g=l*x-h*b,d=h*g-m*y,Y=m*X-l*g,z=l*y-h*X,Z=x*g-p*y,M=p*X-b*g,I=b*y-x*X,V=u*g-v*y,L=v*X-f*g,w=f*y-u*X;let k,B,A,P,S=-1,T=0;if(k=0,B=0,A=0,t*d+i*Y+o*z<0){let t,i,o,s,a,n,e,r,_;t=qt.x,i=qt.y,o=qt.z,s=Et.x,a=Et.y,n=Et.z,e=s-t,r=a-i,_=n-o;let l,h=e*t+r*i+_*o;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=o,l=1;else if(h>1)c.x=s,c.y=a,c.z=n,l=2;else{let s,a,n;s=t+e*h,a=i+r*h,n=o+_*h,c.x=s,c.y=a,c.z=n,l=3}T=l,S=c.x*c.x+c.y*c.y+c.z*c.z,k=c.x,B=c.y,A=c.z}if(s*Z+a*M+n*I<0){let t,i,o,s,a,n,e,r,_;t=Et.x,i=Et.y,o=Et.z,s=Dt.x,a=Dt.y,n=Dt.z,e=s-t,r=a-i,_=n-o;let l,h=e*t+r*i+_*o;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=o,l=1;else if(h>1)c.x=s,c.y=a,c.z=n,l=2;else{let s,a,n;s=t+e*h,a=i+r*h,n=o+_*h,c.x=s,c.y=a,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(S<0||m<S)&&(T=l<<1,S=m,k=c.x,B=c.y,A=c.z)}if(e*V+r*L+_*w<0){let t,i,o,s,a,n,e,r,_;t=qt.x,i=qt.y,o=qt.z,s=Dt.x,a=Dt.y,n=Dt.z,e=s-t,r=a-i,_=n-o;let l,h=e*t+r*i+_*o;if(h=-h/(e*e+r*r+_*_),h<0)c.x=t,c.y=i,c.z=o,l=1;else if(h>1)c.x=s,c.y=a,c.z=n,l=2;else{let s,a,n;s=t+e*h,a=i+r*h,n=o+_*h,c.x=s,c.y=a,c.z=n,l=3}let m=c.x*c.x+c.y*c.y+c.z*c.z;(S<0||m<S)&&(T=1&l|(2&l)<<1,S=m,k=c.x,B=c.y,A=c.z)}if(S>0)c.x=k,c.y=B,c.z=A,P=T;else{let s=X*X+y*y+g*g;s>0&&(s=1/Math.sqrt(s)),X*=s,y*=s,g*=s;let a=X*X+y*y+g*g;a=(t*X+i*y+o*g)/a,k=X*a,B=y*a,A=g*a,c.x=k,c.y=B,c.z=A,P=7}let C=c.x*c.x+c.y*c.y+c.z*c.z;(Jt<0||C<Jt)&&(Ot=P<<1,Jt=C,Ft=c.x,Nt=c.y,Wt=c.z)}Jt>0?(c.x=Ft,c.y=Nt,c.z=Wt,t=Ot):(c.zero(),t=15)}if(this.shrinkSimplex(t),c.x*c.x+c.y*c.y+c.z*c.z<1e-8){if(0==u||4==this.simplexSize)return e.fraction=u,!1;this.interpolateClosestPoints(),e.fraction=u;let t=e.normal;t.x=m.x,t.y=m.y,t.z=m.z;let i=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);i>0&&(i=1/i),t.x*=i,t.y*=i,t.z*=i;let o=e.position,s=this.closestPoint1;return o.x=s.x,o.y=s.y,o.z=s.z,o.x+=a.x*u,o.y+=a.y*u,o.z+=a.z*u,!0}if(m.x=c.x,m.y=c.y,m.z=c.z,m.x=-m.x,m.y=-m.y,m.z=-m.z,null!=this.c1)this.computeWitnessPoint1(!0);else{let t=this.w1[this.simplexSize];t.x=this.tf1._positionX,t.y=this.tf1._positionY,t.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);let i=this.s[this.simplexSize],o=this.w1[this.simplexSize];i.x=o.x,i.y=o.y,i.z=o.z;let s=this.w2[this.simplexSize];i.x-=s.x,i.y-=s.y,i.z-=s.z;let n=h[this.simplexSize];if(n.x-=v.x,n.y-=v.y,n.z-=v.z,m.x*m.x+m.y*m.y+m.z*m.z<1e-8)throw new Error("!?");let r=h[this.simplexSize],_=r.x*m.x+r.y*m.y+r.z*m.z;if(_<0){if(X.x*m.x+X.y*m.y+X.z*m.z>=0)return!1;let t=_/(X.x*m.x+X.y*m.y+X.z*m.z);if(u+=t,u>=1)return!1;v.x+=X.x*t,v.y+=X.y*t,v.z+=X.z*t;let i=0,o=this.simplexSize+1;for(;i<o;){let o=h[i++],s=-t;o.x+=X.x*s,o.y+=X.y*s,o.z+=X.z*s}}let l=!1,b=0,x=this.simplexSize;for(;b<x;){let t=b++,i=h[t].x-h[this.simplexSize].x,o=h[t].y-h[this.simplexSize].y,s=h[t].z-h[this.simplexSize].z;if(i*i+o*o+s*s<1e-8){l=!0;break}}l||this.simplexSize++,++f}return!1}interpolateClosestPoints(){switch(this.simplexSize){case 1:let t=this.closestPoint1,i=this.w1[0];t.x=i.x,t.y=i.y,t.z=i.z;let o=this.closestPoint2,s=this.w2[0];o.x=s.x,o.y=s.y,o.z=s.z;break;case 2:let a,n,e,r,_,l,h,c,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z=this.closest;a=Z.x,n=Z.y,e=Z.z;let M=this.s[0];r=M.x,_=M.y,l=M.z;let I=this.w1[0];h=I.x,c=I.y,m=I.z;let V=this.w2[0];b=V.x,x=V.y,p=V.z;let L=this.s[1];f=L.x,u=L.y,v=L.z;let w=this.w1[1];X=w.x,y=w.y,g=w.z;let k,B,A,P=this.w2[1];d=P.x,Y=P.y,z=P.z,k=f-r,B=u-_,A=v-l;let S,T,C,j=k*k+B*B+A*A;0!=j&&(j=1/j),S=a-r,T=n-_,C=e-l;let R,q,E,D,F,N,W,G,J,O=(S*k+T*B+C*A)*j;R=X-h,q=y-c,E=g-m,D=h+R*O,F=c+q*O,N=m+E*O,R=d-b,q=Y-x,E=z-p,W=b+R*O,G=x+q*O,J=p+E*O;let H=this.closestPoint1;H.x=D,H.y=F,H.z=N;let U=this.closestPoint2;U.x=W,U.y=G,U.z=J;break;case 3:let Q,K,$,tt,it,ot,st,at,nt,et,rt,_t,lt,ht,ct,mt,bt,xt,pt,ft,ut,vt,Xt,yt,gt,dt,Yt,zt,Zt,Mt,It=this.closest;Q=It.x,K=It.y,$=It.z;let Vt=this.s[0];tt=Vt.x,it=Vt.y,ot=Vt.z;let Lt=this.w1[0];st=Lt.x,at=Lt.y,nt=Lt.z;let wt=this.w2[0];et=wt.x,rt=wt.y,_t=wt.z;let kt=this.s[1];lt=kt.x,ht=kt.y,ct=kt.z;let Bt=this.w1[1];mt=Bt.x,bt=Bt.y,xt=Bt.z;let At=this.w2[1];pt=At.x,ft=At.y,ut=At.z;let Pt=this.s[2];vt=Pt.x,Xt=Pt.y,yt=Pt.z;let St=this.w1[2];gt=St.x,dt=St.y,Yt=St.z;let Tt,Ct,jt,Rt,qt,Et,Dt,Ft,Nt,Wt=this.w2[2];zt=Wt.x,Zt=Wt.y,Mt=Wt.z,Tt=lt-tt,Ct=ht-it,jt=ct-ot,Rt=vt-tt,qt=Xt-it,Et=yt-ot,Dt=Q-tt,Ft=K-it,Nt=$-ot;let Gt=Tt*Tt+Ct*Ct+jt*jt,Jt=Tt*Rt+Ct*qt+jt*Et,Ot=Rt*Rt+qt*qt+Et*Et,Ht=Tt*Dt+Ct*Ft+jt*Nt,Ut=Rt*Dt+qt*Ft+Et*Nt,Qt=Gt*Ot-Jt*Jt;0!=Qt&&(Qt=1/Qt);let Kt,$t,ti,ii,oi,si,ai,ni,ei,ri=(Ht*Ot-Ut*Jt)*Qt,_i=(-Ht*Jt+Ut*Gt)*Qt;Kt=mt-st,$t=bt-at,ti=xt-nt,ii=st+Kt*ri,oi=at+$t*ri,si=nt+ti*ri,Kt=gt-st,$t=dt-at,ti=Yt-nt,ii+=Kt*_i,oi+=$t*_i,si+=ti*_i,Kt=pt-et,$t=ft-rt,ti=ut-_t,ai=et+Kt*ri,ni=rt+$t*ri,ei=_t+ti*ri,Kt=zt-et,$t=Zt-rt,ti=Mt-_t,ai+=Kt*_i,ni+=$t*_i,ei+=ti*_i;let li=this.closestPoint1;li.x=ii,li.y=oi,li.z=si;let hi=this.closestPoint2;hi.x=ai,hi.y=ni,hi.z=ei;break;default:throw new Error("!?")}}loadCache(t){let i=this.dir,o=t.prevClosestDir;i.x=o.x,i.y=o.y,i.z=o.z}saveCache(t){let i=t.prevClosestDir,o=this.closest;i.x=o.x,i.y=o.y,i.z=o.z,i.x=-i.x,i.y=-i.y,i.z=-i.z}shrinkSimplex(t){switch(this.simplexSize=t,this.simplexSize=(5&this.simplexSize)+(this.simplexSize>>1&5),this.simplexSize=(3&this.simplexSize)+(this.simplexSize>>2&3),t){case 2:let t=this.s[0],i=this.s[1];t.x=i.x,t.y=i.y,t.z=i.z;let o=this.w1[0],s=this.w1[1];o.x=s.x,o.y=s.y,o.z=s.z;let a=this.w2[0],n=this.w2[1];a.x=n.x,a.y=n.y,a.z=n.z;break;case 4:let e=this.s[0],r=this.s[2];e.x=r.x,e.y=r.y,e.z=r.z;let _=this.w1[0],l=this.w1[2];_.x=l.x,_.y=l.y,_.z=l.z;let h=this.w2[0],c=this.w2[2];h.x=c.x,h.y=c.y,h.z=c.z;break;case 5:let m=this.s[1],b=this.s[2];m.x=b.x,m.y=b.y,m.z=b.z;let x=this.w1[1],p=this.w1[2];x.x=p.x,x.y=p.y,x.z=p.z;let f=this.w2[1],u=this.w2[2];f.x=u.x,f.y=u.y,f.z=u.z;break;case 6:let v=this.s[0],X=this.s[2];v.x=X.x,v.y=X.y,v.z=X.z;let y=this.w1[0],g=this.w1[2];y.x=g.x,y.y=g.y,y.z=g.z;let d=this.w2[0],Y=this.w2[2];d.x=Y.x,d.y=Y.y,d.z=Y.z;break;case 8:let z=this.s[0],Z=this.s[3];z.x=Z.x,z.y=Z.y,z.z=Z.z;let M=this.w1[0],I=this.w1[3];M.x=I.x,M.y=I.y,M.z=I.z;let V=this.w2[0],L=this.w2[3];V.x=L.x,V.y=L.y,V.z=L.z;break;case 9:let w=this.s[1],k=this.s[3];w.x=k.x,w.y=k.y,w.z=k.z;let B=this.w1[1],A=this.w1[3];B.x=A.x,B.y=A.y,B.z=A.z;let P=this.w2[1],S=this.w2[3];P.x=S.x,P.y=S.y,P.z=S.z;break;case 10:let T=this.s[0],C=this.s[3];T.x=C.x,T.y=C.y,T.z=C.z;let j=this.w1[0],R=this.w1[3];j.x=R.x,j.y=R.y,j.z=R.z;let q=this.w2[0],E=this.w2[3];q.x=E.x,q.y=E.y,q.z=E.z;break;case 11:let D=this.s[2],F=this.s[3];D.x=F.x,D.y=F.y,D.z=F.z;let N=this.w1[2],W=this.w1[3];N.x=W.x,N.y=W.y,N.z=W.z;let G=this.w2[2],J=this.w2[3];G.x=J.x,G.y=J.y,G.z=J.z;break;case 12:let O=this.s[0],H=this.s[2];O.x=H.x,O.y=H.y,O.z=H.z;let U=this.w1[0],Q=this.w1[2];U.x=Q.x,U.y=Q.y,U.z=Q.z;let K=this.w2[0],$=this.w2[2];K.x=$.x,K.y=$.y,K.z=$.z;let tt=this.s[1],it=this.s[3];tt.x=it.x,tt.y=it.y,tt.z=it.z;let ot=this.w1[1],st=this.w1[3];ot.x=st.x,ot.y=st.y,ot.z=st.z;let at=this.w2[1],nt=this.w2[3];at.x=nt.x,at.y=nt.y,at.z=nt.z;break;case 13:let et=this.s[1],rt=this.s[3];et.x=rt.x,et.y=rt.y,et.z=rt.z;let _t=this.w1[1],lt=this.w1[3];_t.x=lt.x,_t.y=lt.y,_t.z=lt.z;let ht=this.w2[1],ct=this.w2[3];ht.x=ct.x,ht.y=ct.y,ht.z=ct.z;break;case 14:let mt=this.s[0],bt=this.s[3];mt.x=bt.x,mt.y=bt.y,mt.z=bt.z;let xt=this.w1[0],pt=this.w1[3];xt.x=pt.x,xt.y=pt.y,xt.z=pt.z;let ft=this.w2[0],ut=this.w2[3];ft.x=ut.x,ft.y=ut.y,ft.z=ut.z}}computeWitnessPoint1(t){let i,o,s,a,n,e,r,_,l,h,c,m,b,x,p,f=this.dir;a=f.x,n=f.y,e=f.z,h=this.tf1._rotation00*a+this.tf1._rotation10*n+this.tf1._rotation20*e,c=this.tf1._rotation01*a+this.tf1._rotation11*n+this.tf1._rotation21*e,m=this.tf1._rotation02*a+this.tf1._rotation12*n+this.tf1._rotation22*e,r=h,_=c,l=m;let u=this.dir;if(u.x=r,u.y=_,u.z=l,this.c1.computeLocalSupportingVertex(this.dir,this.w1[this.simplexSize]),t){let t=this.dir,i=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);i>0&&(i=1/i),t.x*=i,t.y*=i,t.z*=i;let o=this.w1[this.simplexSize],s=this.dir,a=this.c1._gjkMargin;o.x+=s.x*a,o.y+=s.y*a,o.z+=s.z*a}let v,X,y,g=this.w1[this.simplexSize];i=g.x,o=g.y,s=g.z,v=this.tf1._rotation00*i+this.tf1._rotation01*o+this.tf1._rotation02*s,X=this.tf1._rotation10*i+this.tf1._rotation11*o+this.tf1._rotation12*s,y=this.tf1._rotation20*i+this.tf1._rotation21*o+this.tf1._rotation22*s,b=v,x=X,p=y,b+=this.tf1._positionX,x+=this.tf1._positionY,p+=this.tf1._positionZ;let d=this.w1[this.simplexSize];d.x=b,d.y=x,d.z=p;let Y=this.dir;Y.x=a,Y.y=n,Y.z=e}computeWitnessPoint2(t){let i,o,s,a,n,e,r,_,l,h,c,m,b,x,p,f=this.dir;a=f.x,n=f.y,e=f.z,h=this.tf2._rotation00*a+this.tf2._rotation10*n+this.tf2._rotation20*e,c=this.tf2._rotation01*a+this.tf2._rotation11*n+this.tf2._rotation21*e,m=this.tf2._rotation02*a+this.tf2._rotation12*n+this.tf2._rotation22*e,r=h,_=c,l=m,r=-r,_=-_,l=-l;let u=this.dir;if(u.x=r,u.y=_,u.z=l,this.c2.computeLocalSupportingVertex(this.dir,this.w2[this.simplexSize]),t){let t=this.dir,i=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z);i>0&&(i=1/i),t.x*=i,t.y*=i,t.z*=i;let o=this.w2[this.simplexSize],s=this.dir,a=this.c2._gjkMargin;o.x+=s.x*a,o.y+=s.y*a,o.z+=s.z*a}let v,X,y,g=this.w2[this.simplexSize];i=g.x,o=g.y,s=g.z,v=this.tf2._rotation00*i+this.tf2._rotation01*o+this.tf2._rotation02*s,X=this.tf2._rotation10*i+this.tf2._rotation11*o+this.tf2._rotation12*s,y=this.tf2._rotation20*i+this.tf2._rotation21*o+this.tf2._rotation22*s,b=v,x=X,p=y,b+=this.tf2._positionX,x+=this.tf2._positionY,p+=this.tf2._positionZ;let d=this.w2[this.simplexSize];d.x=b,d.y=x,d.z=p;let Y=this.dir;Y.x=a,Y.y=n,Y.z=e}pointToTetrahedron(){let t=0;for(;t<3;){let i=this.dir,o=this.baseDirs[t++];i.x=o.x,i.y=o.y,i.z=o.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let s=this.s[this.simplexSize],a=this.w1[this.simplexSize];s.x=a.x,s.y=a.y,s.z=a.z;let n=this.w2[this.simplexSize];if(s.x-=n.x,s.y-=n.y,s.z-=n.z,this.simplexSize++,this.lineToTetrahedron(),4==this.simplexSize)break;this.simplexSize--;let e=this.dir;e.x=-e.x,e.y=-e.y,e.z=-e.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let r=this.s[this.simplexSize],_=this.w1[this.simplexSize];r.x=_.x,r.y=_.y,r.z=_.z;let l=this.w2[this.simplexSize];if(r.x-=l.x,r.y-=l.y,r.z-=l.z,this.simplexSize++,this.lineToTetrahedron(),4==this.simplexSize)break;this.simplexSize--}}lineToTetrahedron(){let t,i,o,s,a,n,e,r,_,l,h,c,m=this.dir;t=m.x,i=m.y,o=m.z;let b=this.s[0];s=b.x,a=b.y,n=b.z;let x=this.s[1];e=x.x,r=x.y,_=x.z,l=s-e,h=a-r,c=n-_;let p=0;for(;p<3;){let t,i,o,s,a,n,e=this.baseDirs[p++];t=e.x,i=e.y,o=e.z,s=h*o-c*i,a=c*t-l*o,n=l*i-h*t;let r=this.dir;r.x=s,r.y=a,r.z=n,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let _=this.s[this.simplexSize],m=this.w1[this.simplexSize];_.x=m.x,_.y=m.y,_.z=m.z;let b=this.w2[this.simplexSize];if(_.x-=b.x,_.y-=b.y,_.z-=b.z,this.simplexSize++,this.triangleToTetrahedron(),4==this.simplexSize)break;this.simplexSize--;let x=this.dir;x.x=-x.x,x.y=-x.y,x.z=-x.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let f=this.s[this.simplexSize],u=this.w1[this.simplexSize];f.x=u.x,f.y=u.y,f.z=u.z;let v=this.w2[this.simplexSize];if(f.x-=v.x,f.y-=v.y,f.z-=v.z,this.simplexSize++,this.triangleToTetrahedron(),4==this.simplexSize)break;this.simplexSize--}let f=this.dir;f.x=t,f.y=i,f.z=o}triangleToTetrahedron(){let t,i,o,s=this.dir;for(t=s.x,i=s.y,o=s.z;;){let t,i,o,s,a,n,e,r,_,l,h,c,m,b,x,p=this.s[0];t=p.x,i=p.y,o=p.z;let f=this.s[1];s=f.x,a=f.y,n=f.z;let u,v,X,y=this.s[2];e=y.x,r=y.y,_=y.z,l=s-t,h=a-i,c=n-o,m=e-t,b=r-i,x=_-o,u=h*x-c*b,v=c*m-l*x,X=l*b-h*m;let g=this.dir;g.x=u,g.y=v,g.z=X,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let d=this.s[this.simplexSize],Y=this.w1[this.simplexSize];d.x=Y.x,d.y=Y.y,d.z=Y.z;let z=this.w2[this.simplexSize];if(d.x-=z.x,d.y-=z.y,d.z-=z.z,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;let Z=this.dir;Z.x=-Z.x,Z.y=-Z.y,Z.z=-Z.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let M=this.s[this.simplexSize],I=this.w1[this.simplexSize];M.x=I.x,M.y=I.y,M.z=I.z;let V=this.w2[this.simplexSize];if(M.x-=V.x,M.y-=V.y,M.z-=V.z,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;break}let a=this.dir;a.x=t,a.y=i,a.z=o}isValidTetrahedron(){let t=this.s[2].x-this.s[0].x,i=this.s[2].y-this.s[0].y,o=this.s[2].z-this.s[0].z,s=this.s[3].x-this.s[0].x,a=this.s[3].y-this.s[0].y,n=this.s[3].z-this.s[0].z,e=(this.s[1].x-this.s[0].x)*(i*n-o*a)-(this.s[1].y-this.s[0].y)*(t*n-o*s)+(this.s[1].z-this.s[0].z)*(t*a-i*s);return e>1e-12||e<-1e-12}computeDepth(t,i,o,s,a,n,e){let r=this.polyhedron;for(;r._numTriangles>0;){let t=r._triangleList;r._numTriangles--;let i=t._prev,o=t._next;null!=i&&(i._next=o),null!=o&&(o._prev=i),t==r._triangleList&&(r._triangleList=r._triangleList._next),t==r._triangleListLast&&(r._triangleListLast=r._triangleListLast._prev),t._next=null,t._prev=null,t.removeReferences(),t._next=r._trianglePool,r._trianglePool=t}for(;r._numVertices>0;){let t=r._vertices[--r._numVertices];t.removeReferences(),t._next=r._vertexPool,r._vertexPool=t}let _=this.polyhedron,l=this.polyhedron,h=l._vertexPool;null!=h?(l._vertexPool=h._next,h._next=null):h=new oimo.collision.narrowphase.detector.gjkepa.EpaVertex;let c=h.init(a[0],n[0],e[0]),m=this.polyhedron,b=m._vertexPool;null!=b?(m._vertexPool=b._next,b._next=null):b=new oimo.collision.narrowphase.detector.gjkepa.EpaVertex;let x=b.init(a[1],n[1],e[1]),p=this.polyhedron,f=p._vertexPool;null!=f?(p._vertexPool=f._next,f._next=null):f=new oimo.collision.narrowphase.detector.gjkepa.EpaVertex;let u=f.init(a[2],n[2],e[2]),v=this.polyhedron,X=v._vertexPool;if(null!=X?(v._vertexPool=X._next,X._next=null):X=new oimo.collision.narrowphase.detector.gjkepa.EpaVertex,!_._init(c,x,u,X.init(a[3],n[3],e[3])))return oimo.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT;this.simplexSize=0;let y=this.s[0],g=this.w1[0],d=this.w2[0],Y=0;for(;Y<40;){let t=this.polyhedron._triangleList,i=Infinity,o=null;for(;null!=t;)t._distanceSq<i&&(i=t._distanceSq,o=t),t=t._next;let s=o,a=this.dir,n=s._normal;a.x=n.x,a.y=n.y,a.z=n.z;let e=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z);e>0&&(e=1/e),a.x*=e,a.y*=e,a.z*=e,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let r=this.s[this.simplexSize],_=this.w1[this.simplexSize];r.x=_.x,r.y=_.y,r.z=_.z;let l=this.w2[this.simplexSize];r.x-=l.x,r.y-=l.y,r.z-=l.z;let h=s._vertices[0],c=s._vertices[1],m=s._vertices[2],b=h.v,x=this.dir,p=this.dir;if(y.x*p.x+y.y*p.y+y.z*p.z-(b.x*x.x+b.y*x.y+b.z*x.z)<1e-6||39==Y){let t=this.closest,i=this.dir;t.x=i.x,t.y=i.y,t.z=i.z;let o,s,a,n=this.dir,e=h.v,r=this.dir,_=(n.x*e.x+n.y*e.y+n.z*e.z)/(r.x*r.x+r.y*r.y+r.z*r.z);t.x*=_,t.y*=_,t.z*=_;let l,b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A,P,S,T,C,j,R=this.closest;o=R.x,s=R.y,a=R.z;let q=h.v;l=q.x,b=q.y,x=q.z;let E=h.w1;p=E.x,f=E.y,u=E.z;let D=h.w2;v=D.x,X=D.y,y=D.z;let F=c.v;g=F.x,d=F.y,Y=F.z;let N=c.w1;z=N.x,Z=N.y,M=N.z;let W=c.w2;I=W.x,V=W.y,L=W.z;let G=m.v;w=G.x,k=G.y,B=G.z;let J=m.w1;A=J.x,P=J.y,S=J.z;let O,H,U,Q,K,$,tt,it,ot,st=m.w2;T=st.x,C=st.y,j=st.z,O=g-l,H=d-b,U=Y-x,Q=w-l,K=k-b,$=B-x,tt=o-l,it=s-b,ot=a-x;let at=O*O+H*H+U*U,nt=O*Q+H*K+U*$,et=Q*Q+K*K+$*$,rt=O*tt+H*it+U*ot,_t=Q*tt+K*it+$*ot,lt=at*et-nt*nt;0!=lt&&(lt=1/lt);let ht,ct,mt,bt,xt,pt,ft,ut,vt,Xt=(rt*et-_t*nt)*lt,yt=(-rt*nt+_t*at)*lt;ht=z-p,ct=Z-f,mt=M-u,bt=p+ht*Xt,xt=f+ct*Xt,pt=u+mt*Xt,ht=A-p,ct=P-f,mt=S-u,bt+=ht*yt,xt+=ct*yt,pt+=mt*yt,ht=I-v,ct=V-X,mt=L-y,ft=v+ht*Xt,ut=X+ct*Xt,vt=y+mt*Xt,ht=T-v,ct=C-X,mt=j-y,ft+=ht*yt,ut+=ct*yt,vt+=mt*yt;let gt=this.closestPoint1;gt.x=bt,gt.y=xt,gt.z=pt;let dt=this.closestPoint2;dt.x=ft,dt.y=ut,dt.z=vt;let Yt=this.closest;return this.depth=Math.sqrt(Yt.x*Yt.x+Yt.y*Yt.y+Yt.z*Yt.z),oimo.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED}let f=this.polyhedron,u=f._vertexPool;null!=u?(f._vertexPool=u._next,u._next=null):u=new oimo.collision.narrowphase.detector.gjkepa.EpaVertex;let v=u.init(y,g,d);if(!this.polyhedron._addVertex(v,s))return oimo.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX;++Y}return oimo.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE}computeClosestPoints(t,i,o,s,a){return this.computeClosestPointsImpl(t,i,o,s,a,!0)}computeDistance(t,i,o,s,a){return this.computeClosestPointsImpl(t,i,o,s,a,!1)}convexCast(t,i,o,s,a,n,e){return this.convexCastImpl(t,i,o,s,a,n,e)}rayCast(t,i,o,s,a){let n=this.tempTransform;n._positionX=o.x,n._positionY=o.y,n._positionZ=o.z;let e=this.tl1,r=this.tl2;return e.x=s.x,e.y=s.y,e.z=s.z,e.x-=o.x,e.y-=o.y,e.z-=o.z,r.zero(),this.convexCastImpl(null,t,n,i,e,r,a)}static getInstance(){return oimo.collision.narrowphase.detector.gjkepa.GjkEpa.instance}},oimo.collision.narrowphase.detector.gjkepa.GjkEpaLog=class{},oimo.collision.narrowphase.detector.gjkepa.GjkEpaResultState=class{},oimo.collision.narrowphase.detector.gjkepa.SimplexUtil=class{static projectOrigin2(t,i,o){let s,a,n,e,r,_,l,h,c;s=t.x,a=t.y,n=t.z,e=i.x,r=i.y,_=i.z,l=e-s,h=r-a,c=_-n;let m,b,x,p=l*s+h*a+c*n;return p=-p/(l*l+h*h+c*c),p<0?(o.x=s,o.y=a,o.z=n,1):p>1?(o.x=e,o.y=r,o.z=_,2):(m=s+l*p,b=a+h*p,x=n+c*p,o.x=m,o.y=b,o.z=x,3)}static projectOrigin3(t,i,o,s){let a,n,e,r,_,l,h,c,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A;a=t.x,n=t.y,e=t.z,r=i.x,_=i.y,l=i.z,h=o.x,c=o.y,m=o.z,b=r-a,x=_-n,p=l-e,f=h-r,u=c-_,v=m-l,X=a-h,y=n-c,g=e-m,d=x*v-p*u,Y=p*f-b*v,z=b*u-x*f,Z=x*z-p*Y,M=p*d-b*z,I=b*Y-x*d,V=u*z-v*Y,L=v*d-f*z,w=f*Y-u*d,k=y*z-g*Y,B=g*d-X*z,A=X*Y-y*d;let P,S,T,C=-1,j=0;if(P=0,S=0,T=0,a*Z+n*M+e*I<0){let o,a,n,e,r,_,l,h,c;o=t.x,a=t.y,n=t.z,e=i.x,r=i.y,_=i.z,l=e-o,h=r-a,c=_-n;let m,b=l*o+h*a+c*n;if(b=-b/(l*l+h*h+c*c),b<0)s.x=o,s.y=a,s.z=n,m=1;else if(b>1)s.x=e,s.y=r,s.z=_,m=2;else{let t,i,e;t=o+l*b,i=a+h*b,e=n+c*b,s.x=t,s.y=i,s.z=e,m=3}j=m,C=s.x*s.x+s.y*s.y+s.z*s.z,P=s.x,S=s.y,T=s.z}if(r*V+_*L+l*w<0){let t,a,n,e,r,_,l,h,c;t=i.x,a=i.y,n=i.z,e=o.x,r=o.y,_=o.z,l=e-t,h=r-a,c=_-n;let m,b=l*t+h*a+c*n;if(b=-b/(l*l+h*h+c*c),b<0)s.x=t,s.y=a,s.z=n,m=1;else if(b>1)s.x=e,s.y=r,s.z=_,m=2;else{let i,o,e;i=t+l*b,o=a+h*b,e=n+c*b,s.x=i,s.y=o,s.z=e,m=3}let x=s.x*s.x+s.y*s.y+s.z*s.z;(C<0||x<C)&&(j=m<<1,C=x,P=s.x,S=s.y,T=s.z)}if(h*k+c*B+m*A<0){let i,a,n,e,r,_,l,h,c;i=t.x,a=t.y,n=t.z,e=o.x,r=o.y,_=o.z,l=e-i,h=r-a,c=_-n;let m,b=l*i+h*a+c*n;if(b=-b/(l*l+h*h+c*c),b<0)s.x=i,s.y=a,s.z=n,m=1;else if(b>1)s.x=e,s.y=r,s.z=_,m=2;else{let t,o,e;t=i+l*b,o=a+h*b,e=n+c*b,s.x=t,s.y=o,s.z=e,m=3}let x=s.x*s.x+s.y*s.y+s.z*s.z;(C<0||x<C)&&(j=1&m|(2&m)<<1,C=x,P=s.x,S=s.y,T=s.z)}if(C>0)return s.x=P,s.y=S,s.z=T,j;let R=d*d+Y*Y+z*z;R>0&&(R=1/Math.sqrt(R)),d*=R,Y*=R,z*=R;let q=d*d+Y*Y+z*z;return q=(a*d+n*Y+e*z)/q,P=d*q,S=Y*q,T=z*q,s.x=P,s.y=S,s.z=T,7}static projectOrigin4(t,i,o,s,a){let n,e,r,_,l,h,c,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A,P,S,T,C,j,R,q,E,D,F;n=t.x,e=t.y,r=t.z,_=i.x,l=i.y,h=i.z,c=o.x,m=o.y,b=o.z,x=s.x,p=s.y,f=s.z,u=_-n,v=l-e,X=h-r,y=c-n,g=m-e,d=b-r,Y=x-n,z=p-e,Z=f-r,M=c-_,I=m-l,V=b-h,L=x-_,w=p-l,k=f-h,B=v*d-X*g,A=X*y-u*d,P=u*g-v*y,S=g*Z-d*z,T=d*Y-y*Z,C=y*z-g*Y,j=z*X-Z*v,R=Z*u-Y*X,q=Y*v-z*u,E=w*V-k*I,D=k*M-L*V,F=L*I-w*M;let N,W,G,J=u*E+v*D+X*F>0?1:-1,O=-1,H=0;if(N=0,W=0,G=0,(n*B+e*A+r*P)*J<0){let s,n,e,r,_,l,h,c,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A;s=t.x,n=t.y,e=t.z,r=i.x,_=i.y,l=i.z,h=o.x,c=o.y,m=o.z,b=r-s,x=_-n,p=l-e,f=h-r,u=c-_,v=m-l,X=s-h,y=n-c,g=e-m,d=x*v-p*u,Y=p*f-b*v,z=b*u-x*f,Z=x*z-p*Y,M=p*d-b*z,I=b*Y-x*d,V=u*z-v*Y,L=v*d-f*z,w=f*Y-u*d,k=y*z-g*Y,B=g*d-X*z,A=X*Y-y*d;let P,S,T,C,j=-1,R=0;if(P=0,S=0,T=0,s*Z+n*M+e*I<0){let o,s,n,e,r,_,l,h,c;o=t.x,s=t.y,n=t.z,e=i.x,r=i.y,_=i.z,l=e-o,h=r-s,c=_-n;let m,b=l*o+h*s+c*n;if(b=-b/(l*l+h*h+c*c),b<0)a.x=o,a.y=s,a.z=n,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let t,i,e;t=o+l*b,i=s+h*b,e=n+c*b,a.x=t,a.y=i,a.z=e,m=3}R=m,j=a.x*a.x+a.y*a.y+a.z*a.z,P=a.x,S=a.y,T=a.z}if(r*V+_*L+l*w<0){let t,s,n,e,r,_,l,h,c;t=i.x,s=i.y,n=i.z,e=o.x,r=o.y,_=o.z,l=e-t,h=r-s,c=_-n;let m,b=l*t+h*s+c*n;if(b=-b/(l*l+h*h+c*c),b<0)a.x=t,a.y=s,a.z=n,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let i,o,e;i=t+l*b,o=s+h*b,e=n+c*b,a.x=i,a.y=o,a.z=e,m=3}let x=a.x*a.x+a.y*a.y+a.z*a.z;(j<0||x<j)&&(R=m<<1,j=x,P=a.x,S=a.y,T=a.z)}if(h*k+c*B+m*A<0){let i,s,n,e,r,_,l,h,c;i=t.x,s=t.y,n=t.z,e=o.x,r=o.y,_=o.z,l=e-i,h=r-s,c=_-n;let m,b=l*i+h*s+c*n;if(b=-b/(l*l+h*h+c*c),b<0)a.x=i,a.y=s,a.z=n,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let t,o,e;t=i+l*b,o=s+h*b,e=n+c*b,a.x=t,a.y=o,a.z=e,m=3}let x=a.x*a.x+a.y*a.y+a.z*a.z;(j<0||x<j)&&(R=1&m|(2&m)<<1,j=x,P=a.x,S=a.y,T=a.z)}if(j>0)a.x=P,a.y=S,a.z=T,C=R;else{let t=d*d+Y*Y+z*z;t>0&&(t=1/Math.sqrt(t)),d*=t,Y*=t,z*=t;let i=d*d+Y*Y+z*z;i=(s*d+n*Y+e*z)/i,P=d*i,S=Y*i,T=z*i,a.x=P,a.y=S,a.z=T,C=7}H=C,O=a.x*a.x+a.y*a.y+a.z*a.z,N=a.x,W=a.y,G=a.z}if((n*S+e*T+r*C)*J<0){let i,n,e,r,_,l,h,c,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A;i=t.x,n=t.y,e=t.z,r=o.x,_=o.y,l=o.z,h=s.x,c=s.y,m=s.z,b=r-i,x=_-n,p=l-e,f=h-r,u=c-_,v=m-l,X=i-h,y=n-c,g=e-m,d=x*v-p*u,Y=p*f-b*v,z=b*u-x*f,Z=x*z-p*Y,M=p*d-b*z,I=b*Y-x*d,V=u*z-v*Y,L=v*d-f*z,w=f*Y-u*d,k=y*z-g*Y,B=g*d-X*z,A=X*Y-y*d;let P,S,T,C,j=-1,R=0;if(P=0,S=0,T=0,i*Z+n*M+e*I<0){let i,s,n,e,r,_,l,h,c;i=t.x,s=t.y,n=t.z,e=o.x,r=o.y,_=o.z,l=e-i,h=r-s,c=_-n;let m,b=l*i+h*s+c*n;if(b=-b/(l*l+h*h+c*c),b<0)a.x=i,a.y=s,a.z=n,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let t,o,e;t=i+l*b,o=s+h*b,e=n+c*b,a.x=t,a.y=o,a.z=e,m=3}R=m,j=a.x*a.x+a.y*a.y+a.z*a.z,P=a.x,S=a.y,T=a.z}if(r*V+_*L+l*w<0){let t,i,n,e,r,_,l,h,c;t=o.x,i=o.y,n=o.z,e=s.x,r=s.y,_=s.z,l=e-t,h=r-i,c=_-n;let m,b=l*t+h*i+c*n;if(b=-b/(l*l+h*h+c*c),b<0)a.x=t,a.y=i,a.z=n,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let o,s,e;o=t+l*b,s=i+h*b,e=n+c*b,a.x=o,a.y=s,a.z=e,m=3}let x=a.x*a.x+a.y*a.y+a.z*a.z;(j<0||x<j)&&(R=m<<1,j=x,P=a.x,S=a.y,T=a.z)}if(h*k+c*B+m*A<0){let i,o,n,e,r,_,l,h,c;i=t.x,o=t.y,n=t.z,e=s.x,r=s.y,_=s.z,l=e-i,h=r-o,c=_-n;let m,b=l*i+h*o+c*n;if(b=-b/(l*l+h*h+c*c),b<0)a.x=i,a.y=o,a.z=n,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let t,s,e;t=i+l*b,s=o+h*b,e=n+c*b,a.x=t,a.y=s,a.z=e,m=3}let x=a.x*a.x+a.y*a.y+a.z*a.z;(j<0||x<j)&&(R=1&m|(2&m)<<1,j=x,P=a.x,S=a.y,T=a.z)}if(j>0)a.x=P,a.y=S,a.z=T,C=R;else{let t=d*d+Y*Y+z*z;t>0&&(t=1/Math.sqrt(t)),d*=t,Y*=t,z*=t;let o=d*d+Y*Y+z*z;o=(i*d+n*Y+e*z)/o,P=d*o,S=Y*o,T=z*o,a.x=P,a.y=S,a.z=T,C=7}let q=a.x*a.x+a.y*a.y+a.z*a.z;(O<0||q<O)&&(H=1&C|(6&C)<<1,O=q,N=a.x,W=a.y,G=a.z)}if((n*j+e*R+r*q)*J<0){let o,n,e,r,_,l,h,c,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A;o=t.x,n=t.y,e=t.z,r=i.x,_=i.y,l=i.z,h=s.x,c=s.y,m=s.z,b=r-o,x=_-n,p=l-e,f=h-r,u=c-_,v=m-l,X=o-h,y=n-c,g=e-m,d=x*v-p*u,Y=p*f-b*v,z=b*u-x*f,Z=x*z-p*Y,M=p*d-b*z,I=b*Y-x*d,V=u*z-v*Y,L=v*d-f*z,w=f*Y-u*d,k=y*z-g*Y,B=g*d-X*z,A=X*Y-y*d;let P,S,T,C,j=-1,R=0;if(P=0,S=0,T=0,o*Z+n*M+e*I<0){let o,s,n,e,r,_,l,h,c;o=t.x,s=t.y,n=t.z,e=i.x,r=i.y,_=i.z,l=e-o,h=r-s,c=_-n;let m,b=l*o+h*s+c*n;if(b=-b/(l*l+h*h+c*c),b<0)a.x=o,a.y=s,a.z=n,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let t,i,e;t=o+l*b,i=s+h*b,e=n+c*b,a.x=t,a.y=i,a.z=e,m=3}R=m,j=a.x*a.x+a.y*a.y+a.z*a.z,P=a.x,S=a.y,T=a.z}if(r*V+_*L+l*w<0){let t,o,n,e,r,_,l,h,c;t=i.x,o=i.y,n=i.z,e=s.x,r=s.y,_=s.z,l=e-t,h=r-o,c=_-n;let m,b=l*t+h*o+c*n;if(b=-b/(l*l+h*h+c*c),b<0)a.x=t,a.y=o,a.z=n,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let i,s,e;i=t+l*b,s=o+h*b,e=n+c*b,a.x=i,a.y=s,a.z=e,m=3}let x=a.x*a.x+a.y*a.y+a.z*a.z;(j<0||x<j)&&(R=m<<1,j=x,P=a.x,S=a.y,T=a.z)}if(h*k+c*B+m*A<0){let i,o,n,e,r,_,l,h,c;i=t.x,o=t.y,n=t.z,e=s.x,r=s.y,_=s.z,l=e-i,h=r-o,c=_-n;let m,b=l*i+h*o+c*n;if(b=-b/(l*l+h*h+c*c),b<0)a.x=i,a.y=o,a.z=n,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let t,s,e;t=i+l*b,s=o+h*b,e=n+c*b,a.x=t,a.y=s,a.z=e,m=3}let x=a.x*a.x+a.y*a.y+a.z*a.z;(j<0||x<j)&&(R=1&m|(2&m)<<1,j=x,P=a.x,S=a.y,T=a.z)}if(j>0)a.x=P,a.y=S,a.z=T,C=R;else{let t=d*d+Y*Y+z*z;t>0&&(t=1/Math.sqrt(t)),d*=t,Y*=t,z*=t;let i=d*d+Y*Y+z*z;i=(o*d+n*Y+e*z)/i,P=d*i,S=Y*i,T=z*i,a.x=P,a.y=S,a.z=T,C=7}let q=a.x*a.x+a.y*a.y+a.z*a.z;(O<0||q<O)&&(H=3&C|(4&C)<<1,O=q,N=a.x,W=a.y,G=a.z)}if((_*E+l*D+h*F)*J<0){let t,n,e,r,_,l,h,c,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A;t=i.x,n=i.y,e=i.z,r=o.x,_=o.y,l=o.z,h=s.x,c=s.y,m=s.z,b=r-t,x=_-n,p=l-e,f=h-r,u=c-_,v=m-l,X=t-h,y=n-c,g=e-m,d=x*v-p*u,Y=p*f-b*v,z=b*u-x*f,Z=x*z-p*Y,M=p*d-b*z,I=b*Y-x*d,V=u*z-v*Y,L=v*d-f*z,w=f*Y-u*d,k=y*z-g*Y,B=g*d-X*z,A=X*Y-y*d;let P,S,T,C,j=-1,R=0;if(P=0,S=0,T=0,t*Z+n*M+e*I<0){let t,s,n,e,r,_,l,h,c;t=i.x,s=i.y,n=i.z,e=o.x,r=o.y,_=o.z,l=e-t,h=r-s,c=_-n;let m,b=l*t+h*s+c*n;if(b=-b/(l*l+h*h+c*c),b<0)a.x=t,a.y=s,a.z=n,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let i,o,e;i=t+l*b,o=s+h*b,e=n+c*b,a.x=i,a.y=o,a.z=e,m=3}R=m,j=a.x*a.x+a.y*a.y+a.z*a.z,P=a.x,S=a.y,T=a.z}if(r*V+_*L+l*w<0){let t,i,n,e,r,_,l,h,c;t=o.x,i=o.y,n=o.z,e=s.x,r=s.y,_=s.z,l=e-t,h=r-i,c=_-n;let m,b=l*t+h*i+c*n;if(b=-b/(l*l+h*h+c*c),b<0)a.x=t,a.y=i,a.z=n,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let o,s,e;o=t+l*b,s=i+h*b,e=n+c*b,a.x=o,a.y=s,a.z=e,m=3}let x=a.x*a.x+a.y*a.y+a.z*a.z;(j<0||x<j)&&(R=m<<1,j=x,P=a.x,S=a.y,T=a.z)}if(h*k+c*B+m*A<0){let t,o,n,e,r,_,l,h,c;t=i.x,o=i.y,n=i.z,e=s.x,r=s.y,_=s.z,l=e-t,h=r-o,c=_-n;let m,b=l*t+h*o+c*n;if(b=-b/(l*l+h*h+c*c),b<0)a.x=t,a.y=o,a.z=n,m=1;else if(b>1)a.x=e,a.y=r,a.z=_,m=2;else{let i,s,e;i=t+l*b,s=o+h*b,e=n+c*b,a.x=i,a.y=s,a.z=e,m=3}let x=a.x*a.x+a.y*a.y+a.z*a.z;(j<0||x<j)&&(R=1&m|(2&m)<<1,j=x,P=a.x,S=a.y,T=a.z)}if(j>0)a.x=P,a.y=S,a.z=T,C=R;else{let i=d*d+Y*Y+z*z;i>0&&(i=1/Math.sqrt(i)),d*=i,Y*=i,z*=i;let o=d*d+Y*Y+z*z;o=(t*d+n*Y+e*z)/o,P=d*o,S=Y*o,T=z*o,a.x=P,a.y=S,a.z=T,C=7}let q=a.x*a.x+a.y*a.y+a.z*a.z;(O<0||q<O)&&(H=C<<1,O=q,N=a.x,W=a.y,G=a.z)}return O>0?(a.x=N,a.y=W,a.z=G,H):(a.zero(),15)}},oimo.common.Mat3=class{constructor(t,i,o,s,a,n,e,r,_){null==_&&(_=1),null==r&&(r=0),null==e&&(e=0),null==n&&(n=0),null==a&&(a=1),null==s&&(s=0),null==o&&(o=0),null==i&&(i=0),null==t&&(t=1),this.e00=t,this.e01=i,this.e02=o,this.e10=s,this.e11=a,this.e12=n,this.e20=e,this.e21=r,this.e22=_,oimo.common.Mat3.numCreations++}init(t,i,o,s,a,n,e,r,_){return this.e00=t,this.e01=i,this.e02=o,this.e10=s,this.e11=a,this.e12=n,this.e20=e,this.e21=r,this.e22=_,this}identity(){return this.e00=1,this.e01=0,this.e02=0,this.e10=0,this.e11=1,this.e12=0,this.e20=0,this.e21=0,this.e22=1,this}add(t){return new oimo.common.Mat3(this.e00+t.e00,this.e01+t.e01,this.e02+t.e02,this.e10+t.e10,this.e11+t.e11,this.e12+t.e12,this.e20+t.e20,this.e21+t.e21,this.e22+t.e22)}sub(t){return new oimo.common.Mat3(this.e00-t.e00,this.e01-t.e01,this.e02-t.e02,this.e10-t.e10,this.e11-t.e11,this.e12-t.e12,this.e20-t.e20,this.e21-t.e21,this.e22-t.e22)}scale(t){return new oimo.common.Mat3(this.e00*t,this.e01*t,this.e02*t,this.e10*t,this.e11*t,this.e12*t,this.e20*t,this.e21*t,this.e22*t)}mul(t){return new oimo.common.Mat3(this.e00*t.e00+this.e01*t.e10+this.e02*t.e20,this.e00*t.e01+this.e01*t.e11+this.e02*t.e21,this.e00*t.e02+this.e01*t.e12+this.e02*t.e22,this.e10*t.e00+this.e11*t.e10+this.e12*t.e20,this.e10*t.e01+this.e11*t.e11+this.e12*t.e21,this.e10*t.e02+this.e11*t.e12+this.e12*t.e22,this.e20*t.e00+this.e21*t.e10+this.e22*t.e20,this.e20*t.e01+this.e21*t.e11+this.e22*t.e21,this.e20*t.e02+this.e21*t.e12+this.e22*t.e22)}addEq(t){return this.e00+=t.e00,this.e01+=t.e01,this.e02+=t.e02,this.e10+=t.e10,this.e11+=t.e11,this.e12+=t.e12,this.e20+=t.e20,this.e21+=t.e21,this.e22+=t.e22,this}subEq(t){return this.e00-=t.e00,this.e01-=t.e01,this.e02-=t.e02,this.e10-=t.e10,this.e11-=t.e11,this.e12-=t.e12,this.e20-=t.e20,this.e21-=t.e21,this.e22-=t.e22,this}scaleEq(t){return this.e00*=t,this.e01*=t,this.e02*=t,this.e10*=t,this.e11*=t,this.e12*=t,this.e20*=t,this.e21*=t,this.e22*=t,this}mulEq(t){let i=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21,o=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22,s=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20,a=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21,n=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22,e=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20,r=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21,_=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22;return this.e00=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20,this.e01=i,this.e02=o,this.e10=s,this.e11=a,this.e12=n,this.e20=e,this.e21=r,this.e22=_,this}prependScale(t,i,o){return new oimo.common.Mat3(this.e00*t,this.e01*t,this.e02*t,this.e10*i,this.e11*i,this.e12*i,this.e20*o,this.e21*o,this.e22*o)}appendScale(t,i,o){return new oimo.common.Mat3(this.e00*t,this.e01*i,this.e02*o,this.e10*t,this.e11*i,this.e12*o,this.e20*t,this.e21*i,this.e22*o)}prependRotation(t,i,o,s){let a=Math.sin(t),n=Math.cos(t),e=1-n,r=i*i*e+n,_=i*o*e-s*a,l=i*s*e+o*a,h=o*i*e+s*a,c=o*o*e+n,m=o*s*e-i*a,b=s*i*e-o*a,x=s*o*e+i*a,p=s*s*e+n;return new oimo.common.Mat3(r*this.e00+_*this.e10+l*this.e20,r*this.e01+_*this.e11+l*this.e21,r*this.e02+_*this.e12+l*this.e22,h*this.e00+c*this.e10+m*this.e20,h*this.e01+c*this.e11+m*this.e21,h*this.e02+c*this.e12+m*this.e22,b*this.e00+x*this.e10+p*this.e20,b*this.e01+x*this.e11+p*this.e21,b*this.e02+x*this.e12+p*this.e22)}appendRotation(t,i,o,s){let a=Math.sin(t),n=Math.cos(t),e=1-n,r=i*i*e+n,_=i*o*e-s*a,l=i*s*e+o*a,h=o*i*e+s*a,c=o*o*e+n,m=o*s*e-i*a,b=s*i*e-o*a,x=s*o*e+i*a,p=s*s*e+n;return new oimo.common.Mat3(this.e00*r+this.e01*h+this.e02*b,this.e00*_+this.e01*c+this.e02*x,this.e00*l+this.e01*m+this.e02*p,this.e10*r+this.e11*h+this.e12*b,this.e10*_+this.e11*c+this.e12*x,this.e10*l+this.e11*m+this.e12*p,this.e20*r+this.e21*h+this.e22*b,this.e20*_+this.e21*c+this.e22*x,this.e20*l+this.e21*m+this.e22*p)}prependScaleEq(t,i,o){return this.e00*=t,this.e01*=t,this.e02*=t,this.e10*=i,this.e11*=i,this.e12*=i,this.e20*=o,this.e21*=o,this.e22*=o,this}appendScaleEq(t,i,o){return this.e00*=t,this.e01*=i,this.e02*=o,this.e10*=t,this.e11*=i,this.e12*=o,this.e20*=t,this.e21*=i,this.e22*=o,this}prependRotationEq(t,i,o,s){let a=Math.sin(t),n=Math.cos(t),e=1-n,r=i*i*e+n,_=i*o*e-s*a,l=i*s*e+o*a,h=o*i*e+s*a,c=o*o*e+n,m=o*s*e-i*a,b=s*i*e-o*a,x=s*o*e+i*a,p=s*s*e+n,f=h*this.e00+c*this.e10+m*this.e20,u=h*this.e01+c*this.e11+m*this.e21,v=h*this.e02+c*this.e12+m*this.e22,X=b*this.e00+x*this.e10+p*this.e20,y=b*this.e01+x*this.e11+p*this.e21,g=b*this.e02+x*this.e12+p*this.e22;return this.e00=r*this.e00+_*this.e10+l*this.e20,this.e01=r*this.e01+_*this.e11+l*this.e21,this.e02=r*this.e02+_*this.e12+l*this.e22,this.e10=f,this.e11=u,this.e12=v,this.e20=X,this.e21=y,this.e22=g,this}appendRotationEq(t,i,o,s){let a=Math.sin(t),n=Math.cos(t),e=1-n,r=i*i*e+n,_=i*o*e-s*a,l=i*s*e+o*a,h=o*i*e+s*a,c=o*o*e+n,m=o*s*e-i*a,b=s*i*e-o*a,x=s*o*e+i*a,p=s*s*e+n,f=this.e00*_+this.e01*c+this.e02*x,u=this.e00*l+this.e01*m+this.e02*p,v=this.e10*_+this.e11*c+this.e12*x,X=this.e10*l+this.e11*m+this.e12*p,y=this.e20*_+this.e21*c+this.e22*x,g=this.e20*l+this.e21*m+this.e22*p;return this.e00=this.e00*r+this.e01*h+this.e02*b,this.e01=f,this.e02=u,this.e10=this.e10*r+this.e11*h+this.e12*b,this.e11=v,this.e12=X,this.e20=this.e20*r+this.e21*h+this.e22*b,this.e21=y,this.e22=g,this}transpose(){return new oimo.common.Mat3(this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22)}transposeEq(){let t=this.e01,i=this.e02,o=this.e12;return this.e01=this.e10,this.e02=this.e20,this.e10=t,this.e12=this.e21,this.e20=i,this.e21=o,this}determinant(){return this.e00*(this.e11*this.e22-this.e12*this.e21)-this.e01*(this.e10*this.e22-this.e12*this.e20)+this.e02*(this.e10*this.e21-this.e11*this.e20)}trace(){return this.e00+this.e11+this.e22}inverse(){let t=this.e11*this.e22-this.e12*this.e21,i=this.e10*this.e22-this.e12*this.e20,o=this.e10*this.e21-this.e11*this.e20,s=this.e00*t-this.e01*i+this.e02*o;return 0!=s&&(s=1/s),new oimo.common.Mat3(t*s,-(this.e01*this.e22-this.e02*this.e21)*s,(this.e01*this.e12-this.e02*this.e11)*s,-i*s,(this.e00*this.e22-this.e02*this.e20)*s,-(this.e00*this.e12-this.e02*this.e10)*s,o*s,-(this.e00*this.e21-this.e01*this.e20)*s,(this.e00*this.e11-this.e01*this.e10)*s)}inverseEq(){let t=this.e11*this.e22-this.e12*this.e21,i=this.e10*this.e22-this.e12*this.e20,o=this.e10*this.e21-this.e11*this.e20,s=this.e00*t-this.e01*i+this.e02*o;0!=s&&(s=1/s);let a=(this.e01*this.e12-this.e02*this.e11)*s,n=(this.e00*this.e22-this.e02*this.e20)*s,e=-(this.e00*this.e12-this.e02*this.e10)*s,r=-(this.e00*this.e21-this.e01*this.e20)*s,_=(this.e00*this.e11-this.e01*this.e10)*s;return this.e00=t*s,this.e01=-(this.e01*this.e22-this.e02*this.e21)*s,this.e02=a,this.e10=-i*s,this.e11=n,this.e12=e,this.e20=o*s,this.e21=r,this.e22=_,this}toArray(t){return null==t&&(t=!1),t?[this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22]:[this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22]}copyFrom(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this}clone(){return new oimo.common.Mat3(this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22)}fromQuat(t){let i=t.x,o=t.y,s=t.z,a=t.w,n=2*i,e=2*o,r=2*s,_=i*n,l=o*e,h=s*r,c=i*e,m=o*r,b=i*r,x=a*n,p=a*e,f=a*r;return this.e00=1-l-h,this.e01=c-f,this.e02=b+p,this.e10=c+f,this.e11=1-_-h,this.e12=m-x,this.e20=b-p,this.e21=m+x,this.e22=1-_-l,this}toQuat(){let t,i=new oimo.common.Quat,o=this.e00,s=this.e11,a=this.e22,n=o+s+a;return n>0?(t=Math.sqrt(n+1),i.w=.5*t,t=.5/t,i.x=(this.e21-this.e12)*t,i.y=(this.e02-this.e20)*t,i.z=(this.e10-this.e01)*t):o>s?o>a?(t=Math.sqrt(o-s-a+1),i.x=.5*t,t=.5/t,i.y=(this.e01+this.e10)*t,i.z=(this.e02+this.e20)*t,i.w=(this.e21-this.e12)*t):(t=Math.sqrt(a-o-s+1),i.z=.5*t,t=.5/t,i.x=(this.e02+this.e20)*t,i.y=(this.e12+this.e21)*t,i.w=(this.e10-this.e01)*t):s>a?(t=Math.sqrt(s-a-o+1),i.y=.5*t,t=.5/t,i.x=(this.e01+this.e10)*t,i.z=(this.e12+this.e21)*t,i.w=(this.e02-this.e20)*t):(t=Math.sqrt(a-o-s+1),i.z=.5*t,t=.5/t,i.x=(this.e02+this.e20)*t,i.y=(this.e12+this.e21)*t,i.w=(this.e10-this.e01)*t),i}fromEulerXyz(t){let i=Math.sin(t.x),o=Math.sin(t.y),s=Math.sin(t.z),a=Math.cos(t.x),n=Math.cos(t.y),e=Math.cos(t.z);return this.e00=n*e,this.e01=-n*s,this.e02=o,this.e10=a*s+e*i*o,this.e11=a*e-i*o*s,this.e12=-n*i,this.e20=i*s-a*e*o,this.e21=e*i+a*o*s,this.e22=a*n,this}toEulerXyz(){let t=this.e02;if(t<=-1){let t=Math.atan2(this.e21,this.e11);return new oimo.common.Vec3(.5*t,-1.570796326794895,.5*-t)}if(t>=1){let t=Math.atan2(this.e21,this.e11);return new oimo.common.Vec3(.5*t,1.570796326794895,.5*t)}return new oimo.common.Vec3(Math.atan2(-this.e12,this.e22),Math.asin(t),Math.atan2(-this.e01,this.e00))}getRow(t){return 0==t?new oimo.common.Vec3(this.e00,this.e01,this.e02):1==t?new oimo.common.Vec3(this.e10,this.e11,this.e12):2==t?new oimo.common.Vec3(this.e20,this.e21,this.e22):null}getCol(t){return 0==t?new oimo.common.Vec3(this.e00,this.e10,this.e20):1==t?new oimo.common.Vec3(this.e01,this.e11,this.e21):2==t?new oimo.common.Vec3(this.e02,this.e12,this.e22):null}getRowTo(t,i){0==t?i.init(this.e00,this.e01,this.e02):1==t?i.init(this.e10,this.e11,this.e12):2==t?i.init(this.e20,this.e21,this.e22):i.zero()}getColTo(t,i){0==t?i.init(this.e00,this.e10,this.e20):1==t?i.init(this.e01,this.e11,this.e21):2==t?i.init(this.e02,this.e12,this.e22):i.zero()}fromRows(t,i,o){return this.e00=t.x,this.e01=t.y,this.e02=t.z,this.e10=i.x,this.e11=i.y,this.e12=i.z,this.e20=o.x,this.e21=o.y,this.e22=o.z,this}fromCols(t,i,o){return this.e00=t.x,this.e01=i.x,this.e02=o.x,this.e10=t.y,this.e11=i.y,this.e12=o.y,this.e20=t.z,this.e21=i.z,this.e22=o.z,this}toString(){return"Mat3["+(this.e00>0?(1e7*this.e00+.5|0)/1e7:(1e7*this.e00-.5|0)/1e7)+", "+(this.e01>0?(1e7*this.e01+.5|0)/1e7:(1e7*this.e01-.5|0)/1e7)+", "+(this.e02>0?(1e7*this.e02+.5|0)/1e7:(1e7*this.e02-.5|0)/1e7)+",\n     "+(this.e10>0?(1e7*this.e10+.5|0)/1e7:(1e7*this.e10-.5|0)/1e7)+", "+(this.e11>0?(1e7*this.e11+.5|0)/1e7:(1e7*this.e11-.5|0)/1e7)+", "+(this.e12>0?(1e7*this.e12+.5|0)/1e7:(1e7*this.e12-.5|0)/1e7)+",\n     "+(this.e20>0?(1e7*this.e20+.5|0)/1e7:(1e7*this.e20-.5|0)/1e7)+", "+(this.e21>0?(1e7*this.e21+.5|0)/1e7:(1e7*this.e21-.5|0)/1e7)+", "+(this.e22>0?(1e7*this.e22+.5|0)/1e7:(1e7*this.e22-.5|0)/1e7)+"]"}},oimo.common.Mat4=class{constructor(t,i,o,s,a,n,e,r,_,l,h,c,m,b,x,p){null==p&&(p=1),null==x&&(x=0),null==b&&(b=0),null==m&&(m=0),null==c&&(c=0),null==h&&(h=1),null==l&&(l=0),null==_&&(_=0),null==r&&(r=0),null==e&&(e=0),null==n&&(n=1),null==a&&(a=0),null==s&&(s=0),null==o&&(o=0),null==i&&(i=0),null==t&&(t=1),this.e00=t,this.e01=i,this.e02=o,this.e03=s,this.e10=a,this.e11=n,this.e12=e,this.e13=r,this.e20=_,this.e21=l,this.e22=h,this.e23=c,this.e30=m,this.e31=b,this.e32=x,this.e33=p,oimo.common.Mat4.numCreations++}init(t,i,o,s,a,n,e,r,_,l,h,c,m,b,x,p){return this.e00=t,this.e01=i,this.e02=o,this.e03=s,this.e10=a,this.e11=n,this.e12=e,this.e13=r,this.e20=_,this.e21=l,this.e22=h,this.e23=c,this.e30=m,this.e31=b,this.e32=x,this.e33=p,this}identity(){return this.e00=1,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=1,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=1,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}add(t){return new oimo.common.Mat4(this.e00+t.e00,this.e01+t.e01,this.e02+t.e02,this.e03+t.e03,this.e10+t.e10,this.e11+t.e11,this.e12+t.e12,this.e13+t.e13,this.e20+t.e20,this.e21+t.e21,this.e22+t.e22,this.e23+t.e23,this.e30+t.e30,this.e31+t.e31,this.e32+t.e32,this.e33+t.e33)}sub(t){return new oimo.common.Mat4(this.e00-t.e00,this.e01-t.e01,this.e02-t.e02,this.e03-t.e03,this.e10-t.e10,this.e11-t.e11,this.e12-t.e12,this.e13-t.e13,this.e20-t.e20,this.e21-t.e21,this.e22-t.e22,this.e23-t.e23,this.e30-t.e30,this.e31-t.e31,this.e32-t.e32,this.e33-t.e33)}scale(t){return new oimo.common.Mat4(this.e00*t,this.e01*t,this.e02*t,this.e03*t,this.e10*t,this.e11*t,this.e12*t,this.e13*t,this.e20*t,this.e21*t,this.e22*t,this.e23*t,this.e30*t,this.e31*t,this.e32*t,this.e33*t)}mul(t){return new oimo.common.Mat4(this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30,this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31,this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32,this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33,this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30,this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31,this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32,this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33,this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30,this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31,this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32,this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33,this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30,this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31,this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32,this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33)}addEq(t){return this.e00+=t.e00,this.e01+=t.e01,this.e02+=t.e02,this.e03+=t.e03,this.e10+=t.e10,this.e11+=t.e11,this.e12+=t.e12,this.e13+=t.e13,this.e20+=t.e20,this.e21+=t.e21,this.e22+=t.e22,this.e23+=t.e23,this.e30+=t.e30,this.e31+=t.e31,this.e32+=t.e32,this.e33+=t.e33,this}subEq(t){return this.e00-=t.e00,this.e01-=t.e01,this.e02-=t.e02,this.e03-=t.e03,this.e10-=t.e10,this.e11-=t.e11,this.e12-=t.e12,this.e13-=t.e13,this.e20-=t.e20,this.e21-=t.e21,this.e22-=t.e22,this.e23-=t.e23,this.e30-=t.e30,this.e31-=t.e31,this.e32-=t.e32,this.e33-=t.e33,this}scaleEq(t){return this.e00*=t,this.e01*=t,this.e02*=t,this.e03*=t,this.e10*=t,this.e11*=t,this.e12*=t,this.e13*=t,this.e20*=t,this.e21*=t,this.e22*=t,this.e23*=t,this.e30*=t,this.e31*=t,this.e32*=t,this.e33*=t,this}mulEq(t){let i=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31,o=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32,s=this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33,a=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30,n=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31,e=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32,r=this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33,_=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30,l=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31,h=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32,c=this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33,m=this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30,b=this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31,x=this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32,p=this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33;return this.e00=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30,this.e01=i,this.e02=o,this.e03=s,this.e10=a,this.e11=n,this.e12=e,this.e13=r,this.e20=_,this.e21=l,this.e22=h,this.e23=c,this.e30=m,this.e31=b,this.e32=x,this.e33=p,this}prependScale(t,i,o){return new oimo.common.Mat4(this.e00*t,this.e01*t,this.e02*t,this.e03*t,this.e10*i,this.e11*i,this.e12*i,this.e13*i,this.e20*o,this.e21*o,this.e22*o,this.e23*o,this.e30,this.e31,this.e32,this.e33)}appendScale(t,i,o){return new oimo.common.Mat4(this.e00*t,this.e01*i,this.e02*o,this.e03,this.e10*t,this.e11*i,this.e12*o,this.e13,this.e20*t,this.e21*i,this.e22*o,this.e23,this.e30*t,this.e31*i,this.e32*o,this.e33)}prependRotation(t,i,o,s){let a=Math.sin(t),n=Math.cos(t),e=1-n,r=i*i*e+n,_=i*o*e-s*a,l=i*s*e+o*a,h=o*i*e+s*a,c=o*o*e+n,m=o*s*e-i*a,b=s*i*e-o*a,x=s*o*e+i*a,p=s*s*e+n;return new oimo.common.Mat4(r*this.e00+_*this.e10+l*this.e20,r*this.e01+_*this.e11+l*this.e21,r*this.e02+_*this.e12+l*this.e22,r*this.e03+_*this.e13+l*this.e23,h*this.e00+c*this.e10+m*this.e20,h*this.e01+c*this.e11+m*this.e21,h*this.e02+c*this.e12+m*this.e22,h*this.e03+c*this.e13+m*this.e23,b*this.e00+x*this.e10+p*this.e20,b*this.e01+x*this.e11+p*this.e21,b*this.e02+x*this.e12+p*this.e22,b*this.e03+x*this.e13+p*this.e23,this.e30,this.e31,this.e32,this.e33)}appendRotation(t,i,o,s){let a=Math.sin(t),n=Math.cos(t),e=1-n,r=i*i*e+n,_=i*o*e-s*a,l=i*s*e+o*a,h=o*i*e+s*a,c=o*o*e+n,m=o*s*e-i*a,b=s*i*e-o*a,x=s*o*e+i*a,p=s*s*e+n;return new oimo.common.Mat4(this.e00*r+this.e01*h+this.e02*b,this.e00*_+this.e01*c+this.e02*x,this.e00*l+this.e01*m+this.e02*p,this.e03,this.e10*r+this.e11*h+this.e12*b,this.e10*_+this.e11*c+this.e12*x,this.e10*l+this.e11*m+this.e12*p,this.e13,this.e20*r+this.e21*h+this.e22*b,this.e20*_+this.e21*c+this.e22*x,this.e20*l+this.e21*m+this.e22*p,this.e23,this.e30*r+this.e31*h+this.e32*b,this.e30*_+this.e31*c+this.e32*x,this.e30*l+this.e31*m+this.e32*p,this.e33)}prependTranslation(t,i,o){return new oimo.common.Mat4(this.e00+t*this.e30,this.e01+t*this.e31,this.e02+t*this.e32,this.e03+t*this.e33,this.e10+i*this.e30,this.e11+i*this.e31,this.e12+i*this.e32,this.e13+i*this.e33,this.e20+o*this.e30,this.e21+o*this.e31,this.e22+o*this.e32,this.e23+o*this.e33,this.e30,this.e31,this.e32,this.e33)}appendTranslation(t,i,o){return new oimo.common.Mat4(this.e00,this.e01,this.e02,this.e00*t+this.e01*i+this.e02*o+this.e03,this.e10,this.e11,this.e12,this.e10*t+this.e11*i+this.e12*o+this.e13,this.e20,this.e21,this.e22,this.e20*t+this.e21*i+this.e22*o+this.e23,this.e30,this.e31,this.e32,this.e30*t+this.e31*i+this.e32*o+this.e33)}prependScaleEq(t,i,o){return this.e00*=t,this.e01*=t,this.e02*=t,this.e03*=t,this.e10*=i,this.e11*=i,this.e12*=i,this.e13*=i,this.e20*=o,this.e21*=o,this.e22*=o,this.e23*=o,this}appendScaleEq(t,i,o){return this.e00*=t,this.e01*=i,this.e02*=o,this.e10*=t,this.e11*=i,this.e12*=o,this.e20*=t,this.e21*=i,this.e22*=o,this.e30*=t,this.e31*=i,this.e32*=o,this}prependRotationEq(t,i,o,s){let a=Math.sin(t),n=Math.cos(t),e=1-n,r=i*i*e+n,_=i*o*e-s*a,l=i*s*e+o*a,h=o*i*e+s*a,c=o*o*e+n,m=o*s*e-i*a,b=s*i*e-o*a,x=s*o*e+i*a,p=s*s*e+n,f=h*this.e00+c*this.e10+m*this.e20,u=h*this.e01+c*this.e11+m*this.e21,v=h*this.e02+c*this.e12+m*this.e22,X=h*this.e03+c*this.e13+m*this.e23,y=b*this.e00+x*this.e10+p*this.e20,g=b*this.e01+x*this.e11+p*this.e21,d=b*this.e02+x*this.e12+p*this.e22,Y=b*this.e03+x*this.e13+p*this.e23;return this.e00=r*this.e00+_*this.e10+l*this.e20,this.e01=r*this.e01+_*this.e11+l*this.e21,this.e02=r*this.e02+_*this.e12+l*this.e22,this.e03=r*this.e03+_*this.e13+l*this.e23,this.e10=f,this.e11=u,this.e12=v,this.e13=X,this.e20=y,this.e21=g,this.e22=d,this.e23=Y,this}appendRotationEq(t,i,o,s){let a=Math.sin(t),n=Math.cos(t),e=1-n,r=i*i*e+n,_=i*o*e-s*a,l=i*s*e+o*a,h=o*i*e+s*a,c=o*o*e+n,m=o*s*e-i*a,b=s*i*e-o*a,x=s*o*e+i*a,p=s*s*e+n,f=this.e00*_+this.e01*c+this.e02*x,u=this.e00*l+this.e01*m+this.e02*p,v=this.e10*_+this.e11*c+this.e12*x,X=this.e10*l+this.e11*m+this.e12*p,y=this.e20*_+this.e21*c+this.e22*x,g=this.e20*l+this.e21*m+this.e22*p,d=this.e30*_+this.e31*c+this.e32*x,Y=this.e30*l+this.e31*m+this.e32*p;return this.e00=this.e00*r+this.e01*h+this.e02*b,this.e01=f,this.e02=u,this.e10=this.e10*r+this.e11*h+this.e12*b,this.e11=v,this.e12=X,this.e20=this.e20*r+this.e21*h+this.e22*b,this.e21=y,this.e22=g,this.e30=this.e30*r+this.e31*h+this.e32*b,this.e31=d,this.e32=Y,this}prependTranslationEq(t,i,o){return this.e00+=t*this.e30,this.e01+=t*this.e31,this.e02+=t*this.e32,this.e03+=t*this.e33,this.e10+=i*this.e30,this.e11+=i*this.e31,this.e12+=i*this.e32,this.e13+=i*this.e33,this.e20+=o*this.e30,this.e21+=o*this.e31,this.e22+=o*this.e32,this.e23+=o*this.e33,this}appendTranslationEq(t,i,o){let s=this.e00*t+this.e01*i+this.e02*o+this.e03,a=this.e10*t+this.e11*i+this.e12*o+this.e13,n=this.e20*t+this.e21*i+this.e22*o+this.e23,e=this.e30*t+this.e31*i+this.e32*o+this.e33;return this.e03=s,this.e13=a,this.e23=n,this.e33=e,this}transpose(){return new oimo.common.Mat4(this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33)}transposeEq(){let t=this.e01,i=this.e02,o=this.e12,s=this.e03,a=this.e13,n=this.e23;return this.e01=this.e10,this.e02=this.e20,this.e03=this.e30,this.e10=t,this.e12=this.e21,this.e13=this.e31,this.e20=i,this.e21=o,this.e23=this.e32,this.e30=s,this.e31=a,this.e32=n,this}determinant(){let t=this.e20*this.e31-this.e21*this.e30,i=this.e20*this.e32-this.e22*this.e30,o=this.e20*this.e33-this.e23*this.e30,s=this.e21*this.e32-this.e22*this.e31,a=this.e21*this.e33-this.e23*this.e31,n=this.e22*this.e33-this.e23*this.e32;return this.e00*(this.e11*n-this.e12*a+this.e13*s)-this.e01*(this.e10*n-this.e12*o+this.e13*i)+this.e02*(this.e10*a-this.e11*o+this.e13*t)-this.e03*(this.e10*s-this.e11*i+this.e12*t)}trace(){return this.e00+this.e11+this.e22+this.e33}inverse(){let t=this.e00*this.e11-this.e01*this.e10,i=this.e00*this.e12-this.e02*this.e10,o=this.e00*this.e13-this.e03*this.e10,s=this.e01*this.e12-this.e02*this.e11,a=this.e01*this.e13-this.e03*this.e11,n=this.e02*this.e13-this.e03*this.e12,e=this.e20*this.e31-this.e21*this.e30,r=this.e20*this.e32-this.e22*this.e30,_=this.e20*this.e33-this.e23*this.e30,l=this.e21*this.e32-this.e22*this.e31,h=this.e21*this.e33-this.e23*this.e31,c=this.e22*this.e33-this.e23*this.e32,m=this.e11*c-this.e12*h+this.e13*l,b=this.e10*c-this.e12*_+this.e13*r,x=this.e10*h-this.e11*_+this.e13*e,p=this.e10*l-this.e11*r+this.e12*e,f=this.e00*m-this.e01*b+this.e02*x-this.e03*p;return 0!=f&&(f=1/f),new oimo.common.Mat4(m*f,-(this.e01*c-this.e02*h+this.e03*l)*f,(this.e31*n-this.e32*a+this.e33*s)*f,-(this.e21*n-this.e22*a+this.e23*s)*f,-b*f,(this.e00*c-this.e02*_+this.e03*r)*f,-(this.e30*n-this.e32*o+this.e33*i)*f,(this.e20*n-this.e22*o+this.e23*i)*f,x*f,-(this.e00*h-this.e01*_+this.e03*e)*f,(this.e30*a-this.e31*o+this.e33*t)*f,-(this.e20*a-this.e21*o+this.e23*t)*f,-p*f,(this.e00*l-this.e01*r+this.e02*e)*f,-(this.e30*s-this.e31*i+this.e32*t)*f,(this.e20*s-this.e21*i+this.e22*t)*f)}inverseEq(){let t=this.e00*this.e11-this.e01*this.e10,i=this.e00*this.e12-this.e02*this.e10,o=this.e00*this.e13-this.e03*this.e10,s=this.e01*this.e12-this.e02*this.e11,a=this.e01*this.e13-this.e03*this.e11,n=this.e02*this.e13-this.e03*this.e12,e=this.e20*this.e31-this.e21*this.e30,r=this.e20*this.e32-this.e22*this.e30,_=this.e20*this.e33-this.e23*this.e30,l=this.e21*this.e32-this.e22*this.e31,h=this.e21*this.e33-this.e23*this.e31,c=this.e22*this.e33-this.e23*this.e32,m=this.e11*c-this.e12*h+this.e13*l,b=this.e10*c-this.e12*_+this.e13*r,x=this.e10*h-this.e11*_+this.e13*e,p=this.e10*l-this.e11*r+this.e12*e,f=this.e00*m-this.e01*b+this.e02*x-this.e03*p;0!=f&&(f=1/f);let u=(this.e00*c-this.e02*_+this.e03*r)*f,v=-(this.e00*h-this.e01*_+this.e03*e)*f,X=-(this.e20*a-this.e21*o+this.e23*t)*f,y=(this.e00*l-this.e01*r+this.e02*e)*f,g=-(this.e30*s-this.e31*i+this.e32*t)*f,d=(this.e20*s-this.e21*i+this.e22*t)*f;return this.e00=m*f,this.e01=-(this.e01*c-this.e02*h+this.e03*l)*f,this.e02=(this.e31*n-this.e32*a+this.e33*s)*f,this.e03=-(this.e21*n-this.e22*a+this.e23*s)*f,this.e10=-b*f,this.e11=u,this.e12=-(this.e30*n-this.e32*o+this.e33*i)*f,this.e13=(this.e20*n-this.e22*o+this.e23*i)*f,this.e20=x*f,this.e21=v,this.e22=(this.e30*a-this.e31*o+this.e33*t)*f,this.e23=X,this.e30=-p*f,this.e31=y,this.e32=g,this.e33=d,this}lookAt(t,i,o,s,a,n,e,r,_){let l=t-s,h=i-a,c=o-n,m=1/Math.sqrt(l*l+h*h+c*c);l*=m,h*=m,c*=m;let b=r*c-_*h,x=_*l-e*c,p=e*h-r*l;m=1/Math.sqrt(b*b+x*x+p*p),b*=m,x*=m,p*=m;let f=h*p-c*x,u=c*b-l*p,v=l*x-h*b;return this.e00=b,this.e01=x,this.e02=p,this.e03=-(b*t+x*i+p*o),this.e10=f,this.e11=u,this.e12=v,this.e13=-(f*t+u*i+v*o),this.e20=l,this.e21=h,this.e22=c,this.e23=-(l*t+h*i+c*o),this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}perspective(t,i,o,s){let a=1/Math.tan(.5*t),n=s/(o-s);return this.e00=a/i,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=a,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=n,this.e23=o*n,this.e30=0,this.e31=0,this.e32=-1,this.e33=0,this}ortho(t,i,o,s){let a=1/(o-s);return this.e00=2/t,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=2/i,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=a,this.e23=o*a,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}toArray(t){return null==t&&(t=!1),t?[this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33]:[this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33]}copyFrom(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e03=t.e03,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e13=t.e13,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this.e23=t.e23,this.e30=t.e30,this.e31=t.e31,this.e32=t.e32,this.e33=t.e33,this}fromMat3(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e03=0,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e13=0,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}fromTransform(t){return this.e00=t._rotation00,this.e01=t._rotation01,this.e02=t._rotation02,this.e10=t._rotation10,this.e11=t._rotation11,this.e12=t._rotation12,this.e20=t._rotation20,this.e21=t._rotation21,this.e22=t._rotation22,this.e03=t._positionX,this.e13=t._positionY,this.e23=t._positionZ,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}clone(){return new oimo.common.Mat4(this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33)}toString(){return"Mat4["+(this.e00>0?(1e7*this.e00+.5|0)/1e7:(1e7*this.e00-.5|0)/1e7)+", "+(this.e01>0?(1e7*this.e01+.5|0)/1e7:(1e7*this.e01-.5|0)/1e7)+", "+(this.e02>0?(1e7*this.e02+.5|0)/1e7:(1e7*this.e02-.5|0)/1e7)+", "+(this.e03>0?(1e7*this.e03+.5|0)/1e7:(1e7*this.e03-.5|0)/1e7)+",\n    "+(this.e10>0?(1e7*this.e10+.5|0)/1e7:(1e7*this.e10-.5|0)/1e7)+", "+(this.e11>0?(1e7*this.e11+.5|0)/1e7:(1e7*this.e11-.5|0)/1e7)+", "+(this.e12>0?(1e7*this.e12+.5|0)/1e7:(1e7*this.e12-.5|0)/1e7)+", "+(this.e13>0?(1e7*this.e13+.5|0)/1e7:(1e7*this.e13-.5|0)/1e7)+",\n    "+(this.e20>0?(1e7*this.e20+.5|0)/1e7:(1e7*this.e20-.5|0)/1e7)+", "+(this.e21>0?(1e7*this.e21+.5|0)/1e7:(1e7*this.e21-.5|0)/1e7)+", "+(this.e22>0?(1e7*this.e22+.5|0)/1e7:(1e7*this.e22-.5|0)/1e7)+", "+(this.e23>0?(1e7*this.e23+.5|0)/1e7:(1e7*this.e23-.5|0)/1e7)+",\n    "+(this.e30>0?(1e7*this.e30+.5|0)/1e7:(1e7*this.e30-.5|0)/1e7)+", "+(this.e31>0?(1e7*this.e31+.5|0)/1e7:(1e7*this.e31-.5|0)/1e7)+", "+(this.e32>0?(1e7*this.e32+.5|0)/1e7:(1e7*this.e32-.5|0)/1e7)+", "+(this.e33>0?(1e7*this.e33+.5|0)/1e7:(1e7*this.e33-.5|0)/1e7)+"]"}},oimo.common.MathUtil=class{static abs(t){return t>0?t:-t}static sin(t){return Math.sin(t)}static cos(t){return Math.cos(t)}static tan(t){return Math.tan(t)}static asin(t){return Math.asin(t)}static acos(t){return Math.acos(t)}static atan(t){return Math.atan(t)}static safeAsin(t){return t<=-1?-1.570796326794895:t>=1?1.570796326794895:Math.asin(t)}static safeAcos(t){return t<=-1?3.14159265358979:t>=1?0:Math.acos(t)}static atan2(t,i){return Math.atan2(t,i)}static sqrt(t){return Math.sqrt(t)}static clamp(t,i,o){return t<i?i:t>o?o:t}static rand(){return Math.random()}static randIn(t,i){return t+Math.random()*(i-t)}static randVec3In(t,i){return new oimo.common.Vec3(t+Math.random()*(i-t),t+Math.random()*(i-t),t+Math.random()*(i-t))}static randVec3(){return new oimo.common.Vec3(2*Math.random()-1,2*Math.random()-1,2*Math.random()-1)}},oimo.common.Pool=class{constructor(){this.stackVec3=new Array(256),this.sizeVec3=0,this.stackMat3=new Array(256),this.sizeMat3=0,this.stackMat4=new Array(256),this.sizeMat4=0,this.stackQuat=new Array(256),this.sizeQuat=0}vec3(){return 0==this.sizeVec3?new oimo.common.Vec3:this.stackVec3[--this.sizeVec3]}mat3(){return 0==this.sizeMat3?new oimo.common.Mat3:this.stackMat3[--this.sizeMat3]}mat4(){return 0==this.sizeMat4?new oimo.common.Mat4:this.stackMat4[--this.sizeMat4]}quat(){return 0==this.sizeQuat?new oimo.common.Quat:this.stackQuat[--this.sizeQuat]}dispose(t,i,o,s){if(null!=t){if(t.zero(),this.sizeVec3==this.stackVec3.length){let t=new Array(this.sizeVec3<<1),i=0,o=this.sizeVec3;for(;i<o;){let o=i++;t[o]=this.stackVec3[o],this.stackVec3[o]=null}this.stackVec3=t}this.stackVec3[this.sizeVec3++]=t}if(null!=i){if(i.e00=1,i.e01=0,i.e02=0,i.e10=0,i.e11=1,i.e12=0,i.e20=0,i.e21=0,i.e22=1,this.sizeMat3==this.stackMat3.length){let t=new Array(this.sizeMat3<<1),i=0,o=this.sizeMat3;for(;i<o;){let o=i++;t[o]=this.stackMat3[o],this.stackMat3[o]=null}this.stackMat3=t}this.stackMat3[this.sizeMat3++]=i}if(null!=o){if(o.e00=1,o.e01=0,o.e02=0,o.e03=0,o.e10=0,o.e11=1,o.e12=0,o.e13=0,o.e20=0,o.e21=0,o.e22=1,o.e23=0,o.e30=0,o.e31=0,o.e32=0,o.e33=1,this.sizeMat4==this.stackMat4.length){let t=new Array(this.sizeMat4<<1),i=0,o=this.sizeMat4;for(;i<o;){let o=i++;t[o]=this.stackMat4[o],this.stackMat4[o]=null}this.stackMat4=t}this.stackMat4[this.sizeMat4++]=o}if(null!=s){if(s.x=0,s.y=0,s.z=0,s.w=1,this.sizeQuat==this.stackQuat.length){let t=new Array(this.sizeQuat<<1),i=0,o=this.sizeQuat;for(;i<o;){let o=i++;t[o]=this.stackQuat[o],this.stackQuat[o]=null}this.stackQuat=t}this.stackQuat[this.sizeQuat++]=s}}disposeVec3(t){if(t.zero(),this.sizeVec3==this.stackVec3.length){let t=new Array(this.sizeVec3<<1),i=0,o=this.sizeVec3;for(;i<o;){let o=i++;t[o]=this.stackVec3[o],this.stackVec3[o]=null}this.stackVec3=t}this.stackVec3[this.sizeVec3++]=t}disposeMat3(t){if(t.e00=1,t.e01=0,t.e02=0,t.e10=0,t.e11=1,t.e12=0,t.e20=0,t.e21=0,t.e22=1,this.sizeMat3==this.stackMat3.length){let t=new Array(this.sizeMat3<<1),i=0,o=this.sizeMat3;for(;i<o;){let o=i++;t[o]=this.stackMat3[o],this.stackMat3[o]=null}this.stackMat3=t}this.stackMat3[this.sizeMat3++]=t}disposeMat4(t){if(t.e00=1,t.e01=0,t.e02=0,t.e03=0,t.e10=0,t.e11=1,t.e12=0,t.e13=0,t.e20=0,t.e21=0,t.e22=1,t.e23=0,t.e30=0,t.e31=0,t.e32=0,t.e33=1,this.sizeMat4==this.stackMat4.length){let t=new Array(this.sizeMat4<<1),i=0,o=this.sizeMat4;for(;i<o;){let o=i++;t[o]=this.stackMat4[o],this.stackMat4[o]=null}this.stackMat4=t}this.stackMat4[this.sizeMat4++]=t}disposeQuat(t){if(t.x=0,t.y=0,t.z=0,t.w=1,this.sizeQuat==this.stackQuat.length){let t=new Array(this.sizeQuat<<1),i=0,o=this.sizeQuat;for(;i<o;){let o=i++;t[o]=this.stackQuat[o],this.stackQuat[o]=null}this.stackQuat=t}this.stackQuat[this.sizeQuat++]=t}},oimo.common.Quat=class{constructor(t,i,o,s){null==s&&(s=1),null==o&&(o=0),null==i&&(i=0),null==t&&(t=0),this.x=t,this.y=i,this.z=o,this.w=s,oimo.common.Quat.numCreations++}identity(){return this.x=0,this.y=0,this.z=0,this.w=1,this}init(t,i,o,s){return this.x=t,this.y=i,this.z=o,this.w=s,this}add(t){return new oimo.common.Quat(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)}sub(t){return new oimo.common.Quat(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)}scale(t){return new oimo.common.Quat(this.x*t,this.y*t,this.z*t,this.w*t)}addEq(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}subEq(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}scaleEq(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}normalized(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return t>0&&(t=1/t),new oimo.common.Quat(this.x*t,this.y*t,this.z*t,this.w*t)}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return t>0&&(t=1/t),this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}setArc(t,i){let o=t.x,s=t.y,a=t.z,n=i.x,e=i.y,r=i.z,_=o*n+s*e+a*r;return this.w=Math.sqrt(.5*(1+_)),0==this.w?(n=o*o,e=s*s,r=a*a,n<e?n<r?(_=1/Math.sqrt(e+r),this.x=0,this.y=a*_,this.z=-s*_):(_=1/Math.sqrt(n+e),this.z=0,this.x=s*_,this.y=-o*_):e<r?(_=1/Math.sqrt(r+n),this.y=0,this.z=o*_,this.x=-a*_):(_=1/Math.sqrt(n+e),this.z=0,this.x=s*_,this.y=-o*_),this):(_=.5/this.w,this.x=(s*r-a*e)*_,this.y=(a*n-o*r)*_,this.z=(o*e-s*n)*_,this)}slerp(t,i){let o,s,a,n,e=this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w;if(e<0?(e=-e,o=-t.x,s=-t.y,a=-t.z,n=-t.w):(o=t.x,s=t.y,a=t.z,n=t.w),e>.999999){let t=new oimo.common.Quat(this.x+(o-this.x)*i,this.y+(s-this.y)*i,this.z+(a-this.z)*i,this.w+(n-this.w)*i),e=Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w);return e>0&&(e=1/e),t.x*=e,t.y*=e,t.z*=e,t.w*=e,t}let r=i*Math.acos(e);o-=this.x*e,s-=this.y*e,a-=this.z*e,n-=this.w*e;let _=1/Math.sqrt(o*o+s*s+a*a+n*n);o*=_,s*=_,a*=_,n*=_;let l=Math.sin(r),h=Math.cos(r);return new oimo.common.Quat(this.x*h+o*l,this.y*h+s*l,this.z*h+a*l,this.w*h+n*l)}copyFrom(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}clone(){return new oimo.common.Quat(this.x,this.y,this.z,this.w)}fromMat3(t){let i,o=t.e00,s=t.e11,a=t.e22,n=o+s+a;return n>0?(i=Math.sqrt(n+1),this.w=.5*i,i=.5/i,this.x=(t.e21-t.e12)*i,this.y=(t.e02-t.e20)*i,this.z=(t.e10-t.e01)*i):o>s?o>a?(i=Math.sqrt(o-s-a+1),this.x=.5*i,i=.5/i,this.y=(t.e01+t.e10)*i,this.z=(t.e02+t.e20)*i,this.w=(t.e21-t.e12)*i):(i=Math.sqrt(a-o-s+1),this.z=.5*i,i=.5/i,this.x=(t.e02+t.e20)*i,this.y=(t.e12+t.e21)*i,this.w=(t.e10-t.e01)*i):s>a?(i=Math.sqrt(s-a-o+1),this.y=.5*i,i=.5/i,this.x=(t.e01+t.e10)*i,this.z=(t.e12+t.e21)*i,this.w=(t.e02-t.e20)*i):(i=Math.sqrt(a-o-s+1),this.z=.5*i,i=.5/i,this.x=(t.e02+t.e20)*i,this.y=(t.e12+t.e21)*i,this.w=(t.e10-t.e01)*i),this}toMat3(){let t=new oimo.common.Mat3,i=this.x,o=this.y,s=this.z,a=this.w,n=2*i,e=2*o,r=2*s,_=i*n,l=o*e,h=s*r,c=i*e,m=o*r,b=i*r,x=a*n,p=a*e,f=a*r;return t.e00=1-l-h,t.e01=c-f,t.e02=b+p,t.e10=c+f,t.e11=1-_-h,t.e12=m-x,t.e20=b-p,t.e21=m+x,t.e22=1-_-l,t}toString(){return"Quat["+(this.x>0?(1e7*this.x+.5|0)/1e7:(1e7*this.x-.5|0)/1e7)+" i,\n    "+(this.y>0?(1e7*this.y+.5|0)/1e7:(1e7*this.y-.5|0)/1e7)+" j,\n    "+(this.z>0?(1e7*this.z+.5|0)/1e7:(1e7*this.z-.5|0)/1e7)+" k,\n    "+(this.w>0?(1e7*this.w+.5|0)/1e7:(1e7*this.w-.5|0)/1e7)+"]"}},oimo.dynamics||(oimo.dynamics={}),oimo.dynamics.Contact=class{constructor(){this._next=null,this._prev=null,this._link1=new oimo.dynamics.ContactLink,this._link2=new oimo.dynamics.ContactLink,this._s1=null,this._s2=null,this._b1=null,this._b2=null,this._detector=null,this._cachedDetectorData=new oimo.collision.narrowphase.detector.CachedDetectorData,this._detectorResult=new oimo.collision.narrowphase.DetectorResult,this._latest=!1,this._shouldBeSkipped=!1,this._manifold=new oimo.dynamics.constraint.contact.Manifold,this._updater=new oimo.dynamics.constraint.contact.ManifoldUpdater(this._manifold),this._contactConstraint=new oimo.dynamics.constraint.contact.ContactConstraint(this._manifold),this._touching=!1}_updateManifold(){if(null==this._detector)return;let t=this._touching,i=this._detectorResult;if(this._detector.detect(i,this._s1._geom,this._s2._geom,this._s1._transform,this._s2._transform,this._cachedDetectorData),this._touching=i.numPoints>0,this._touching?(this._manifold._buildBasis(i.normal),i.getMaxDepth()>oimo.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold?this._contactConstraint._positionCorrectionAlgorithm=oimo.common.Setting.alternativeContactPositionCorrectionAlgorithm:this._contactConstraint._positionCorrectionAlgorithm=oimo.common.Setting.defaultContactPositionCorrectionAlgorithm,i.incremental?this._updater.incrementalUpdate(i,this._b1._transform,this._b2._transform):this._updater.totalUpdate(i,this._b1._transform,this._b2._transform)):this._manifold._clear(),this._touching&&!t){let t=this._s1._contactCallback,i=this._s2._contactCallback;t==i&&(i=null),null!=t&&t.beginContact(this),null!=i&&i.beginContact(this)}if(!this._touching&&t){let t=this._s1._contactCallback,i=this._s2._contactCallback;t==i&&(i=null),null!=t&&t.endContact(this),null!=i&&i.endContact(this)}if(this._touching){let t=this._s1._contactCallback,i=this._s2._contactCallback;t==i&&(i=null),null!=t&&t.preSolve(this),null!=i&&i.preSolve(this)}}_postSolve(){let t=this._s1._contactCallback,i=this._s2._contactCallback;t==i&&(i=null),null!=t&&t.postSolve(this),null!=i&&i.postSolve(this)}getShape1(){return this._s1}getShape2(){return this._s2}isTouching(){return this._touching}getManifold(){return this._manifold}getContactConstraint(){return this._contactConstraint}getPrev(){return this._prev}getNext(){return this._next}},oimo.dynamics.ContactLink=class{constructor(){this._prev=null,this._next=null,this._contact=null,this._other=null}getContact(){return this._contact}getOther(){return this._other}getPrev(){return this._prev}getNext(){return this._next}},oimo.dynamics.ContactManager=class{constructor(t){this._broadPhase=t,this._collisionMatrix=new oimo.collision.narrowphase.CollisionMatrix,this._numContacts=0}createContacts(){let t=this._broadPhase._proxyPairList;for(;null!=t;){let i=t._next;for(;;){let i,o;if(t._p1._id<t._p2._id?(i=t._p1.userData,o=t._p2.userData):(i=t._p2.userData,o=t._p1.userData),!this.shouldCollide(i,o))break;let s,a=i._rigidBody,n=o._rigidBody;s=a._numContactLinks<n._numContactLinks?a._contactLinkList:n._contactLinkList;let e=i._id,r=o._id,_=!1;for(;null!=s;){let t=s._contact;if(t._s1._id==e&&t._s2._id==r){t._latest=!0,_=!0;break}s=s._next}if(!_){let t=this._contactPool;null!=t?(this._contactPool=t._next,t._next=null):t=new oimo.dynamics.Contact;let s=t;null==this._contactList?(this._contactList=s,this._contactListLast=s):(this._contactListLast._next=s,s._prev=this._contactListLast,this._contactListLast=s),s._latest=!0;let a=this._collisionMatrix.detectors[i._geom._type][o._geom._type];s._s1=i,s._s2=o,s._b1=i._rigidBody,s._b2=o._rigidBody,s._touching=!1,null==s._b1._contactLinkList?(s._b1._contactLinkList=s._link1,s._b1._contactLinkListLast=s._link1):(s._b1._contactLinkListLast._next=s._link1,s._link1._prev=s._b1._contactLinkListLast,s._b1._contactLinkListLast=s._link1),null==s._b2._contactLinkList?(s._b2._contactLinkList=s._link2,s._b2._contactLinkListLast=s._link2):(s._b2._contactLinkListLast._next=s._link2,s._link2._prev=s._b2._contactLinkListLast,s._b2._contactLinkListLast=s._link2),s._b1._numContactLinks++,s._b2._numContactLinks++,s._link1._other=s._b2,s._link2._other=s._b1,s._link1._contact=s,s._link2._contact=s,s._detector=a;let n=s._contactConstraint;n._s1=i,n._s2=o,n._b1=n._s1._rigidBody,n._b2=n._s2._rigidBody,n._tf1=n._b1._transform,n._tf2=n._b2._transform,this._numContacts++}break}t=i}}destroyOutdatedContacts(){let t=this._broadPhase._incremental,i=this._contactList;for(;null!=i;){let o=i._next;for(;;){if(i._latest){i._latest=!1,i._shouldBeSkipped=!1;break}if(!t){let t=i._prev,o=i._next;if(null!=t&&(t._next=o),null!=o&&(o._prev=t),i==this._contactList&&(this._contactList=this._contactList._next),i==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),i._next=null,i._prev=null,i._touching){let t=i._s1._contactCallback,o=i._s2._contactCallback;t==o&&(o=null),null!=t&&t.endContact(i),null!=o&&o.endContact(i)}let s=i._link1._prev,a=i._link1._next;null!=s&&(s._next=a),null!=a&&(a._prev=s),i._link1==i._b1._contactLinkList&&(i._b1._contactLinkList=i._b1._contactLinkList._next),i._link1==i._b1._contactLinkListLast&&(i._b1._contactLinkListLast=i._b1._contactLinkListLast._prev),i._link1._next=null,i._link1._prev=null;let n=i._link2._prev,e=i._link2._next;null!=n&&(n._next=e),null!=e&&(e._prev=n),i._link2==i._b2._contactLinkList&&(i._b2._contactLinkList=i._b2._contactLinkList._next),i._link2==i._b2._contactLinkListLast&&(i._b2._contactLinkListLast=i._b2._contactLinkListLast._prev),i._link2._next=null,i._link2._prev=null,i._b1._numContactLinks--,i._b2._numContactLinks--,i._link1._other=null,i._link2._other=null,i._link1._contact=null,i._link2._contact=null,i._s1=null,i._s2=null,i._b1=null,i._b2=null,i._touching=!1,i._cachedDetectorData._clear(),i._manifold._clear(),i._detector=null;let r=i._contactConstraint;r._s1=null,r._s2=null,r._b1=null,r._b2=null,r._tf1=null,r._tf2=null,i._next=this._contactPool,this._contactPool=i,this._numContacts--;break}let o=i._s1,s=i._s2,a=o._rigidBody,n=s._rigidBody;if((a._sleeping||1==a._type)&&(n._sleeping||1==n._type)){i._shouldBeSkipped=!0;break}let e=o._aabb,r=s._aabb,_=o._proxy,l=s._proxy;if(!(_._aabbMinX<l._aabbMaxX&&_._aabbMaxX>l._aabbMinX&&_._aabbMinY<l._aabbMaxY&&_._aabbMaxY>l._aabbMinY&&_._aabbMinZ<l._aabbMaxZ&&_._aabbMaxZ>l._aabbMinZ&&this.shouldCollide(o,s))){let t=i._prev,o=i._next;if(null!=t&&(t._next=o),null!=o&&(o._prev=t),i==this._contactList&&(this._contactList=this._contactList._next),i==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),i._next=null,i._prev=null,i._touching){let t=i._s1._contactCallback,o=i._s2._contactCallback;t==o&&(o=null),null!=t&&t.endContact(i),null!=o&&o.endContact(i)}let s=i._link1._prev,a=i._link1._next;null!=s&&(s._next=a),null!=a&&(a._prev=s),i._link1==i._b1._contactLinkList&&(i._b1._contactLinkList=i._b1._contactLinkList._next),i._link1==i._b1._contactLinkListLast&&(i._b1._contactLinkListLast=i._b1._contactLinkListLast._prev),i._link1._next=null,i._link1._prev=null;let n=i._link2._prev,e=i._link2._next;null!=n&&(n._next=e),null!=e&&(e._prev=n),i._link2==i._b2._contactLinkList&&(i._b2._contactLinkList=i._b2._contactLinkList._next),i._link2==i._b2._contactLinkListLast&&(i._b2._contactLinkListLast=i._b2._contactLinkListLast._prev),i._link2._next=null,i._link2._prev=null,i._b1._numContactLinks--,i._b2._numContactLinks--,i._link1._other=null,i._link2._other=null,i._link1._contact=null,i._link2._contact=null,i._s1=null,i._s2=null,i._b1=null,i._b2=null,i._touching=!1,i._cachedDetectorData._clear(),i._manifold._clear(),i._detector=null;let r=i._contactConstraint;r._s1=null,r._s2=null,r._b1=null,r._b2=null,r._tf1=null,r._tf2=null,i._next=this._contactPool,this._contactPool=i,this._numContacts--;break}i._shouldBeSkipped=!(e._minX<r._maxX&&e._maxX>r._minX&&e._minY<r._maxY&&e._maxY>r._minY&&e._minZ<r._maxZ&&e._maxZ>r._minZ);break}i=o}}shouldCollide(t,i){let o,s,a=t._rigidBody,n=i._rigidBody;if(a==n)return!1;if(0!=a._type&&0!=n._type)return!1;if(0==(t._collisionGroup&i._collisionMask)||0==(i._collisionGroup&t._collisionMask))return!1;for(a._numJointLinks<n._numJointLinks?(o=a._jointLinkList,s=n):(o=n._jointLinkList,s=a);null!=o;){if(o._other==s&&!o._joint._allowCollision)return!1;o=o._next}return!0}_updateContacts(){this._broadPhase.collectPairs(),this.createContacts(),this.destroyOutdatedContacts()}_postSolve(){let t=this._contactList;for(;null!=t;){let i=t._next;t._touching&&t._postSolve(),t=i}}getNumContacts(){return this._numContacts}getContactList(){return this._contactList}},oimo.dynamics.Island=class{constructor(){this.rigidBodies=new Array(oimo.common.Setting.islandInitialRigidBodyArraySize),this.solvers=new Array(oimo.common.Setting.islandInitialConstraintArraySize),this.solversSi=new Array(oimo.common.Setting.islandInitialConstraintArraySize),this.solversNgs=new Array(oimo.common.Setting.islandInitialConstraintArraySize),this.numRigidBodies=0,this.numSolvers=0,this.numSolversSi=0,this.numSolversNgs=0}_clear(){for(;this.numRigidBodies>0;)this.rigidBodies[--this.numRigidBodies]=null;for(;this.numSolvers>0;)this.solvers[--this.numSolvers]=null;for(;this.numSolversSi>0;)this.solversSi[--this.numSolversSi]=null;for(;this.numSolversNgs>0;)this.solversNgs[--this.numSolversNgs]=null}_addRigidBody(t){if(this.numRigidBodies==this.rigidBodies.length){let t=new Array(this.numRigidBodies<<1),i=0,o=this.numRigidBodies;for(;i<o;){let o=i++;t[o]=this.rigidBodies[o],this.rigidBodies[o]=null}this.rigidBodies=t}t._addedToIsland=!0,this.rigidBodies[this.numRigidBodies++]=t}_addConstraintSolver(t,i){if(this.numSolvers==this.solvers.length){let t=new Array(this.numSolvers<<1),i=0,o=this.numSolvers;for(;i<o;){let o=i++;t[o]=this.solvers[o],this.solvers[o]=null}this.solvers=t}if(t._addedToIsland=!0,this.solvers[this.numSolvers++]=t,i==oimo.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE){if(this.numSolversSi==this.solversSi.length){let t=new Array(this.numSolversSi<<1),i=0,o=this.numSolversSi;for(;i<o;){let o=i++;t[o]=this.solversSi[o],this.solversSi[o]=null}this.solversSi=t}this.solversSi[this.numSolversSi++]=t}if(i==oimo.dynamics.constraint.PositionCorrectionAlgorithm.NGS){if(this.numSolversNgs==this.solversNgs.length){let t=new Array(this.numSolversNgs<<1),i=0,o=this.numSolversNgs;for(;i<o;){let o=i++;t[o]=this.solversNgs[o],this.solversNgs[o]=null}this.solversNgs=t}this.solversNgs[this.numSolversNgs++]=t}}_stepSingleRigidBody(t,i){let o=t.dt,s=i._ptransform,a=i._transform;if(s._positionX=a._positionX,s._positionY=a._positionY,s._positionZ=a._positionZ,s._rotation00=a._rotation00,s._rotation01=a._rotation01,s._rotation02=a._rotation02,s._rotation10=a._rotation10,s._rotation11=a._rotation11,s._rotation12=a._rotation12,s._rotation20=a._rotation20,s._rotation21=a._rotation21,s._rotation22=a._rotation22,i._linearContactImpulseX=0,i._linearContactImpulseY=0,i._linearContactImpulseZ=0,i._angularContactImpulseX=0,i._angularContactImpulseY=0,i._angularContactImpulseZ=0,i._autoSleep&&i._velX*i._velX+i._velY*i._velY+i._velZ*i._velZ<oimo.common.Setting.sleepingVelocityThreshold*oimo.common.Setting.sleepingVelocityThreshold&&i._angVelX*i._angVelX+i._angVelY*i._angVelY+i._angVelZ*i._angVelZ<oimo.common.Setting.sleepingAngularVelocityThreshold*oimo.common.Setting.sleepingAngularVelocityThreshold?(i._sleepTime+=o,i._sleepTime>oimo.common.Setting.sleepingTimeThreshold&&(i._sleeping=!0,i._sleepTime=0)):i._sleepTime=0,!i._sleeping){if(0==i._type){let t,s,a,n,e,r,_,l,h,c=o*i._linearDamping,m=c*c,b=1/(1+c+m*(.5+.16666666666666666*c+.041666666666666664*m)),x=o*i._angularDamping,p=x*x,f=1/(1+x+p*(.5+.16666666666666666*x+.041666666666666664*p));t=this.gravityX*i._gravityScale,s=this.gravityY*i._gravityScale,a=this.gravityZ*i._gravityScale,t+=i._forceX*i._invMass,s+=i._forceY*i._invMass,a+=i._forceZ*i._invMass,_=i._invInertia00*i._torqueX+i._invInertia01*i._torqueY+i._invInertia02*i._torqueZ,l=i._invInertia10*i._torqueX+i._invInertia11*i._torqueY+i._invInertia12*i._torqueZ,h=i._invInertia20*i._torqueX+i._invInertia21*i._torqueY+i._invInertia22*i._torqueZ,n=_,e=l,r=h,i._velX+=t*o,i._velY+=s*o,i._velZ+=a*o,i._velX*=b,i._velY*=b,i._velZ*=b,i._angVelX+=n*o,i._angVelY+=e*o,i._angVelZ+=r*o,i._angVelX*=f,i._angVelY*=f,i._angVelZ*=f}i._integrate(o);let t=i._shapeList;for(;null!=t;){let o,s,a,n,e,r,_,l,h,c,m,b,x=t._next,p=i._ptransform,f=i._transform,u=t._ptransform,v=t._localTransform;o=p._rotation00*v._rotation00+p._rotation01*v._rotation10+p._rotation02*v._rotation20,s=p._rotation00*v._rotation01+p._rotation01*v._rotation11+p._rotation02*v._rotation21,a=p._rotation00*v._rotation02+p._rotation01*v._rotation12+p._rotation02*v._rotation22,n=p._rotation10*v._rotation00+p._rotation11*v._rotation10+p._rotation12*v._rotation20,e=p._rotation10*v._rotation01+p._rotation11*v._rotation11+p._rotation12*v._rotation21,r=p._rotation10*v._rotation02+p._rotation11*v._rotation12+p._rotation12*v._rotation22,_=p._rotation20*v._rotation00+p._rotation21*v._rotation10+p._rotation22*v._rotation20,l=p._rotation20*v._rotation01+p._rotation21*v._rotation11+p._rotation22*v._rotation21,h=p._rotation20*v._rotation02+p._rotation21*v._rotation12+p._rotation22*v._rotation22,u._rotation00=o,u._rotation01=s,u._rotation02=a,u._rotation10=n,u._rotation11=e,u._rotation12=r,u._rotation20=_,u._rotation21=l,u._rotation22=h,c=p._rotation00*v._positionX+p._rotation01*v._positionY+p._rotation02*v._positionZ,m=p._rotation10*v._positionX+p._rotation11*v._positionY+p._rotation12*v._positionZ,b=p._rotation20*v._positionX+p._rotation21*v._positionY+p._rotation22*v._positionZ,u._positionX=c,u._positionY=m,u._positionZ=b,u._positionX+=p._positionX,u._positionY+=p._positionY,u._positionZ+=p._positionZ;let X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A,P,S,T,C=t._transform,j=t._localTransform;if(X=f._rotation00*j._rotation00+f._rotation01*j._rotation10+f._rotation02*j._rotation20,y=f._rotation00*j._rotation01+f._rotation01*j._rotation11+f._rotation02*j._rotation21,g=f._rotation00*j._rotation02+f._rotation01*j._rotation12+f._rotation02*j._rotation22,d=f._rotation10*j._rotation00+f._rotation11*j._rotation10+f._rotation12*j._rotation20,Y=f._rotation10*j._rotation01+f._rotation11*j._rotation11+f._rotation12*j._rotation21,z=f._rotation10*j._rotation02+f._rotation11*j._rotation12+f._rotation12*j._rotation22,Z=f._rotation20*j._rotation00+f._rotation21*j._rotation10+f._rotation22*j._rotation20,M=f._rotation20*j._rotation01+f._rotation21*j._rotation11+f._rotation22*j._rotation21,I=f._rotation20*j._rotation02+f._rotation21*j._rotation12+f._rotation22*j._rotation22,C._rotation00=X,C._rotation01=y,C._rotation02=g,C._rotation10=d,C._rotation11=Y,C._rotation12=z,C._rotation20=Z,C._rotation21=M,C._rotation22=I,V=f._rotation00*j._positionX+f._rotation01*j._positionY+f._rotation02*j._positionZ,L=f._rotation10*j._positionX+f._rotation11*j._positionY+f._rotation12*j._positionZ,w=f._rotation20*j._positionX+f._rotation21*j._positionY+f._rotation22*j._positionZ,C._positionX=V,C._positionY=L,C._positionZ=w,C._positionX+=f._positionX,C._positionY+=f._positionY,C._positionZ+=f._positionZ,t._geom._computeAabb(t._aabb,t._ptransform),k=t._aabb._minX,B=t._aabb._minY,A=t._aabb._minZ,P=t._aabb._maxX,S=t._aabb._maxY,T=t._aabb._maxZ,t._geom._computeAabb(t._aabb,t._transform),t._aabb._minX=k<t._aabb._minX?k:t._aabb._minX,t._aabb._minY=B<t._aabb._minY?B:t._aabb._minY,t._aabb._minZ=A<t._aabb._minZ?A:t._aabb._minZ,t._aabb._maxX=P>t._aabb._maxX?P:t._aabb._maxX,t._aabb._maxY=S>t._aabb._maxY?S:t._aabb._maxY,t._aabb._maxZ=T>t._aabb._maxZ?T:t._aabb._maxZ,null!=t._proxy){let i,o,s;i=t._transform._positionX-t._ptransform._positionX,o=t._transform._positionY-t._ptransform._positionY,s=t._transform._positionZ-t._ptransform._positionZ;let a=t.displacement;a.x=i,a.y=o,a.z=s,t._rigidBody._world._broadPhase.moveProxy(t._proxy,t._aabb,t.displacement)}t=x}}}_step(t,i,o){let s=t.dt,a=!0,n=0,e=this.numRigidBodies;for(;n<e;){let t=this.rigidBodies[n++],i=t._ptransform,o=t._transform;if(i._positionX=o._positionX,i._positionY=o._positionY,i._positionZ=o._positionZ,i._rotation00=o._rotation00,i._rotation01=o._rotation01,i._rotation02=o._rotation02,i._rotation10=o._rotation10,i._rotation11=o._rotation11,i._rotation12=o._rotation12,i._rotation20=o._rotation20,i._rotation21=o._rotation21,i._rotation22=o._rotation22,t._linearContactImpulseX=0,t._linearContactImpulseY=0,t._linearContactImpulseZ=0,t._angularContactImpulseX=0,t._angularContactImpulseY=0,t._angularContactImpulseZ=0,t._sleeping=!1,t._autoSleep&&t._velX*t._velX+t._velY*t._velY+t._velZ*t._velZ<oimo.common.Setting.sleepingVelocityThreshold*oimo.common.Setting.sleepingVelocityThreshold&&t._angVelX*t._angVelX+t._angVelY*t._angVelY+t._angVelZ*t._angVelZ<oimo.common.Setting.sleepingAngularVelocityThreshold*oimo.common.Setting.sleepingAngularVelocityThreshold?t._sleepTime+=s:t._sleepTime=0,t._sleepTime<oimo.common.Setting.sleepingTimeThreshold&&(a=!1),0==t._type){let i,o,a,n,e,r,_,l,h,c=s*t._linearDamping,m=c*c,b=1/(1+c+m*(.5+.16666666666666666*c+.041666666666666664*m)),x=s*t._angularDamping,p=x*x,f=1/(1+x+p*(.5+.16666666666666666*x+.041666666666666664*p));i=this.gravityX*t._gravityScale,o=this.gravityY*t._gravityScale,a=this.gravityZ*t._gravityScale,i+=t._forceX*t._invMass,o+=t._forceY*t._invMass,a+=t._forceZ*t._invMass,_=t._invInertia00*t._torqueX+t._invInertia01*t._torqueY+t._invInertia02*t._torqueZ,l=t._invInertia10*t._torqueX+t._invInertia11*t._torqueY+t._invInertia12*t._torqueZ,h=t._invInertia20*t._torqueX+t._invInertia21*t._torqueY+t._invInertia22*t._torqueZ,n=_,e=l,r=h,t._velX+=i*s,t._velY+=o*s,t._velZ+=a*s,t._velX*=b,t._velY*=b,t._velZ*=b,t._angVelX+=n*s,t._angVelY+=e*s,t._angVelZ+=r*s,t._angVelX*=f,t._angVelY*=f,t._angVelZ*=f}}if(a){let t=0,i=this.numRigidBodies;for(;t<i;){let i=this.rigidBodies[t++];i._sleeping=!0,i._sleepTime=0}return}let r=0,_=this.numSolvers;for(;r<_;)this.solvers[r++].preSolveVelocity(t);let l=0,h=this.numSolvers;for(;l<h;)this.solvers[l++].warmStart(t);let c=0;for(;c<i;){++c;let t=0,i=this.numSolvers;for(;t<i;)this.solvers[t++].solveVelocity()}let m=0,b=this.numSolvers;for(;m<b;)this.solvers[m++].postSolveVelocity(t);let x=0,p=this.numRigidBodies;for(;x<p;)this.rigidBodies[x++]._integrate(s);let f=0,u=this.numSolversSi;for(;f<u;)this.solversSi[f++].preSolvePosition(t);let v=0;for(;v<o;){++v;let t=0,i=this.numSolversSi;for(;t<i;)this.solversSi[t++].solvePositionSplitImpulse()}let X=0,y=this.numRigidBodies;for(;X<y;)this.rigidBodies[X++]._integratePseudoVelocity();let g=0,d=this.numSolversNgs;for(;g<d;)this.solversNgs[g++].preSolvePosition(t);let Y=0;for(;Y<o;){++Y;let i=0,o=this.numSolversNgs;for(;i<o;)this.solversNgs[i++].solvePositionNgs(t)}let z=0,Z=this.numSolvers;for(;z<Z;)this.solvers[z++].postSolve();let M=0,I=this.numRigidBodies;for(;M<I;){let t=this.rigidBodies[M++],i=t._shapeList;for(;null!=i;){let o,s,a,n,e,r,_,l,h,c,m,b,x=i._next,p=t._ptransform,f=t._transform,u=i._ptransform,v=i._localTransform;o=p._rotation00*v._rotation00+p._rotation01*v._rotation10+p._rotation02*v._rotation20,s=p._rotation00*v._rotation01+p._rotation01*v._rotation11+p._rotation02*v._rotation21,a=p._rotation00*v._rotation02+p._rotation01*v._rotation12+p._rotation02*v._rotation22,n=p._rotation10*v._rotation00+p._rotation11*v._rotation10+p._rotation12*v._rotation20,e=p._rotation10*v._rotation01+p._rotation11*v._rotation11+p._rotation12*v._rotation21,r=p._rotation10*v._rotation02+p._rotation11*v._rotation12+p._rotation12*v._rotation22,_=p._rotation20*v._rotation00+p._rotation21*v._rotation10+p._rotation22*v._rotation20,l=p._rotation20*v._rotation01+p._rotation21*v._rotation11+p._rotation22*v._rotation21,h=p._rotation20*v._rotation02+p._rotation21*v._rotation12+p._rotation22*v._rotation22,u._rotation00=o,u._rotation01=s,u._rotation02=a,u._rotation10=n,u._rotation11=e,u._rotation12=r,u._rotation20=_,u._rotation21=l,u._rotation22=h,c=p._rotation00*v._positionX+p._rotation01*v._positionY+p._rotation02*v._positionZ,m=p._rotation10*v._positionX+p._rotation11*v._positionY+p._rotation12*v._positionZ,b=p._rotation20*v._positionX+p._rotation21*v._positionY+p._rotation22*v._positionZ,u._positionX=c,u._positionY=m,u._positionZ=b,u._positionX+=p._positionX,u._positionY+=p._positionY,u._positionZ+=p._positionZ;let X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A,P,S,T,C=i._transform,j=i._localTransform;if(X=f._rotation00*j._rotation00+f._rotation01*j._rotation10+f._rotation02*j._rotation20,y=f._rotation00*j._rotation01+f._rotation01*j._rotation11+f._rotation02*j._rotation21,g=f._rotation00*j._rotation02+f._rotation01*j._rotation12+f._rotation02*j._rotation22,d=f._rotation10*j._rotation00+f._rotation11*j._rotation10+f._rotation12*j._rotation20,Y=f._rotation10*j._rotation01+f._rotation11*j._rotation11+f._rotation12*j._rotation21,z=f._rotation10*j._rotation02+f._rotation11*j._rotation12+f._rotation12*j._rotation22,Z=f._rotation20*j._rotation00+f._rotation21*j._rotation10+f._rotation22*j._rotation20,M=f._rotation20*j._rotation01+f._rotation21*j._rotation11+f._rotation22*j._rotation21,I=f._rotation20*j._rotation02+f._rotation21*j._rotation12+f._rotation22*j._rotation22,C._rotation00=X,C._rotation01=y,C._rotation02=g,C._rotation10=d,C._rotation11=Y,C._rotation12=z,C._rotation20=Z,C._rotation21=M,C._rotation22=I,V=f._rotation00*j._positionX+f._rotation01*j._positionY+f._rotation02*j._positionZ,L=f._rotation10*j._positionX+f._rotation11*j._positionY+f._rotation12*j._positionZ,w=f._rotation20*j._positionX+f._rotation21*j._positionY+f._rotation22*j._positionZ,C._positionX=V,C._positionY=L,C._positionZ=w,C._positionX+=f._positionX,C._positionY+=f._positionY,C._positionZ+=f._positionZ,i._geom._computeAabb(i._aabb,i._ptransform),k=i._aabb._minX,B=i._aabb._minY,A=i._aabb._minZ,P=i._aabb._maxX,S=i._aabb._maxY,T=i._aabb._maxZ,i._geom._computeAabb(i._aabb,i._transform),i._aabb._minX=k<i._aabb._minX?k:i._aabb._minX,i._aabb._minY=B<i._aabb._minY?B:i._aabb._minY,i._aabb._minZ=A<i._aabb._minZ?A:i._aabb._minZ,i._aabb._maxX=P>i._aabb._maxX?P:i._aabb._maxX,i._aabb._maxY=S>i._aabb._maxY?S:i._aabb._maxY,i._aabb._maxZ=T>i._aabb._maxZ?T:i._aabb._maxZ,null!=i._proxy){let t,o,s;t=i._transform._positionX-i._ptransform._positionX,o=i._transform._positionY-i._ptransform._positionY,s=i._transform._positionZ-i._ptransform._positionZ;let a=i.displacement;a.x=t,a.y=o,a.z=s,i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=x}}}},oimo.dynamics.TimeStep=class{constructor(){this.dt=0,this.invDt=0,this.dtRatio=1}},oimo.dynamics.World=class{constructor(t,i){switch(null==t&&(t=2),t){case 1:this._broadPhase=new oimo.collision.broadphase.bruteforce.BruteForceBroadPhase;break;case 2:this._broadPhase=new oimo.collision.broadphase.bvh.BvhBroadPhase}this._contactManager=new oimo.dynamics.ContactManager(this._broadPhase),null==i&&(i=new oimo.common.Vec3(0,-9.80665,0)),this._gravity=new oimo.common.Vec3(i.x,i.y,i.z),this._rigidBodyList=null,this._rigidBodyListLast=null,this._jointList=null,this._jointListLast=null,this._numRigidBodies=0,this._numShapes=0,this._numJoints=0,this._numIslands=0,this._numVelocityIterations=10,this._numPositionIterations=5,this._rayCastWrapper=new oimo.dynamics._World.RayCastWrapper,this._convexCastWrapper=new oimo.dynamics._World.ConvexCastWrapper,this._aabbTestWrapper=new oimo.dynamics._World.AabbTestWrapper,this._island=new oimo.dynamics.Island,this._solversInIslands=new Array(oimo.common.Setting.islandInitialConstraintArraySize),this._rigidBodyStack=new Array(oimo.common.Setting.islandInitialRigidBodyArraySize),this._timeStep=new oimo.dynamics.TimeStep,this._pool=new oimo.common.Pool,this._shapeIdCount=0}_updateContacts(){let t=Date.now()/1e3;this._contactManager._updateContacts(),oimo.dynamics.common.Performance.broadPhaseCollisionTime=1e3*(Date.now()/1e3-t);let i=Date.now()/1e3,o=this._contactManager._contactList;for(;null!=o;){let t=o._next;o._shouldBeSkipped||o._updateManifold(),o=t}oimo.dynamics.common.Performance.narrowPhaseCollisionTime=1e3*(Date.now()/1e3-i)}_solveIslands(){let t=Date.now()/1e3;if(oimo.common.Setting.disableSleeping){let t=this._rigidBodyList;for(;null!=t;)t._sleeping=!1,t._sleepTime=0,t=t._next}if(this._rigidBodyStack.length<this._numRigidBodies){let t=this._rigidBodyStack.length<<1;for(;t<this._numRigidBodies;)t<<=1;this._rigidBodyStack=new Array(t)}this._numIslands=0;let i=this._island,o=this._gravity;i.gravityX=o.x,i.gravityY=o.y,i.gravityZ=o.z;let s=this._rigidBodyList;for(this._numSolversInIslands=0;null!=s;){let t=s._next;for(;!s._addedToIsland&&!s._sleeping&&1!=s._type;){if(0==s._numContactLinks&&0==s._numJointLinks){this._island._stepSingleRigidBody(this._timeStep,s),this._numIslands++;break}this.buildIsland(s),this._island._step(this._timeStep,this._numVelocityIterations,this._numPositionIterations),this._island._clear(),this._numIslands++;break}s=t}for(this._contactManager._postSolve(),s=this._rigidBodyList;null!=s;)s._addedToIsland=!1,s=s._next;for(s=this._rigidBodyList;null!=s;)s._forceX=0,s._forceY=0,s._forceZ=0,s._torqueX=0,s._torqueY=0,s._torqueZ=0,s=s._next;for(;this._numSolversInIslands>0;)this._solversInIslands[--this._numSolversInIslands]._addedToIsland=!1,this._solversInIslands[this._numSolversInIslands]=null;oimo.dynamics.common.Performance.dynamicsTime=1e3*(Date.now()/1e3-t)}buildIsland(t){let i=1;for(this._island._addRigidBody(t),this._rigidBodyStack[0]=t;i>0;){let t=this._rigidBodyStack[--i];if(this._rigidBodyStack[i]=null,1==t._type)continue;let o=t._contactLinkList;for(;null!=o;){let t=o._next,s=o._contact._contactConstraint,a=o._contact._contactConstraint._solver;if(s.isTouching()&&!a._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){let t=new Array(this._numSolversInIslands<<1),i=0,o=this._numSolversInIslands;for(;i<o;){let o=i++;t[o]=this._solversInIslands[o],this._solversInIslands[o]=null}this._solversInIslands=t}this._solversInIslands[this._numSolversInIslands++]=a,this._island._addConstraintSolver(a,s._positionCorrectionAlgorithm);let t=o._other;t._addedToIsland||(this._island._addRigidBody(t),this._rigidBodyStack[i++]=t)}o=t}let s=t._jointLinkList;for(;null!=s;){let t=s._next,o=s._joint,a=o._solver;if(!a._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){let t=new Array(this._numSolversInIslands<<1),i=0,o=this._numSolversInIslands;for(;i<o;){let o=i++;t[o]=this._solversInIslands[o],this._solversInIslands[o]=null}this._solversInIslands=t}this._solversInIslands[this._numSolversInIslands++]=a,this._island._addConstraintSolver(a,o._positionCorrectionAlgorithm);let t=s._other;t._addedToIsland||(this._island._addRigidBody(t),this._rigidBodyStack[i++]=t)}s=t}}}_drawBvh(t,i){t.drawBvh&&this._drawBvhNode(t,i._root,0,t.style.bvhNodeColor)}_drawBvhNode(t,i,o,s){if(null!=i){if(o>=t.drawBvhMinLevel&&o<=t.drawBvhMaxLevel){let o=this._pool,a=0==o.sizeVec3?new oimo.common.Vec3:o.stackVec3[--o.sizeVec3],n=this._pool,e=0==n.sizeVec3?new oimo.common.Vec3:n.stackVec3[--n.sizeVec3],r=a;r.x=i._aabbMinX,r.y=i._aabbMinY,r.z=i._aabbMinZ;let _=e;_.x=i._aabbMaxX,_.y=i._aabbMaxY,_.z=i._aabbMaxZ,t.aabb(a,e,s);let l=this._pool;if(null!=a){if(a.zero(),l.sizeVec3==l.stackVec3.length){let t=new Array(l.sizeVec3<<1),i=0,o=l.sizeVec3;for(;i<o;){let o=i++;t[o]=l.stackVec3[o],l.stackVec3[o]=null}l.stackVec3=t}l.stackVec3[l.sizeVec3++]=a}let h=this._pool;if(null!=e){if(e.zero(),h.sizeVec3==h.stackVec3.length){let t=new Array(h.sizeVec3<<1),i=0,o=h.sizeVec3;for(;i<o;){let o=i++;t[o]=h.stackVec3[o],h.stackVec3[o]=null}h.stackVec3=t}h.stackVec3[h.sizeVec3++]=e}}this._drawBvhNode(t,i._children[0],o+1,s),this._drawBvhNode(t,i._children[1],o+1,s)}}_drawRigidBodies(t){let i=t.style,o=this._rigidBodyList;for(;null!=o;){let s=o._next;if(t.drawBases){let i=t.style;t.basis(o._transform,i.basisLength,i.basisColorX,i.basisColorY,i.basisColorZ)}let a=null,n=0==o._type;n||(a=2==o._type?i.kinematicShapeColor:i.staticShapeColor);let e=o._shapeList;for(;null!=e;){let s=e._next;if(n&&(a=0==(1&e._id)?o._sleeping?i.sleepingShapeColor1:o._sleepTime>oimo.common.Setting.sleepingTimeThreshold?i.sleepyShapeColor1:i.shapeColor1:o._sleeping?i.sleepingShapeColor2:o._sleepTime>oimo.common.Setting.sleepingTimeThreshold?i.sleepyShapeColor2:i.shapeColor2),t.drawShapes){let i=e._geom,o=e._transform;switch(i._type){case 0:t.sphere(o,i._radius,a);break;case 1:let s=i,n=this._pool,e=0==n.sizeVec3?new oimo.common.Vec3:n.stackVec3[--n.sizeVec3],r=e;r.x=s._halfExtentsX,r.y=s._halfExtentsY,r.z=s._halfExtentsZ,t.box(o,e,a);let _=this._pool;if(null!=e){if(e.zero(),_.sizeVec3==_.stackVec3.length){let t=new Array(_.sizeVec3<<1),i=0,o=_.sizeVec3;for(;i<o;){let o=i++;t[o]=_.stackVec3[o],_.stackVec3[o]=null}_.stackVec3=t}_.stackVec3[_.sizeVec3++]=e}break;case 2:let l=i;t.cylinder(o,l._radius,l._halfHeight,a);break;case 3:let h=i;t.cone(o,h._radius,h._halfHeight,a);break;case 4:let c=i;t.capsule(o,c._radius,c._halfHeight,a);break;case 5:let m=i,b=m._numVertices,x=this._pool,p=0==x.sizeVec3?new oimo.common.Vec3:x.stackVec3[--x.sizeVec3],f=this._pool,u=0==f.sizeVec3?new oimo.common.Vec3:f.stackVec3[--f.sizeVec3],v=this._pool,X=0==v.sizeVec3?new oimo.common.Vec3:v.stackVec3[--v.sizeVec3],y=this._pool,g=0==y.sizeVec3?new oimo.common.Vec3:y.stackVec3[--y.sizeVec3],d=this._pool,Y=0==d.sizeVec3?new oimo.common.Vec3:d.stackVec3[--d.sizeVec3],z=this._pool,Z=0==z.sizeVec3?new oimo.common.Vec3:z.stackVec3[--z.sizeVec3],M=this._pool,I=0==M.sizeMat3?new oimo.common.Mat3:M.stackMat3[--M.sizeMat3],V=this._pool,L=0==V.sizeVec3?new oimo.common.Vec3:V.stackVec3[--V.sizeVec3],w=I;w.e00=o._rotation00,w.e01=o._rotation01,w.e02=o._rotation02,w.e10=o._rotation10,w.e11=o._rotation11,w.e12=o._rotation12,w.e20=o._rotation20,w.e21=o._rotation21,w.e22=o._rotation22;let k=L;k.x=o._positionX,k.y=o._positionY,k.z=o._positionZ;let B=0;for(;B<b;){let t=B++,i=m._tmpVertices[t],o=m._vertices[t];i.x=o.x,i.y=o.y,i.z=o.z;let s=i.x*I.e10+i.y*I.e11+i.z*I.e12,a=i.x*I.e20+i.y*I.e21+i.z*I.e22;i.x=i.x*I.e00+i.y*I.e01+i.z*I.e02,i.y=s,i.z=a,i.x+=L.x,i.y+=L.y,i.z+=L.z}if(b>30){let i=0;for(;i<b;){let o=i++,s=m._tmpVertices[o];p.x=s.x,p.y=s.y,p.z=s.z;let n=m._tmpVertices[(o+1)%b];u.x=n.x,u.y=n.y,u.z=n.z,t.line(p,u,a)}}else if(this._debugDraw.wireframe||b>10){let i=0;for(;i<b;){let o=i++,s=m._tmpVertices[o];p.x=s.x,p.y=s.y,p.z=s.z;let n=0;for(;n<o;){let i=m._tmpVertices[n++];u.x=i.x,u.y=i.y,u.z=i.z,t.line(p,u,a)}}}else{let i=0;for(;i<b;){let o=i++,s=m._tmpVertices[o];p.x=s.x,p.y=s.y,p.z=s.z;let n=0;for(;n<o;){let i=n++,o=m._tmpVertices[i];u.x=o.x,u.y=o.y,u.z=o.z;let s=0;for(;s<i;){let i=m._tmpVertices[s++];X.x=i.x,X.y=i.y,X.z=i.z,g.x=u.x,g.y=u.y,g.z=u.z;let o=g;o.x-=p.x,o.y-=p.y,o.z-=p.z,Y.x=X.x,Y.y=X.y,Y.z=X.z;let n=Y;n.x-=p.x,n.y-=p.y,n.z-=p.z,Z.x=g.x,Z.y=g.y,Z.z=g.z;let e=Z,r=e.z*Y.x-e.x*Y.z,_=e.x*Y.y-e.y*Y.x;e.x=e.y*Y.z-e.z*Y.y,e.y=r,e.z=_;let l=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);l>0&&(l=1/l),e.x*=l,e.y*=l,e.z*=l,t.triangle(p,u,X,Z,Z,Z,a),Z.x=-Z.x,Z.y=-Z.y,Z.z=-Z.z,t.triangle(p,X,u,Z,Z,Z,a)}}}}let A=this._pool;if(null!=p){if(p.zero(),A.sizeVec3==A.stackVec3.length){let t=new Array(A.sizeVec3<<1),i=0,o=A.sizeVec3;for(;i<o;){let o=i++;t[o]=A.stackVec3[o],A.stackVec3[o]=null}A.stackVec3=t}A.stackVec3[A.sizeVec3++]=p}let P=this._pool;if(null!=u){if(u.zero(),P.sizeVec3==P.stackVec3.length){let t=new Array(P.sizeVec3<<1),i=0,o=P.sizeVec3;for(;i<o;){let o=i++;t[o]=P.stackVec3[o],P.stackVec3[o]=null}P.stackVec3=t}P.stackVec3[P.sizeVec3++]=u}let S=this._pool;if(null!=X){if(X.zero(),S.sizeVec3==S.stackVec3.length){let t=new Array(S.sizeVec3<<1),i=0,o=S.sizeVec3;for(;i<o;){let o=i++;t[o]=S.stackVec3[o],S.stackVec3[o]=null}S.stackVec3=t}S.stackVec3[S.sizeVec3++]=X}let T=this._pool;if(null!=g){if(g.zero(),T.sizeVec3==T.stackVec3.length){let t=new Array(T.sizeVec3<<1),i=0,o=T.sizeVec3;for(;i<o;){let o=i++;t[o]=T.stackVec3[o],T.stackVec3[o]=null}T.stackVec3=t}T.stackVec3[T.sizeVec3++]=g}let C=this._pool;if(null!=Y){if(Y.zero(),C.sizeVec3==C.stackVec3.length){let t=new Array(C.sizeVec3<<1),i=0,o=C.sizeVec3;for(;i<o;){let o=i++;t[o]=C.stackVec3[o],C.stackVec3[o]=null}C.stackVec3=t}C.stackVec3[C.sizeVec3++]=Y}let j=this._pool;if(null!=Z){if(Z.zero(),j.sizeVec3==j.stackVec3.length){let t=new Array(j.sizeVec3<<1),i=0,o=j.sizeVec3;for(;i<o;){let o=i++;t[o]=j.stackVec3[o],j.stackVec3[o]=null}j.stackVec3=t}j.stackVec3[j.sizeVec3++]=Z}let R=this._pool;if(null!=I){if(I.e00=1,I.e01=0,I.e02=0,I.e10=0,I.e11=1,I.e12=0,I.e20=0,I.e21=0,I.e22=1,R.sizeMat3==R.stackMat3.length){let t=new Array(R.sizeMat3<<1),i=0,o=R.sizeMat3;for(;i<o;){let o=i++;t[o]=R.stackMat3[o],R.stackMat3[o]=null}R.stackMat3=t}R.stackMat3[R.sizeMat3++]=I}let q=this._pool;if(null!=L){if(L.zero(),q.sizeVec3==q.stackVec3.length){let t=new Array(q.sizeVec3<<1),i=0,o=q.sizeVec3;for(;i<o;){let o=i++;t[o]=q.stackVec3[o],q.stackVec3[o]=null}q.stackVec3=t}q.stackVec3[q.sizeVec3++]=L}}}if(t.drawAabbs){let o=e._aabb,s=i.aabbColor,a=this._pool,n=0==a.sizeVec3?new oimo.common.Vec3:a.stackVec3[--a.sizeVec3],r=this._pool,_=0==r.sizeVec3?new oimo.common.Vec3:r.stackVec3[--r.sizeVec3],l=n;l.x=o._minX,l.y=o._minY,l.z=o._minZ;let h=_;h.x=o._maxX,h.y=o._maxY,h.z=o._maxZ,t.aabb(n,_,s);let c=this._pool;if(null!=n){if(n.zero(),c.sizeVec3==c.stackVec3.length){let t=new Array(c.sizeVec3<<1),i=0,o=c.sizeVec3;for(;i<o;){let o=i++;t[o]=c.stackVec3[o],c.stackVec3[o]=null}c.stackVec3=t}c.stackVec3[c.sizeVec3++]=n}let m=this._pool;if(null!=_){if(_.zero(),m.sizeVec3==m.stackVec3.length){let t=new Array(m.sizeVec3<<1),i=0,o=m.sizeVec3;for(;i<o;){let o=i++;t[o]=m.stackVec3[o],m.stackVec3[o]=null}m.stackVec3=t}m.stackVec3[m.sizeVec3++]=_}}e=s}o=s}}_drawConstraints(t){let i=t.style;if(t.drawPairs||t.drawContacts){let o=this._contactManager._contactList;for(;null!=o;){let s=o._next;if(t.drawPairs){let s=i.pairColor,a=this._pool,n=0==a.sizeVec3?new oimo.common.Vec3:a.stackVec3[--a.sizeVec3],e=this._pool,r=0==e.sizeVec3?new oimo.common.Vec3:e.stackVec3[--e.sizeVec3],_=n;_.x=o._s1._transform._positionX,_.y=o._s1._transform._positionY,_.z=o._s1._transform._positionZ;let l=r;l.x=o._s2._transform._positionX,l.y=o._s2._transform._positionY,l.z=o._s2._transform._positionZ,t.line(n,r,s);let h=this._pool;if(null!=n){if(n.zero(),h.sizeVec3==h.stackVec3.length){let t=new Array(h.sizeVec3<<1),i=0,o=h.sizeVec3;for(;i<o;){let o=i++;t[o]=h.stackVec3[o],h.stackVec3[o]=null}h.stackVec3=t}h.stackVec3[h.sizeVec3++]=n}let c=this._pool;if(null!=r){if(r.zero(),c.sizeVec3==c.stackVec3.length){let t=new Array(c.sizeVec3<<1),i=0,o=c.sizeVec3;for(;i<o;){let o=i++;t[o]=c.stackVec3[o],c.stackVec3[o]=null}c.stackVec3=t}c.stackVec3[c.sizeVec3++]=r}}if(t.drawContacts){let i=o._contactConstraint,s=o._contactConstraint._manifold._points,a=0,n=o._contactConstraint._manifold._numPoints;for(;a<n;){let o=s[a++],n=t.style,e=this._pool,r=0==e.sizeVec3?new oimo.common.Vec3:e.stackVec3[--e.sizeVec3],_=this._pool,l=0==_.sizeVec3?new oimo.common.Vec3:_.stackVec3[--_.sizeVec3],h=this._pool,c=0==h.sizeVec3?new oimo.common.Vec3:h.stackVec3[--h.sizeVec3],m=this._pool,b=0==m.sizeVec3?new oimo.common.Vec3:m.stackVec3[--m.sizeVec3],x=this._pool,p=0==x.sizeVec3?new oimo.common.Vec3:x.stackVec3[--x.sizeVec3],f=r;f.x=o._pos1X,f.y=o._pos1Y,f.z=o._pos1Z;let u=l;u.x=o._pos2X,u.y=o._pos2Y,u.z=o._pos2Z;let v=c;v.x=i._manifold._normalX,v.y=i._manifold._normalY,v.z=i._manifold._normalZ;let X=b;X.x=i._manifold._tangentX,X.y=i._manifold._tangentY,X.z=i._manifold._tangentZ;let y=p;if(y.x=i._manifold._binormalX,y.y=i._manifold._binormalY,y.z=i._manifold._binormalZ,o._disabled)t.point(r,n.disabledContactColor),t.point(l,n.disabledContactColor),t.line(r,l,n.disabledContactColor);else if(o._warmStarted){let i;switch(3&o._id){case 0:i=n.contactColor;break;case 1:i=n.contactColor2;break;case 2:i=n.contactColor3;break;default:i=n.contactColor4}t.point(r,i),t.point(l,i),t.line(r,l,n.contactColor)}else t.point(r,n.newContactColor),t.point(l,n.newContactColor),t.line(r,l,n.newContactColor);l.x=r.x,l.y=r.y,l.z=r.z;let g=l,d=n.contactNormalLength;if(g.x+=c.x*d,g.y+=c.y*d,g.z+=c.z*d,t.line(r,l,n.contactNormalColor),t.drawContactBases){l.x=r.x,l.y=r.y,l.z=r.z;let i=l,o=n.contactTangentLength;i.x+=b.x*o,i.y+=b.y*o,i.z+=b.z*o,t.line(r,l,n.contactTangentColor),l.x=r.x,l.y=r.y,l.z=r.z;let s=l,a=n.contactBinormalLength;s.x+=p.x*a,s.y+=p.y*a,s.z+=p.z*a,t.line(r,l,n.contactBinormalColor)}let Y=this._pool;if(null!=r){if(r.zero(),Y.sizeVec3==Y.stackVec3.length){let t=new Array(Y.sizeVec3<<1),i=0,o=Y.sizeVec3;for(;i<o;){let o=i++;t[o]=Y.stackVec3[o],Y.stackVec3[o]=null}Y.stackVec3=t}Y.stackVec3[Y.sizeVec3++]=r}let z=this._pool;if(null!=l){if(l.zero(),z.sizeVec3==z.stackVec3.length){let t=new Array(z.sizeVec3<<1),i=0,o=z.sizeVec3;for(;i<o;){let o=i++;t[o]=z.stackVec3[o],z.stackVec3[o]=null}z.stackVec3=t}z.stackVec3[z.sizeVec3++]=l}let Z=this._pool;if(null!=c){if(c.zero(),Z.sizeVec3==Z.stackVec3.length){let t=new Array(Z.sizeVec3<<1),i=0,o=Z.sizeVec3;for(;i<o;){let o=i++;t[o]=Z.stackVec3[o],Z.stackVec3[o]=null}Z.stackVec3=t}Z.stackVec3[Z.sizeVec3++]=c}let M=this._pool;if(null!=b){if(b.zero(),M.sizeVec3==M.stackVec3.length){let t=new Array(M.sizeVec3<<1),i=0,o=M.sizeVec3;for(;i<o;){let o=i++;t[o]=M.stackVec3[o],M.stackVec3[o]=null}M.stackVec3=t}M.stackVec3[M.sizeVec3++]=b}let I=this._pool;if(null!=p){if(p.zero(),I.sizeVec3==I.stackVec3.length){let t=new Array(I.sizeVec3<<1),i=0,o=I.sizeVec3;for(;i<o;){let o=i++;t[o]=I.stackVec3[o],I.stackVec3[o]=null}I.stackVec3=t}I.stackVec3[I.sizeVec3++]=p}}}o=s}}if(t.drawJoints){let i=this._jointList;for(;null!=i;){let o=i._next,s=this._pool,a=0==s.sizeVec3?new oimo.common.Vec3:s.stackVec3[--s.sizeVec3],n=this._pool,e=0==n.sizeVec3?new oimo.common.Vec3:n.stackVec3[--n.sizeVec3],r=a;r.x=i._b1._transform._positionX,r.y=i._b1._transform._positionY,r.z=i._b1._transform._positionZ;let _=e;_.x=i._b2._transform._positionX,_.y=i._b2._transform._positionY,_.z=i._b2._transform._positionZ;let l=this._pool,h=0==l.sizeVec3?new oimo.common.Vec3:l.stackVec3[--l.sizeVec3],c=this._pool,m=0==c.sizeVec3?new oimo.common.Vec3:c.stackVec3[--c.sizeVec3],b=this._pool,x=0==b.sizeVec3?new oimo.common.Vec3:b.stackVec3[--b.sizeVec3],p=this._pool,f=0==p.sizeVec3?new oimo.common.Vec3:p.stackVec3[--p.sizeVec3],u=this._pool,v=0==u.sizeVec3?new oimo.common.Vec3:u.stackVec3[--u.sizeVec3],X=this._pool,y=0==X.sizeVec3?new oimo.common.Vec3:X.stackVec3[--X.sizeVec3],g=this._pool,d=0==g.sizeVec3?new oimo.common.Vec3:g.stackVec3[--g.sizeVec3],Y=this._pool,z=0==Y.sizeVec3?new oimo.common.Vec3:Y.stackVec3[--Y.sizeVec3],Z=h;Z.x=i._anchor1X,Z.y=i._anchor1Y,Z.z=i._anchor1Z;let M=m;M.x=i._anchor2X,M.y=i._anchor2Y,M.z=i._anchor2Z;let I=x;I.x=i._basisX1X,I.y=i._basisX1Y,I.z=i._basisX1Z;let V=f;V.x=i._basisY1X,V.y=i._basisY1Y,V.z=i._basisY1Z;let L=v;L.x=i._basisZ1X,L.y=i._basisZ1Y,L.z=i._basisZ1Z;let w=y;w.x=i._basisX2X,w.y=i._basisX2Y,w.z=i._basisX2Z;let k=d;k.x=i._basisY2X,k.y=i._basisY2Y,k.z=i._basisY2Z;let B=z;if(B.x=i._basisZ2X,B.y=i._basisZ2Y,B.z=i._basisZ2Z,t.line(a,h,t.style.jointLineColor),t.line(e,m,t.style.jointLineColor),t.drawJointLimits)switch(i._type){case 0:break;case 1:let o=i._lm;this._drawRotationalLimit(t,h,f,v,d,t.style.jointRotationalConstraintRadius,o.lowerLimit,o.upperLimit,t.style.jointLineColor);break;case 2:let s=i,a=t.style.jointLineColor,n=s._rotLm,e=s._translLm;this._drawRotationalLimit(t,m,f,v,d,t.style.jointRotationalConstraintRadius,n.lowerLimit,n.upperLimit,a),this._drawTranslationalLimit(t,h,x,e.lowerLimit,e.upperLimit,a);break;case 3:let r=i._lm;this._drawTranslationalLimit(t,h,x,r.lowerLimit,r.upperLimit,t.style.jointLineColor);break;case 4:let _=i,l=t.style.jointRotationalConstraintRadius,c=t.style.jointLineColor,b=_._lm1,p=_._lm2;this._drawRotationalLimit(t,h,f,v,f,l,_._angleX-b.upperLimit,_._angleX-b.lowerLimit,c),this._drawRotationalLimit(t,m,y,d,y,l,p.lowerLimit-_._angleZ,p.upperLimit-_._angleZ,c);break;case 5:let u=i,X=t.style.jointRotationalConstraintRadius,g=t.style.jointLineColor,Y=u._twistLm;this._drawRotationalLimit(t,m,d,z,d,X,Y.lowerLimit-u._twistAngle,Y.upperLimit-u._twistAngle,g),this._drawEllipseOnSphere(t,h,x,f,v,u._maxSwingAngle1,u._maxSwingAngle2,X,g);let Z=this._pool,M=0==Z.sizeVec3?new oimo.common.Vec3:Z.stackVec3[--Z.sizeVec3];M.x=m.x,M.y=m.y,M.z=m.z;let I=M;I.x+=y.x*X,I.y+=y.y*X,I.z+=y.z*X,t.line(m,I,g);let V=this._pool;if(null!=I){if(I.zero(),V.sizeVec3==V.stackVec3.length){let t=new Array(V.sizeVec3<<1),i=0,o=V.sizeVec3;for(;i<o;){let o=i++;t[o]=V.stackVec3[o],V.stackVec3[o]=null}V.stackVec3=t}V.stackVec3[V.sizeVec3++]=I}break;case 6:let L=i,w=t.style.jointRotationalConstraintRadius,k=t.style.jointLineColor,B=L._rotLms[0],A=L._rotLms[1],P=L._rotLms[2];this._drawTranslationalLimit3D(t,h,x,f,v,L._translLms[0],L._translLms[1],L._translLms[2],k);let S=this._pool,T=0==S.sizeVec3?new oimo.common.Vec3:S.stackVec3[--S.sizeVec3],C=T;C.x=L._axisYX,C.y=L._axisYY,C.z=L._axisYZ;let j=this._pool,R=0==j.sizeVec3?new oimo.common.Vec3:j.stackVec3[--j.sizeVec3];R.x=x.x,R.y=x.y,R.z=x.z;let q=R,E=this._pool,D=0==E.sizeVec3?new oimo.common.Vec3:E.stackVec3[--E.sizeVec3];D.x=x.x,D.y=x.y,D.z=x.z;let F=D,N=F.z*T.x-F.x*T.z,W=F.x*T.y-F.y*T.x;F.x=F.y*T.z-F.z*T.y,F.y=N,F.z=W,this._drawRotationalLimit(t,m,f,v,f,w,L._angleX-B.upperLimit,L._angleX-B.lowerLimit,k),this._drawRotationalLimit(t,m,q,F,q,w,A.lowerLimit-L._angleY,A.upperLimit-L._angleY,k),this._drawRotationalLimit(t,m,y,d,y,w,P.lowerLimit-L._angleZ,P.upperLimit-L._angleZ,k)}t.line(h,m,t.style.jointErrorColor);let A=this._pool;if(null!=a){if(a.zero(),A.sizeVec3==A.stackVec3.length){let t=new Array(A.sizeVec3<<1),i=0,o=A.sizeVec3;for(;i<o;){let o=i++;t[o]=A.stackVec3[o],A.stackVec3[o]=null}A.stackVec3=t}A.stackVec3[A.sizeVec3++]=a}let P=this._pool;if(null!=e){if(e.zero(),P.sizeVec3==P.stackVec3.length){let t=new Array(P.sizeVec3<<1),i=0,o=P.sizeVec3;for(;i<o;){let o=i++;t[o]=P.stackVec3[o],P.stackVec3[o]=null}P.stackVec3=t}P.stackVec3[P.sizeVec3++]=e}let S=this._pool;if(null!=h){if(h.zero(),S.sizeVec3==S.stackVec3.length){let t=new Array(S.sizeVec3<<1),i=0,o=S.sizeVec3;for(;i<o;){let o=i++;t[o]=S.stackVec3[o],S.stackVec3[o]=null}S.stackVec3=t}S.stackVec3[S.sizeVec3++]=h}let T=this._pool;if(null!=m){if(m.zero(),T.sizeVec3==T.stackVec3.length){let t=new Array(T.sizeVec3<<1),i=0,o=T.sizeVec3;for(;i<o;){let o=i++;t[o]=T.stackVec3[o],T.stackVec3[o]=null}T.stackVec3=t}T.stackVec3[T.sizeVec3++]=m}let C=this._pool;if(null!=x){if(x.zero(),C.sizeVec3==C.stackVec3.length){let t=new Array(C.sizeVec3<<1),i=0,o=C.sizeVec3;for(;i<o;){let o=i++;t[o]=C.stackVec3[o],C.stackVec3[o]=null}C.stackVec3=t}C.stackVec3[C.sizeVec3++]=x}let j=this._pool;if(null!=f){if(f.zero(),j.sizeVec3==j.stackVec3.length){let t=new Array(j.sizeVec3<<1),i=0,o=j.sizeVec3;for(;i<o;){let o=i++;t[o]=j.stackVec3[o],j.stackVec3[o]=null}j.stackVec3=t}j.stackVec3[j.sizeVec3++]=f}let R=this._pool;if(null!=v){if(v.zero(),R.sizeVec3==R.stackVec3.length){let t=new Array(R.sizeVec3<<1),i=0,o=R.sizeVec3;for(;i<o;){let o=i++;t[o]=R.stackVec3[o],R.stackVec3[o]=null}R.stackVec3=t}R.stackVec3[R.sizeVec3++]=v}let q=this._pool;if(null!=y){if(y.zero(),q.sizeVec3==q.stackVec3.length){let t=new Array(q.sizeVec3<<1),i=0,o=q.sizeVec3;for(;i<o;){let o=i++;t[o]=q.stackVec3[o],q.stackVec3[o]=null}q.stackVec3=t}q.stackVec3[q.sizeVec3++]=y}let E=this._pool;if(null!=d){if(d.zero(),E.sizeVec3==E.stackVec3.length){let t=new Array(E.sizeVec3<<1),i=0,o=E.sizeVec3;for(;i<o;){let o=i++;t[o]=E.stackVec3[o],E.stackVec3[o]=null}E.stackVec3=t}E.stackVec3[E.sizeVec3++]=d}let D=this._pool;if(null!=z){if(z.zero(),D.sizeVec3==D.stackVec3.length){let t=new Array(D.sizeVec3<<1),i=0,o=D.sizeVec3;for(;i<o;){let o=i++;t[o]=D.stackVec3[o],D.stackVec3[o]=null}D.stackVec3=t}D.stackVec3[D.sizeVec3++]=z}i=o}}}_drawRotationalLimit(t,i,o,s,a,n,e,r,_){if(e!=r){let l=this._pool,h=0==l.sizeVec3?new oimo.common.Vec3:l.stackVec3[--l.sizeVec3];h.x=i.x,h.y=i.y,h.z=i.z;let c=h;c.x+=a.x*n,c.y+=a.y*n,c.z+=a.z*n,t.line(i,c,_);let m=this._pool;if(null!=c){if(c.zero(),m.sizeVec3==m.stackVec3.length){let t=new Array(m.sizeVec3<<1),i=0,o=m.sizeVec3;for(;i<o;){let o=i++;t[o]=m.stackVec3[o],m.stackVec3[o]=null}m.stackVec3=t}m.stackVec3[m.sizeVec3++]=c}e>r?t.ellipse(i,o,s,n,n,_):t.arc(i,o,s,n,n,e,r,!0,_)}}_drawTranslationalLimit(t,i,o,s,a,n){if(s<a){let e=this._pool,r=0==e.sizeVec3?new oimo.common.Vec3:e.stackVec3[--e.sizeVec3];r.x=i.x,r.y=i.y,r.z=i.z;let _=r;_.x+=o.x*s,_.y+=o.y*s,_.z+=o.z*s;let l=this._pool,h=0==l.sizeVec3?new oimo.common.Vec3:l.stackVec3[--l.sizeVec3];h.x=i.x,h.y=i.y,h.z=i.z;let c=h;c.x+=o.x*a,c.y+=o.y*a,c.z+=o.z*a,t.line(_,c,n);let m=this._pool;if(null!=_){if(_.zero(),m.sizeVec3==m.stackVec3.length){let t=new Array(m.sizeVec3<<1),i=0,o=m.sizeVec3;for(;i<o;){let o=i++;t[o]=m.stackVec3[o],m.stackVec3[o]=null}m.stackVec3=t}m.stackVec3[m.sizeVec3++]=_}let b=this._pool;if(null!=c){if(c.zero(),b.sizeVec3==b.stackVec3.length){let t=new Array(b.sizeVec3<<1),i=0,o=b.sizeVec3;for(;i<o;){let o=i++;t[o]=b.stackVec3[o],b.stackVec3[o]=null}b.stackVec3=t}b.stackVec3[b.sizeVec3++]=c}}}_drawTranslationalLimit3D(t,i,o,s,a,n,e,r,_){let l=n.lowerLimit,h=n.upperLimit,c=e.lowerLimit,m=e.upperLimit,b=r.lowerLimit,x=r.upperLimit,p=this._pool;0==p.sizeVec3?new oimo.common.Vec3:--p.sizeVec3;let f=this._pool;0==f.sizeVec3?new oimo.common.Vec3:--f.sizeVec3;let u=this._pool,v=0==u.sizeVec3?new oimo.common.Vec3:u.stackVec3[--u.sizeVec3];v.x=i.x,v.y=i.y,v.z=i.z;let X=v;X.x+=o.x*l,X.y+=o.y*l,X.z+=o.z*l,X.x+=s.x*c,X.y+=s.y*c,X.z+=s.z*c,X.x+=a.x*b,X.y+=a.y*b,X.z+=a.z*b;let y=this._pool,g=0==y.sizeVec3?new oimo.common.Vec3:y.stackVec3[--y.sizeVec3];g.x=i.x,g.y=i.y,g.z=i.z;let d=g;d.x+=o.x*l,d.y+=o.y*l,d.z+=o.z*l,d.x+=s.x*c,d.y+=s.y*c,d.z+=s.z*c,d.x+=a.x*x,d.y+=a.y*x,d.z+=a.z*x;let Y=this._pool,z=0==Y.sizeVec3?new oimo.common.Vec3:Y.stackVec3[--Y.sizeVec3];z.x=i.x,z.y=i.y,z.z=i.z;let Z=z;Z.x+=o.x*l,Z.y+=o.y*l,Z.z+=o.z*l,Z.x+=s.x*m,Z.y+=s.y*m,Z.z+=s.z*m,Z.x+=a.x*b,Z.y+=a.y*b,Z.z+=a.z*b;let M=this._pool,I=0==M.sizeVec3?new oimo.common.Vec3:M.stackVec3[--M.sizeVec3];I.x=i.x,I.y=i.y,I.z=i.z;let V=I;V.x+=o.x*l,V.y+=o.y*l,V.z+=o.z*l,V.x+=s.x*m,V.y+=s.y*m,V.z+=s.z*m,V.x+=a.x*x,V.y+=a.y*x,V.z+=a.z*x;let L=this._pool,w=0==L.sizeVec3?new oimo.common.Vec3:L.stackVec3[--L.sizeVec3];w.x=i.x,w.y=i.y,w.z=i.z;let k=w;k.x+=o.x*h,k.y+=o.y*h,k.z+=o.z*h,k.x+=s.x*c,k.y+=s.y*c,k.z+=s.z*c,k.x+=a.x*b,k.y+=a.y*b,k.z+=a.z*b;let B=this._pool,A=0==B.sizeVec3?new oimo.common.Vec3:B.stackVec3[--B.sizeVec3];A.x=i.x,A.y=i.y,A.z=i.z;let P=A;P.x+=o.x*h,P.y+=o.y*h,P.z+=o.z*h,P.x+=s.x*c,P.y+=s.y*c,P.z+=s.z*c,P.x+=a.x*x,P.y+=a.y*x,P.z+=a.z*x;let S=this._pool,T=0==S.sizeVec3?new oimo.common.Vec3:S.stackVec3[--S.sizeVec3];T.x=i.x,T.y=i.y,T.z=i.z;let C=T;C.x+=o.x*h,C.y+=o.y*h,C.z+=o.z*h,C.x+=s.x*m,C.y+=s.y*m,C.z+=s.z*m,C.x+=a.x*b,C.y+=a.y*b,C.z+=a.z*b;let j=this._pool,R=0==j.sizeVec3?new oimo.common.Vec3:j.stackVec3[--j.sizeVec3];R.x=i.x,R.y=i.y,R.z=i.z;let q=R;q.x+=o.x*h,q.y+=o.y*h,q.z+=o.z*h,q.x+=s.x*m,q.y+=s.y*m,q.z+=s.z*m,q.x+=a.x*x,q.y+=a.y*x,q.z+=a.z*x,t.line(X,k,_),t.line(Z,C,_),t.line(d,P,_),t.line(V,q,_),t.line(X,Z,_),t.line(k,C,_),t.line(d,V,_),t.line(P,q,_),t.line(X,d,_),t.line(k,P,_),t.line(Z,V,_),t.line(C,q,_);let E=this._pool;if(null!=X){if(X.zero(),E.sizeVec3==E.stackVec3.length){let t=new Array(E.sizeVec3<<1),i=0,o=E.sizeVec3;for(;i<o;){let o=i++;t[o]=E.stackVec3[o],E.stackVec3[o]=null}E.stackVec3=t}E.stackVec3[E.sizeVec3++]=X}let D=this._pool;if(null!=d){if(d.zero(),D.sizeVec3==D.stackVec3.length){let t=new Array(D.sizeVec3<<1),i=0,o=D.sizeVec3;for(;i<o;){let o=i++;t[o]=D.stackVec3[o],D.stackVec3[o]=null}D.stackVec3=t}D.stackVec3[D.sizeVec3++]=d}let F=this._pool;if(null!=Z){if(Z.zero(),F.sizeVec3==F.stackVec3.length){let t=new Array(F.sizeVec3<<1),i=0,o=F.sizeVec3;for(;i<o;){let o=i++;t[o]=F.stackVec3[o],F.stackVec3[o]=null}F.stackVec3=t}F.stackVec3[F.sizeVec3++]=Z}let N=this._pool;if(null!=V){if(V.zero(),N.sizeVec3==N.stackVec3.length){let t=new Array(N.sizeVec3<<1),i=0,o=N.sizeVec3;for(;i<o;){let o=i++;t[o]=N.stackVec3[o],N.stackVec3[o]=null}N.stackVec3=t}N.stackVec3[N.sizeVec3++]=V}let W=this._pool;if(null!=k){if(k.zero(),W.sizeVec3==W.stackVec3.length){let t=new Array(W.sizeVec3<<1),i=0,o=W.sizeVec3;for(;i<o;){let o=i++;t[o]=W.stackVec3[o],W.stackVec3[o]=null}W.stackVec3=t}W.stackVec3[W.sizeVec3++]=k}let G=this._pool;if(null!=P){if(P.zero(),G.sizeVec3==G.stackVec3.length){let t=new Array(G.sizeVec3<<1),i=0,o=G.sizeVec3;for(;i<o;){let o=i++;t[o]=G.stackVec3[o],G.stackVec3[o]=null}G.stackVec3=t}G.stackVec3[G.sizeVec3++]=P}let J=this._pool;if(null!=C){if(C.zero(),J.sizeVec3==J.stackVec3.length){let t=new Array(J.sizeVec3<<1),i=0,o=J.sizeVec3;for(;i<o;){let o=i++;t[o]=J.stackVec3[o],J.stackVec3[o]=null}J.stackVec3=t}J.stackVec3[J.sizeVec3++]=C}let O=this._pool;if(null!=q){if(q.zero(),O.sizeVec3==O.stackVec3.length){let t=new Array(O.sizeVec3<<1),i=0,o=O.sizeVec3;for(;i<o;){let o=i++;t[o]=O.stackVec3[o],O.stackVec3[o]=null}O.stackVec3=t}O.stackVec3[O.sizeVec3++]=q}}_drawEllipseOnSphere(t,i,o,s,a,n,e,r,_){let l=0,h=this._pool,c=0==h.sizeVec3?new oimo.common.Vec3:h.stackVec3[--h.sizeVec3],m=this._pool,b=0==m.sizeQuat?new oimo.common.Quat:m.stackQuat[--m.sizeQuat],x=this._pool,p=0==x.sizeMat3?new oimo.common.Mat3:x.stackMat3[--x.sizeMat3],f=this._pool,u=0==f.sizeVec3?new oimo.common.Vec3:f.stackVec3[--f.sizeVec3],v=0;for(;v<17;){let h=v++,m=Math.cos(l)*n,x=Math.sin(l)*e,f=Math.sqrt(m*m+x*x),X=Math.sin(.5*f),y=Math.cos(.5*f),g=c.zero();g.x+=s.x*m,g.y+=s.y*m,g.z+=s.z*m,g.x+=a.x*x,g.y+=a.y*x,g.z+=a.z*x;let d=1/f*X;c.x*=d,c.y*=d,c.z*=d,b.x=c.x,b.y=c.y,b.z=c.z,b.w=y;let Y=b.x,z=b.y,Z=b.z,M=b.w,I=2*Y,V=2*z,L=2*Z,w=Y*I,k=z*V,B=Z*L,A=Y*V,P=z*L,S=Y*L,T=M*I,C=M*V,j=M*L;p.e00=1-k-B,p.e01=A-j,p.e02=S+C,p.e10=A+j,p.e11=1-w-B,p.e12=P-T,p.e20=S-C,p.e21=P+T,p.e22=1-w-k;let R=this._pool,q=0==R.sizeVec3?new oimo.common.Vec3:R.stackVec3[--R.sizeVec3];q.x+=o.x*r,q.y+=o.y*r,q.z+=o.z*r;let E=q,D=E.x*p.e10+E.y*p.e11+E.z*p.e12,F=E.x*p.e20+E.y*p.e21+E.z*p.e22;E.x=E.x*p.e00+E.y*p.e01+E.z*p.e02,E.y=D,E.z=F,E.x+=i.x,E.y+=i.y,E.z+=i.z,h>=1&&t.line(u,E,_);let N=this._pool;if(null!=u){if(u.zero(),N.sizeVec3==N.stackVec3.length){let t=new Array(N.sizeVec3<<1),i=0,o=N.sizeVec3;for(;i<o;){let o=i++;t[o]=N.stackVec3[o],N.stackVec3[o]=null}N.stackVec3=t}N.stackVec3[N.sizeVec3++]=u}u=E,l+=.39269908169872375}let X=this._pool;if(null!=c){if(c.zero(),X.sizeVec3==X.stackVec3.length){let t=new Array(X.sizeVec3<<1),i=0,o=X.sizeVec3;for(;i<o;){let o=i++;t[o]=X.stackVec3[o],X.stackVec3[o]=null}X.stackVec3=t}X.stackVec3[X.sizeVec3++]=c}let y=this._pool;if(null!=b){if(b.x=0,b.y=0,b.z=0,b.w=1,y.sizeQuat==y.stackQuat.length){let t=new Array(y.sizeQuat<<1),i=0,o=y.sizeQuat;for(;i<o;){let o=i++;t[o]=y.stackQuat[o],y.stackQuat[o]=null}y.stackQuat=t}y.stackQuat[y.sizeQuat++]=b}let g=this._pool;if(null!=p){if(p.e00=1,p.e01=0,p.e02=0,p.e10=0,p.e11=1,p.e12=0,p.e20=0,p.e21=0,p.e22=1,g.sizeMat3==g.stackMat3.length){let t=new Array(g.sizeMat3<<1),i=0,o=g.sizeMat3;for(;i<o;){let o=i++;t[o]=g.stackMat3[o],g.stackMat3[o]=null}g.stackMat3=t}g.stackMat3[g.sizeMat3++]=p}let d=this._pool;if(null!=u){if(u.zero(),d.sizeVec3==d.stackVec3.length){let t=new Array(d.sizeVec3<<1),i=0,o=d.sizeVec3;for(;i<o;){let o=i++;t[o]=d.stackVec3[o],d.stackVec3[o]=null}d.stackVec3=t}d.stackVec3[d.sizeVec3++]=u}}step(t){this._timeStep.dt>0&&(this._timeStep.dtRatio=t/this._timeStep.dt),this._timeStep.dt=t,this._timeStep.invDt=1/t;let i=Date.now()/1e3;this._updateContacts(),this._solveIslands(),oimo.dynamics.common.Performance.totalTime=1e3*(Date.now()/1e3-i)}addRigidBody(t){if(null!=t._world)throw new Error("A rigid body cannot belong to multiple worlds.");null==this._rigidBodyList?(this._rigidBodyList=t,this._rigidBodyListLast=t):(this._rigidBodyListLast._next=t,t._prev=this._rigidBodyListLast,this._rigidBodyListLast=t),t._world=this;let i=t._shapeList;for(;null!=i;){let t=i._next;i._proxy=this._broadPhase.createProxy(i,i._aabb),i._id=this._shapeIdCount++,this._numShapes++,i=t}this._numRigidBodies++}removeRigidBody(t){if(t._world!=this)throw new Error("The rigid body doesn't belong to the world.");let i=t._prev,o=t._next;null!=i&&(i._next=o),null!=o&&(o._prev=i),t==this._rigidBodyList&&(this._rigidBodyList=this._rigidBodyList._next),t==this._rigidBodyListLast&&(this._rigidBodyListLast=this._rigidBodyListLast._prev),t._next=null,t._prev=null,t._world=null;let s=t._shapeList;for(;null!=s;){let t=s._next;this._broadPhase.destroyProxy(s._proxy),s._proxy=null,s._id=-1;let i=s._rigidBody._contactLinkList;for(;null!=i;){let t=i._next,o=i._contact;if(o._s1==s||o._s2==s){let t=i._other;t._sleeping=!1,t._sleepTime=0;let s=this._contactManager,a=o._prev,n=o._next;if(null!=a&&(a._next=n),null!=n&&(n._prev=a),o==s._contactList&&(s._contactList=s._contactList._next),o==s._contactListLast&&(s._contactListLast=s._contactListLast._prev),o._next=null,o._prev=null,o._touching){let t=o._s1._contactCallback,i=o._s2._contactCallback;t==i&&(i=null),null!=t&&t.endContact(o),null!=i&&i.endContact(o)}let e=o._link1._prev,r=o._link1._next;null!=e&&(e._next=r),null!=r&&(r._prev=e),o._link1==o._b1._contactLinkList&&(o._b1._contactLinkList=o._b1._contactLinkList._next),o._link1==o._b1._contactLinkListLast&&(o._b1._contactLinkListLast=o._b1._contactLinkListLast._prev),o._link1._next=null,o._link1._prev=null;let _=o._link2._prev,l=o._link2._next;null!=_&&(_._next=l),null!=l&&(l._prev=_),o._link2==o._b2._contactLinkList&&(o._b2._contactLinkList=o._b2._contactLinkList._next),o._link2==o._b2._contactLinkListLast&&(o._b2._contactLinkListLast=o._b2._contactLinkListLast._prev),o._link2._next=null,o._link2._prev=null,o._b1._numContactLinks--,o._b2._numContactLinks--,o._link1._other=null,o._link2._other=null,o._link1._contact=null,o._link2._contact=null,o._s1=null,o._s2=null,o._b1=null,o._b2=null,o._touching=!1,o._cachedDetectorData._clear(),o._manifold._clear(),o._detector=null;let h=o._contactConstraint;h._s1=null,h._s2=null,h._b1=null,h._b2=null,h._tf1=null,h._tf2=null,o._next=s._contactPool,s._contactPool=o,s._numContacts--}i=t}this._numShapes--,s=t}this._numRigidBodies--}addJoint(t){if(null!=t._world)throw new Error("A joint cannot belong to multiple worlds.");null==this._jointList?(this._jointList=t,this._jointListLast=t):(this._jointListLast._next=t,t._prev=this._jointListLast,this._jointListLast=t),t._world=this,t._link1._other=t._b2,t._link2._other=t._b1,null==t._b1._jointLinkList?(t._b1._jointLinkList=t._link1,t._b1._jointLinkListLast=t._link1):(t._b1._jointLinkListLast._next=t._link1,t._link1._prev=t._b1._jointLinkListLast,t._b1._jointLinkListLast=t._link1),null==t._b2._jointLinkList?(t._b2._jointLinkList=t._link2,t._b2._jointLinkListLast=t._link2):(t._b2._jointLinkListLast._next=t._link2,t._link2._prev=t._b2._jointLinkListLast,t._b2._jointLinkListLast=t._link2),t._b1._numJointLinks++,t._b2._numJointLinks++;let i=t._b1;i._sleeping=!1,i._sleepTime=0;let o=t._b2;o._sleeping=!1,o._sleepTime=0,t._syncAnchors(),this._numJoints++}removeJoint(t){if(t._world!=this)throw new Error("The joint doesn't belong to the world.");let i=t._prev,o=t._next;null!=i&&(i._next=o),null!=o&&(o._prev=i),t==this._jointList&&(this._jointList=this._jointList._next),t==this._jointListLast&&(this._jointListLast=this._jointListLast._prev),t._next=null,t._prev=null,t._world=null;let s=t._link1._prev,a=t._link1._next;null!=s&&(s._next=a),null!=a&&(a._prev=s),t._link1==t._b1._jointLinkList&&(t._b1._jointLinkList=t._b1._jointLinkList._next),t._link1==t._b1._jointLinkListLast&&(t._b1._jointLinkListLast=t._b1._jointLinkListLast._prev),t._link1._next=null,t._link1._prev=null;let n=t._link2._prev,e=t._link2._next;null!=n&&(n._next=e),null!=e&&(e._prev=n),t._link2==t._b2._jointLinkList&&(t._b2._jointLinkList=t._b2._jointLinkList._next),t._link2==t._b2._jointLinkListLast&&(t._b2._jointLinkListLast=t._b2._jointLinkListLast._prev),t._link2._next=null,t._link2._prev=null,t._link1._other=null,t._link2._other=null,t._b1._numJointLinks--,t._b2._numJointLinks--;let r=t._b1;r._sleeping=!1,r._sleepTime=0;let _=t._b2;_._sleeping=!1,_._sleepTime=0,this._numJoints--}setDebugDraw(t){this._debugDraw=t}getDebugDraw(){return this._debugDraw}debugDraw(){null!=this._debugDraw&&(2==this._broadPhase._type&&this._drawBvh(this._debugDraw,this._broadPhase._tree),this._drawRigidBodies(this._debugDraw),this._drawConstraints(this._debugDraw))}rayCast(t,i,o){let s=this._rayCastWrapper.begin;s.x=t.x,s.y=t.y,s.z=t.z;let a=this._rayCastWrapper.end;a.x=i.x,a.y=i.y,a.z=i.z,this._rayCastWrapper.callback=o,this._broadPhase.rayCast(t,i,this._rayCastWrapper)}convexCast(t,i,o,s){this._convexCastWrapper.convex=t;let a=this._convexCastWrapper.begin;a._positionX=i._positionX,a._positionY=i._positionY,a._positionZ=i._positionZ,a._rotation00=i._rotation00,a._rotation01=i._rotation01,a._rotation02=i._rotation02,a._rotation10=i._rotation10,a._rotation11=i._rotation11,a._rotation12=i._rotation12,a._rotation20=i._rotation20,a._rotation21=i._rotation21,a._rotation22=i._rotation22;let n=this._convexCastWrapper.translation;n.x=o.x,n.y=o.y,n.z=o.z,this._convexCastWrapper.callback=s,this._broadPhase.convexCast(t,i,o,this._convexCastWrapper)}aabbTest(t,i){this._aabbTestWrapper._aabb.copyFrom(t),this._aabbTestWrapper._callback=i,this._broadPhase.aabbTest(t,this._aabbTestWrapper)}getRigidBodyList(){return this._rigidBodyList}getJointList(){return this._jointList}getBroadPhase(){return this._broadPhase}getContactManager(){return this._contactManager}getNumRigidBodies(){return this._numRigidBodies}getNumJoints(){return this._numJoints}getNumShapes(){return this._numShapes}getNumIslands(){return this._numIslands}getNumVelocityIterations(){return this._numVelocityIterations}setNumVelocityIterations(t){this._numVelocityIterations=t}getNumPositionIterations(){return this._numPositionIterations}setNumPositionIterations(t){this._numPositionIterations=t}getGravity(){return this._gravity}setGravity(t){let i=this._gravity;i.x=t.x,i.y=t.y,i.z=t.z}},oimo.dynamics._World||(oimo.dynamics._World={}),oimo.dynamics._World.RayCastWrapper=class extends oimo.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this.rayCastHit=new oimo.collision.geometry.RayCastHit,this.begin=new oimo.common.Vec3,this.end=new oimo.common.Vec3,this.callback=null}process(t){let i=t.userData;i._geom.rayCast(this.begin,this.end,i._transform,this.rayCastHit)&&this.callback.process(i,this.rayCastHit)}},oimo.dynamics._World.ConvexCastWrapper=class extends oimo.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this.rayCastHit=new oimo.collision.geometry.RayCastHit,this.begin=new oimo.common.Transform,this.translation=new oimo.common.Vec3,this.zero=new oimo.common.Vec3,this.callback=null,this.convex=null}process(t){let i=t.userData,o=i._geom._type;o<0||o>5||oimo.collision.narrowphase.detector.gjkepa.GjkEpa.instance.convexCast(this.convex,i._geom,this.begin,i._transform,this.translation,this.zero,this.rayCastHit)&&this.callback.process(i,this.rayCastHit)}},oimo.dynamics._World.AabbTestWrapper=class extends oimo.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this._aabb=new oimo.collision.geometry.Aabb,this._callback=null}process(t){let i=t.userData,o=i._aabb;o._minX<this._aabb._maxX&&o._maxX>this._aabb._minX&&o._minY<this._aabb._maxY&&o._maxY>this._aabb._minY&&o._minZ<this._aabb._maxZ&&o._maxZ>this._aabb._minZ&&this._callback.process(i)}},oimo.dynamics.callback||(oimo.dynamics.callback={}),oimo.dynamics.callback.AabbTestCallback=class{constructor(){}process(t){}},oimo.dynamics.callback.ContactCallback=class{constructor(){}beginContact(t){}preSolve(t){}postSolve(t){}endContact(t){}},oimo.dynamics.callback.RayCastCallback=class{constructor(){}process(t,i){}},oimo.dynamics.callback.RayCastClosest=class extends oimo.dynamics.callback.RayCastCallback{constructor(){super(),this.position=new oimo.common.Vec3,this.normal=new oimo.common.Vec3,this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1}clear(){this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1}process(t,i){if(i.fraction<this.fraction){this.shape=t,this.hit=!0,this.fraction=i.fraction;let o=this.position,s=i.position;o.x=s.x,o.y=s.y,o.z=s.z;let a=this.normal,n=i.normal;a.x=n.x,a.y=n.y,a.z=n.z}}},oimo.dynamics.common||(oimo.dynamics.common={}),oimo.dynamics.common.DebugDraw=class{constructor(){this.p=new oimo.common.Pool,this.wireframe=!1,this.drawShapes=!0,this.drawBvh=!1,this.drawBvhMinLevel=0,this.drawBvhMaxLevel=65536,this.drawAabbs=!1,this.drawBases=!1,this.drawPairs=!1,this.drawContacts=!1,this.drawJoints=!0,this.drawJointLimits=!1,this.sphereCoords=new Array(5),this.tmpSphereVerts=new Array(5),this.tmpSphereNorms=new Array(5);let t=0;for(;t<5;){let i=t++,o=0==i||4==i?1:8;this.sphereCoords[i]=new Array(o),this.tmpSphereVerts[i]=new Array(o),this.tmpSphereNorms[i]=new Array(o);let s=0;for(;s<8;){let t=s++,o=.7853981633974475*i,a=.7853981633974475*t;this.sphereCoords[i][t]=new oimo.common.Vec3(Math.sin(o)*Math.cos(a),Math.cos(o),-Math.sin(o)*Math.sin(a)),this.tmpSphereVerts[i][t]=new oimo.common.Vec3,this.tmpSphereNorms[i][t]=new oimo.common.Vec3}}this.circleCoords=new Array(8),this.circleCoordsShift=new Array(8),this.tmpCircleVerts1=new Array(8),this.tmpCircleVerts2=new Array(8),this.tmpCircleNorms=new Array(8);let i=0;for(;i<8;){let t=i++;this.circleCoords[t]=new oimo.common.Vec3(Math.cos(.7853981633974475*t),0,-Math.sin(.7853981633974475*t)),this.circleCoordsShift[t]=new oimo.common.Vec3(Math.cos(.7853981633974475*(t+.5)),0,-Math.sin(.7853981633974475*(t+.5))),this.tmpCircleVerts1[t]=new oimo.common.Vec3,this.tmpCircleVerts2[t]=new oimo.common.Vec3,this.tmpCircleNorms[t]=new oimo.common.Vec3}this.style=new oimo.dynamics.common.DebugDrawStyle}aabb(t,i,o){let s=this.p,a=(0==s.sizeVec3?new oimo.common.Vec3:s.stackVec3[--s.sizeVec3]).init(t.x,t.y,t.z),n=this.p,e=(0==n.sizeVec3?new oimo.common.Vec3:n.stackVec3[--n.sizeVec3]).init(t.x,t.y,i.z),r=this.p,_=(0==r.sizeVec3?new oimo.common.Vec3:r.stackVec3[--r.sizeVec3]).init(t.x,i.y,t.z),l=this.p,h=(0==l.sizeVec3?new oimo.common.Vec3:l.stackVec3[--l.sizeVec3]).init(t.x,i.y,i.z),c=this.p,m=(0==c.sizeVec3?new oimo.common.Vec3:c.stackVec3[--c.sizeVec3]).init(i.x,t.y,t.z),b=this.p,x=(0==b.sizeVec3?new oimo.common.Vec3:b.stackVec3[--b.sizeVec3]).init(i.x,t.y,i.z),p=this.p,f=(0==p.sizeVec3?new oimo.common.Vec3:p.stackVec3[--p.sizeVec3]).init(i.x,i.y,t.z),u=this.p,v=(0==u.sizeVec3?new oimo.common.Vec3:u.stackVec3[--u.sizeVec3]).init(i.x,i.y,i.z);this.line(a,e,o),this.line(_,h,o),this.line(m,x,o),this.line(f,v,o),this.line(a,_,o),this.line(e,h,o),this.line(m,f,o),this.line(x,v,o),this.line(a,m,o),this.line(e,x,o),this.line(_,f,o),this.line(h,v,o);let X=this.p;if(null!=a){if(a.zero(),X.sizeVec3==X.stackVec3.length){let t=new Array(X.sizeVec3<<1),i=0,o=X.sizeVec3;for(;i<o;){let o=i++;t[o]=X.stackVec3[o],X.stackVec3[o]=null}X.stackVec3=t}X.stackVec3[X.sizeVec3++]=a}let y=this.p;if(null!=e){if(e.zero(),y.sizeVec3==y.stackVec3.length){let t=new Array(y.sizeVec3<<1),i=0,o=y.sizeVec3;for(;i<o;){let o=i++;t[o]=y.stackVec3[o],y.stackVec3[o]=null}y.stackVec3=t}y.stackVec3[y.sizeVec3++]=e}let g=this.p;if(null!=_){if(_.zero(),g.sizeVec3==g.stackVec3.length){let t=new Array(g.sizeVec3<<1),i=0,o=g.sizeVec3;for(;i<o;){let o=i++;t[o]=g.stackVec3[o],g.stackVec3[o]=null}g.stackVec3=t}g.stackVec3[g.sizeVec3++]=_}let d=this.p;if(null!=h){if(h.zero(),d.sizeVec3==d.stackVec3.length){let t=new Array(d.sizeVec3<<1),i=0,o=d.sizeVec3;for(;i<o;){let o=i++;t[o]=d.stackVec3[o],d.stackVec3[o]=null}d.stackVec3=t}d.stackVec3[d.sizeVec3++]=h}let Y=this.p;if(null!=m){if(m.zero(),Y.sizeVec3==Y.stackVec3.length){let t=new Array(Y.sizeVec3<<1),i=0,o=Y.sizeVec3;for(;i<o;){let o=i++;t[o]=Y.stackVec3[o],Y.stackVec3[o]=null}Y.stackVec3=t}Y.stackVec3[Y.sizeVec3++]=m}let z=this.p;if(null!=x){if(x.zero(),z.sizeVec3==z.stackVec3.length){let t=new Array(z.sizeVec3<<1),i=0,o=z.sizeVec3;for(;i<o;){let o=i++;t[o]=z.stackVec3[o],z.stackVec3[o]=null}z.stackVec3=t}z.stackVec3[z.sizeVec3++]=x}let Z=this.p;if(null!=f){if(f.zero(),Z.sizeVec3==Z.stackVec3.length){let t=new Array(Z.sizeVec3<<1),i=0,o=Z.sizeVec3;for(;i<o;){let o=i++;t[o]=Z.stackVec3[o],Z.stackVec3[o]=null}Z.stackVec3=t}Z.stackVec3[Z.sizeVec3++]=f}let M=this.p;if(null!=v){if(v.zero(),M.sizeVec3==M.stackVec3.length){let t=new Array(M.sizeVec3<<1),i=0,o=M.sizeVec3;for(;i<o;){let o=i++;t[o]=M.stackVec3[o],M.stackVec3[o]=null}M.stackVec3=t}M.stackVec3[M.sizeVec3++]=v}}basis(t,i,o,s,a){let n=this.p,e=0==n.sizeVec3?new oimo.common.Vec3:n.stackVec3[--n.sizeVec3],r=this.p,_=0==r.sizeMat3?new oimo.common.Mat3:r.stackMat3[--r.sizeMat3],l=this.p,h=0==l.sizeVec3?new oimo.common.Vec3:l.stackVec3[--l.sizeVec3],c=this.p,m=0==c.sizeVec3?new oimo.common.Vec3:c.stackVec3[--c.sizeVec3],b=this.p,x=0==b.sizeVec3?new oimo.common.Vec3:b.stackVec3[--b.sizeVec3],p=e;p.x=t._positionX,p.y=t._positionY,p.z=t._positionZ;let f=_;f.e00=t._rotation00,f.e01=t._rotation01,f.e02=t._rotation02,f.e10=t._rotation10,f.e11=t._rotation11,f.e12=t._rotation12,f.e20=t._rotation20,f.e21=t._rotation21,f.e22=t._rotation22,h.init(_.e00,_.e10,_.e20),m.init(_.e01,_.e11,_.e21),x.init(_.e02,_.e12,_.e22),h.x*=i,h.y*=i,h.z*=i;let u=h;u.x+=e.x,u.y+=e.y,u.z+=e.z,m.x*=i,m.y*=i,m.z*=i;let v=m;v.x+=e.x,v.y+=e.y,v.z+=e.z,x.x*=i,x.y*=i,x.z*=i;let X=x;X.x+=e.x,X.y+=e.y,X.z+=e.z,this.line(e,h,o),this.line(e,m,s),this.line(e,x,a);let y=this.p;if(null!=e){if(e.zero(),y.sizeVec3==y.stackVec3.length){let t=new Array(y.sizeVec3<<1),i=0,o=y.sizeVec3;for(;i<o;){let o=i++;t[o]=y.stackVec3[o],y.stackVec3[o]=null}y.stackVec3=t}y.stackVec3[y.sizeVec3++]=e}let g=this.p;if(null!=_){if(_.e00=1,_.e01=0,_.e02=0,_.e10=0,_.e11=1,_.e12=0,_.e20=0,_.e21=0,_.e22=1,g.sizeMat3==g.stackMat3.length){let t=new Array(g.sizeMat3<<1),i=0,o=g.sizeMat3;for(;i<o;){let o=i++;t[o]=g.stackMat3[o],g.stackMat3[o]=null}g.stackMat3=t}g.stackMat3[g.sizeMat3++]=_}let d=this.p;if(null!=h){if(h.zero(),d.sizeVec3==d.stackVec3.length){let t=new Array(d.sizeVec3<<1),i=0,o=d.sizeVec3;for(;i<o;){let o=i++;t[o]=d.stackVec3[o],d.stackVec3[o]=null}d.stackVec3=t}d.stackVec3[d.sizeVec3++]=h}let Y=this.p;if(null!=m){if(m.zero(),Y.sizeVec3==Y.stackVec3.length){let t=new Array(Y.sizeVec3<<1),i=0,o=Y.sizeVec3;for(;i<o;){let o=i++;t[o]=Y.stackVec3[o],Y.stackVec3[o]=null}Y.stackVec3=t}Y.stackVec3[Y.sizeVec3++]=m}let z=this.p;if(null!=x){if(x.zero(),z.sizeVec3==z.stackVec3.length){let t=new Array(z.sizeVec3<<1),i=0,o=z.sizeVec3;for(;i<o;){let o=i++;t[o]=z.stackVec3[o],z.stackVec3[o]=null}z.stackVec3=t}z.stackVec3[z.sizeVec3++]=x}}ellipse(t,i,o,s,a,n){this.arc(t,i,o,s,a,0,6.28318530717958,!1,n)}arc(t,i,o,s,a,n,e,r,_){let l=this.p,h=0==l.sizeVec3?new oimo.common.Vec3:l.stackVec3[--l.sizeVec3];h.x=i.x,h.y=i.y,h.z=i.z;let c=h;c.x*=s,c.y*=s,c.z*=s;let m=this.p,b=0==m.sizeVec3?new oimo.common.Vec3:m.stackVec3[--m.sizeVec3];b.x=o.x,b.y=o.y,b.z=o.z;let x=b;x.x*=a,x.y*=a,x.z*=a;let p=e-n;p<0&&(p=-p);let f=p/.5235987755982984+.5|0;0==f&&(f=1);let u=n,v=(e-n)/f,X=this.p,y=0==X.sizeVec3?new oimo.common.Vec3:X.stackVec3[--X.sizeVec3];y.x=t.x,y.y=t.y,y.z=t.z;let g=y,d=Math.cos(n);g.x+=c.x*d,g.y+=c.y*d,g.z+=c.z*d;let Y=Math.sin(n);g.x+=x.x*Y,g.y+=x.y*Y,g.z+=x.z*Y;let z=g;r&&this.line(t,g,_);let Z=0,M=f;for(;Z<M;){++Z,u+=v;let i=this.p,o=0==i.sizeVec3?new oimo.common.Vec3:i.stackVec3[--i.sizeVec3];o.x=t.x,o.y=t.y,o.z=t.z;let s=o,a=Math.cos(u);s.x+=c.x*a,s.y+=c.y*a,s.z+=c.z*a;let n=Math.sin(u);s.x+=x.x*n,s.y+=x.y*n,s.z+=x.z*n,this.line(z,s,_);let e=this.p;if(null!=z){if(z.zero(),e.sizeVec3==e.stackVec3.length){let t=new Array(e.sizeVec3<<1),i=0,o=e.sizeVec3;for(;i<o;){let o=i++;t[o]=e.stackVec3[o],e.stackVec3[o]=null}e.stackVec3=t}e.stackVec3[e.sizeVec3++]=z}z=s}r&&this.line(t,z,_);let I=this.p;if(null!=z){if(z.zero(),I.sizeVec3==I.stackVec3.length){let t=new Array(I.sizeVec3<<1),i=0,o=I.sizeVec3;for(;i<o;){let o=i++;t[o]=I.stackVec3[o],I.stackVec3[o]=null}I.stackVec3=t}I.stackVec3[I.sizeVec3++]=z}let V=this.p;if(null!=c){if(c.zero(),V.sizeVec3==V.stackVec3.length){let t=new Array(V.sizeVec3<<1),i=0,o=V.sizeVec3;for(;i<o;){let o=i++;t[o]=V.stackVec3[o],V.stackVec3[o]=null}V.stackVec3=t}V.stackVec3[V.sizeVec3++]=c}let L=this.p;if(null!=x){if(x.zero(),L.sizeVec3==L.stackVec3.length){let t=new Array(L.sizeVec3<<1),i=0,o=L.sizeVec3;for(;i<o;){let o=i++;t[o]=L.stackVec3[o],L.stackVec3[o]=null}L.stackVec3=t}L.stackVec3[L.sizeVec3++]=x}}cone(t,i,o,s){let a=this.p,n=0==a.sizeVec3?new oimo.common.Vec3:a.stackVec3[--a.sizeVec3],e=this.p,r=0==e.sizeVec3?new oimo.common.Vec3:e.stackVec3[--e.sizeVec3],_=this.p,l=0==_.sizeVec3?new oimo.common.Vec3:_.stackVec3[--_.sizeVec3],h=this.p,c=0==h.sizeVec3?new oimo.common.Vec3:h.stackVec3[--h.sizeVec3],m=this.p,b=0==m.sizeMat3?new oimo.common.Mat3:m.stackMat3[--m.sizeMat3],x=c;x.x=t._positionX,x.y=t._positionY,x.z=t._positionZ;let p=b;p.e00=t._rotation00,p.e01=t._rotation01,p.e02=t._rotation02,p.e10=t._rotation10,p.e11=t._rotation11,p.e12=t._rotation12,p.e20=t._rotation20,p.e21=t._rotation21,p.e22=t._rotation22,n.init(b.e00,b.e10,b.e20),r.init(b.e01,b.e11,b.e21),l.init(b.e02,b.e12,b.e22);let f=this.p,u=0==f.sizeVec3?new oimo.common.Vec3:f.stackVec3[--f.sizeVec3];u.x=c.x,u.y=c.y,u.z=c.z;let v=u;v.x+=r.x*o,v.y+=r.y*o,v.z+=r.z*o;let X=this.p,y=0==X.sizeVec3?new oimo.common.Vec3:X.stackVec3[--X.sizeVec3];y.x=c.x,y.y=c.y,y.z=c.z;let g=y,d=-o;if(g.x+=r.x*d,g.y+=r.y*d,g.z+=r.z*d,this.wireframe){let t=this.p,o=0==t.sizeVec3?new oimo.common.Vec3:t.stackVec3[--t.sizeVec3];o.x=g.x,o.y=g.y,o.z=g.z;let a=o,e=-i;a.x+=n.x*e,a.y+=n.y*e,a.z+=n.z*e,a.x+=0*l.x,a.y+=0*l.y,a.z+=0*l.z;let r=this.p,_=0==r.sizeVec3?new oimo.common.Vec3:r.stackVec3[--r.sizeVec3];_.x=g.x,_.y=g.y,_.z=g.z;let h=_;h.x+=n.x*i,h.y+=n.y*i,h.z+=n.z*i,h.x+=0*l.x,h.y+=0*l.y,h.z+=0*l.z;let c=this.p,m=0==c.sizeVec3?new oimo.common.Vec3:c.stackVec3[--c.sizeVec3];m.x=g.x,m.y=g.y,m.z=g.z;let b=m;b.x+=0*n.x,b.y+=0*n.y,b.z+=0*n.z;let x=-i;b.x+=l.x*x,b.y+=l.y*x,b.z+=l.z*x;let p=this.p,f=0==p.sizeVec3?new oimo.common.Vec3:p.stackVec3[--p.sizeVec3];f.x=g.x,f.y=g.y,f.z=g.z;let u=f;u.x+=0*n.x,u.y+=0*n.y,u.z+=0*n.z,u.x+=l.x*i,u.y+=l.y*i,u.z+=l.z*i,this.ellipse(g,n,l,i,i,s),this.line(v,a,s),this.line(v,h,s),this.line(v,b,s),this.line(v,u,s);let X=this.p;if(null!=a){if(a.zero(),X.sizeVec3==X.stackVec3.length){let t=new Array(X.sizeVec3<<1),i=0,o=X.sizeVec3;for(;i<o;){let o=i++;t[o]=X.stackVec3[o],X.stackVec3[o]=null}X.stackVec3=t}X.stackVec3[X.sizeVec3++]=a}let y=this.p;if(null!=h){if(h.zero(),y.sizeVec3==y.stackVec3.length){let t=new Array(y.sizeVec3<<1),i=0,o=y.sizeVec3;for(;i<o;){let o=i++;t[o]=y.stackVec3[o],y.stackVec3[o]=null}y.stackVec3=t}y.stackVec3[y.sizeVec3++]=h}let d=this.p;if(null!=b){if(b.zero(),d.sizeVec3==d.stackVec3.length){let t=new Array(d.sizeVec3<<1),i=0,o=d.sizeVec3;for(;i<o;){let o=i++;t[o]=d.stackVec3[o],d.stackVec3[o]=null}d.stackVec3=t}d.stackVec3[d.sizeVec3++]=b}let Y=this.p;if(null!=u){if(u.zero(),Y.sizeVec3==Y.stackVec3.length){let t=new Array(Y.sizeVec3<<1),i=0,o=Y.sizeVec3;for(;i<o;){let o=i++;t[o]=Y.stackVec3[o],Y.stackVec3[o]=null}Y.stackVec3=t}Y.stackVec3[Y.sizeVec3++]=u}}else{let t=1/Math.sqrt(i*i+4*o*o),a=2*o*t,n=i*t,e=0;for(;e<8;){let t=e++,s=this.tmpCircleNorms[t],_=this.circleCoords[t];s.x=_.x,s.y=_.y,s.z=_.z,s.x*=a,s.y*=a,s.z*=a,s.y+=n;let l=this.tmpCircleNorms[t],h=l.x*b.e10+l.y*b.e11+l.z*b.e12,m=l.x*b.e20+l.y*b.e21+l.z*b.e22;l.x=l.x*b.e00+l.y*b.e01+l.z*b.e02,l.y=h,l.z=m;let x=this.tmpCircleVerts1[t],p=this.circleCoordsShift[t];x.x=p.x,x.y=p.y,x.z=p.z,x.x*=a,x.y*=a,x.z*=a,x.y+=n;let f=this.tmpCircleVerts1[t],u=f.x*b.e10+f.y*b.e11+f.z*b.e12,v=f.x*b.e20+f.y*b.e21+f.z*b.e22;f.x=f.x*b.e00+f.y*b.e01+f.z*b.e02,f.y=u,f.z=v;let X=this.tmpCircleVerts2[t],y=this.circleCoords[t];X.x=y.x,X.y=y.y,X.z=y.z;let g=X.x*b.e10+X.y*b.e11+X.z*b.e12,d=X.x*b.e20+X.y*b.e21+X.z*b.e22;X.x=X.x*b.e00+X.y*b.e01+X.z*b.e02,X.y=g,X.z=d,X.x*=i,X.y*=i,X.z*=i,X.x+=c.x,X.y+=c.y,X.z+=c.z;let Y=this.tmpCircleVerts2[t],z=-o;Y.x+=r.x*z,Y.y+=r.y*z,Y.z+=r.z*z}let _=0;for(;_<8;){let t=_++,i=this.tmpCircleVerts2[t],o=this.tmpCircleVerts2[(t+1)%8],a=this.tmpCircleVerts1[t];this.triangle(v,i,o,a,this.tmpCircleNorms[t],this.tmpCircleNorms[(t+1)%8],s),i=this.tmpCircleVerts2[(t+1)%8],o=this.tmpCircleVerts2[t];let n=this.p,e=0==n.sizeVec3?new oimo.common.Vec3:n.stackVec3[--n.sizeVec3];e.x=r.x,e.y=r.y,e.z=r.z;let l=e;l.x=-l.x,l.y=-l.y,l.z=-l.z,this.triangle(g,i,o,l,l,l,s);let h=this.p;if(null!=l){if(l.zero(),h.sizeVec3==h.stackVec3.length){let t=new Array(h.sizeVec3<<1),i=0,o=h.sizeVec3;for(;i<o;){let o=i++;t[o]=h.stackVec3[o],h.stackVec3[o]=null}h.stackVec3=t}h.stackVec3[h.sizeVec3++]=l}}}let Y=this.p;if(null!=v){if(v.zero(),Y.sizeVec3==Y.stackVec3.length){let t=new Array(Y.sizeVec3<<1),i=0,o=Y.sizeVec3;for(;i<o;){let o=i++;t[o]=Y.stackVec3[o],Y.stackVec3[o]=null}Y.stackVec3=t}Y.stackVec3[Y.sizeVec3++]=v}let z=this.p;if(null!=g){if(g.zero(),z.sizeVec3==z.stackVec3.length){let t=new Array(z.sizeVec3<<1),i=0,o=z.sizeVec3;for(;i<o;){let o=i++;t[o]=z.stackVec3[o],z.stackVec3[o]=null}z.stackVec3=t}z.stackVec3[z.sizeVec3++]=g}let Z=this.p;if(null!=c){if(c.zero(),Z.sizeVec3==Z.stackVec3.length){let t=new Array(Z.sizeVec3<<1),i=0,o=Z.sizeVec3;for(;i<o;){let o=i++;t[o]=Z.stackVec3[o],Z.stackVec3[o]=null}Z.stackVec3=t}Z.stackVec3[Z.sizeVec3++]=c}let M=this.p;if(null!=b){if(b.e00=1,b.e01=0,b.e02=0,b.e10=0,b.e11=1,b.e12=0,b.e20=0,b.e21=0,b.e22=1,M.sizeMat3==M.stackMat3.length){let t=new Array(M.sizeMat3<<1),i=0,o=M.sizeMat3;for(;i<o;){let o=i++;t[o]=M.stackMat3[o],M.stackMat3[o]=null}M.stackMat3=t}M.stackMat3[M.sizeMat3++]=b}let I=this.p;if(null!=n){if(n.zero(),I.sizeVec3==I.stackVec3.length){let t=new Array(I.sizeVec3<<1),i=0,o=I.sizeVec3;for(;i<o;){let o=i++;t[o]=I.stackVec3[o],I.stackVec3[o]=null}I.stackVec3=t}I.stackVec3[I.sizeVec3++]=n}let V=this.p;if(null!=r){if(r.zero(),V.sizeVec3==V.stackVec3.length){let t=new Array(V.sizeVec3<<1),i=0,o=V.sizeVec3;for(;i<o;){let o=i++;t[o]=V.stackVec3[o],V.stackVec3[o]=null}V.stackVec3=t}V.stackVec3[V.sizeVec3++]=r}let L=this.p;if(null!=l){if(l.zero(),L.sizeVec3==L.stackVec3.length){let t=new Array(L.sizeVec3<<1),i=0,o=L.sizeVec3;for(;i<o;){let o=i++;t[o]=L.stackVec3[o],L.stackVec3[o]=null}L.stackVec3=t}L.stackVec3[L.sizeVec3++]=l}}cylinder(t,i,o,s){let a=this.p,n=0==a.sizeVec3?new oimo.common.Vec3:a.stackVec3[--a.sizeVec3],e=this.p,r=0==e.sizeVec3?new oimo.common.Vec3:e.stackVec3[--e.sizeVec3],_=this.p,l=0==_.sizeVec3?new oimo.common.Vec3:_.stackVec3[--_.sizeVec3],h=this.p,c=0==h.sizeVec3?new oimo.common.Vec3:h.stackVec3[--h.sizeVec3],m=this.p,b=0==m.sizeMat3?new oimo.common.Mat3:m.stackMat3[--m.sizeMat3],x=c;x.x=t._positionX,x.y=t._positionY,x.z=t._positionZ;let p=b;p.e00=t._rotation00,p.e01=t._rotation01,p.e02=t._rotation02,p.e10=t._rotation10,p.e11=t._rotation11,p.e12=t._rotation12,p.e20=t._rotation20,p.e21=t._rotation21,p.e22=t._rotation22,n.init(b.e00,b.e10,b.e20),r.init(b.e01,b.e11,b.e21),l.init(b.e02,b.e12,b.e22);let f=this.p,u=0==f.sizeVec3?new oimo.common.Vec3:f.stackVec3[--f.sizeVec3];u.x=c.x,u.y=c.y,u.z=c.z;let v=u;v.x+=r.x*o,v.y+=r.y*o,v.z+=r.z*o;let X=this.p,y=0==X.sizeVec3?new oimo.common.Vec3:X.stackVec3[--X.sizeVec3];y.x=c.x,y.y=c.y,y.z=c.z;let g=y,d=-o;if(g.x+=r.x*d,g.y+=r.y*d,g.z+=r.z*d,this.wireframe){let t=this.p,o=0==t.sizeVec3?new oimo.common.Vec3:t.stackVec3[--t.sizeVec3];o.x=v.x,o.y=v.y,o.z=v.z;let a=o,e=-i;a.x+=n.x*e,a.y+=n.y*e,a.z+=n.z*e,a.x+=0*l.x,a.y+=0*l.y,a.z+=0*l.z;let r=this.p,_=0==r.sizeVec3?new oimo.common.Vec3:r.stackVec3[--r.sizeVec3];_.x=v.x,_.y=v.y,_.z=v.z;let h=_;h.x+=n.x*i,h.y+=n.y*i,h.z+=n.z*i,h.x+=0*l.x,h.y+=0*l.y,h.z+=0*l.z;let c=this.p,m=0==c.sizeVec3?new oimo.common.Vec3:c.stackVec3[--c.sizeVec3];m.x=v.x,m.y=v.y,m.z=v.z;let b=m;b.x+=0*n.x,b.y+=0*n.y,b.z+=0*n.z;let x=-i;b.x+=l.x*x,b.y+=l.y*x,b.z+=l.z*x;let p=this.p,f=0==p.sizeVec3?new oimo.common.Vec3:p.stackVec3[--p.sizeVec3];f.x=v.x,f.y=v.y,f.z=v.z;let u=f;u.x+=0*n.x,u.y+=0*n.y,u.z+=0*n.z,u.x+=l.x*i,u.y+=l.y*i,u.z+=l.z*i;let X=this.p,y=0==X.sizeVec3?new oimo.common.Vec3:X.stackVec3[--X.sizeVec3];y.x=g.x,y.y=g.y,y.z=g.z;let d=y,Y=-i;d.x+=n.x*Y,d.y+=n.y*Y,d.z+=n.z*Y,d.x+=0*l.x,d.y+=0*l.y,d.z+=0*l.z;let z=this.p,Z=0==z.sizeVec3?new oimo.common.Vec3:z.stackVec3[--z.sizeVec3];Z.x=g.x,Z.y=g.y,Z.z=g.z;let M=Z;M.x+=n.x*i,M.y+=n.y*i,M.z+=n.z*i,M.x+=0*l.x,M.y+=0*l.y,M.z+=0*l.z;let I=this.p,V=0==I.sizeVec3?new oimo.common.Vec3:I.stackVec3[--I.sizeVec3];V.x=g.x,V.y=g.y,V.z=g.z;let L=V;L.x+=0*n.x,L.y+=0*n.y,L.z+=0*n.z;let w=-i;L.x+=l.x*w,L.y+=l.y*w,L.z+=l.z*w;let k=this.p,B=0==k.sizeVec3?new oimo.common.Vec3:k.stackVec3[--k.sizeVec3];B.x=g.x,B.y=g.y,B.z=g.z;let A=B;A.x+=0*n.x,A.y+=0*n.y,A.z+=0*n.z,A.x+=l.x*i,A.y+=l.y*i,A.z+=l.z*i,this.ellipse(v,n,l,i,i,s),this.ellipse(g,n,l,i,i,s),this.line(a,d,s),this.line(h,M,s),this.line(b,L,s),this.line(u,A,s);let P=this.p;if(null!=a){if(a.zero(),P.sizeVec3==P.stackVec3.length){let t=new Array(P.sizeVec3<<1),i=0,o=P.sizeVec3;for(;i<o;){let o=i++;t[o]=P.stackVec3[o],P.stackVec3[o]=null}P.stackVec3=t}P.stackVec3[P.sizeVec3++]=a}let S=this.p;if(null!=h){if(h.zero(),S.sizeVec3==S.stackVec3.length){let t=new Array(S.sizeVec3<<1),i=0,o=S.sizeVec3;for(;i<o;){let o=i++;t[o]=S.stackVec3[o],S.stackVec3[o]=null}S.stackVec3=t}S.stackVec3[S.sizeVec3++]=h}let T=this.p;if(null!=b){if(b.zero(),T.sizeVec3==T.stackVec3.length){let t=new Array(T.sizeVec3<<1),i=0,o=T.sizeVec3;for(;i<o;){let o=i++;t[o]=T.stackVec3[o],T.stackVec3[o]=null}T.stackVec3=t}T.stackVec3[T.sizeVec3++]=b}let C=this.p;if(null!=u){if(u.zero(),C.sizeVec3==C.stackVec3.length){let t=new Array(C.sizeVec3<<1),i=0,o=C.sizeVec3;for(;i<o;){let o=i++;t[o]=C.stackVec3[o],C.stackVec3[o]=null}C.stackVec3=t}C.stackVec3[C.sizeVec3++]=u}let j=this.p;if(null!=d){if(d.zero(),j.sizeVec3==j.stackVec3.length){let t=new Array(j.sizeVec3<<1),i=0,o=j.sizeVec3;for(;i<o;){let o=i++;t[o]=j.stackVec3[o],j.stackVec3[o]=null}j.stackVec3=t}j.stackVec3[j.sizeVec3++]=d}let R=this.p;if(null!=M){if(M.zero(),R.sizeVec3==R.stackVec3.length){let t=new Array(R.sizeVec3<<1),i=0,o=R.sizeVec3;for(;i<o;){let o=i++;t[o]=R.stackVec3[o],R.stackVec3[o]=null}R.stackVec3=t}R.stackVec3[R.sizeVec3++]=M}let q=this.p;if(null!=L){if(L.zero(),q.sizeVec3==q.stackVec3.length){let t=new Array(q.sizeVec3<<1),i=0,o=q.sizeVec3;for(;i<o;){let o=i++;t[o]=q.stackVec3[o],q.stackVec3[o]=null}q.stackVec3=t}q.stackVec3[q.sizeVec3++]=L}let E=this.p;if(null!=A){if(A.zero(),E.sizeVec3==E.stackVec3.length){let t=new Array(E.sizeVec3<<1),i=0,o=E.sizeVec3;for(;i<o;){let o=i++;t[o]=E.stackVec3[o],E.stackVec3[o]=null}E.stackVec3=t}E.stackVec3[E.sizeVec3++]=A}}else{let t=0;for(;t<8;){let s=t++,a=this.tmpCircleNorms[s],n=this.circleCoords[s];a.x=n.x,a.y=n.y,a.z=n.z;let e=a.x*b.e10+a.y*b.e11+a.z*b.e12,_=a.x*b.e20+a.y*b.e21+a.z*b.e22;a.x=a.x*b.e00+a.y*b.e01+a.z*b.e02,a.y=e,a.z=_;let l=this.tmpCircleVerts1[s],h=this.tmpCircleNorms[s];l.x=h.x,l.y=h.y,l.z=h.z,l.x*=i,l.y*=i,l.z*=i,l.x+=c.x,l.y+=c.y,l.z+=c.z;let m=this.tmpCircleVerts2[s],x=this.tmpCircleVerts1[s];m.x=x.x,m.y=x.y,m.z=x.z;let p=this.tmpCircleVerts1[s];p.x+=r.x*o,p.y+=r.y*o,p.z+=r.z*o;let f=this.tmpCircleVerts2[s],u=-o;f.x+=r.x*u,f.y+=r.y*u,f.z+=r.z*u}let a=0;for(;a<8;){let t,i=a++,o=this.tmpCircleVerts1[i],n=this.tmpCircleVerts1[(i+1)%8],e=r;this.triangle(v,o,n,e,e,e,s),o=this.tmpCircleVerts2[(i+1)%8],n=this.tmpCircleVerts2[i];let _=this.p,l=0==_.sizeVec3?new oimo.common.Vec3:_.stackVec3[--_.sizeVec3];l.x=r.x,l.y=r.y,l.z=r.z;let h=l;h.x=-h.x,h.y=-h.y,h.z=-h.z,this.triangle(g,o,n,h,h,h,s);let c=this.p;if(null!=h){if(h.zero(),c.sizeVec3==c.stackVec3.length){let t=new Array(c.sizeVec3<<1),i=0,o=c.sizeVec3;for(;i<o;){let o=i++;t[o]=c.stackVec3[o],c.stackVec3[o]=null}c.stackVec3=t}c.stackVec3[c.sizeVec3++]=h}t=this.tmpCircleVerts1[i],o=this.tmpCircleVerts2[i],n=this.tmpCircleVerts2[(i+1)%8],e=this.tmpCircleNorms[i];let m=this.tmpCircleNorms[(i+1)%8];this.rect(t,o,n,this.tmpCircleVerts1[(i+1)%8],e,e,m,m,s)}}let Y=this.p;if(null!=v){if(v.zero(),Y.sizeVec3==Y.stackVec3.length){let t=new Array(Y.sizeVec3<<1),i=0,o=Y.sizeVec3;for(;i<o;){let o=i++;t[o]=Y.stackVec3[o],Y.stackVec3[o]=null}Y.stackVec3=t}Y.stackVec3[Y.sizeVec3++]=v}let z=this.p;if(null!=g){if(g.zero(),z.sizeVec3==z.stackVec3.length){let t=new Array(z.sizeVec3<<1),i=0,o=z.sizeVec3;for(;i<o;){let o=i++;t[o]=z.stackVec3[o],z.stackVec3[o]=null}z.stackVec3=t}z.stackVec3[z.sizeVec3++]=g}let Z=this.p;if(null!=c){if(c.zero(),Z.sizeVec3==Z.stackVec3.length){let t=new Array(Z.sizeVec3<<1),i=0,o=Z.sizeVec3;for(;i<o;){let o=i++;t[o]=Z.stackVec3[o],Z.stackVec3[o]=null}Z.stackVec3=t}Z.stackVec3[Z.sizeVec3++]=c}let M=this.p;if(null!=b){if(b.e00=1,b.e01=0,b.e02=0,b.e10=0,b.e11=1,b.e12=0,b.e20=0,b.e21=0,b.e22=1,M.sizeMat3==M.stackMat3.length){let t=new Array(M.sizeMat3<<1),i=0,o=M.sizeMat3;for(;i<o;){let o=i++;t[o]=M.stackMat3[o],M.stackMat3[o]=null}M.stackMat3=t}M.stackMat3[M.sizeMat3++]=b}let I=this.p;if(null!=n){if(n.zero(),I.sizeVec3==I.stackVec3.length){let t=new Array(I.sizeVec3<<1),i=0,o=I.sizeVec3;for(;i<o;){let o=i++;t[o]=I.stackVec3[o],I.stackVec3[o]=null}I.stackVec3=t}I.stackVec3[I.sizeVec3++]=n}let V=this.p;if(null!=r){if(r.zero(),V.sizeVec3==V.stackVec3.length){let t=new Array(V.sizeVec3<<1),i=0,o=V.sizeVec3;for(;i<o;){let o=i++;t[o]=V.stackVec3[o],V.stackVec3[o]=null}V.stackVec3=t}V.stackVec3[V.sizeVec3++]=r}let L=this.p;if(null!=l){if(l.zero(),L.sizeVec3==L.stackVec3.length){let t=new Array(L.sizeVec3<<1),i=0,o=L.sizeVec3;for(;i<o;){let o=i++;t[o]=L.stackVec3[o],L.stackVec3[o]=null}L.stackVec3=t}L.stackVec3[L.sizeVec3++]=l}}capsule(t,i,o,s){let a=this.p,n=0==a.sizeVec3?new oimo.common.Vec3:a.stackVec3[--a.sizeVec3],e=this.p,r=0==e.sizeVec3?new oimo.common.Vec3:e.stackVec3[--e.sizeVec3],_=this.p,l=0==_.sizeVec3?new oimo.common.Vec3:_.stackVec3[--_.sizeVec3],h=this.p,c=0==h.sizeVec3?new oimo.common.Vec3:h.stackVec3[--h.sizeVec3],m=this.p,b=0==m.sizeMat3?new oimo.common.Mat3:m.stackMat3[--m.sizeMat3],x=c;x.x=t._positionX,x.y=t._positionY,x.z=t._positionZ;let p=b;p.e00=t._rotation00,p.e01=t._rotation01,p.e02=t._rotation02,p.e10=t._rotation10,p.e11=t._rotation11,p.e12=t._rotation12,p.e20=t._rotation20,p.e21=t._rotation21,p.e22=t._rotation22,n.init(b.e00,b.e10,b.e20),r.init(b.e01,b.e11,b.e21),l.init(b.e02,b.e12,b.e22);let f=this.tmpSphereVerts,u=this.tmpSphereNorms,v=0;for(;v<5;){let t=v++,i=this.tmpSphereVerts[t].length,o=0;for(;o<i;){let i=o++,s=u[t][i],a=this.sphereCoords[t][i];s.x=a.x,s.y=a.y,s.z=a.z;let n=s.x*b.e10+s.y*b.e11+s.z*b.e12,e=s.x*b.e20+s.y*b.e21+s.z*b.e22;s.x=s.x*b.e00+s.y*b.e01+s.z*b.e02,s.y=n,s.z=e}}let X=0;for(;X<4;){let t=X++;if(0==t){let t=0;for(;t<3;){let s=t++,a=this.tmpSphereVerts[s].length,n=0;for(;n<a;){let t=n++,a=f[s][t],e=u[s][t];a.x=e.x,a.y=e.y,a.z=e.z,a.x*=i,a.y*=i,a.z*=i,a.x+=c.x,a.y+=c.y,a.z+=c.z,a.x+=r.x*o,a.y+=r.y*o,a.z+=r.z*o}}}if(2==t){let t=2;for(;t<5;){let s=t++,a=this.tmpSphereVerts[s].length,n=0;for(;n<a;){let t=n++,a=f[s][t],e=u[s][t];a.x=e.x,a.y=e.y,a.z=e.z,a.x*=i,a.y*=i,a.z*=i,a.x+=c.x,a.y+=c.y,a.z+=c.z;let _=-o;a.x+=r.x*_,a.y+=r.y*_,a.z+=r.z*_}}}let a=0;for(;a<8;){let i,o,n,e,r,_,l,h,c=a++;0==t?this.wireframe?(i=f[0][0],o=f[1][c],this.line(i,o,s)):(i=f[0][0],o=f[1][c],n=f[1][(c+1)%8],r=u[0][0],_=u[1][c],l=u[1][(c+1)%8],this.triangle(i,o,n,r,_,l,s)):3==t?this.wireframe?(i=f[4][0],o=f[t][(c+1)%8],n=f[t][c],this.line(i,o,s),this.line(o,n,s)):(i=f[4][0],o=f[t][(c+1)%8],n=f[t][c],r=u[4][0],_=u[t][(c+1)%8],l=u[t][c],this.triangle(i,o,n,r,_,l,s)):this.wireframe?(i=f[t][c],o=f[t][(c+1)%8],n=f[t+1][c],this.line(i,o,s),this.line(i,n,s)):(i=f[t][c],o=f[t][(c+1)%8],n=f[t+1][c],e=f[t+1][(c+1)%8],r=u[t][c],_=u[t][(c+1)%8],l=u[t+1][c],h=u[t+1][(c+1)%8],this.rect(i,n,e,o,r,l,h,_,s))}}let y=this.p,g=0==y.sizeVec3?new oimo.common.Vec3:y.stackVec3[--y.sizeVec3];g.x=c.x,g.y=c.y,g.z=c.z;let d=g;d.x+=r.x*o,d.y+=r.y*o,d.z+=r.z*o;let Y=this.p,z=0==Y.sizeVec3?new oimo.common.Vec3:Y.stackVec3[--Y.sizeVec3];z.x=c.x,z.y=c.y,z.z=c.z;let Z=z,M=-o;if(Z.x+=r.x*M,Z.y+=r.y*M,Z.z+=r.z*M,this.wireframe){let t=this.p,o=0==t.sizeVec3?new oimo.common.Vec3:t.stackVec3[--t.sizeVec3];o.x=d.x,o.y=d.y,o.z=d.z;let a=o,e=-i;a.x+=n.x*e,a.y+=n.y*e,a.z+=n.z*e,a.x+=0*l.x,a.y+=0*l.y,a.z+=0*l.z;let r=this.p,_=0==r.sizeVec3?new oimo.common.Vec3:r.stackVec3[--r.sizeVec3];_.x=d.x,_.y=d.y,_.z=d.z;let h=_;h.x+=n.x*i,h.y+=n.y*i,h.z+=n.z*i,h.x+=0*l.x,h.y+=0*l.y,h.z+=0*l.z;let c=this.p,m=0==c.sizeVec3?new oimo.common.Vec3:c.stackVec3[--c.sizeVec3];m.x=d.x,m.y=d.y,m.z=d.z;let b=m;b.x+=0*n.x,b.y+=0*n.y,b.z+=0*n.z;let x=-i;b.x+=l.x*x,b.y+=l.y*x,b.z+=l.z*x;let p=this.p,f=0==p.sizeVec3?new oimo.common.Vec3:p.stackVec3[--p.sizeVec3];f.x=d.x,f.y=d.y,f.z=d.z;let u=f;u.x+=0*n.x,u.y+=0*n.y,u.z+=0*n.z,u.x+=l.x*i,u.y+=l.y*i,u.z+=l.z*i;let v=this.p,X=0==v.sizeVec3?new oimo.common.Vec3:v.stackVec3[--v.sizeVec3];X.x=Z.x,X.y=Z.y,X.z=Z.z;let y=X,g=-i;y.x+=n.x*g,y.y+=n.y*g,y.z+=n.z*g,y.x+=0*l.x,y.y+=0*l.y,y.z+=0*l.z;let Y=this.p,z=0==Y.sizeVec3?new oimo.common.Vec3:Y.stackVec3[--Y.sizeVec3];z.x=Z.x,z.y=Z.y,z.z=Z.z;let M=z;M.x+=n.x*i,M.y+=n.y*i,M.z+=n.z*i,M.x+=0*l.x,M.y+=0*l.y,M.z+=0*l.z;let I=this.p,V=0==I.sizeVec3?new oimo.common.Vec3:I.stackVec3[--I.sizeVec3];V.x=Z.x,V.y=Z.y,V.z=Z.z;let L=V;L.x+=0*n.x,L.y+=0*n.y,L.z+=0*n.z;let w=-i;L.x+=l.x*w,L.y+=l.y*w,L.z+=l.z*w;let k=this.p,B=0==k.sizeVec3?new oimo.common.Vec3:k.stackVec3[--k.sizeVec3];B.x=Z.x,B.y=Z.y,B.z=Z.z;let A=B;A.x+=0*n.x,A.y+=0*n.y,A.z+=0*n.z,A.x+=l.x*i,A.y+=l.y*i,A.z+=l.z*i,this.ellipse(d,n,l,i,i,s),this.ellipse(Z,n,l,i,i,s),this.line(a,y,s),this.line(h,M,s),this.line(b,L,s),this.line(u,A,s);let P=this.p;if(null!=a){if(a.zero(),P.sizeVec3==P.stackVec3.length){let t=new Array(P.sizeVec3<<1),i=0,o=P.sizeVec3;for(;i<o;){let o=i++;t[o]=P.stackVec3[o],P.stackVec3[o]=null}P.stackVec3=t}P.stackVec3[P.sizeVec3++]=a}let S=this.p;if(null!=h){if(h.zero(),S.sizeVec3==S.stackVec3.length){let t=new Array(S.sizeVec3<<1),i=0,o=S.sizeVec3;for(;i<o;){let o=i++;t[o]=S.stackVec3[o],S.stackVec3[o]=null}S.stackVec3=t}S.stackVec3[S.sizeVec3++]=h}let T=this.p;if(null!=b){if(b.zero(),T.sizeVec3==T.stackVec3.length){let t=new Array(T.sizeVec3<<1),i=0,o=T.sizeVec3;for(;i<o;){let o=i++;t[o]=T.stackVec3[o],T.stackVec3[o]=null}T.stackVec3=t}T.stackVec3[T.sizeVec3++]=b}let C=this.p;if(null!=u){if(u.zero(),C.sizeVec3==C.stackVec3.length){let t=new Array(C.sizeVec3<<1),i=0,o=C.sizeVec3;for(;i<o;){let o=i++;t[o]=C.stackVec3[o],C.stackVec3[o]=null}C.stackVec3=t}C.stackVec3[C.sizeVec3++]=u}let j=this.p;if(null!=y){if(y.zero(),j.sizeVec3==j.stackVec3.length){let t=new Array(j.sizeVec3<<1),i=0,o=j.sizeVec3;for(;i<o;){let o=i++;t[o]=j.stackVec3[o],j.stackVec3[o]=null}j.stackVec3=t}j.stackVec3[j.sizeVec3++]=y}let R=this.p;if(null!=M){if(M.zero(),R.sizeVec3==R.stackVec3.length){let t=new Array(R.sizeVec3<<1),i=0,o=R.sizeVec3;for(;i<o;){let o=i++;t[o]=R.stackVec3[o],R.stackVec3[o]=null}R.stackVec3=t}R.stackVec3[R.sizeVec3++]=M}let q=this.p;if(null!=L){if(L.zero(),q.sizeVec3==q.stackVec3.length){let t=new Array(q.sizeVec3<<1),i=0,o=q.sizeVec3;for(;i<o;){let o=i++;t[o]=q.stackVec3[o],q.stackVec3[o]=null}q.stackVec3=t}q.stackVec3[q.sizeVec3++]=L}let E=this.p;if(null!=A){if(A.zero(),E.sizeVec3==E.stackVec3.length){let t=new Array(E.sizeVec3<<1),i=0,o=E.sizeVec3;for(;i<o;){let o=i++;t[o]=E.stackVec3[o],E.stackVec3[o]=null}E.stackVec3=t}E.stackVec3[E.sizeVec3++]=A}}else{let t=0;for(;t<8;){let s=t++,a=this.tmpCircleNorms[s],n=this.circleCoords[s];a.x=n.x,a.y=n.y,a.z=n.z;let e=a.x*b.e10+a.y*b.e11+a.z*b.e12,_=a.x*b.e20+a.y*b.e21+a.z*b.e22;a.x=a.x*b.e00+a.y*b.e01+a.z*b.e02,a.y=e,a.z=_;let l=this.tmpCircleVerts1[s],h=this.tmpCircleNorms[s];l.x=h.x,l.y=h.y,l.z=h.z,l.x*=i,l.y*=i,l.z*=i,l.x+=c.x,l.y+=c.y,l.z+=c.z;let m=this.tmpCircleVerts2[s],x=this.tmpCircleVerts1[s];m.x=x.x,m.y=x.y,m.z=x.z;let p=this.tmpCircleVerts1[s];p.x+=r.x*o,p.y+=r.y*o,p.z+=r.z*o;let f=this.tmpCircleVerts2[s],u=-o;f.x+=r.x*u,f.y+=r.y*u,f.z+=r.z*u}let a=0;for(;a<8;){let t=a++,i=this.tmpCircleNorms[t],o=this.tmpCircleNorms[(t+1)%8];this.rect(this.tmpCircleVerts1[t],this.tmpCircleVerts2[t],this.tmpCircleVerts2[(t+1)%8],this.tmpCircleVerts1[(t+1)%8],i,i,o,o,s)}}let I=this.p;if(null!=d){if(d.zero(),I.sizeVec3==I.stackVec3.length){let t=new Array(I.sizeVec3<<1),i=0,o=I.sizeVec3;for(;i<o;){let o=i++;t[o]=I.stackVec3[o],I.stackVec3[o]=null}I.stackVec3=t}I.stackVec3[I.sizeVec3++]=d}let V=this.p;if(null!=Z){if(Z.zero(),V.sizeVec3==V.stackVec3.length){let t=new Array(V.sizeVec3<<1),i=0,o=V.sizeVec3;for(;i<o;){let o=i++;t[o]=V.stackVec3[o],V.stackVec3[o]=null}V.stackVec3=t}V.stackVec3[V.sizeVec3++]=Z}let L=this.p;if(null!=c){if(c.zero(),L.sizeVec3==L.stackVec3.length){let t=new Array(L.sizeVec3<<1),i=0,o=L.sizeVec3;for(;i<o;){let o=i++;t[o]=L.stackVec3[o],L.stackVec3[o]=null}L.stackVec3=t}L.stackVec3[L.sizeVec3++]=c}let w=this.p;if(null!=b){if(b.e00=1,b.e01=0,b.e02=0,b.e10=0,b.e11=1,b.e12=0,b.e20=0,b.e21=0,b.e22=1,w.sizeMat3==w.stackMat3.length){let t=new Array(w.sizeMat3<<1),i=0,o=w.sizeMat3;for(;i<o;){let o=i++;t[o]=w.stackMat3[o],w.stackMat3[o]=null}w.stackMat3=t}w.stackMat3[w.sizeMat3++]=b}let k=this.p;if(null!=n){if(n.zero(),k.sizeVec3==k.stackVec3.length){let t=new Array(k.sizeVec3<<1),i=0,o=k.sizeVec3;for(;i<o;){let o=i++;t[o]=k.stackVec3[o],k.stackVec3[o]=null}k.stackVec3=t}k.stackVec3[k.sizeVec3++]=n}let B=this.p;if(null!=r){if(r.zero(),B.sizeVec3==B.stackVec3.length){let t=new Array(B.sizeVec3<<1),i=0,o=B.sizeVec3;for(;i<o;){let o=i++;t[o]=B.stackVec3[o],B.stackVec3[o]=null}B.stackVec3=t}B.stackVec3[B.sizeVec3++]=r}let A=this.p;if(null!=l){if(l.zero(),A.sizeVec3==A.stackVec3.length){let t=new Array(A.sizeVec3<<1),i=0,o=A.sizeVec3;for(;i<o;){let o=i++;t[o]=A.stackVec3[o],A.stackVec3[o]=null}A.stackVec3=t}A.stackVec3[A.sizeVec3++]=l}}sphere(t,i,o){let s=this.p,a=0==s.sizeVec3?new oimo.common.Vec3:s.stackVec3[--s.sizeVec3],n=this.p,e=0==n.sizeMat3?new oimo.common.Mat3:n.stackMat3[--n.sizeMat3],r=a;r.x=t._positionX,r.y=t._positionY,r.z=t._positionZ;let _=e;_.e00=t._rotation00,_.e01=t._rotation01,_.e02=t._rotation02,_.e10=t._rotation10,_.e11=t._rotation11,_.e12=t._rotation12,_.e20=t._rotation20,_.e21=t._rotation21,_.e22=t._rotation22;let l=this.tmpSphereVerts,h=this.tmpSphereNorms,c=0;for(;c<5;){let t=c++,o=this.tmpSphereVerts[t].length,s=0;for(;s<o;){let o=s++,n=h[t][o],r=this.sphereCoords[t][o];n.x=r.x,n.y=r.y,n.z=r.z;let _=n.x*e.e10+n.y*e.e11+n.z*e.e12,c=n.x*e.e20+n.y*e.e21+n.z*e.e22;n.x=n.x*e.e00+n.y*e.e01+n.z*e.e02,n.y=_,n.z=c;let m=l[t][o],b=h[t][o];m.x=b.x,m.y=b.y,m.z=b.z,m.x*=i,m.y*=i,m.z*=i,m.x+=a.x,m.y+=a.y,m.z+=a.z}}let m=0;for(;m<4;){let t=m++,i=0;for(;i<8;){let s,a,n,e,r,_,c,m,b=i++;0==t?this.wireframe?(s=l[0][0],a=l[1][b],this.line(s,a,o)):(s=l[0][0],a=l[1][b],n=l[1][(b+1)%8],r=h[0][0],_=h[1][b],c=h[1][(b+1)%8],this.triangle(s,a,n,r,_,c,o)):3==t?this.wireframe?(s=l[4][0],a=l[t][(b+1)%8],n=l[t][b],this.line(s,a,o),this.line(a,n,o)):(s=l[4][0],a=l[t][(b+1)%8],n=l[t][b],r=h[4][0],_=h[t][(b+1)%8],c=h[t][b],this.triangle(s,a,n,r,_,c,o)):this.wireframe?(s=l[t][b],a=l[t][(b+1)%8],n=l[t+1][b],this.line(s,a,o),this.line(s,n,o)):(s=l[t][b],a=l[t][(b+1)%8],n=l[t+1][b],e=l[t+1][(b+1)%8],r=h[t][b],_=h[t][(b+1)%8],c=h[t+1][b],m=h[t+1][(b+1)%8],this.rect(s,n,e,a,r,c,m,_,o))}}let b=this.p;if(null!=a){if(a.zero(),b.sizeVec3==b.stackVec3.length){let t=new Array(b.sizeVec3<<1),i=0,o=b.sizeVec3;for(;i<o;){let o=i++;t[o]=b.stackVec3[o],b.stackVec3[o]=null}b.stackVec3=t}b.stackVec3[b.sizeVec3++]=a}let x=this.p;if(null!=e){if(e.e00=1,e.e01=0,e.e02=0,e.e10=0,e.e11=1,e.e12=0,e.e20=0,e.e21=0,e.e22=1,x.sizeMat3==x.stackMat3.length){let t=new Array(x.sizeMat3<<1),i=0,o=x.sizeMat3;for(;i<o;){let o=i++;t[o]=x.stackMat3[o],x.stackMat3[o]=null}x.stackMat3=t}x.stackMat3[x.sizeMat3++]=e}}box(t,i,o){let s=this.p,a=0==s.sizeVec3?new oimo.common.Vec3:s.stackVec3[--s.sizeVec3],n=this.p,e=0==n.sizeVec3?new oimo.common.Vec3:n.stackVec3[--n.sizeVec3],r=this.p,_=0==r.sizeVec3?new oimo.common.Vec3:r.stackVec3[--r.sizeVec3],l=this.p,h=0==l.sizeVec3?new oimo.common.Vec3:l.stackVec3[--l.sizeVec3],c=this.p,m=0==c.sizeMat3?new oimo.common.Mat3:c.stackMat3[--c.sizeMat3],b=h;b.x=t._positionX,b.y=t._positionY,b.z=t._positionZ;let x=m;x.e00=t._rotation00,x.e01=t._rotation01,x.e02=t._rotation02,x.e10=t._rotation10,x.e11=t._rotation11,x.e12=t._rotation12,x.e20=t._rotation20,x.e21=t._rotation21,x.e22=t._rotation22,a.init(m.e00,m.e10,m.e20),e.init(m.e01,m.e11,m.e21),_.init(m.e02,m.e12,m.e22);let p=i.x,f=i.y,u=i.z,v=this.p,X=0==v.sizeVec3?new oimo.common.Vec3:v.stackVec3[--v.sizeVec3];X.x=h.x,X.y=h.y,X.z=h.z;let y=X,g=-p;y.x+=a.x*g,y.y+=a.y*g,y.z+=a.z*g;let d=-f;y.x+=e.x*d,y.y+=e.y*d,y.z+=e.z*d;let Y=-u;y.x+=_.x*Y,y.y+=_.y*Y,y.z+=_.z*Y;let z=this.p,Z=0==z.sizeVec3?new oimo.common.Vec3:z.stackVec3[--z.sizeVec3];Z.x=h.x,Z.y=h.y,Z.z=h.z;let M=Z,I=-p;M.x+=a.x*I,M.y+=a.y*I,M.z+=a.z*I;let V=-f;M.x+=e.x*V,M.y+=e.y*V,M.z+=e.z*V,M.x+=_.x*u,M.y+=_.y*u,M.z+=_.z*u;let L=this.p,w=0==L.sizeVec3?new oimo.common.Vec3:L.stackVec3[--L.sizeVec3];w.x=h.x,w.y=h.y,w.z=h.z;let k=w,B=-p;k.x+=a.x*B,k.y+=a.y*B,k.z+=a.z*B,k.x+=e.x*f,k.y+=e.y*f,k.z+=e.z*f;let A=-u;k.x+=_.x*A,k.y+=_.y*A,k.z+=_.z*A;let P=this.p,S=0==P.sizeVec3?new oimo.common.Vec3:P.stackVec3[--P.sizeVec3];S.x=h.x,S.y=h.y,S.z=h.z;let T=S,C=-p;T.x+=a.x*C,T.y+=a.y*C,T.z+=a.z*C,T.x+=e.x*f,T.y+=e.y*f,T.z+=e.z*f,T.x+=_.x*u,T.y+=_.y*u,T.z+=_.z*u;let j=this.p,R=0==j.sizeVec3?new oimo.common.Vec3:j.stackVec3[--j.sizeVec3];R.x=h.x,R.y=h.y,R.z=h.z;let q=R;q.x+=a.x*p,q.y+=a.y*p,q.z+=a.z*p;let E=-f;q.x+=e.x*E,q.y+=e.y*E,q.z+=e.z*E;let D=-u;q.x+=_.x*D,q.y+=_.y*D,q.z+=_.z*D;let F=this.p,N=0==F.sizeVec3?new oimo.common.Vec3:F.stackVec3[--F.sizeVec3];N.x=h.x,N.y=h.y,N.z=h.z;let W=N;W.x+=a.x*p,W.y+=a.y*p,W.z+=a.z*p;let G=-f;W.x+=e.x*G,W.y+=e.y*G,W.z+=e.z*G,W.x+=_.x*u,W.y+=_.y*u,W.z+=_.z*u;let J=this.p,O=0==J.sizeVec3?new oimo.common.Vec3:J.stackVec3[--J.sizeVec3];O.x=h.x,O.y=h.y,O.z=h.z;let H=O;H.x+=a.x*p,H.y+=a.y*p,H.z+=a.z*p,H.x+=e.x*f,H.y+=e.y*f,H.z+=e.z*f;let U=-u;H.x+=_.x*U,H.y+=_.y*U,H.z+=_.z*U;let Q=this.p,K=0==Q.sizeVec3?new oimo.common.Vec3:Q.stackVec3[--Q.sizeVec3];K.x=h.x,K.y=h.y,K.z=h.z;let $=K;if($.x+=a.x*p,$.y+=a.y*p,$.z+=a.z*p,$.x+=e.x*f,$.y+=e.y*f,$.z+=e.z*f,$.x+=_.x*u,$.y+=_.y*u,$.z+=_.z*u,this.wireframe)this.line(y,M,o),this.line(k,T,o),this.line(q,W,o),this.line(H,$,o),this.line(y,k,o),this.line(M,T,o),this.line(q,H,o),this.line(W,$,o),this.line(y,q,o),this.line(M,W,o),this.line(k,H,o),this.line(T,$,o);else{let t=this.p,i=0==t.sizeVec3?new oimo.common.Vec3:t.stackVec3[--t.sizeVec3];i.x=a.x,i.y=a.y,i.z=a.z;let s=i;s.x=-s.x,s.y=-s.y,s.z=-s.z;let n=this.p,r=0==n.sizeVec3?new oimo.common.Vec3:n.stackVec3[--n.sizeVec3];r.x=e.x,r.y=e.y,r.z=e.z;let l=r;l.x=-l.x,l.y=-l.y,l.z=-l.z;let h=this.p,c=0==h.sizeVec3?new oimo.common.Vec3:h.stackVec3[--h.sizeVec3];c.x=_.x,c.y=_.y,c.z=_.z;let m=c;m.x=-m.x,m.y=-m.y,m.z=-m.z,this.rect(y,M,T,k,s,s,s,s,o),this.rect(q,H,$,W,a,a,a,a,o),this.rect(y,q,W,M,l,l,l,l,o),this.rect(k,T,$,H,e,e,e,e,o),this.rect(y,k,H,q,m,m,m,m,o),this.rect(M,W,$,T,_,_,_,_,o);let b=this.p;if(null!=s){if(s.zero(),b.sizeVec3==b.stackVec3.length){let t=new Array(b.sizeVec3<<1),i=0,o=b.sizeVec3;for(;i<o;){let o=i++;t[o]=b.stackVec3[o],b.stackVec3[o]=null}b.stackVec3=t}b.stackVec3[b.sizeVec3++]=s}let x=this.p;if(null!=l){if(l.zero(),x.sizeVec3==x.stackVec3.length){let t=new Array(x.sizeVec3<<1),i=0,o=x.sizeVec3;for(;i<o;){let o=i++;t[o]=x.stackVec3[o],x.stackVec3[o]=null}x.stackVec3=t}x.stackVec3[x.sizeVec3++]=l}let p=this.p;if(null!=m){if(m.zero(),p.sizeVec3==p.stackVec3.length){let t=new Array(p.sizeVec3<<1),i=0,o=p.sizeVec3;for(;i<o;){let o=i++;t[o]=p.stackVec3[o],p.stackVec3[o]=null}p.stackVec3=t}p.stackVec3[p.sizeVec3++]=m}}let tt=this.p;if(null!=y){if(y.zero(),tt.sizeVec3==tt.stackVec3.length){let t=new Array(tt.sizeVec3<<1),i=0,o=tt.sizeVec3;for(;i<o;){let o=i++;t[o]=tt.stackVec3[o],tt.stackVec3[o]=null}tt.stackVec3=t}tt.stackVec3[tt.sizeVec3++]=y}let it=this.p;if(null!=M){if(M.zero(),it.sizeVec3==it.stackVec3.length){let t=new Array(it.sizeVec3<<1),i=0,o=it.sizeVec3;for(;i<o;){let o=i++;t[o]=it.stackVec3[o],it.stackVec3[o]=null}it.stackVec3=t}it.stackVec3[it.sizeVec3++]=M}let ot=this.p;if(null!=k){if(k.zero(),ot.sizeVec3==ot.stackVec3.length){let t=new Array(ot.sizeVec3<<1),i=0,o=ot.sizeVec3;for(;i<o;){let o=i++;t[o]=ot.stackVec3[o],ot.stackVec3[o]=null}ot.stackVec3=t}ot.stackVec3[ot.sizeVec3++]=k}let st=this.p;if(null!=T){if(T.zero(),st.sizeVec3==st.stackVec3.length){let t=new Array(st.sizeVec3<<1),i=0,o=st.sizeVec3;for(;i<o;){let o=i++;t[o]=st.stackVec3[o],st.stackVec3[o]=null}st.stackVec3=t}st.stackVec3[st.sizeVec3++]=T}let at=this.p;if(null!=q){if(q.zero(),at.sizeVec3==at.stackVec3.length){let t=new Array(at.sizeVec3<<1),i=0,o=at.sizeVec3;for(;i<o;){let o=i++;t[o]=at.stackVec3[o],at.stackVec3[o]=null}at.stackVec3=t}at.stackVec3[at.sizeVec3++]=q}let nt=this.p;if(null!=W){if(W.zero(),nt.sizeVec3==nt.stackVec3.length){let t=new Array(nt.sizeVec3<<1),i=0,o=nt.sizeVec3;for(;i<o;){let o=i++;t[o]=nt.stackVec3[o],nt.stackVec3[o]=null}nt.stackVec3=t}nt.stackVec3[nt.sizeVec3++]=W}let et=this.p;if(null!=H){if(H.zero(),et.sizeVec3==et.stackVec3.length){let t=new Array(et.sizeVec3<<1),i=0,o=et.sizeVec3;for(;i<o;){let o=i++;t[o]=et.stackVec3[o],et.stackVec3[o]=null}et.stackVec3=t}et.stackVec3[et.sizeVec3++]=H}let rt=this.p;if(null!=$){if($.zero(),rt.sizeVec3==rt.stackVec3.length){let t=new Array(rt.sizeVec3<<1),i=0,o=rt.sizeVec3;for(;i<o;){let o=i++;t[o]=rt.stackVec3[o],rt.stackVec3[o]=null}rt.stackVec3=t}rt.stackVec3[rt.sizeVec3++]=$}let _t=this.p;if(null!=h){if(h.zero(),_t.sizeVec3==_t.stackVec3.length){let t=new Array(_t.sizeVec3<<1),i=0,o=_t.sizeVec3;for(;i<o;){let o=i++;t[o]=_t.stackVec3[o],_t.stackVec3[o]=null}_t.stackVec3=t}_t.stackVec3[_t.sizeVec3++]=h}let lt=this.p;if(null!=m){if(m.e00=1,m.e01=0,m.e02=0,m.e10=0,m.e11=1,m.e12=0,m.e20=0,m.e21=0,m.e22=1,lt.sizeMat3==lt.stackMat3.length){let t=new Array(lt.sizeMat3<<1),i=0,o=lt.sizeMat3;for(;i<o;){let o=i++;t[o]=lt.stackMat3[o],lt.stackMat3[o]=null}lt.stackMat3=t}lt.stackMat3[lt.sizeMat3++]=m}let ht=this.p;if(null!=a){if(a.zero(),ht.sizeVec3==ht.stackVec3.length){let t=new Array(ht.sizeVec3<<1),i=0,o=ht.sizeVec3;for(;i<o;){let o=i++;t[o]=ht.stackVec3[o],ht.stackVec3[o]=null}ht.stackVec3=t}ht.stackVec3[ht.sizeVec3++]=a}let ct=this.p;if(null!=e){if(e.zero(),ct.sizeVec3==ct.stackVec3.length){let t=new Array(ct.sizeVec3<<1),i=0,o=ct.sizeVec3;for(;i<o;){let o=i++;t[o]=ct.stackVec3[o],ct.stackVec3[o]=null}ct.stackVec3=t}ct.stackVec3[ct.sizeVec3++]=e}let mt=this.p;if(null!=_){if(_.zero(),mt.sizeVec3==mt.stackVec3.length){let t=new Array(mt.sizeVec3<<1),i=0,o=mt.sizeVec3;for(;i<o;){let o=i++;t[o]=mt.stackVec3[o],mt.stackVec3[o]=null}mt.stackVec3=t}mt.stackVec3[mt.sizeVec3++]=_}}rect(t,i,o,s,a,n,e,r,_){this.triangle(t,i,o,a,n,e,_),this.triangle(t,o,s,a,e,r,_)}point(t,i){}triangle(t,i,o,s,a,n,e){}line(t,i,o){}},oimo.dynamics.common.DebugDrawStyle=class{constructor(){this.basisColorZ=new oimo.common.Vec3(0,0,1),this.basisColorY=new oimo.common.Vec3(0,1,0),this.basisColorX=new oimo.common.Vec3(1,0,0),this.basisLength=.5,this.jointRotationalConstraintRadius=.3,this.jointErrorColor=new oimo.common.Vec3(1,.1,.1),this.jointLineColor=new oimo.common.Vec3(.8,.8,.8),this.contactBinormalLength=.5,this.contactTangentLength=.5,this.contactNormalLength=.5,this.contactBinormalColor=new oimo.common.Vec3(.2,.2,1),this.contactTangentColor=new oimo.common.Vec3(.1,.8,.1),this.contactNormalColor=new oimo.common.Vec3(1,.1,.1),this.disabledContactColor=new oimo.common.Vec3(.5,.1,.1),this.newContactColor=new oimo.common.Vec3(1,1,.1),this.contactColor4=new oimo.common.Vec3(.8,.1,1),this.contactColor3=new oimo.common.Vec3(.1,.8,.6),this.contactColor2=new oimo.common.Vec3(1,.6,.1),this.contactColor=new oimo.common.Vec3(1,.1,.1),this.pairColor=new oimo.common.Vec3(1,1,.1),this.bvhNodeColor=new oimo.common.Vec3(.4,.4,.4),this.aabbColor=new oimo.common.Vec3(1,.1,.1),this.kinematicShapeColor=new oimo.common.Vec3(1,.5,.1),this.staticShapeColor=new oimo.common.Vec3(.7,.7,.7),this.sleepingShapeColor2=new oimo.common.Vec3(.2,.8,.5),this.sleepingShapeColor1=new oimo.common.Vec3(.3,.3,.8),this.sleepyShapeColor2=new oimo.common.Vec3(.6,.8,.3),this.sleepyShapeColor1=new oimo.common.Vec3(.5,.25,.6),this.shapeColor2=new oimo.common.Vec3(1,.8,.1),this.shapeColor1=new oimo.common.Vec3(.7,.2,.4)}},oimo.dynamics.common.Performance=class{},oimo.dynamics.constraint||(oimo.dynamics.constraint={}),oimo.dynamics.constraint.ConstraintSolver=class{constructor(){this._b1=null,this._b2=null,this._addedToIsland=!1}preSolveVelocity(t){}warmStart(t){}solveVelocity(){}postSolveVelocity(t){}preSolvePosition(t){}solvePositionSplitImpulse(){}solvePositionNgs(t){}postSolve(){}},oimo.dynamics.constraint.PositionCorrectionAlgorithm=class{},oimo.dynamics.constraint.contact||(oimo.dynamics.constraint.contact={}),oimo.dynamics.constraint.contact.ContactConstraint=class{constructor(t){this._solver=new oimo.dynamics.constraint.solver.pgs.PgsContactConstraintSolver(this),this._manifold=t}_getVelocitySolverInfo(t,i){let o,s,a,n,e,r,_,l,h;i.b1=this._b1,i.b2=this._b2,o=this._manifold._normalX,s=this._manifold._normalY,a=this._manifold._normalZ,n=this._manifold._tangentX,e=this._manifold._tangentY,r=this._manifold._tangentZ,_=this._manifold._binormalX,l=this._manifold._binormalY,h=this._manifold._binormalZ;let c=Math.sqrt(this._s1._friction*this._s2._friction),m=Math.sqrt(this._s1._restitution*this._s2._restitution),b=this._manifold._numPoints;i.numRows=0;let x=0;for(;x<b;){let b=this._manifold._points[x++];if(b._depth<0){b._disabled=!0;let t=b._impulse;t.impulseN=0,t.impulseT=0,t.impulseB=0,t.impulseP=0,t.impulseLX=0,t.impulseLY=0,t.impulseLZ=0;continue}b._disabled=!1;let p=i.rows[i.numRows++];p.friction=c,p.cfm=0;let f=p.jacobianN;f.lin1X=o,f.lin1Y=s,f.lin1Z=a,f.lin2X=o,f.lin2Y=s,f.lin2Z=a,f.ang1X=b._relPos1Y*a-b._relPos1Z*s,f.ang1Y=b._relPos1Z*o-b._relPos1X*a,f.ang1Z=b._relPos1X*s-b._relPos1Y*o,f.ang2X=b._relPos2Y*a-b._relPos2Z*s,f.ang2Y=b._relPos2Z*o-b._relPos2X*a,f.ang2Z=b._relPos2X*s-b._relPos2Y*o,f=p.jacobianT,f.lin1X=n,f.lin1Y=e,f.lin1Z=r,f.lin2X=n,f.lin2Y=e,f.lin2Z=r,f.ang1X=b._relPos1Y*r-b._relPos1Z*e,f.ang1Y=b._relPos1Z*n-b._relPos1X*r,f.ang1Z=b._relPos1X*e-b._relPos1Y*n,f.ang2X=b._relPos2Y*r-b._relPos2Z*e,f.ang2Y=b._relPos2Z*n-b._relPos2X*r,f.ang2Z=b._relPos2X*e-b._relPos2Y*n,f=p.jacobianB,f.lin1X=_,f.lin1Y=l,f.lin1Z=h,f.lin2X=_,f.lin2Y=l,f.lin2Z=h,f.ang1X=b._relPos1Y*h-b._relPos1Z*l,f.ang1Y=b._relPos1Z*_-b._relPos1X*h,f.ang1Z=b._relPos1X*l-b._relPos1Y*_,f.ang2X=b._relPos2Y*h-b._relPos2Z*l,f.ang2Y=b._relPos2Z*_-b._relPos2X*h,f.ang2Z=b._relPos2X*l-b._relPos2Y*_,f=p.jacobianN;let u=f.lin1X*this._b1._velX+f.lin1Y*this._b1._velY+f.lin1Z*this._b1._velZ+(f.ang1X*this._b1._angVelX+f.ang1Y*this._b1._angVelY+f.ang1Z*this._b1._angVelZ)-(f.lin2X*this._b2._velX+f.lin2Y*this._b2._velY+f.lin2Z*this._b2._velZ+(f.ang2X*this._b2._angVelX+f.ang2Y*this._b2._angVelY+f.ang2Z*this._b2._angVelZ));if(u<-oimo.common.Setting.contactEnableBounceThreshold&&!b._warmStarted?p.rhs=-u*m:p.rhs=0,this._positionCorrectionAlgorithm==oimo.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE&&b._depth>oimo.common.Setting.linearSlop){let i=(b._depth-oimo.common.Setting.linearSlop)*oimo.common.Setting.velocityBaumgarte*t.invDt;p.rhs<i&&(p.rhs=i)}if(!b._warmStarted){let t=b._impulse;t.impulseN=0,t.impulseT=0,t.impulseB=0,t.impulseP=0,t.impulseLX=0,t.impulseLY=0,t.impulseLZ=0}p.impulse=b._impulse}}_getPositionSolverInfo(t){let i,o,s;t.b1=this._b1,t.b2=this._b2,i=this._manifold._normalX,o=this._manifold._normalY,s=this._manifold._normalZ;let a=this._manifold._numPoints;t.numRows=0;let n=0;for(;n<a;){let a=this._manifold._points[n++];if(a._disabled)continue;let e=t.rows[t.numRows++],r=e.jacobianN;r.lin1X=i,r.lin1Y=o,r.lin1Z=s,r.lin2X=i,r.lin2Y=o,r.lin2Z=s,r.ang1X=a._relPos1Y*s-a._relPos1Z*o,r.ang1Y=a._relPos1Z*i-a._relPos1X*s,r.ang1Z=a._relPos1X*o-a._relPos1Y*i,r.ang2X=a._relPos2Y*s-a._relPos2Z*o,r.ang2Y=a._relPos2Z*i-a._relPos2X*s,r.ang2Z=a._relPos2X*o-a._relPos2Y*i,e.rhs=a._depth-oimo.common.Setting.linearSlop,e.rhs<0&&(e.rhs=0),e.impulse=a._impulse}}_syncManifold(){this._manifold._updateDepthsAndPositions(this._tf1,this._tf2)}getShape1(){return this._s1}getShape2(){return this._s2}getManifold(){return this._manifold}isTouching(){let t=0,i=this._manifold._numPoints;for(;t<i;)if(this._manifold._points[t++]._depth>=0)return!0;return!1}},oimo.dynamics.constraint.contact.ContactImpulse=class{constructor(){this.impulseN=0,this.impulseT=0,this.impulseB=0,this.impulseP=0,this.impulseLX=0,this.impulseLY=0,this.impulseLZ=0}copyFrom(t){this.impulseN=t.impulseN,this.impulseT=t.impulseT,this.impulseB=t.impulseB,this.impulseLX=t.impulseLX,this.impulseLY=t.impulseLY,this.impulseLZ=t.impulseLZ}},oimo.dynamics.constraint.contact.Manifold=class{constructor(){this._normalX=0,this._normalY=0,this._normalZ=0,this._tangentX=0,this._tangentY=0,this._tangentZ=0,this._binormalX=0,this._binormalY=0,this._binormalZ=0,this._numPoints=0,this._points=new Array(oimo.common.Setting.maxManifoldPoints);let t=0,i=oimo.common.Setting.maxManifoldPoints;for(;t<i;)this._points[t++]=new oimo.dynamics.constraint.contact.ManifoldPoint}_clear(){let t=0,i=this._numPoints;for(;t<i;){let i=this._points[t++];i._localPos1X=0,i._localPos1Y=0,i._localPos1Z=0,i._localPos2X=0,i._localPos2Y=0,i._localPos2Z=0,i._relPos1X=0,i._relPos1Y=0,i._relPos1Z=0,i._relPos2X=0,i._relPos2Y=0,i._relPos2Z=0,i._pos1X=0,i._pos1Y=0,i._pos1Z=0,i._pos2X=0,i._pos2Y=0,i._pos2Z=0,i._depth=0;let o=i._impulse;o.impulseN=0,o.impulseT=0,o.impulseB=0,o.impulseP=0,o.impulseLX=0,o.impulseLY=0,o.impulseLZ=0,i._warmStarted=!1,i._disabled=!1,i._id=-1}this._numPoints=0}_buildBasis(t){this._normalX=t.x,this._normalY=t.y,this._normalZ=t.z;let i,o,s,a,n,e,r=t.x,_=t.y,l=t.z,h=r*r,c=_*_,m=l*l;if(h<c)if(h<m){let t=1/Math.sqrt(c+m);i=0,o=-l*t,s=_*t,a=_*s-l*o,n=-r*s,e=r*o}else{let t=1/Math.sqrt(h+c);i=-_*t,o=r*t,s=0,a=-l*o,n=l*i,e=r*o-_*i}else if(c<m){let t=1/Math.sqrt(h+m);i=l*t,o=0,s=-r*t,a=_*s,n=l*i-r*s,e=-_*i}else{let t=1/Math.sqrt(h+c);i=-_*t,o=r*t,s=0,a=-l*o,n=l*i,e=r*o-_*i}this._tangentX=i,this._tangentY=o,this._tangentZ=s,this._binormalX=a,this._binormalY=n,this._binormalZ=e}_updateDepthsAndPositions(t,i){let o=0,s=this._numPoints;for(;o<s;){let s,a,n,e,r,_,l,h,c,m=this._points[o++];s=t._rotation00*m._localPos1X+t._rotation01*m._localPos1Y+t._rotation02*m._localPos1Z,a=t._rotation10*m._localPos1X+t._rotation11*m._localPos1Y+t._rotation12*m._localPos1Z,n=t._rotation20*m._localPos1X+t._rotation21*m._localPos1Y+t._rotation22*m._localPos1Z,m._relPos1X=s,m._relPos1Y=a,m._relPos1Z=n,e=i._rotation00*m._localPos2X+i._rotation01*m._localPos2Y+i._rotation02*m._localPos2Z,r=i._rotation10*m._localPos2X+i._rotation11*m._localPos2Y+i._rotation12*m._localPos2Z,_=i._rotation20*m._localPos2X+i._rotation21*m._localPos2Y+i._rotation22*m._localPos2Z,m._relPos2X=e,m._relPos2Y=r,m._relPos2Z=_,m._pos1X=m._relPos1X+t._positionX,m._pos1Y=m._relPos1Y+t._positionY,m._pos1Z=m._relPos1Z+t._positionZ,m._pos2X=m._relPos2X+i._positionX,m._pos2Y=m._relPos2Y+i._positionY,m._pos2Z=m._relPos2Z+i._positionZ,l=m._pos1X-m._pos2X,h=m._pos1Y-m._pos2Y,c=m._pos1Z-m._pos2Z,m._depth=-(l*this._normalX+h*this._normalY+c*this._normalZ)}}getNormal(){let t=new oimo.common.Vec3;return t.x=this._normalX,t.y=this._normalY,t.z=this._normalZ,t}getNormalTo(t){t.x=this._normalX,t.y=this._normalY,t.z=this._normalZ}getTangent(){let t=new oimo.common.Vec3;return t.x=this._tangentX,t.y=this._tangentY,t.z=this._tangentZ,t}getTangentTo(t){t.x=this._tangentX,t.y=this._tangentY,t.z=this._tangentZ}getBinormal(){let t=new oimo.common.Vec3;return t.x=this._binormalX,t.y=this._binormalY,t.z=this._binormalZ,t}getBinormalTo(t){t.x=this._binormalX,t.y=this._binormalY,t.z=this._binormalZ}getPoints(){return this._points}getNumPoints(){return this._numPoints}},oimo.dynamics.constraint.contact.ManifoldPoint=class{constructor(){this._localPos1X=0,this._localPos1Y=0,this._localPos1Z=0,this._localPos2X=0,this._localPos2Y=0,this._localPos2Z=0,this._relPos1X=0,this._relPos1Y=0,this._relPos1Z=0,this._relPos2X=0,this._relPos2Y=0,this._relPos2Z=0,this._pos1X=0,this._pos1Y=0,this._pos1Z=0,this._pos2X=0,this._pos2Y=0,this._pos2Z=0,this._depth=0,this._impulse=new oimo.dynamics.constraint.contact.ContactImpulse,this._warmStarted=!1,this._disabled=!1,this._id=-1}getPosition1(){let t=new oimo.common.Vec3;return t.x=this._pos1X,t.y=this._pos1Y,t.z=this._pos1Z,t}getPosition1To(t){t.x=this._pos1X,t.y=this._pos1Y,t.z=this._pos1Z}getPosition2(){let t=new oimo.common.Vec3;return t.x=this._pos2X,t.y=this._pos2Y,t.z=this._pos2Z,t}getPosition2To(t){t.x=this._pos2X,t.y=this._pos2Y,t.z=this._pos2Z}getDepth(){return this._depth}isWarmStarted(){return this._warmStarted}getNormalImpulse(){return this._impulse.impulseN}getTangentImpulse(){return this._impulse.impulseT}getBinormalImpulse(){return this._impulse.impulseB}isEnabled(){return!this._disabled}},oimo.dynamics.constraint.contact.ManifoldUpdater=class{constructor(t){this._manifold=t,this.numOldPoints=0,this.oldPoints=new Array(oimo.common.Setting.maxManifoldPoints);let i=0,o=oimo.common.Setting.maxManifoldPoints;for(;i<o;)this.oldPoints[i++]=new oimo.dynamics.constraint.contact.ManifoldPoint}removeOutdatedPoints(){let t=this._manifold._numPoints;for(;--t>=0;){let i,o,s,a=this._manifold._points[t];i=a._pos1X-a._pos2X,o=a._pos1Y-a._pos2Y,s=a._pos1Z-a._pos2Z;let n=this._manifold._normalX*i+this._manifold._normalY*o+this._manifold._normalZ*s;n>oimo.common.Setting.contactPersistenceThreshold?this.removeManifoldPoint(t):(i+=this._manifold._normalX*-n,o+=this._manifold._normalY*-n,s+=this._manifold._normalZ*-n,i*i+o*o+s*s>oimo.common.Setting.contactPersistenceThreshold*oimo.common.Setting.contactPersistenceThreshold&&this.removeManifoldPoint(t))}}removeManifoldPoint(t){let i=--this._manifold._numPoints;if(t!=i){let o=this._manifold._points[t];this._manifold._points[t]=this._manifold._points[i],this._manifold._points[i]=o}let o=this._manifold._points[i];o._localPos1X=0,o._localPos1Y=0,o._localPos1Z=0,o._localPos2X=0,o._localPos2Y=0,o._localPos2Z=0,o._relPos1X=0,o._relPos1Y=0,o._relPos1Z=0,o._relPos2X=0,o._relPos2Y=0,o._relPos2Z=0,o._pos1X=0,o._pos1Y=0,o._pos1Z=0,o._pos2X=0,o._pos2Y=0,o._pos2Z=0,o._depth=0;let s=o._impulse;s.impulseN=0,s.impulseT=0,s.impulseB=0,s.impulseP=0,s.impulseLX=0,s.impulseLY=0,s.impulseLZ=0,o._warmStarted=!1,o._disabled=!1,o._id=-1}addManifoldPoint(t,i,o){let s=this._manifold._numPoints;if(s==oimo.common.Setting.maxManifoldPoints){let s=this.computeTargetIndex(t,i,o),a=this._manifold._points[s],n=t.position1;a._pos1X=n.x,a._pos1Y=n.y,a._pos1Z=n.z;let e,r,_,l,h,c,m=t.position2;a._pos2X=m.x,a._pos2Y=m.y,a._pos2Z=m.z,a._relPos1X=a._pos1X-i._positionX,a._relPos1Y=a._pos1Y-i._positionY,a._relPos1Z=a._pos1Z-i._positionZ,a._relPos2X=a._pos2X-o._positionX,a._relPos2Y=a._pos2Y-o._positionY,a._relPos2Z=a._pos2Z-o._positionZ,e=i._rotation00*a._relPos1X+i._rotation10*a._relPos1Y+i._rotation20*a._relPos1Z,r=i._rotation01*a._relPos1X+i._rotation11*a._relPos1Y+i._rotation21*a._relPos1Z,_=i._rotation02*a._relPos1X+i._rotation12*a._relPos1Y+i._rotation22*a._relPos1Z,a._localPos1X=e,a._localPos1Y=r,a._localPos1Z=_,l=o._rotation00*a._relPos2X+o._rotation10*a._relPos2Y+o._rotation20*a._relPos2Z,h=o._rotation01*a._relPos2X+o._rotation11*a._relPos2Y+o._rotation21*a._relPos2Z,c=o._rotation02*a._relPos2X+o._rotation12*a._relPos2Y+o._rotation22*a._relPos2Z,a._localPos2X=l,a._localPos2Y=h,a._localPos2Z=c,a._depth=t.depth;let b=a._impulse;return b.impulseN=0,b.impulseT=0,b.impulseB=0,b.impulseP=0,b.impulseLX=0,b.impulseLY=0,b.impulseLZ=0,a._id=t.id,a._warmStarted=!1,void(a._disabled=!1)}let a=this._manifold._points[s],n=t.position1;a._pos1X=n.x,a._pos1Y=n.y,a._pos1Z=n.z;let e,r,_,l,h,c,m=t.position2;a._pos2X=m.x,a._pos2Y=m.y,a._pos2Z=m.z,a._relPos1X=a._pos1X-i._positionX,a._relPos1Y=a._pos1Y-i._positionY,a._relPos1Z=a._pos1Z-i._positionZ,a._relPos2X=a._pos2X-o._positionX,a._relPos2Y=a._pos2Y-o._positionY,a._relPos2Z=a._pos2Z-o._positionZ,e=i._rotation00*a._relPos1X+i._rotation10*a._relPos1Y+i._rotation20*a._relPos1Z,r=i._rotation01*a._relPos1X+i._rotation11*a._relPos1Y+i._rotation21*a._relPos1Z,_=i._rotation02*a._relPos1X+i._rotation12*a._relPos1Y+i._rotation22*a._relPos1Z,a._localPos1X=e,a._localPos1Y=r,a._localPos1Z=_,l=o._rotation00*a._relPos2X+o._rotation10*a._relPos2Y+o._rotation20*a._relPos2Z,h=o._rotation01*a._relPos2X+o._rotation11*a._relPos2Y+o._rotation21*a._relPos2Z,c=o._rotation02*a._relPos2X+o._rotation12*a._relPos2Y+o._rotation22*a._relPos2Z,a._localPos2X=l,a._localPos2Y=h,a._localPos2Z=c,a._depth=t.depth;let b=a._impulse;b.impulseN=0,b.impulseT=0,b.impulseB=0,b.impulseP=0,b.impulseLX=0,b.impulseLY=0,b.impulseLZ=0,a._id=t.id,a._warmStarted=!1,a._disabled=!1,this._manifold._numPoints++}computeTargetIndex(t,i,o){let s,a,n,e=this._manifold._points[0],r=this._manifold._points[1],_=this._manifold._points[2],l=this._manifold._points[3],h=e._depth,c=0;r._depth>h&&(h=r._depth,c=1),_._depth>h&&(h=_._depth,c=2),l._depth>h&&(c=3);let m=t.position1;s=m.x,a=m.y,n=m.z,s-=i._positionX,a-=i._positionY,n-=i._positionZ;let b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A,P,S,T,C,j,R,q=r._relPos1X,E=r._relPos1Y,D=r._relPos1Z,F=_._relPos1X,N=_._relPos1Y,W=_._relPos1Z,G=l._relPos1X,J=l._relPos1Y,O=l._relPos1Z;b=F-q,x=N-E,p=W-D,f=s-G,u=a-J,v=n-O,X=G-q,y=J-E,g=O-D,d=s-F,Y=a-N,z=n-W,Z=s-q,M=a-E,I=n-D,V=G-F,L=J-N,w=O-W,k=x*v-p*u,B=p*f-b*v,A=b*u-x*f,P=y*z-g*Y,S=g*d-X*z,T=X*Y-y*d,C=M*w-I*L,j=I*V-Z*w,R=Z*L-M*V;let H,U,Q,K,$,tt,it,ot,st,at,nt,et,rt,_t,lt,ht,ct,mt,bt,xt,pt,ft,ut,vt,Xt,yt,gt,dt=k*k+B*B+A*A,Yt=P*P+S*S+T*T,zt=C*C+j*j+R*R,Zt=e._relPos1X,Mt=e._relPos1Y,It=e._relPos1Z,Vt=_._relPos1X,Lt=_._relPos1Y,wt=_._relPos1Z,kt=l._relPos1X,Bt=l._relPos1Y,At=l._relPos1Z;H=Vt-Zt,U=Lt-Mt,Q=wt-It,K=s-kt,$=a-Bt,tt=n-At,it=kt-Zt,ot=Bt-Mt,st=At-It,at=s-Vt,nt=a-Lt,et=n-wt,rt=s-Zt,_t=a-Mt,lt=n-It,ht=kt-Vt,ct=Bt-Lt,mt=At-wt,bt=U*tt-Q*$,xt=Q*K-H*tt,pt=H*$-U*K,ft=ot*et-st*nt,ut=st*at-it*et,vt=it*nt-ot*at,Xt=_t*mt-lt*ct,yt=lt*ht-rt*mt,gt=rt*ct-_t*ht;let Pt,St,Tt,Ct,jt,Rt,qt,Et,Dt,Ft,Nt,Wt,Gt,Jt,Ot,Ht,Ut,Qt,Kt,$t,ti,ii,oi,si,ai,ni,ei,ri=bt*bt+xt*xt+pt*pt,_i=ft*ft+ut*ut+vt*vt,li=Xt*Xt+yt*yt+gt*gt,hi=ri>_i?ri>li?ri:li:_i>li?_i:li,ci=e._relPos1X,mi=e._relPos1Y,bi=e._relPos1Z,xi=r._relPos1X,pi=r._relPos1Y,fi=r._relPos1Z,ui=l._relPos1X,vi=l._relPos1Y,Xi=l._relPos1Z;Pt=xi-ci,St=pi-mi,Tt=fi-bi,Ct=s-ui,jt=a-vi,Rt=n-Xi,qt=ui-ci,Et=vi-mi,Dt=Xi-bi,Ft=s-xi,Nt=a-pi,Wt=n-fi,Gt=s-ci,Jt=a-mi,Ot=n-bi,Ht=ui-xi,Ut=vi-pi,Qt=Xi-fi,Kt=St*Rt-Tt*jt,$t=Tt*Ct-Pt*Rt,ti=Pt*jt-St*Ct,ii=Et*Wt-Dt*Nt,oi=Dt*Ft-qt*Wt,si=qt*Nt-Et*Ft,ai=Jt*Qt-Ot*Ut,ni=Ot*Ht-Gt*Qt,ei=Gt*Ut-Jt*Ht;let yi,gi,di,Yi,zi,Zi,Mi,Ii,Vi,Li,wi,ki,Bi,Ai,Pi,Si,Ti,Ci,ji,Ri,qi,Ei,Di,Fi,Ni,Wi,Gi,Ji=Kt*Kt+$t*$t+ti*ti,Oi=ii*ii+oi*oi+si*si,Hi=ai*ai+ni*ni+ei*ei,Ui=Ji>Oi?Ji>Hi?Ji:Hi:Oi>Hi?Oi:Hi,Qi=e._relPos1X,Ki=e._relPos1Y,$i=e._relPos1Z,to=r._relPos1X,io=r._relPos1Y,oo=r._relPos1Z,so=_._relPos1X,ao=_._relPos1Y,no=_._relPos1Z;yi=to-Qi,gi=io-Ki,di=oo-$i,Yi=s-so,zi=a-ao,Zi=n-no,Mi=so-Qi,Ii=ao-Ki,Vi=no-$i,Li=s-to,wi=a-io,ki=n-oo,Bi=s-Qi,Ai=a-Ki,Pi=n-$i,Si=so-to,Ti=ao-io,Ci=no-oo,ji=gi*Zi-di*zi,Ri=di*Yi-yi*Zi,qi=yi*zi-gi*Yi,Ei=Ii*ki-Vi*wi,Di=Vi*Li-Mi*ki,Fi=Mi*wi-Ii*Li,Ni=Ai*Ci-Pi*Ti,Wi=Pi*Si-Bi*Ci,Gi=Bi*Ti-Ai*Si;let eo=ji*ji+Ri*Ri+qi*qi,ro=Ei*Ei+Di*Di+Fi*Fi,_o=Ni*Ni+Wi*Wi+Gi*Gi,lo=dt>Yt?dt>zt?dt:zt:Yt>zt?Yt:zt,ho=0;return(hi>lo&&1!=c||0==c)&&(lo=hi,ho=1),Ui>lo&&2!=c&&(lo=Ui,ho=2),(eo>ro?eo>_o?eo:_o:ro>_o?ro:_o)>lo&&3!=c&&(ho=3),ho}computeRelativePositions(t,i){let o=this._manifold._numPoints,s=0;for(;s<o;){let o,a,n,e,r,_,l=this._manifold._points[s++];o=t._rotation00*l._localPos1X+t._rotation01*l._localPos1Y+t._rotation02*l._localPos1Z,a=t._rotation10*l._localPos1X+t._rotation11*l._localPos1Y+t._rotation12*l._localPos1Z,n=t._rotation20*l._localPos1X+t._rotation21*l._localPos1Y+t._rotation22*l._localPos1Z,l._relPos1X=o,l._relPos1Y=a,l._relPos1Z=n,e=i._rotation00*l._localPos2X+i._rotation01*l._localPos2Y+i._rotation02*l._localPos2Z,r=i._rotation10*l._localPos2X+i._rotation11*l._localPos2Y+i._rotation12*l._localPos2Z,_=i._rotation20*l._localPos2X+i._rotation21*l._localPos2Y+i._rotation22*l._localPos2Z,l._relPos2X=e,l._relPos2Y=r,l._relPos2Z=_,l._warmStarted=!0}}findNearestContactPointIndex(t,i,o){let s=oimo.common.Setting.contactPersistenceThreshold*oimo.common.Setting.contactPersistenceThreshold,a=-1,n=0,e=this._manifold._numPoints;for(;n<e;){let e,r,_,l,h,c,m=n++,b=this._manifold._points[m],x=t.position1;e=x.x,r=x.y,_=x.z;let p,f,u,v,X,y,g=t.position2;l=g.x,h=g.y,c=g.z,e-=i._positionX,r-=i._positionY,_-=i._positionZ,l-=o._positionX,h-=o._positionY,c-=o._positionZ,p=b._relPos1X-e,f=b._relPos1Y-r,u=b._relPos1Z-_,v=b._relPos2X-l,X=b._relPos2Y-h,y=b._relPos2Z-c;let d=p*p+f*f+u*u,Y=v*v+X*X+y*y,z=d<Y?d:Y;z<s&&(s=z,a=m)}return a}totalUpdate(t,i,o){this.numOldPoints=this._manifold._numPoints;let s=0,a=this.numOldPoints;for(;s<a;){let t=s++,i=this.oldPoints[t],o=this._manifold._points[t];i._localPos1X=o._localPos1X,i._localPos1Y=o._localPos1Y,i._localPos1Z=o._localPos1Z,i._localPos2X=o._localPos2X,i._localPos2Y=o._localPos2Y,i._localPos2Z=o._localPos2Z,i._relPos1X=o._relPos1X,i._relPos1Y=o._relPos1Y,i._relPos1Z=o._relPos1Z,i._relPos2X=o._relPos2X,i._relPos2Y=o._relPos2Y,i._relPos2Z=o._relPos2Z,i._pos1X=o._pos1X,i._pos1Y=o._pos1Y,i._pos1Z=o._pos1Z,i._pos2X=o._pos2X,i._pos2Y=o._pos2Y,i._pos2Z=o._pos2Z,i._depth=o._depth,i._impulse.copyFrom(o._impulse),i._id=o._id,i._warmStarted=o._warmStarted,i._disabled=!1}let n=t.numPoints;this._manifold._numPoints=n;let e=0;for(;e<n;){let s=e++,a=this._manifold._points[s],n=t.points[s],r=n.position1;a._pos1X=r.x,a._pos1Y=r.y,a._pos1Z=r.z;let _,l,h,c,m,b,x=n.position2;a._pos2X=x.x,a._pos2Y=x.y,a._pos2Z=x.z,a._relPos1X=a._pos1X-i._positionX,a._relPos1Y=a._pos1Y-i._positionY,a._relPos1Z=a._pos1Z-i._positionZ,a._relPos2X=a._pos2X-o._positionX,a._relPos2Y=a._pos2Y-o._positionY,a._relPos2Z=a._pos2Z-o._positionZ,_=i._rotation00*a._relPos1X+i._rotation10*a._relPos1Y+i._rotation20*a._relPos1Z,l=i._rotation01*a._relPos1X+i._rotation11*a._relPos1Y+i._rotation21*a._relPos1Z,h=i._rotation02*a._relPos1X+i._rotation12*a._relPos1Y+i._rotation22*a._relPos1Z,a._localPos1X=_,a._localPos1Y=l,a._localPos1Z=h,c=o._rotation00*a._relPos2X+o._rotation10*a._relPos2Y+o._rotation20*a._relPos2Z,m=o._rotation01*a._relPos2X+o._rotation11*a._relPos2Y+o._rotation21*a._relPos2Z,b=o._rotation02*a._relPos2X+o._rotation12*a._relPos2Y+o._rotation22*a._relPos2Z,a._localPos2X=c,a._localPos2Y=m,a._localPos2Z=b,a._depth=n.depth;let p=a._impulse;p.impulseN=0,p.impulseT=0,p.impulseB=0,p.impulseP=0,p.impulseLX=0,p.impulseLY=0,p.impulseLZ=0,a._id=n.id,a._warmStarted=!1,a._disabled=!1;let f=0,u=this.numOldPoints;for(;f<u;){let t=this.oldPoints[f++];if(a._id==t._id){a._impulse.copyFrom(t._impulse),a._warmStarted=!0;break}}}}incrementalUpdate(t,i,o){this._manifold._updateDepthsAndPositions(i,o);let s=0,a=this._manifold._numPoints;for(;s<a;)this._manifold._points[s++]._warmStarted=!0;let n=t.points[0],e=this.findNearestContactPointIndex(n,i,o);if(-1==e)this.addManifoldPoint(n,i,o);else{let t=this._manifold._points[e],s=n.position1;t._pos1X=s.x,t._pos1Y=s.y,t._pos1Z=s.z;let a,r,_,l,h,c,m=n.position2;t._pos2X=m.x,t._pos2Y=m.y,t._pos2Z=m.z,t._relPos1X=t._pos1X-i._positionX,t._relPos1Y=t._pos1Y-i._positionY,t._relPos1Z=t._pos1Z-i._positionZ,t._relPos2X=t._pos2X-o._positionX,t._relPos2Y=t._pos2Y-o._positionY,t._relPos2Z=t._pos2Z-o._positionZ,a=i._rotation00*t._relPos1X+i._rotation10*t._relPos1Y+i._rotation20*t._relPos1Z,r=i._rotation01*t._relPos1X+i._rotation11*t._relPos1Y+i._rotation21*t._relPos1Z,_=i._rotation02*t._relPos1X+i._rotation12*t._relPos1Y+i._rotation22*t._relPos1Z,t._localPos1X=a,t._localPos1Y=r,t._localPos1Z=_,l=o._rotation00*t._relPos2X+o._rotation10*t._relPos2Y+o._rotation20*t._relPos2Z,h=o._rotation01*t._relPos2X+o._rotation11*t._relPos2Y+o._rotation21*t._relPos2Z,c=o._rotation02*t._relPos2X+o._rotation12*t._relPos2Y+o._rotation22*t._relPos2Z,t._localPos2X=l,t._localPos2Y=h,t._localPos2Z=c,t._depth=n.depth}this.removeOutdatedPoints()}},oimo.dynamics.constraint.info||(oimo.dynamics.constraint.info={}),oimo.dynamics.constraint.info.JacobianRow=class{constructor(){this.lin1X=0,this.lin1Y=0,this.lin1Z=0,this.lin2X=0,this.lin2Y=0,this.lin2Z=0,this.ang1X=0,this.ang1Y=0,this.ang1Z=0,this.ang2X=0,this.ang2Y=0,this.ang2Z=0,this.flag=0}updateSparsity(){this.flag=0,0==this.lin1X&&0==this.lin1Y&&0==this.lin1Z&&0==this.lin2X&&0==this.lin2Y&&0==this.lin2Z||(this.flag|=1),0==this.ang1X&&0==this.ang1Y&&0==this.ang1Z&&0==this.ang2X&&0==this.ang2Y&&0==this.ang2Z||(this.flag|=2)}},oimo.dynamics.constraint.info.contact||(oimo.dynamics.constraint.info.contact={}),oimo.dynamics.constraint.info.contact.ContactSolverInfo=class{constructor(){this.b1=null,this.b2=null,this.numRows=0,this.rows=new Array(oimo.common.Setting.maxManifoldPoints);let t=0,i=this.rows.length;for(;t<i;)this.rows[t++]=new oimo.dynamics.constraint.info.contact.ContactSolverInfoRow}},oimo.dynamics.constraint.info.contact.ContactSolverInfoRow=class{constructor(){this.jacobianN=new oimo.dynamics.constraint.info.JacobianRow,this.jacobianT=new oimo.dynamics.constraint.info.JacobianRow,this.jacobianB=new oimo.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.friction=0,this.impulse=null}},oimo.dynamics.constraint.info.joint||(oimo.dynamics.constraint.info.joint={}),oimo.dynamics.constraint.info.joint.JointSolverInfo=class{constructor(){this.b1=null,this.b2=null,this.numRows=0,this.rows=new Array(oimo.common.Setting.maxJacobianRows);let t=0,i=this.rows.length;for(;t<i;)this.rows[t++]=new oimo.dynamics.constraint.info.joint.JointSolverInfoRow}},oimo.dynamics.constraint.info.joint.JointSolverInfoRow=class{constructor(){this.jacobian=new oimo.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.minImpulse=0,this.maxImpulse=0,this.motorSpeed=0,this.motorMaxImpulse=0,this.impulse=null}},oimo.dynamics.constraint.joint||(oimo.dynamics.constraint.joint={}),oimo.dynamics.constraint.joint.BasisTracker=class{constructor(t){this.joint=t,this.xX=0,this.xY=0,this.xZ=0,this.yX=0,this.yY=0,this.yZ=0,this.zX=0,this.zY=0,this.zZ=0}},oimo.dynamics.constraint.joint.Joint=class{constructor(t,i){switch(this._link1=new oimo.dynamics.constraint.joint.JointLink(this),this._link2=new oimo.dynamics.constraint.joint.JointLink(this),this._positionCorrectionAlgorithm=oimo.common.Setting.defaultJointPositionCorrectionAlgorithm,this._type=i,this._world=null,this._b1=t.rigidBody1,this._b2=t.rigidBody2,this._allowCollision=t.allowCollision,this._breakForce=t.breakForce,this._breakTorque=t.breakTorque,t.solverType){case 0:this._solver=new oimo.dynamics.constraint.solver.pgs.PgsJointConstraintSolver(this);break;case 1:this._solver=new oimo.dynamics.constraint.solver.direct.DirectJointConstraintSolver(this)}let o=t.localAnchor1;this._localAnchor1X=o.x,this._localAnchor1Y=o.y,this._localAnchor1Z=o.z;let s=t.localAnchor2;this._localAnchor2X=s.x,this._localAnchor2Y=s.y,this._localAnchor2Z=s.z,this._relativeAnchor1X=0,this._relativeAnchor1Y=0,this._relativeAnchor1Z=0,this._relativeAnchor2X=0,this._relativeAnchor2Y=0,this._relativeAnchor2Z=0,this._anchor1X=0,this._anchor1Y=0,this._anchor1Z=0,this._anchor2X=0,this._anchor2Y=0,this._anchor2Z=0,this._localBasisX1X=0,this._localBasisX1Y=0,this._localBasisX1Z=0,this._localBasisY1X=0,this._localBasisY1Y=0,this._localBasisY1Z=0,this._localBasisZ1X=0,this._localBasisZ1Y=0,this._localBasisZ1Z=0,this._localBasisX2X=0,this._localBasisX2Y=0,this._localBasisX2Z=0,this._localBasisY2X=0,this._localBasisY2Y=0,this._localBasisY2Z=0,this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=0,this._impulses=new Array(oimo.common.Setting.maxJacobianRows);let a=0,n=oimo.common.Setting.maxJacobianRows;for(;a<n;)this._impulses[a++]=new oimo.dynamics.constraint.joint.JointImpulse}buildLocalBasesFromX(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{let t=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX2X*=t,this._localBasisX2Y*=t,this._localBasisX2Z*=t}let t,i,o,s,a,n,e,r,_,l,h,c,m,b=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(b<-.999999999){let a,n,e,r,_=this._localBasisX1X,l=this._localBasisX1Y,h=this._localBasisX1Z,c=_*_,m=l*l,b=h*h;c<m?c<b?(r=1/Math.sqrt(m+b),a=0,n=h*r,e=-l*r):(r=1/Math.sqrt(c+m),a=l*r,n=-_*r,e=0):m<b?(r=1/Math.sqrt(b+c),a=-h*r,n=0,e=_*r):(r=1/Math.sqrt(c+m),a=l*r,n=-_*r,e=0),t=a,i=n,o=e,s=0}else{let a,n,e;a=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,n=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,e=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;let r=Math.sqrt(.5*(1+b));b=.5/r,a*=b,n*=b,e*=b,t=a,i=n,o=e,s=r}let x=2*t,p=2*i,f=2*o,u=t*x,v=i*p,X=o*f,y=t*p,g=i*f,d=t*f,Y=s*x,z=s*p,Z=s*f;a=1-v-X,n=y-Z,e=d+z,r=y+Z,_=1-u-X,l=g-Y,h=d-z,c=g+Y,m=1-u-v;let M,I,V,L,w,k,B,A,P,S,T=this._localBasisX1X,C=this._localBasisX1Y,j=this._localBasisX1Z,R=T*T,q=C*C,E=j*j;R<q?R<E?(M=1/Math.sqrt(q+E),this._localBasisY1X=0,this._localBasisY1Y=j*M,this._localBasisY1Z=-C*M):(M=1/Math.sqrt(R+q),this._localBasisY1X=C*M,this._localBasisY1Y=-T*M,this._localBasisY1Z=0):q<E?(M=1/Math.sqrt(E+R),this._localBasisY1X=-j*M,this._localBasisY1Y=0,this._localBasisY1Z=T*M):(M=1/Math.sqrt(R+q),this._localBasisY1X=C*M,this._localBasisY1Y=-T*M,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,I=a*this._localBasisX1X+n*this._localBasisX1Y+e*this._localBasisX1Z,V=r*this._localBasisX1X+_*this._localBasisX1Y+l*this._localBasisX1Z,L=h*this._localBasisX1X+c*this._localBasisX1Y+m*this._localBasisX1Z,this._localBasisX2X=I,this._localBasisX2Y=V,this._localBasisX2Z=L,w=a*this._localBasisY1X+n*this._localBasisY1Y+e*this._localBasisY1Z,k=r*this._localBasisY1X+_*this._localBasisY1Y+l*this._localBasisY1Z,B=h*this._localBasisY1X+c*this._localBasisY1Y+m*this._localBasisY1Z,this._localBasisY2X=w,this._localBasisY2Y=k,this._localBasisY2Z=B,A=a*this._localBasisZ1X+n*this._localBasisZ1Y+e*this._localBasisZ1Z,P=r*this._localBasisZ1X+_*this._localBasisZ1Y+l*this._localBasisZ1Z,S=h*this._localBasisZ1X+c*this._localBasisZ1Y+m*this._localBasisZ1Z,this._localBasisZ2X=A,this._localBasisZ2Y=P,this._localBasisZ2Z=S}buildLocalBasesFromXY(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{let t=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX2X*=t,this._localBasisX2Y*=t,this._localBasisX2Z*=t}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){let t,i=this._localBasisX1X,o=this._localBasisX1Y,s=this._localBasisX1Z,a=i*i,n=o*o,e=s*s;a<n?a<e?(t=1/Math.sqrt(n+e),this._localBasisY1X=0,this._localBasisY1Y=s*t,this._localBasisY1Z=-o*t):(t=1/Math.sqrt(a+n),this._localBasisY1X=o*t,this._localBasisY1Y=-i*t,this._localBasisY1Z=0):n<e?(t=1/Math.sqrt(e+a),this._localBasisY1X=-s*t,this._localBasisY1Y=0,this._localBasisY1Z=i*t):(t=1/Math.sqrt(a+n),this._localBasisY1X=o*t,this._localBasisY1Y=-i*t,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{let t=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisZ1X*=t,this._localBasisZ1Y*=t,this._localBasisZ1Z*=t,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0){let t,i=this._localBasisX2X,o=this._localBasisX2Y,s=this._localBasisX2Z,a=i*i,n=o*o,e=s*s;a<n?a<e?(t=1/Math.sqrt(n+e),this._localBasisY2X=0,this._localBasisY2Y=s*t,this._localBasisY2Z=-o*t):(t=1/Math.sqrt(a+n),this._localBasisY2X=o*t,this._localBasisY2Y=-i*t,this._localBasisY2Z=0):n<e?(t=1/Math.sqrt(e+a),this._localBasisY2X=-s*t,this._localBasisY2Y=0,this._localBasisY2Z=i*t):(t=1/Math.sqrt(a+n),this._localBasisY2X=o*t,this._localBasisY2Y=-i*t,this._localBasisY2Z=0),this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X}else{let t=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisZ2X*=t,this._localBasisZ2Y*=t,this._localBasisZ2Z*=t,this._localBasisY2X=this._localBasisZ2Y*this._localBasisX2Z-this._localBasisZ2Z*this._localBasisX2Y,this._localBasisY2Y=this._localBasisZ2Z*this._localBasisX2X-this._localBasisZ2X*this._localBasisX2Z,this._localBasisY2Z=this._localBasisZ2X*this._localBasisX2Y-this._localBasisZ2Y*this._localBasisX2X}}buildLocalBasesFromX1Z2(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0)this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=1;else{let t=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisZ2X*=t,this._localBasisZ2Y*=t,this._localBasisZ2Z*=t}let t,i,o,s,a,n,e,r,_,l,h,c,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A,P,S,T,C,j,R=this._b1._transform,q=this._b2._transform;if(p=R._rotation00*this._localBasisX1X+R._rotation01*this._localBasisX1Y+R._rotation02*this._localBasisX1Z,f=R._rotation10*this._localBasisX1X+R._rotation11*this._localBasisX1Y+R._rotation12*this._localBasisX1Z,u=R._rotation20*this._localBasisX1X+R._rotation21*this._localBasisX1Y+R._rotation22*this._localBasisX1Z,t=p,i=f,o=u,v=q._rotation00*this._localBasisZ2X+q._rotation01*this._localBasisZ2Y+q._rotation02*this._localBasisZ2Z,X=q._rotation10*this._localBasisZ2X+q._rotation11*this._localBasisZ2Y+q._rotation12*this._localBasisZ2Z,y=q._rotation20*this._localBasisZ2X+q._rotation21*this._localBasisZ2Y+q._rotation22*this._localBasisZ2Z,m=v,b=X,x=y,e=b*o-x*i,r=x*t-m*o,_=m*i-b*t,e*e+r*r+_*_==0){let s,a=t,n=i,l=o,h=a*a,c=n*n,m=l*l;h<c?h<m?(s=1/Math.sqrt(c+m),e=0,r=l*s,_=-n*s):(s=1/Math.sqrt(h+c),e=n*s,r=-a*s,_=0):c<m?(s=1/Math.sqrt(m+h),e=-l*s,r=0,_=a*s):(s=1/Math.sqrt(h+c),e=n*s,r=-a*s,_=0)}s=i*_-o*r,a=o*e-t*_,n=t*r-i*e,l=r*x-_*b,h=_*m-e*x,c=e*b-r*m,g=R._rotation00*t+R._rotation10*i+R._rotation20*o,d=R._rotation01*t+R._rotation11*i+R._rotation21*o,Y=R._rotation02*t+R._rotation12*i+R._rotation22*o,this._localBasisX1X=g,this._localBasisX1Y=d,this._localBasisX1Z=Y,z=R._rotation00*e+R._rotation10*r+R._rotation20*_,Z=R._rotation01*e+R._rotation11*r+R._rotation21*_,M=R._rotation02*e+R._rotation12*r+R._rotation22*_,this._localBasisY1X=z,this._localBasisY1Y=Z,this._localBasisY1Z=M,I=R._rotation00*s+R._rotation10*a+R._rotation20*n,V=R._rotation01*s+R._rotation11*a+R._rotation21*n,L=R._rotation02*s+R._rotation12*a+R._rotation22*n,this._localBasisZ1X=I,this._localBasisZ1Y=V,this._localBasisZ1Z=L,w=q._rotation00*l+q._rotation10*h+q._rotation20*c,k=q._rotation01*l+q._rotation11*h+q._rotation21*c,B=q._rotation02*l+q._rotation12*h+q._rotation22*c,this._localBasisX2X=w,this._localBasisX2Y=k,this._localBasisX2Z=B,A=q._rotation00*e+q._rotation10*r+q._rotation20*_,P=q._rotation01*e+q._rotation11*r+q._rotation21*_,S=q._rotation02*e+q._rotation12*r+q._rotation22*_,this._localBasisY2X=A,this._localBasisY2Y=P,this._localBasisY2Z=S,T=q._rotation00*m+q._rotation10*b+q._rotation20*x,C=q._rotation01*m+q._rotation11*b+q._rotation21*x,j=q._rotation02*m+q._rotation12*b+q._rotation22*x,this._localBasisZ2X=T,this._localBasisZ2Y=C,this._localBasisZ2Z=j}buildLocalBasesFromXY1X2(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){let t,i=this._localBasisX1X,o=this._localBasisX1Y,s=this._localBasisX1Z,a=i*i,n=o*o,e=s*s;a<n?a<e?(t=1/Math.sqrt(n+e),this._localBasisY1X=0,this._localBasisY1Y=s*t,this._localBasisY1Z=-o*t):(t=1/Math.sqrt(a+n),this._localBasisY1X=o*t,this._localBasisY1Y=-i*t,this._localBasisY1Z=0):n<e?(t=1/Math.sqrt(e+a),this._localBasisY1X=-s*t,this._localBasisY1Y=0,this._localBasisY1Z=i*t):(t=1/Math.sqrt(a+n),this._localBasisY1X=o*t,this._localBasisY1Y=-i*t,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{let t=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisZ1X*=t,this._localBasisZ1Y*=t,this._localBasisZ1Z*=t,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}let t,i,o,s,a,n,e,r,_,l,h,c,m,b=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(b<-.999999999){let a,n,e,r,_=this._localBasisX1X,l=this._localBasisX1Y,h=this._localBasisX1Z,c=_*_,m=l*l,b=h*h;c<m?c<b?(r=1/Math.sqrt(m+b),a=0,n=h*r,e=-l*r):(r=1/Math.sqrt(c+m),a=l*r,n=-_*r,e=0):m<b?(r=1/Math.sqrt(b+c),a=-h*r,n=0,e=_*r):(r=1/Math.sqrt(c+m),a=l*r,n=-_*r,e=0),t=a,i=n,o=e,s=0}else{let a,n,e;a=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,n=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,e=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;let r=Math.sqrt(.5*(1+b));b=.5/r,a*=b,n*=b,e*=b,t=a,i=n,o=e,s=r}let x,p,f,u,v,X,y,g,d,Y=2*t,z=2*i,Z=2*o,M=t*Y,I=i*z,V=o*Z,L=t*z,w=i*Z,k=t*Z,B=s*Y,A=s*z,P=s*Z;a=1-I-V,n=L-P,e=k+A,r=L+P,_=1-M-V,l=w-B,h=k-A,c=w+B,m=1-M-I,x=a*this._localBasisX1X+n*this._localBasisX1Y+e*this._localBasisX1Z,p=r*this._localBasisX1X+_*this._localBasisX1Y+l*this._localBasisX1Z,f=h*this._localBasisX1X+c*this._localBasisX1Y+m*this._localBasisX1Z,this._localBasisX2X=x,this._localBasisX2Y=p,this._localBasisX2Z=f,u=a*this._localBasisY1X+n*this._localBasisY1Y+e*this._localBasisY1Z,v=r*this._localBasisY1X+_*this._localBasisY1Y+l*this._localBasisY1Z,X=h*this._localBasisY1X+c*this._localBasisY1Y+m*this._localBasisY1Z,this._localBasisY2X=u,this._localBasisY2Y=v,this._localBasisY2Z=X,y=a*this._localBasisZ1X+n*this._localBasisZ1Y+e*this._localBasisZ1Z,g=r*this._localBasisZ1X+_*this._localBasisZ1Y+l*this._localBasisZ1Z,d=h*this._localBasisZ1X+c*this._localBasisZ1Y+m*this._localBasisZ1Z,this._localBasisZ2X=y,this._localBasisZ2Y=g,this._localBasisZ2Z=d}setSolverInfoRowLinear(t,i,o,s,a,n,e){let r,_,l=oimo.common.Setting.linearSlop;if(e)r=0,_=1;else{if(a.frequency>0){l=0;let t=6.28318530717958*a.frequency,i=a.dampingRatio;i<oimo.common.Setting.minSpringDamperDampingRatio&&(i=oimo.common.Setting.minSpringDamperDampingRatio);let o=n.dt,s=2*i*t,e=t*t;a.useSymplecticEuler?(r=1/(o*s),_=e/s):(r=1/(o*(o*e+s)),_=e/(o*e+s))}else r=0,_=this.getErp(n,!1);o.motorForce>0?(t.motorSpeed=o.motorSpeed,t.motorMaxImpulse=o.motorForce*n.dt):(t.motorSpeed=0,t.motorMaxImpulse=0)}let h,c,m,b=o.lowerLimit,x=o.upperLimit;b>x?(h=0,c=0,m=0):b==x?(h=-Infinity,c=Infinity,m=i-b):i<b?(h=-Infinity,c=0,m=i-b+l,m>0&&(m=0)):i>x?(h=0,c=Infinity,m=i-x-l,m<0&&(m=0)):(h=0,c=0,m=0),t.minImpulse=h,t.maxImpulse=c,t.cfm=r*(0==s?0:1/s),t.rhs=m*_}setSolverInfoRowAngular(t,i,o,s,a,n,e){let r,_,l=oimo.common.Setting.angularSlop;if(e)r=0,_=1;else{if(a.frequency>0){l=0;let t=6.28318530717958*a.frequency,i=a.dampingRatio;i<oimo.common.Setting.minSpringDamperDampingRatio&&(i=oimo.common.Setting.minSpringDamperDampingRatio);let o=n.dt,s=2*i*t,e=t*t;a.useSymplecticEuler?(r=1/(o*s),_=e/s):(r=1/(o*(o*e+s)),_=e/(o*e+s))}else r=0,_=this.getErp(n,!1);o.motorTorque>0?(t.motorSpeed=o.motorSpeed,t.motorMaxImpulse=o.motorTorque*n.dt):(t.motorSpeed=0,t.motorMaxImpulse=0)}let h,c,m,b=o.lowerLimit,x=o.upperLimit,p=.5*(b+x);i=((3.14159265358979+(i-=p))%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,i+=p,b>x?(h=0,c=0,m=0):b==x?(h=-Infinity,c=Infinity,m=i-b):i<b?(h=-Infinity,c=0,m=i-b+l,m>0&&(m=0)):i>x?(h=0,c=Infinity,m=i-x-l,m<0&&(m=0)):(h=0,c=0,m=0),t.minImpulse=h,t.maxImpulse=c,t.cfm=r*(0==s?0:1/s),t.rhs=m*_}getErp(t,i){return i?1:this._positionCorrectionAlgorithm==oimo.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?t.invDt*oimo.common.Setting.velocityBaumgarte:0}computeEffectiveInertiaMoment(t,i,o){let s,a,n,e,r,_,l,h,c,m,b,x;l=this._b1._invInertia00*t+this._b1._invInertia01*i+this._b1._invInertia02*o,h=this._b1._invInertia10*t+this._b1._invInertia11*i+this._b1._invInertia12*o,c=this._b1._invInertia20*t+this._b1._invInertia21*i+this._b1._invInertia22*o,s=l,a=h,n=c,m=this._b2._invInertia00*t+this._b2._invInertia01*i+this._b2._invInertia02*o,b=this._b2._invInertia10*t+this._b2._invInertia11*i+this._b2._invInertia12*o,x=this._b2._invInertia20*t+this._b2._invInertia21*i+this._b2._invInertia22*o,e=m,r=b,_=x;let p=s*t+a*i+n*o,f=e*t+r*i+_*o;if(p>0){let s=t*this._relativeAnchor1X+i*this._relativeAnchor1Y+o*this._relativeAnchor1Z,a=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z-s*s;a>0&&(p=this._b1._invMass>0?1/(1/p+this._b1._mass*a):0)}if(f>0){let s=t*this._relativeAnchor2X+i*this._relativeAnchor2Y+o*this._relativeAnchor2Z,a=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z-s*s;a>0&&(f=this._b2._invMass>0?1/(1/f+this._b2._mass*a):0)}return p+f==0?0:1/(p+f)}computeEffectiveInertiaMoment2(t,i,o,s,a,n){let e,r,_,l,h,c,m,b,x,p,f,u;m=this._b1._invInertia00*t+this._b1._invInertia01*i+this._b1._invInertia02*o,b=this._b1._invInertia10*t+this._b1._invInertia11*i+this._b1._invInertia12*o,x=this._b1._invInertia20*t+this._b1._invInertia21*i+this._b1._invInertia22*o,e=m,r=b,_=x,p=this._b2._invInertia00*s+this._b2._invInertia01*a+this._b2._invInertia02*n,f=this._b2._invInertia10*s+this._b2._invInertia11*a+this._b2._invInertia12*n,u=this._b2._invInertia20*s+this._b2._invInertia21*a+this._b2._invInertia22*n,l=p,h=f,c=u;let v=e*t+r*i+_*o,X=l*s+h*a+c*n;if(v>0){let s=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,a=t*this._relativeAnchor1X+i*this._relativeAnchor1Y+o*this._relativeAnchor1Z,n=s*s-a*a;n>0&&(v=this._b1._invMass>0?1/(1/v+this._b1._mass*n):0)}if(X>0){let t=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,i=s*this._relativeAnchor2X+a*this._relativeAnchor2Y+n*this._relativeAnchor2Z,o=t*t-i*i;o>0&&(X=this._b2._invMass>0?1/(1/X+this._b2._mass*o):0)}return v+X==0?0:1/(v+X)}_syncAnchors(){let t,i,o,s,a,n,e,r,_,l,h,c,m,b,x,p,f,u,v,X,y,g,d,Y,z=this._b1._transform,Z=this._b2._transform;t=z._rotation00*this._localAnchor1X+z._rotation01*this._localAnchor1Y+z._rotation02*this._localAnchor1Z,i=z._rotation10*this._localAnchor1X+z._rotation11*this._localAnchor1Y+z._rotation12*this._localAnchor1Z,o=z._rotation20*this._localAnchor1X+z._rotation21*this._localAnchor1Y+z._rotation22*this._localAnchor1Z,this._relativeAnchor1X=t,this._relativeAnchor1Y=i,this._relativeAnchor1Z=o,s=Z._rotation00*this._localAnchor2X+Z._rotation01*this._localAnchor2Y+Z._rotation02*this._localAnchor2Z,a=Z._rotation10*this._localAnchor2X+Z._rotation11*this._localAnchor2Y+Z._rotation12*this._localAnchor2Z,n=Z._rotation20*this._localAnchor2X+Z._rotation21*this._localAnchor2Y+Z._rotation22*this._localAnchor2Z,this._relativeAnchor2X=s,this._relativeAnchor2Y=a,this._relativeAnchor2Z=n,this._anchor1X=this._relativeAnchor1X+z._positionX,this._anchor1Y=this._relativeAnchor1Y+z._positionY,this._anchor1Z=this._relativeAnchor1Z+z._positionZ,this._anchor2X=this._relativeAnchor2X+Z._positionX,this._anchor2Y=this._relativeAnchor2Y+Z._positionY,this._anchor2Z=this._relativeAnchor2Z+Z._positionZ,e=z._rotation00*this._localBasisX1X+z._rotation01*this._localBasisX1Y+z._rotation02*this._localBasisX1Z,r=z._rotation10*this._localBasisX1X+z._rotation11*this._localBasisX1Y+z._rotation12*this._localBasisX1Z,_=z._rotation20*this._localBasisX1X+z._rotation21*this._localBasisX1Y+z._rotation22*this._localBasisX1Z,this._basisX1X=e,this._basisX1Y=r,this._basisX1Z=_,l=z._rotation00*this._localBasisY1X+z._rotation01*this._localBasisY1Y+z._rotation02*this._localBasisY1Z,h=z._rotation10*this._localBasisY1X+z._rotation11*this._localBasisY1Y+z._rotation12*this._localBasisY1Z,c=z._rotation20*this._localBasisY1X+z._rotation21*this._localBasisY1Y+z._rotation22*this._localBasisY1Z,this._basisY1X=l,this._basisY1Y=h,this._basisY1Z=c,m=z._rotation00*this._localBasisZ1X+z._rotation01*this._localBasisZ1Y+z._rotation02*this._localBasisZ1Z,b=z._rotation10*this._localBasisZ1X+z._rotation11*this._localBasisZ1Y+z._rotation12*this._localBasisZ1Z,x=z._rotation20*this._localBasisZ1X+z._rotation21*this._localBasisZ1Y+z._rotation22*this._localBasisZ1Z,this._basisZ1X=m,this._basisZ1Y=b,this._basisZ1Z=x,p=Z._rotation00*this._localBasisX2X+Z._rotation01*this._localBasisX2Y+Z._rotation02*this._localBasisX2Z,f=Z._rotation10*this._localBasisX2X+Z._rotation11*this._localBasisX2Y+Z._rotation12*this._localBasisX2Z,u=Z._rotation20*this._localBasisX2X+Z._rotation21*this._localBasisX2Y+Z._rotation22*this._localBasisX2Z,this._basisX2X=p,this._basisX2Y=f,this._basisX2Z=u,v=Z._rotation00*this._localBasisY2X+Z._rotation01*this._localBasisY2Y+Z._rotation02*this._localBasisY2Z,X=Z._rotation10*this._localBasisY2X+Z._rotation11*this._localBasisY2Y+Z._rotation12*this._localBasisY2Z,y=Z._rotation20*this._localBasisY2X+Z._rotation21*this._localBasisY2Y+Z._rotation22*this._localBasisY2Z,this._basisY2X=v,this._basisY2Y=X,this._basisY2Z=y,g=Z._rotation00*this._localBasisZ2X+Z._rotation01*this._localBasisZ2Y+Z._rotation02*this._localBasisZ2Z,d=Z._rotation10*this._localBasisZ2X+Z._rotation11*this._localBasisZ2Y+Z._rotation12*this._localBasisZ2Z,Y=Z._rotation20*this._localBasisZ2X+Z._rotation21*this._localBasisZ2Y+Z._rotation22*this._localBasisZ2Z,this._basisZ2X=g,this._basisZ2Y=d,this._basisZ2Z=Y}_getVelocitySolverInfo(t,i){i.b1=this._b1,i.b2=this._b2,i.numRows=0}_getPositionSolverInfo(t){t.b1=this._b1,t.b2=this._b2,t.numRows=0}_checkDestruction(){let t=this._appliedTorqueX*this._appliedTorqueX+this._appliedTorqueY*this._appliedTorqueY+this._appliedTorqueZ*this._appliedTorqueZ;(this._breakForce>0&&this._appliedForceX*this._appliedForceX+this._appliedForceY*this._appliedForceY+this._appliedForceZ*this._appliedForceZ>this._breakForce*this._breakForce||this._breakTorque>0&&t>this._breakTorque*this._breakTorque)&&this._world.removeJoint(this)}getRigidBody1(){return this._b1}getRigidBody2(){return this._b2}getType(){return this._type}getAnchor1(){let t=new oimo.common.Vec3;return t.x=this._anchor1X,t.y=this._anchor1Y,t.z=this._anchor1Z,t}getAnchor2(){let t=new oimo.common.Vec3;return t.x=this._anchor2X,t.y=this._anchor2Y,t.z=this._anchor2Z,t}getAnchor1To(t){t.x=this._anchor1X,t.y=this._anchor1Y,t.z=this._anchor1Z}getAnchor2To(t){t.x=this._anchor2X,t.y=this._anchor2Y,t.z=this._anchor2Z}getLocalAnchor1(){let t=new oimo.common.Vec3;return t.x=this._localAnchor1X,t.y=this._localAnchor1Y,t.z=this._localAnchor1Z,t}getLocalAnchor2(){let t=new oimo.common.Vec3;return t.x=this._localAnchor2X,t.y=this._localAnchor2Y,t.z=this._localAnchor2Z,t}getLocalAnchor1To(t){t.x=this._localAnchor1X,t.y=this._localAnchor1Y,t.z=this._localAnchor1Z}getLocalAnchor2To(t){t.x=this._localAnchor2X,t.y=this._localAnchor2Y,t.z=this._localAnchor2Z}getBasis1(){let t,i,o,s,a,n,e,r,_,l=new oimo.common.Mat3;return t=this._basisX1X,i=this._basisY1X,o=this._basisZ1X,s=this._basisX1Y,a=this._basisY1Y,n=this._basisZ1Y,e=this._basisX1Z,r=this._basisY1Z,_=this._basisZ1Z,l.e00=t,l.e01=i,l.e02=o,l.e10=s,l.e11=a,l.e12=n,l.e20=e,l.e21=r,l.e22=_,l}getBasis2(){let t,i,o,s,a,n,e,r,_,l=new oimo.common.Mat3;return t=this._basisX2X,i=this._basisY2X,o=this._basisZ2X,s=this._basisX2Y,a=this._basisY2Y,n=this._basisZ2Y,e=this._basisX2Z,r=this._basisY2Z,_=this._basisZ2Z,l.e00=t,l.e01=i,l.e02=o,l.e10=s,l.e11=a,l.e12=n,l.e20=e,l.e21=r,l.e22=_,l}getBasis1To(t){let i,o,s,a,n,e,r,_,l;i=this._basisX1X,o=this._basisY1X,s=this._basisZ1X,a=this._basisX1Y,n=this._basisY1Y,e=this._basisZ1Y,r=this._basisX1Z,_=this._basisY1Z,l=this._basisZ1Z,t.e00=i,t.e01=o,t.e02=s,t.e10=a,t.e11=n,t.e12=e,t.e20=r,t.e21=_,t.e22=l}getBasis2To(t){let i,o,s,a,n,e,r,_,l;i=this._basisX2X,o=this._basisY2X,s=this._basisZ2X,a=this._basisX2Y,n=this._basisY2Y,e=this._basisZ2Y,r=this._basisX2Z,_=this._basisY2Z,l=this._basisZ2Z,t.e00=i,t.e01=o,t.e02=s,t.e10=a,t.e11=n,t.e12=e,t.e20=r,t.e21=_,t.e22=l}getAllowCollision(){return this._allowCollision}setAllowCollision(t){this._allowCollision=t}getBreakForce(){return this._breakForce}setBreakForce(t){this._breakForce=t}getBreakTorque(){return this._breakTorque}setBreakTorque(t){this._breakTorque=t}getPositionCorrectionAlgorithm(){return this._positionCorrectionAlgorithm}setPositionCorrectionAlgorithm(t){switch(t){case 0:case 1:case 2:break;default:throw new Error("invalid position correction algorithm id: "+t)}this._positionCorrectionAlgorithm=t}getAppliedForce(){let t=new oimo.common.Vec3;return t.x=this._appliedForceX,t.y=this._appliedForceY,t.z=this._appliedForceZ,t}getAppliedForceTo(t){t.x=this._appliedForceX,t.y=this._appliedForceY,t.z=this._appliedForceZ}getAppliedTorque(){let t=new oimo.common.Vec3;return t.x=this._appliedTorqueX,t.y=this._appliedTorqueY,t.z=this._appliedTorqueZ,t}getAppliedTorqueTo(t){t.x=this._appliedTorqueX,t.y=this._appliedTorqueY,t.z=this._appliedTorqueZ}getPrev(){return this._prev}getNext(){return this._next}},oimo.dynamics.constraint.joint.CylindricalJoint=class extends oimo.dynamics.constraint.joint.Joint{constructor(t){super(t,2);let i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let o=t.localAxis2;this._localBasisX2X=o.x,this._localBasisX2Y=o.y,this._localBasisX2Z=o.z,this.buildLocalBasesFromX(),this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this._basis=new oimo.dynamics.constraint.joint.BasisTracker(this),this._translSd=t.translationalSpringDamper.clone(),this._translLm=t.translationalLimitMotor.clone(),this._rotSd=t.rotationalSpringDamper.clone(),this._rotLm=t.rotationalLimitMotor.clone()}getInfo(t,i,o){let s,a=this.getErp(i,o),n=this.linearErrorY*a,e=this.linearErrorZ*a,r=this.angularErrorY*a,_=this.angularErrorZ*a,l=1/(this._b1._invMass+this._b2._invMass),h=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ);if(this._translSd.frequency<=0||!o){let a=this._impulses[0],n=t.rows[t.numRows++],e=n.jacobian;e.lin1X=0,e.lin1Y=0,e.lin1Z=0,e.lin2X=0,e.lin2Y=0,e.lin2Z=0,e.ang1X=0,e.ang1Y=0,e.ang1Z=0,e.ang2X=0,e.ang2Y=0,e.ang2Z=0,n.rhs=0,n.cfm=0,n.minImpulse=0,n.maxImpulse=0,n.motorSpeed=0,n.motorMaxImpulse=0,n.impulse=null,n.impulse=a,this.setSolverInfoRowLinear(n,this.translation,this._translLm,l,this._translSd,i,o),s=n.jacobian,s.lin1X=this._basis.xX,s.lin1Y=this._basis.xY,s.lin1Z=this._basis.xZ,s.lin2X=this._basis.xX,s.lin2Y=this._basis.xY,s.lin2Z=this._basis.xZ,s.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,s.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,s.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,s.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,s.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,s.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}let c=this._impulses[1],m=t.rows[t.numRows++],b=m.jacobian;b.lin1X=0,b.lin1Y=0,b.lin1Z=0,b.lin2X=0,b.lin2Y=0,b.lin2Z=0,b.ang1X=0,b.ang1Y=0,b.ang1Z=0,b.ang2X=0,b.ang2Y=0,b.ang2Z=0,m.rhs=0,m.cfm=0,m.minImpulse=0,m.maxImpulse=0,m.motorSpeed=0,m.motorMaxImpulse=0,m.impulse=null,m.impulse=c,m.rhs=n,m.cfm=0,m.minImpulse=-Infinity,m.maxImpulse=Infinity,s=m.jacobian,s.lin1X=this._basis.yX,s.lin1Y=this._basis.yY,s.lin1Z=this._basis.yZ,s.lin2X=this._basis.yX,s.lin2Y=this._basis.yY,s.lin2Z=this._basis.yZ,s.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,s.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,s.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,s.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,s.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,s.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;let x=this._impulses[2],p=t.rows[t.numRows++],f=p.jacobian;if(f.lin1X=0,f.lin1Y=0,f.lin1Z=0,f.lin2X=0,f.lin2Y=0,f.lin2Z=0,f.ang1X=0,f.ang1Y=0,f.ang1Z=0,f.ang2X=0,f.ang2Y=0,f.ang2Z=0,p.rhs=0,p.cfm=0,p.minImpulse=0,p.maxImpulse=0,p.motorSpeed=0,p.motorMaxImpulse=0,p.impulse=null,p.impulse=x,p.rhs=e,p.cfm=0,p.minImpulse=-Infinity,p.maxImpulse=Infinity,s=p.jacobian,s.lin1X=this._basis.zX,s.lin1Y=this._basis.zY,s.lin1Z=this._basis.zZ,s.lin2X=this._basis.zX,s.lin2Y=this._basis.zY,s.lin2Z=this._basis.zZ,s.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,s.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,s.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,s.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,s.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,s.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX,this._rotSd.frequency<=0||!o){let a=this._impulses[3],n=t.rows[t.numRows++],e=n.jacobian;e.lin1X=0,e.lin1Y=0,e.lin1Z=0,e.lin2X=0,e.lin2Y=0,e.lin2Z=0,e.ang1X=0,e.ang1Y=0,e.ang1Z=0,e.ang2X=0,e.ang2Y=0,e.ang2Z=0,n.rhs=0,n.cfm=0,n.minImpulse=0,n.maxImpulse=0,n.motorSpeed=0,n.motorMaxImpulse=0,n.impulse=null,n.impulse=a,this.setSolverInfoRowAngular(n,this.angle,this._rotLm,h,this._rotSd,i,o),s=n.jacobian,s.ang1X=this._basis.xX,s.ang1Y=this._basis.xY,s.ang1Z=this._basis.xZ,s.ang2X=this._basis.xX,s.ang2Y=this._basis.xY,s.ang2Z=this._basis.xZ}let u=this._impulses[4],v=t.rows[t.numRows++],X=v.jacobian;X.lin1X=0,X.lin1Y=0,X.lin1Z=0,X.lin2X=0,X.lin2Y=0,X.lin2Z=0,X.ang1X=0,X.ang1Y=0,X.ang1Z=0,X.ang2X=0,X.ang2Y=0,X.ang2Z=0,v.rhs=0,v.cfm=0,v.minImpulse=0,v.maxImpulse=0,v.motorSpeed=0,v.motorMaxImpulse=0,v.impulse=null,v.impulse=u,v.rhs=r,v.cfm=0,v.minImpulse=-Infinity,v.maxImpulse=Infinity,s=v.jacobian,s.ang1X=this._basis.yX,s.ang1Y=this._basis.yY,s.ang1Z=this._basis.yZ,s.ang2X=this._basis.yX,s.ang2Y=this._basis.yY,s.ang2Z=this._basis.yZ;let y=this._impulses[5],g=t.rows[t.numRows++],d=g.jacobian;d.lin1X=0,d.lin1Y=0,d.lin1Z=0,d.lin2X=0,d.lin2Y=0,d.lin2Z=0,d.ang1X=0,d.ang1Y=0,d.ang1Z=0,d.ang2X=0,d.ang2Y=0,d.ang2Z=0,g.rhs=0,g.cfm=0,g.minImpulse=0,g.maxImpulse=0,g.motorSpeed=0,g.motorMaxImpulse=0,g.impulse=null,g.impulse=y,g.rhs=_,g.cfm=0,g.minImpulse=-Infinity,g.maxImpulse=Infinity,s=g.jacobian,s.ang1X=this._basis.zX,s.ang1Y=this._basis.zY,s.ang1Z=this._basis.zZ,s.ang2X=this._basis.zX,s.ang2Y=this._basis.zY,s.ang2Z=this._basis.zZ}_syncAnchors(){super._syncAnchors();let t,i,o,s,a,n,e,r,_,l,h,c,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A,P,S,T,C,j,R,q,E,D,F,N=this._basis,W=N.joint._b1._invMass,G=N.joint._b2._invMass,J=N.joint._basisX1X*N.joint._basisX2X+N.joint._basisX1Y*N.joint._basisX2Y+N.joint._basisX1Z*N.joint._basisX2Z;if(J<-.999999999){let a,n,e,r,_=N.joint._basisX1X,l=N.joint._basisX1Y,h=N.joint._basisX1Z,c=_*_,m=l*l,b=h*h;c<m?c<b?(r=1/Math.sqrt(m+b),a=0,n=h*r,e=-l*r):(r=1/Math.sqrt(c+m),a=l*r,n=-_*r,e=0):m<b?(r=1/Math.sqrt(b+c),a=-h*r,n=0,e=_*r):(r=1/Math.sqrt(c+m),a=l*r,n=-_*r,e=0),t=a,i=n,o=e,s=0}else{let a,n,e;a=N.joint._basisX1Y*N.joint._basisX2Z-N.joint._basisX1Z*N.joint._basisX2Y,n=N.joint._basisX1Z*N.joint._basisX2X-N.joint._basisX1X*N.joint._basisX2Z,e=N.joint._basisX1X*N.joint._basisX2Y-N.joint._basisX1Y*N.joint._basisX2X;let r=Math.sqrt(.5*(1+J));J=.5/r,a*=J,n*=J,e*=J,t=a,i=n,o=e,s=r}a=0,n=0,e=0,r=1,T=0,C=0,j=0,R=1,q=t,E=i,D=o,F=s;let O=T*q+C*E+j*D+R*F;if(O<0&&(O=-O,q=-q,E=-E,D=-D,F=-F),O>.999999){let t,i,o,s;t=q-T,i=E-C,o=D-j,s=F-R,q=T+t*(W/(W+G)),E=C+i*(W/(W+G)),D=j+o*(W/(W+G)),F=R+s*(W/(W+G));let a=q*q+E*E+D*D+F*F;a>1e-32&&(a=1/Math.sqrt(a)),_=q*a,l=E*a,h=D*a,c=F*a}else{let t=W/(W+G)*Math.acos(O);q+=T*-O,E+=C*-O,D+=j*-O,F+=R*-O;let i=q*q+E*E+D*D+F*F;i>1e-32&&(i=1/Math.sqrt(i)),q*=i,E*=i,D*=i,F*=i;let o=Math.sin(t),s=Math.cos(t);T*=s,C*=s,j*=s,R*=s,_=T+q*o,l=C+E*o,h=j+D*o,c=R+F*o}let H,U,Q,K=2*_,$=2*l,tt=2*h,it=_*K,ot=l*$,st=h*tt,at=_*$,nt=l*tt,et=_*tt,rt=c*K,_t=c*$,lt=c*tt;m=1-ot-st,b=at-lt,x=et+_t,p=at+lt,f=1-it-st,u=nt-rt,v=et-_t,X=nt+rt,y=1-it-ot,H=m*N.joint._basisX1X+b*N.joint._basisX1Y+x*N.joint._basisX1Z,U=p*N.joint._basisX1X+f*N.joint._basisX1Y+u*N.joint._basisX1Z,Q=v*N.joint._basisX1X+X*N.joint._basisX1Y+y*N.joint._basisX1Z,g=H,d=U,Y=Q,w=N.xX,k=N.xY,B=N.xZ,A=N.yX,P=N.yY,S=N.yZ;let ht=w*g+k*d+B*Y;if(ht<-.999999999){let t,i,o,s,a=w,n=k,e=B,r=a*a,m=n*n,b=e*e;r<m?r<b?(s=1/Math.sqrt(m+b),t=0,i=e*s,o=-n*s):(s=1/Math.sqrt(r+m),t=n*s,i=-a*s,o=0):m<b?(s=1/Math.sqrt(b+r),t=-e*s,i=0,o=a*s):(s=1/Math.sqrt(r+m),t=n*s,i=-a*s,o=0),_=t,l=i,h=o,c=0}else{let t,i,o;t=k*Y-B*d,i=B*g-w*Y,o=w*d-k*g;let s=Math.sqrt(.5*(1+ht));ht=.5/s,t*=ht,i*=ht,o*=ht,_=t,l=i,h=o,c=s}let ct,mt,bt,xt,pt,ft,ut=2*_,vt=2*l,Xt=2*h,yt=_*ut,gt=l*vt,dt=h*Xt,Yt=_*vt,zt=l*Xt,Zt=_*Xt,Mt=c*ut,It=c*vt,Vt=c*Xt;if(m=1-gt-dt,b=Yt-Vt,x=Zt+It,p=Yt+Vt,f=1-yt-dt,u=zt-Mt,v=Zt-It,X=zt+Mt,y=1-yt-gt,ct=m*A+b*P+x*S,mt=p*A+f*P+u*S,bt=v*A+X*P+y*S,z=ct,Z=mt,M=bt,I=d*M-Y*Z,V=Y*z-g*M,L=g*Z-d*z,I*I+V*V+L*L>1e-6){let t=I*I+V*V+L*L;t>0&&(t=1/Math.sqrt(t)),I*=t,V*=t,L*=t}else{let t,i=g,o=d,s=Y,a=i*i,n=o*o,e=s*s;a<n?a<e?(t=1/Math.sqrt(n+e),I=0,V=s*t,L=-o*t):(t=1/Math.sqrt(a+n),I=o*t,V=-i*t,L=0):n<e?(t=1/Math.sqrt(e+a),I=-s*t,V=0,L=i*t):(t=1/Math.sqrt(a+n),I=o*t,V=-i*t,L=0)}z=V*Y-L*d,Z=L*g-I*Y,M=I*d-V*g,N.xX=g,N.xY=d,N.xZ=Y,N.yX=z,N.yY=Z,N.yZ=M,N.zX=I,N.zY=V,N.zZ=L,xt=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,pt=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,ft=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;let Lt,wt,kt,Bt,At,Pt,St=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,Tt=St<=-1?3.14159265358979:St>=1?0:Math.acos(St),Ct=xt*xt+pt*pt+ft*ft;Ct>0&&(Ct=1/Math.sqrt(Ct)),xt*=Ct,pt*=Ct,ft*=Ct,xt*=Tt,pt*=Tt,ft*=Tt,this.angularErrorY=xt*this._basis.yX+pt*this._basis.yY+ft*this._basis.yZ,this.angularErrorZ=xt*this._basis.zX+pt*this._basis.zY+ft*this._basis.zZ,Lt=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,wt=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,kt=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,St=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=St<=-1?3.14159265358979:St>=1?0:Math.acos(St),Lt*this._basis.xX+wt*this._basis.xY+kt*this._basis.xZ<0&&(this.angle=-this.angle),Bt=this._anchor2X-this._anchor1X,At=this._anchor2Y-this._anchor1Y,Pt=this._anchor2Z-this._anchor1Z,this.translation=Bt*this._basis.xX+At*this._basis.xY+Pt*this._basis.xZ,this.linearErrorY=Bt*this._basis.yX+At*this._basis.yY+Pt*this._basis.yZ,this.linearErrorZ=Bt*this._basis.zX+At*this._basis.zY+Pt*this._basis.zZ}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new oimo.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new oimo.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new oimo.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new oimo.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getTranslationalSpringDamper(){return this._translSd}getRotationalSpringDamper(){return this._rotSd}getTranslationalLimitMotor(){return this._translLm}getRotationalLimitMotor(){return this._rotLm}getAngle(){return this.angle}getTranslation(){return this.translation}},oimo.dynamics.constraint.joint.JointConfig=class{constructor(){this.rigidBody1=null,this.rigidBody2=null,this.localAnchor1=new oimo.common.Vec3,this.localAnchor2=new oimo.common.Vec3,this.allowCollision=!1,this.solverType=oimo.common.Setting.defaultJointConstraintSolverType,this.positionCorrectionAlgorithm=oimo.common.Setting.defaultJointPositionCorrectionAlgorithm,this.breakForce=0,this.breakTorque=0}_init(t,i,o){this.rigidBody1=t,this.rigidBody2=i;let s,a,n,e,r,_,l=this.rigidBody1,h=this.localAnchor1;s=o.x,a=o.y,n=o.z,s-=l._transform._positionX,a-=l._transform._positionY,n-=l._transform._positionZ,e=l._transform._rotation00*s+l._transform._rotation10*a+l._transform._rotation20*n,r=l._transform._rotation01*s+l._transform._rotation11*a+l._transform._rotation21*n,_=l._transform._rotation02*s+l._transform._rotation12*a+l._transform._rotation22*n,s=e,a=r,n=_,h.x=s,h.y=a,h.z=n;let c,m,b,x,p,f,u=this.rigidBody2,v=this.localAnchor2;c=o.x,m=o.y,b=o.z,c-=u._transform._positionX,m-=u._transform._positionY,b-=u._transform._positionZ,x=u._transform._rotation00*c+u._transform._rotation10*m+u._transform._rotation20*b,p=u._transform._rotation01*c+u._transform._rotation11*m+u._transform._rotation21*b,f=u._transform._rotation02*c+u._transform._rotation12*m+u._transform._rotation22*b,c=x,m=p,b=f,v.x=c,v.y=m,v.z=b}},oimo.dynamics.constraint.joint.CylindricalJointConfig=class extends oimo.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new oimo.common.Vec3(1,0,0),this.localAxis2=new oimo.common.Vec3(1,0,0),this.translationalLimitMotor=new oimo.dynamics.constraint.joint.TranslationalLimitMotor,this.translationalSpringDamper=new oimo.dynamics.constraint.joint.SpringDamper,this.rotationalLimitMotor=new oimo.dynamics.constraint.joint.RotationalLimitMotor,this.rotationalSpringDamper=new oimo.dynamics.constraint.joint.SpringDamper}init(t,i,o,s){this._init(t,i,o);let a,n,e,r,_,l,h=this.localAxis1;a=s.x,n=s.y,e=s.z,r=t._transform._rotation00*a+t._transform._rotation10*n+t._transform._rotation20*e,_=t._transform._rotation01*a+t._transform._rotation11*n+t._transform._rotation21*e,l=t._transform._rotation02*a+t._transform._rotation12*n+t._transform._rotation22*e,a=r,n=_,e=l,h.x=a,h.y=n,h.z=e;let c,m,b,x,p,f,u=this.localAxis2;return c=s.x,m=s.y,b=s.z,x=i._transform._rotation00*c+i._transform._rotation10*m+i._transform._rotation20*b,p=i._transform._rotation01*c+i._transform._rotation11*m+i._transform._rotation21*b,f=i._transform._rotation02*c+i._transform._rotation12*m+i._transform._rotation22*b,c=x,m=p,b=f,u.x=c,u.y=m,u.z=b,this}},oimo.dynamics.constraint.joint.GenericJoint=class extends oimo.dynamics.constraint.joint.Joint{constructor(t){let i;super(t,oimo.dynamics.constraint.joint.JointType.GENERIC);let o,s,a,n,e,r,_,l,h,c,m,b,x,p,f,u,v,X,y=t.localBasis1;if(y.e00*(y.e11*y.e22-y.e12*y.e21)-y.e01*(y.e10*y.e22-y.e12*y.e20)+y.e02*(y.e10*y.e21-y.e11*y.e20)<0)i=!0;else{let o=t.localBasis2;i=o.e00*(o.e11*o.e22-o.e12*o.e21)-o.e01*(o.e10*o.e22-o.e12*o.e20)+o.e02*(o.e10*o.e21-o.e11*o.e20)<0}i&&console.log("src/oimo/dynamics/constraint/joint/GenericJoint.hx:50:","[warning] joint basis must be right handed");let g=t.localBasis1;o=g.e00,s=g.e01,a=g.e02,n=g.e10,e=g.e11,r=g.e12,_=g.e20,l=g.e21,h=g.e22;let d=t.localBasis2;c=d.e00,m=d.e01,b=d.e02,x=d.e10,p=d.e11,f=d.e12,u=d.e20,v=d.e21,X=d.e22,this._localBasisX1X=o,this._localBasisX1Y=n,this._localBasisX1Z=_,this._localBasisY1X=s,this._localBasisY1Y=e,this._localBasisY1Z=l,this._localBasisZ1X=a,this._localBasisZ1Y=r,this._localBasisZ1Z=h,this._localBasisX2X=c,this._localBasisX2Y=x,this._localBasisX2Z=u,this._localBasisY2X=m,this._localBasisY2Y=p,this._localBasisY2Z=v,this._localBasisZ2X=b,this._localBasisZ2Y=f,this._localBasisZ2Z=X,this._angleX=0,this._angleY=0,this._angleZ=0,this.translationX=0,this.translationY=0,this.translationZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1,this._translLms=new Array(3),this._translSds=new Array(3),this._rotLms=new Array(3),this._rotSds=new Array(3),this._translLms[0]=t.translationalLimitMotors[0].clone(),this._translLms[1]=t.translationalLimitMotors[1].clone(),this._translLms[2]=t.translationalLimitMotors[2].clone(),this._translSds[0]=t.translationalSpringDampers[0].clone(),this._translSds[1]=t.translationalSpringDampers[1].clone(),this._translSds[2]=t.translationalSpringDampers[2].clone(),this._rotLms[0]=t.rotationalLimitMotors[0].clone(),this._rotLms[1]=t.rotationalLimitMotors[1].clone(),this._rotLms[2]=t.rotationalLimitMotors[2].clone(),this._rotSds[0]=t.rotationalSpringDampers[0].clone(),this._rotSds[1]=t.rotationalSpringDampers[1].clone(),this._rotSds[2]=t.rotationalSpringDampers[2].clone()}getInfo(t,i,o){let s,a=1/(this._b1._invMass+this._b2._invMass),n=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),e=this.computeEffectiveInertiaMoment(this._axisYX,this._axisYY,this._axisYZ),r=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ);if(this._translSds[0].frequency<=0||!o){let n=this._impulses[0],e=t.rows[t.numRows++],r=e.jacobian;r.lin1X=0,r.lin1Y=0,r.lin1Z=0,r.lin2X=0,r.lin2Y=0,r.lin2Z=0,r.ang1X=0,r.ang1Y=0,r.ang1Z=0,r.ang2X=0,r.ang2Y=0,r.ang2Z=0,e.rhs=0,e.cfm=0,e.minImpulse=0,e.maxImpulse=0,e.motorSpeed=0,e.motorMaxImpulse=0,e.impulse=null,e.impulse=n,this.setSolverInfoRowLinear(e,this.translationX,this._translLms[0],a,this._translSds[0],i,o),s=e.jacobian,s.lin1X=this._basisX1X,s.lin1Y=this._basisX1Y,s.lin1Z=this._basisX1Z,s.lin2X=this._basisX1X,s.lin2Y=this._basisX1Y,s.lin2Z=this._basisX1Z,s.ang1X=this._relativeAnchor1Y*this._basisX1Z-this._relativeAnchor1Z*this._basisX1Y,s.ang1Y=this._relativeAnchor1Z*this._basisX1X-this._relativeAnchor1X*this._basisX1Z,s.ang1Z=this._relativeAnchor1X*this._basisX1Y-this._relativeAnchor1Y*this._basisX1X,s.ang2X=this._relativeAnchor2Y*this._basisX1Z-this._relativeAnchor2Z*this._basisX1Y,s.ang2Y=this._relativeAnchor2Z*this._basisX1X-this._relativeAnchor2X*this._basisX1Z,s.ang2Z=this._relativeAnchor2X*this._basisX1Y-this._relativeAnchor2Y*this._basisX1X}if(this._translSds[1].frequency<=0||!o){let n=this._impulses[1],e=t.rows[t.numRows++],r=e.jacobian;r.lin1X=0,r.lin1Y=0,r.lin1Z=0,r.lin2X=0,r.lin2Y=0,r.lin2Z=0,r.ang1X=0,r.ang1Y=0,r.ang1Z=0,r.ang2X=0,r.ang2Y=0,r.ang2Z=0,e.rhs=0,e.cfm=0,e.minImpulse=0,e.maxImpulse=0,e.motorSpeed=0,e.motorMaxImpulse=0,e.impulse=null,e.impulse=n,this.setSolverInfoRowLinear(e,this.translationY,this._translLms[1],a,this._translSds[1],i,o),s=e.jacobian,s.lin1X=this._basisY1X,s.lin1Y=this._basisY1Y,s.lin1Z=this._basisY1Z,s.lin2X=this._basisY1X,s.lin2Y=this._basisY1Y,s.lin2Z=this._basisY1Z,s.ang1X=this._relativeAnchor1Y*this._basisY1Z-this._relativeAnchor1Z*this._basisY1Y,s.ang1Y=this._relativeAnchor1Z*this._basisY1X-this._relativeAnchor1X*this._basisY1Z,s.ang1Z=this._relativeAnchor1X*this._basisY1Y-this._relativeAnchor1Y*this._basisY1X,s.ang2X=this._relativeAnchor2Y*this._basisY1Z-this._relativeAnchor2Z*this._basisY1Y,s.ang2Y=this._relativeAnchor2Z*this._basisY1X-this._relativeAnchor2X*this._basisY1Z,s.ang2Z=this._relativeAnchor2X*this._basisY1Y-this._relativeAnchor2Y*this._basisY1X}if(this._translSds[2].frequency<=0||!o){let n=this._impulses[2],e=t.rows[t.numRows++],r=e.jacobian;r.lin1X=0,r.lin1Y=0,r.lin1Z=0,r.lin2X=0,r.lin2Y=0,r.lin2Z=0,r.ang1X=0,r.ang1Y=0,r.ang1Z=0,r.ang2X=0,r.ang2Y=0,r.ang2Z=0,e.rhs=0,e.cfm=0,e.minImpulse=0,e.maxImpulse=0,e.motorSpeed=0,e.motorMaxImpulse=0,e.impulse=null,e.impulse=n,this.setSolverInfoRowLinear(e,this.translationZ,this._translLms[2],a,this._translSds[2],i,o),s=e.jacobian,s.lin1X=this._basisZ1X,s.lin1Y=this._basisZ1Y,s.lin1Z=this._basisZ1Z,s.lin2X=this._basisZ1X,s.lin2Y=this._basisZ1Y,s.lin2Z=this._basisZ1Z,s.ang1X=this._relativeAnchor1Y*this._basisZ1Z-this._relativeAnchor1Z*this._basisZ1Y,s.ang1Y=this._relativeAnchor1Z*this._basisZ1X-this._relativeAnchor1X*this._basisZ1Z,s.ang1Z=this._relativeAnchor1X*this._basisZ1Y-this._relativeAnchor1Y*this._basisZ1X,s.ang2X=this._relativeAnchor2Y*this._basisZ1Z-this._relativeAnchor2Z*this._basisZ1Y,s.ang2Y=this._relativeAnchor2Z*this._basisZ1X-this._relativeAnchor2X*this._basisZ1Z,s.ang2Z=this._relativeAnchor2X*this._basisZ1Y-this._relativeAnchor2Y*this._basisZ1X}if(!this.xSingular&&(this._rotSds[0].frequency<=0||!o)){let a=this._impulses[3],e=t.rows[t.numRows++],r=e.jacobian;r.lin1X=0,r.lin1Y=0,r.lin1Z=0,r.lin2X=0,r.lin2Y=0,r.lin2Z=0,r.ang1X=0,r.ang1Y=0,r.ang1Z=0,r.ang2X=0,r.ang2Y=0,r.ang2Z=0,e.rhs=0,e.cfm=0,e.minImpulse=0,e.maxImpulse=0,e.motorSpeed=0,e.motorMaxImpulse=0,e.impulse=null,e.impulse=a,this.setSolverInfoRowAngular(e,this._angleX,this._rotLms[0],n,this._rotSds[0],i,o),s=e.jacobian,s.ang1X=this._axisXX,s.ang1Y=this._axisXY,s.ang1Z=this._axisXZ,s.ang2X=this._axisXX,s.ang2Y=this._axisXY,s.ang2Z=this._axisXZ}if(!this.ySingular&&(this._rotSds[1].frequency<=0||!o)){let a=this._impulses[4],n=t.rows[t.numRows++],r=n.jacobian;r.lin1X=0,r.lin1Y=0,r.lin1Z=0,r.lin2X=0,r.lin2Y=0,r.lin2Z=0,r.ang1X=0,r.ang1Y=0,r.ang1Z=0,r.ang2X=0,r.ang2Y=0,r.ang2Z=0,n.rhs=0,n.cfm=0,n.minImpulse=0,n.maxImpulse=0,n.motorSpeed=0,n.motorMaxImpulse=0,n.impulse=null,n.impulse=a,this.setSolverInfoRowAngular(n,this._angleY,this._rotLms[1],e,this._rotSds[1],i,o),s=n.jacobian,s.ang1X=this._axisYX,s.ang1Y=this._axisYY,s.ang1Z=this._axisYZ,s.ang2X=this._axisYX,s.ang2Y=this._axisYY,s.ang2Z=this._axisYZ}if(!this.zSingular&&(this._rotSds[2].frequency<=0||!o)){let a=this._impulses[5],n=t.rows[t.numRows++],e=n.jacobian;e.lin1X=0,e.lin1Y=0,e.lin1Z=0,e.lin2X=0,e.lin2Y=0,e.lin2Z=0,e.ang1X=0,e.ang1Y=0,e.ang1Z=0,e.ang2X=0,e.ang2Y=0,e.ang2Z=0,n.rhs=0,n.cfm=0,n.minImpulse=0,n.maxImpulse=0,n.motorSpeed=0,n.motorMaxImpulse=0,n.impulse=null,n.impulse=a,this.setSolverInfoRowAngular(n,this._angleZ,this._rotLms[2],r,this._rotSds[2],i,o),s=n.jacobian,s.ang1X=this._axisZX,s.ang1Y=this._axisZY,s.ang1Z=this._axisZZ,s.ang2X=this._axisZX,s.ang2Y=this._axisZY,s.ang2Z=this._axisZZ}}_syncAnchors(){let t,i,o,s,a,n,e,r,_;super._syncAnchors(),t=this._basisX1X,i=this._basisX1Y,o=this._basisX1Z,e=this._basisZ2X,r=this._basisZ2Y,_=this._basisZ2Z,s=r*o-_*i,a=_*t-e*o,n=e*i-r*t,this._axisXX=a*_-n*r,this._axisXY=n*e-s*_,this._axisXZ=s*r-a*e,this._axisYX=s,this._axisYY=a,this._axisYZ=n,this._axisZX=i*n-o*a,this._axisZY=o*s-t*n,this._axisZZ=t*a-i*s;let l=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;l>0&&(l=1/Math.sqrt(l)),this._axisXX*=l,this._axisXY*=l,this._axisXZ*=l;let h=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;h>0&&(h=1/Math.sqrt(h)),this._axisYX*=h,this._axisYY*=h,this._axisYZ*=h;let c,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A,P,S,T,C,j,R,q,E,D,F,N,W,G=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;G>0&&(G=1/Math.sqrt(G)),this._axisZX*=G,this._axisZY*=G,this._axisZZ*=G,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0,c=this._basisX1X,m=this._basisY1X,b=this._basisZ1X,x=this._basisX1Y,p=this._basisY1Y,f=this._basisZ1Y,u=this._basisX1Z,v=this._basisY1Z,X=this._basisZ1Z,y=this._basisX2X,g=this._basisY2X,d=this._basisZ2X,Y=this._basisX2Y,z=this._basisY2Y,Z=this._basisZ2Y,M=this._basisX2Z,I=this._basisY2Z,V=this._basisZ2Z,T=c*y+x*Y+u*M,C=c*g+x*z+u*I,j=c*d+x*Z+u*V,R=m*g+p*z+v*I,q=m*d+p*Z+v*V,E=b*g+f*z+X*I,D=b*d+f*Z+X*V,L=T,w=C,k=j,B=R,A=q,P=E,S=D;let J,O,H,U=k;if(U<=-1){let t=Math.atan2(P,B);F=.5*t,N=-1.570796326794895,W=.5*-t}else if(U>=1){let t=Math.atan2(P,B);F=.5*t,N=1.570796326794895,W=.5*t}else F=Math.atan2(-A,S),N=Math.asin(U),W=Math.atan2(-w,L);this._angleX=F,this._angleY=N,this._angleZ=W,J=this._anchor2X-this._anchor1X,O=this._anchor2Y-this._anchor1Y,H=this._anchor2Z-this._anchor1Z,this.translationX=J*this._basisX1X+O*this._basisX1Y+H*this._basisX1Z,this.translationY=J*this._basisY1X+O*this._basisY1Y+H*this._basisY1Z,this.translationZ=J*this._basisZ1X+O*this._basisZ1Y+H*this._basisZ1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxisX(){let t=new oimo.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxisY(){let t=new oimo.common.Vec3;return t.x=this._axisYX,t.y=this._axisYY,t.z=this._axisYZ,t}getAxisZ(){let t=new oimo.common.Vec3;return t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z,t}getTranslationalSpringDampers(){return this._translSds.slice(0)}getRotationalSpringDampers(){return this._translSds.slice(0)}getTranslationalLimitMotors(){return this._translLms.slice(0)}getRotationalLimitMotors(){return this._rotLms.slice(0)}getAngles(){return new oimo.common.Vec3(this._angleX,this._angleY,this._angleZ)}getTranslations(){return new oimo.common.Vec3(this.translationX,this.translationY,this.translationZ)}},oimo.dynamics.constraint.joint.GenericJointConfig=class extends oimo.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localBasis1=new oimo.common.Mat3,this.localBasis2=new oimo.common.Mat3;let t=[];t.push((new oimo.dynamics.constraint.joint.TranslationalLimitMotor).setLimits(0,0)),t.push((new oimo.dynamics.constraint.joint.TranslationalLimitMotor).setLimits(0,0)),t.push((new oimo.dynamics.constraint.joint.TranslationalLimitMotor).setLimits(0,0)),this.translationalLimitMotors=t;let i=[];i.push((new oimo.dynamics.constraint.joint.RotationalLimitMotor).setLimits(0,0)),i.push((new oimo.dynamics.constraint.joint.RotationalLimitMotor).setLimits(0,0)),i.push((new oimo.dynamics.constraint.joint.RotationalLimitMotor).setLimits(0,0)),this.rotationalLimitMotors=i,this.translationalSpringDampers=[new oimo.dynamics.constraint.joint.SpringDamper,new oimo.dynamics.constraint.joint.SpringDamper,new oimo.dynamics.constraint.joint.SpringDamper],this.rotationalSpringDampers=[new oimo.dynamics.constraint.joint.SpringDamper,new oimo.dynamics.constraint.joint.SpringDamper,new oimo.dynamics.constraint.joint.SpringDamper]}init(t,i,o,s,a){this._init(t,i,o);let n,e,r,_,l,h,c,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A,P,S,T,C,j,R,q,E,D,F,N,W,G,J,O,H,U,Q,K,$,tt,it,ot,st,at,nt=t._transform,et=i._transform;n=s.e00,e=s.e01,r=s.e02,_=s.e10,l=s.e11,h=s.e12,c=s.e20,m=s.e21,b=s.e22,x=a.e00,p=a.e01,f=a.e02,u=a.e10,v=a.e11,X=a.e12,y=a.e20,g=a.e21,d=a.e22,E=nt._rotation00*n+nt._rotation10*_+nt._rotation20*c,D=nt._rotation00*e+nt._rotation10*l+nt._rotation20*m,F=nt._rotation00*r+nt._rotation10*h+nt._rotation20*b,N=nt._rotation01*n+nt._rotation11*_+nt._rotation21*c,W=nt._rotation01*e+nt._rotation11*l+nt._rotation21*m,G=nt._rotation01*r+nt._rotation11*h+nt._rotation21*b,J=nt._rotation02*n+nt._rotation12*_+nt._rotation22*c,O=nt._rotation02*e+nt._rotation12*l+nt._rotation22*m,H=nt._rotation02*r+nt._rotation12*h+nt._rotation22*b,Y=E,z=D,Z=F,M=N,I=W,V=G,L=J,w=O,k=H,U=et._rotation00*x+et._rotation10*u+et._rotation20*y,Q=et._rotation00*p+et._rotation10*v+et._rotation20*g,K=et._rotation00*f+et._rotation10*X+et._rotation20*d,$=et._rotation01*x+et._rotation11*u+et._rotation21*y,tt=et._rotation01*p+et._rotation11*v+et._rotation21*g,it=et._rotation01*f+et._rotation11*X+et._rotation21*d,ot=et._rotation02*x+et._rotation12*u+et._rotation22*y,st=et._rotation02*p+et._rotation12*v+et._rotation22*g,at=et._rotation02*f+et._rotation12*X+et._rotation22*d,B=U,A=Q,P=K,S=$,T=tt,C=it,j=ot,R=st,q=at;let rt=this.localBasis1;rt.e00=Y,rt.e01=z,rt.e02=Z,rt.e10=M,rt.e11=I,rt.e12=V,rt.e20=L,rt.e21=w,rt.e22=k;let _t=this.localBasis2;return _t.e00=B,_t.e01=A,_t.e02=P,_t.e10=S,_t.e11=T,_t.e12=C,_t.e20=j,_t.e21=R,_t.e22=q,this}},oimo.dynamics.constraint.joint.JointImpulse=class{constructor(){this.impulse=0,this.impulseM=0,this.impulseP=0}},oimo.dynamics.constraint.joint.JointLink=class{constructor(t){this._joint=t}getContact(){return this._joint}getOther(){return this._other}getPrev(){return this._prev}getNext(){return this._next}},oimo.dynamics.constraint.joint.JointMacro=class{},oimo.dynamics.constraint.joint.JointType=class{},oimo.dynamics.constraint.joint.PrismaticJoint=class extends oimo.dynamics.constraint.joint.Joint{constructor(t){super(t,oimo.dynamics.constraint.joint.JointType.PRISMATIC);let i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let o=t.localAxis2;this._localBasisX2X=o.x,this._localBasisX2Y=o.y,this._localBasisX2Z=o.z,this.buildLocalBasesFromX(),this._basis=new oimo.dynamics.constraint.joint.BasisTracker(this),this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this.angularErrorX=0,this.angularErrorY=0,this.angularErrorZ=0,this._sd=t.springDamper.clone(),this._lm=t.limitMotor.clone()}getInfo(t,i,o){let s,a=this.getErp(i,o),n=this.linearErrorY*a,e=this.linearErrorZ*a,r=this.angularErrorX*a,_=this.angularErrorY*a,l=this.angularErrorZ*a;if(this._sd.frequency<=0||!o){let a=this._impulses[0],n=t.rows[t.numRows++],e=n.jacobian;e.lin1X=0,e.lin1Y=0,e.lin1Z=0,e.lin2X=0,e.lin2Y=0,e.lin2Z=0,e.ang1X=0,e.ang1Y=0,e.ang1Z=0,e.ang2X=0,e.ang2Y=0,e.ang2Z=0,n.rhs=0,n.cfm=0,n.minImpulse=0,n.maxImpulse=0,n.motorSpeed=0,n.motorMaxImpulse=0,n.impulse=null,n.impulse=a,this.setSolverInfoRowLinear(n,this.translation,this._lm,1/(this._b1._invMass+this._b2._invMass),this._sd,i,o),s=n.jacobian,s.lin1X=this._basis.xX,s.lin1Y=this._basis.xY,s.lin1Z=this._basis.xZ,s.lin2X=this._basis.xX,s.lin2Y=this._basis.xY,s.lin2Z=this._basis.xZ,s.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,s.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,s.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,s.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,s.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,s.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}let h=this._impulses[1],c=t.rows[t.numRows++],m=c.jacobian;m.lin1X=0,m.lin1Y=0,m.lin1Z=0,m.lin2X=0,m.lin2Y=0,m.lin2Z=0,m.ang1X=0,m.ang1Y=0,m.ang1Z=0,m.ang2X=0,m.ang2Y=0,m.ang2Z=0,c.rhs=0,c.cfm=0,c.minImpulse=0,c.maxImpulse=0,c.motorSpeed=0,c.motorMaxImpulse=0,c.impulse=null,c.impulse=h,c.rhs=n,c.cfm=0,c.minImpulse=-Infinity,c.maxImpulse=Infinity,s=c.jacobian,s.lin1X=this._basis.yX,s.lin1Y=this._basis.yY,s.lin1Z=this._basis.yZ,s.lin2X=this._basis.yX,s.lin2Y=this._basis.yY,s.lin2Z=this._basis.yZ,s.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,s.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,s.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,s.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,s.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,s.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;let b=this._impulses[2],x=t.rows[t.numRows++],p=x.jacobian;p.lin1X=0,p.lin1Y=0,p.lin1Z=0,p.lin2X=0,p.lin2Y=0,p.lin2Z=0,p.ang1X=0,p.ang1Y=0,p.ang1Z=0,p.ang2X=0,p.ang2Y=0,p.ang2Z=0,x.rhs=0,x.cfm=0,x.minImpulse=0,x.maxImpulse=0,x.motorSpeed=0,x.motorMaxImpulse=0,x.impulse=null,x.impulse=b,x.rhs=e,x.cfm=0,x.minImpulse=-Infinity,x.maxImpulse=Infinity,s=x.jacobian,s.lin1X=this._basis.zX,s.lin1Y=this._basis.zY,s.lin1Z=this._basis.zZ,s.lin2X=this._basis.zX,s.lin2Y=this._basis.zY,s.lin2Z=this._basis.zZ,s.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,s.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,s.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,s.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,s.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,s.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX;let f=this._impulses[3],u=t.rows[t.numRows++],v=u.jacobian;v.lin1X=0,v.lin1Y=0,v.lin1Z=0,v.lin2X=0,v.lin2Y=0,v.lin2Z=0,v.ang1X=0,v.ang1Y=0,v.ang1Z=0,v.ang2X=0,v.ang2Y=0,v.ang2Z=0,u.rhs=0,u.cfm=0,u.minImpulse=0,u.maxImpulse=0,u.motorSpeed=0,u.motorMaxImpulse=0,u.impulse=null,u.impulse=f,u.rhs=r,u.cfm=0,u.minImpulse=-Infinity,u.maxImpulse=Infinity,s=u.jacobian,s.ang1X=1,s.ang1Y=0,s.ang1Z=0,s.ang2X=1,s.ang2Y=0,s.ang2Z=0;let X=this._impulses[4],y=t.rows[t.numRows++],g=y.jacobian;g.lin1X=0,g.lin1Y=0,g.lin1Z=0,g.lin2X=0,g.lin2Y=0,g.lin2Z=0,g.ang1X=0,g.ang1Y=0,g.ang1Z=0,g.ang2X=0,g.ang2Y=0,g.ang2Z=0,y.rhs=0,y.cfm=0,y.minImpulse=0,y.maxImpulse=0,y.motorSpeed=0,y.motorMaxImpulse=0,y.impulse=null,y.impulse=X,y.rhs=_,y.cfm=0,y.minImpulse=-Infinity,y.maxImpulse=Infinity,s=y.jacobian,s.ang1X=0,s.ang1Y=1,s.ang1Z=0,s.ang2X=0,s.ang2Y=1,s.ang2Z=0;let d=this._impulses[5],Y=t.rows[t.numRows++],z=Y.jacobian;z.lin1X=0,z.lin1Y=0,z.lin1Z=0,z.lin2X=0,z.lin2Y=0,z.lin2Z=0,z.ang1X=0,z.ang1Y=0,z.ang1Z=0,z.ang2X=0,z.ang2Y=0,z.ang2Z=0,Y.rhs=0,Y.cfm=0,Y.minImpulse=0,Y.maxImpulse=0,Y.motorSpeed=0,Y.motorMaxImpulse=0,Y.impulse=null,Y.impulse=d,Y.rhs=l,Y.cfm=0,Y.minImpulse=-Infinity,Y.maxImpulse=Infinity,s=Y.jacobian,s.ang1X=0,s.ang1Y=0,s.ang1Z=1,s.ang2X=0,s.ang2Y=0,s.ang2Z=1}_syncAnchors(){super._syncAnchors();let t,i,o,s,a,n,e,r,_,l,h,c,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A,P,S,T,C,j,R,q,E,D,F,N=this._basis,W=N.joint._b1._invMass,G=N.joint._b2._invMass,J=N.joint._basisX1X*N.joint._basisX2X+N.joint._basisX1Y*N.joint._basisX2Y+N.joint._basisX1Z*N.joint._basisX2Z;if(J<-.999999999){let a,n,e,r,_=N.joint._basisX1X,l=N.joint._basisX1Y,h=N.joint._basisX1Z,c=_*_,m=l*l,b=h*h;c<m?c<b?(r=1/Math.sqrt(m+b),a=0,n=h*r,e=-l*r):(r=1/Math.sqrt(c+m),a=l*r,n=-_*r,e=0):m<b?(r=1/Math.sqrt(b+c),a=-h*r,n=0,e=_*r):(r=1/Math.sqrt(c+m),a=l*r,n=-_*r,e=0),t=a,i=n,o=e,s=0}else{let a,n,e;a=N.joint._basisX1Y*N.joint._basisX2Z-N.joint._basisX1Z*N.joint._basisX2Y,n=N.joint._basisX1Z*N.joint._basisX2X-N.joint._basisX1X*N.joint._basisX2Z,e=N.joint._basisX1X*N.joint._basisX2Y-N.joint._basisX1Y*N.joint._basisX2X;let r=Math.sqrt(.5*(1+J));J=.5/r,a*=J,n*=J,e*=J,t=a,i=n,o=e,s=r}a=0,n=0,e=0,r=1,T=0,C=0,j=0,R=1,q=t,E=i,D=o,F=s;let O=T*q+C*E+j*D+R*F;if(O<0&&(O=-O,q=-q,E=-E,D=-D,F=-F),O>.999999){let t,i,o,s;t=q-T,i=E-C,o=D-j,s=F-R,q=T+t*(W/(W+G)),E=C+i*(W/(W+G)),D=j+o*(W/(W+G)),F=R+s*(W/(W+G));let a=q*q+E*E+D*D+F*F;a>1e-32&&(a=1/Math.sqrt(a)),_=q*a,l=E*a,h=D*a,c=F*a}else{let t=W/(W+G)*Math.acos(O);q+=T*-O,E+=C*-O,D+=j*-O,F+=R*-O;let i=q*q+E*E+D*D+F*F;i>1e-32&&(i=1/Math.sqrt(i)),q*=i,E*=i,D*=i,F*=i;let o=Math.sin(t),s=Math.cos(t);T*=s,C*=s,j*=s,R*=s,_=T+q*o,l=C+E*o,h=j+D*o,c=R+F*o}let H,U,Q,K=2*_,$=2*l,tt=2*h,it=_*K,ot=l*$,st=h*tt,at=_*$,nt=l*tt,et=_*tt,rt=c*K,_t=c*$,lt=c*tt;m=1-ot-st,b=at-lt,x=et+_t,p=at+lt,f=1-it-st,u=nt-rt,v=et-_t,X=nt+rt,y=1-it-ot,H=m*N.joint._basisX1X+b*N.joint._basisX1Y+x*N.joint._basisX1Z,U=p*N.joint._basisX1X+f*N.joint._basisX1Y+u*N.joint._basisX1Z,Q=v*N.joint._basisX1X+X*N.joint._basisX1Y+y*N.joint._basisX1Z,g=H,d=U,Y=Q,w=N.xX,k=N.xY,B=N.xZ,A=N.yX,P=N.yY,S=N.yZ;let ht=w*g+k*d+B*Y;if(ht<-.999999999){let t,i,o,s,a=w,n=k,e=B,r=a*a,m=n*n,b=e*e;r<m?r<b?(s=1/Math.sqrt(m+b),t=0,i=e*s,o=-n*s):(s=1/Math.sqrt(r+m),t=n*s,i=-a*s,o=0):m<b?(s=1/Math.sqrt(b+r),t=-e*s,i=0,o=a*s):(s=1/Math.sqrt(r+m),t=n*s,i=-a*s,o=0),_=t,l=i,h=o,c=0}else{let t,i,o;t=k*Y-B*d,i=B*g-w*Y,o=w*d-k*g;let s=Math.sqrt(.5*(1+ht));ht=.5/s,t*=ht,i*=ht,o*=ht,_=t,l=i,h=o,c=s}let ct,mt,bt,xt,pt,ft,ut,vt,Xt,yt,gt,dt,Yt,zt,Zt,Mt,It,Vt,Lt,wt,kt,Bt,At,Pt,St,Tt,Ct,jt,Rt,qt,Et,Dt,Ft,Nt,Wt,Gt,Jt,Ot,Ht,Ut,Qt,Kt,$t,ti=2*_,ii=2*l,oi=2*h,si=_*ti,ai=l*ii,ni=h*oi,ei=_*ii,ri=l*oi,_i=_*oi,li=c*ti,hi=c*ii,ci=c*oi;if(m=1-ai-ni,b=ei-ci,x=_i+hi,p=ei+ci,f=1-si-ni,u=ri-li,v=_i-hi,X=ri+li,y=1-si-ai,ct=m*A+b*P+x*S,mt=p*A+f*P+u*S,bt=v*A+X*P+y*S,z=ct,Z=mt,M=bt,I=d*M-Y*Z,V=Y*z-g*M,L=g*Z-d*z,I*I+V*V+L*L>1e-6){let t=I*I+V*V+L*L;t>0&&(t=1/Math.sqrt(t)),I*=t,V*=t,L*=t}else{let t,i=g,o=d,s=Y,a=i*i,n=o*o,e=s*s;a<n?a<e?(t=1/Math.sqrt(n+e),I=0,V=s*t,L=-o*t):(t=1/Math.sqrt(a+n),I=o*t,V=-i*t,L=0):n<e?(t=1/Math.sqrt(e+a),I=-s*t,V=0,L=i*t):(t=1/Math.sqrt(a+n),I=o*t,V=-i*t,L=0)}z=V*Y-L*d,Z=L*g-I*Y,M=I*d-V*g,N.xX=g,N.xY=d,N.xZ=Y,N.yX=z,N.yY=Z,N.yZ=M,N.zX=I,N.zY=V,N.zZ=L,xt=this._basisX1X,pt=this._basisY1X,ft=this._basisZ1X,ut=this._basisX1Y,vt=this._basisY1Y,Xt=this._basisZ1Y,yt=this._basisX1Z,gt=this._basisY1Z,dt=this._basisZ1Z,Yt=this._basisX2X,zt=this._basisY2X,Zt=this._basisZ2X,Mt=this._basisX2Y,It=this._basisY2Y,Vt=this._basisZ2Y,Lt=this._basisX2Z,wt=this._basisY2Z,kt=this._basisZ2Z,Et=Yt*xt+zt*pt+Zt*ft,Dt=Yt*ut+zt*vt+Zt*Xt,Ft=Yt*yt+zt*gt+Zt*dt,Nt=Mt*xt+It*pt+Vt*ft,Wt=Mt*ut+It*vt+Vt*Xt,Gt=Mt*yt+It*gt+Vt*dt,Jt=Lt*xt+wt*pt+kt*ft,Ot=Lt*ut+wt*vt+kt*Xt,Ht=Lt*yt+wt*gt+kt*dt,Bt=Et,At=Dt,Pt=Ft,St=Nt,Tt=Wt,Ct=Gt,jt=Jt,Rt=Ot,qt=Ht;let mi,bi=Bt,xi=Tt,pi=qt,fi=bi+xi+pi;fi>0?(mi=Math.sqrt(fi+1),$t=.5*mi,mi=.5/mi,Ut=(Rt-Ct)*mi,Qt=(Pt-jt)*mi,Kt=(St-At)*mi):bi>xi?bi>pi?(mi=Math.sqrt(bi-xi-pi+1),Ut=.5*mi,mi=.5/mi,Qt=(At+St)*mi,Kt=(Pt+jt)*mi,$t=(Rt-Ct)*mi):(mi=Math.sqrt(pi-bi-xi+1),Kt=.5*mi,mi=.5/mi,Ut=(Pt+jt)*mi,Qt=(Ct+Rt)*mi,$t=(St-At)*mi):xi>pi?(mi=Math.sqrt(xi-pi-bi+1),Qt=.5*mi,mi=.5/mi,Ut=(At+St)*mi,Kt=(Ct+Rt)*mi,$t=(Pt-jt)*mi):(mi=Math.sqrt(pi-bi-xi+1),Kt=.5*mi,mi=.5/mi,Ut=(Pt+jt)*mi,Qt=(Ct+Rt)*mi,$t=(St-At)*mi);let ui=$t,vi=2*(ui<=-1?3.14159265358979:ui>=1?0:Math.acos(ui));this.angularErrorX=Ut,this.angularErrorY=Qt,this.angularErrorZ=Kt;let Xi,yi,gi,di=this.angularErrorX*this.angularErrorX+this.angularErrorY*this.angularErrorY+this.angularErrorZ*this.angularErrorZ;di>0&&(di=1/Math.sqrt(di)),this.angularErrorX*=di,this.angularErrorY*=di,this.angularErrorZ*=di,this.angularErrorX*=vi,this.angularErrorY*=vi,this.angularErrorZ*=vi,Xi=this._anchor2X-this._anchor1X,yi=this._anchor2Y-this._anchor1Y,gi=this._anchor2Z-this._anchor1Z,this.translation=Xi*this._basis.xX+yi*this._basis.xY+gi*this._basis.xZ,this.linearErrorY=Xi*this._basis.yX+yi*this._basis.yY+gi*this._basis.yZ,this.linearErrorZ=Xi*this._basis.zX+yi*this._basis.zY+gi*this._basis.zZ}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new oimo.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new oimo.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new oimo.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new oimo.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getSpringDamper(){return this._sd}getLimitMotor(){return this._lm}getTranslation(){return this.translation}},oimo.dynamics.constraint.joint.PrismaticJointConfig=class extends oimo.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new oimo.common.Vec3(1,0,0),this.localAxis2=new oimo.common.Vec3(1,0,0),this.limitMotor=new oimo.dynamics.constraint.joint.TranslationalLimitMotor,this.springDamper=new oimo.dynamics.constraint.joint.SpringDamper}init(t,i,o,s){this._init(t,i,o);let a,n,e,r,_,l,h=this.localAxis1;a=s.x,n=s.y,e=s.z,r=t._transform._rotation00*a+t._transform._rotation10*n+t._transform._rotation20*e,_=t._transform._rotation01*a+t._transform._rotation11*n+t._transform._rotation21*e,l=t._transform._rotation02*a+t._transform._rotation12*n+t._transform._rotation22*e,a=r,n=_,e=l,h.x=a,h.y=n,h.z=e;let c,m,b,x,p,f,u=this.localAxis2;return c=s.x,m=s.y,b=s.z,x=i._transform._rotation00*c+i._transform._rotation10*m+i._transform._rotation20*b,p=i._transform._rotation01*c+i._transform._rotation11*m+i._transform._rotation21*b,f=i._transform._rotation02*c+i._transform._rotation12*m+i._transform._rotation22*b,c=x,m=p,b=f,u.x=c,u.y=m,u.z=b,this}},oimo.dynamics.constraint.joint.RagdollJoint=class extends oimo.dynamics.constraint.joint.Joint{constructor(t){super(t,oimo.dynamics.constraint.joint.JointType.RAGDOLL);let i=t.localTwistAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let o=t.localSwingAxis1;this._localBasisY1X=o.x,this._localBasisY1Y=o.y,this._localBasisY1Z=o.z;let s=t.localTwistAxis2;this._localBasisX2X=s.x,this._localBasisX2Y=s.y,this._localBasisX2Z=s.z,this.buildLocalBasesFromXY1X2(),this._twistSd=t.twistSpringDamper.clone(),this._twistLm=t.twistLimitMotor.clone(),this._swingSd=t.swingSpringDamper.clone(),this._maxSwingAngle1=t.maxSwingAngle1,this._maxSwingAngle2=t.maxSwingAngle2,this._maxSwingAngle1<oimo.common.Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle1=oimo.common.Setting.minRagdollMaxSwingAngle),this._maxSwingAngle2<oimo.common.Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle2=oimo.common.Setting.minRagdollMaxSwingAngle),this.dummySwingLm=new oimo.dynamics.constraint.joint.RotationalLimitMotor,this.dummySwingLm.lowerLimit=-1,this.dummySwingLm.upperLimit=0,this._swingAngle=0,this._twistAngle=0,this.swingError=0,this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.twistAxisX=0,this.twistAxisY=0,this.twistAxisZ=0}getInfo(t,i,o){let s,a,n,e,r,_,l,h,c,m,b,x,p,f,u,v,X,y,g,d,Y,z=this.getErp(i,o);s=this.linearErrorX*z,a=this.linearErrorY*z,n=this.linearErrorZ*z,e=0,r=-this._relativeAnchor1Z,_=this._relativeAnchor1Y,l=this._relativeAnchor1Z,h=0,c=-this._relativeAnchor1X,m=-this._relativeAnchor1Y,b=this._relativeAnchor1X,x=0,p=0,f=-this._relativeAnchor2Z,u=this._relativeAnchor2Y,v=this._relativeAnchor2Z,X=0,y=-this._relativeAnchor2X,g=-this._relativeAnchor2Y,d=this._relativeAnchor2X,Y=0,e=-e,r=-r,_=-_,l=-l,h=-h,c=-c,m=-m,b=-b,x=-x,p=-p,f=-f,u=-u,v=-v,X=-X,y=-y,g=-g,d=-d,Y=-Y;let Z=this.computeEffectiveInertiaMoment(this.swingAxisX,this.swingAxisY,this.swingAxisZ),M=this.computeEffectiveInertiaMoment(this._basisX2X,this._basisX2Y,this._basisX2Z),I=this._impulses[0],V=t.rows[t.numRows++],L=V.jacobian;L.lin1X=0,L.lin1Y=0,L.lin1Z=0,L.lin2X=0,L.lin2Y=0,L.lin2Z=0,L.ang1X=0,L.ang1Y=0,L.ang1Z=0,L.ang2X=0,L.ang2Y=0,L.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=I,V.rhs=s,V.cfm=0,V.minImpulse=-Infinity,V.maxImpulse=Infinity;let w=V.jacobian;w.lin1X=1,w.lin1Y=0,w.lin1Z=0,w.lin2X=1,w.lin2Y=0,w.lin2Z=0,w.ang1X=e,w.ang1Y=r,w.ang1Z=_,w.ang2X=p,w.ang2Y=f,w.ang2Z=u;let k=this._impulses[1],B=t.rows[t.numRows++],A=B.jacobian;A.lin1X=0,A.lin1Y=0,A.lin1Z=0,A.lin2X=0,A.lin2Y=0,A.lin2Z=0,A.ang1X=0,A.ang1Y=0,A.ang1Z=0,A.ang2X=0,A.ang2Y=0,A.ang2Z=0,B.rhs=0,B.cfm=0,B.minImpulse=0,B.maxImpulse=0,B.motorSpeed=0,B.motorMaxImpulse=0,B.impulse=null,B.impulse=k,B.rhs=a,B.cfm=0,B.minImpulse=-Infinity,B.maxImpulse=Infinity,w=B.jacobian,w.lin1X=0,w.lin1Y=1,w.lin1Z=0,w.lin2X=0,w.lin2Y=1,w.lin2Z=0,w.ang1X=l,w.ang1Y=h,w.ang1Z=c,w.ang2X=v,w.ang2Y=X,w.ang2Z=y;let P=this._impulses[2],S=t.rows[t.numRows++],T=S.jacobian;if(T.lin1X=0,T.lin1Y=0,T.lin1Z=0,T.lin2X=0,T.lin2Y=0,T.lin2Z=0,T.ang1X=0,T.ang1Y=0,T.ang1Z=0,T.ang2X=0,T.ang2Y=0,T.ang2Z=0,S.rhs=0,S.cfm=0,S.minImpulse=0,S.maxImpulse=0,S.motorSpeed=0,S.motorMaxImpulse=0,S.impulse=null,S.impulse=P,S.rhs=n,S.cfm=0,S.minImpulse=-Infinity,S.maxImpulse=Infinity,w=S.jacobian,w.lin1X=0,w.lin1Y=0,w.lin1Z=1,w.lin2X=0,w.lin2Y=0,w.lin2Z=1,w.ang1X=m,w.ang1Y=b,w.ang1Z=x,w.ang2X=g,w.ang2Y=d,w.ang2Z=Y,this.swingError>0&&(this._swingSd.frequency<=0||!o)){let s=this._impulses[3],a=t.rows[t.numRows++],n=a.jacobian;n.lin1X=0,n.lin1Y=0,n.lin1Z=0,n.lin2X=0,n.lin2Y=0,n.lin2Z=0,n.ang1X=0,n.ang1Y=0,n.ang1Z=0,n.ang2X=0,n.ang2Y=0,n.ang2Z=0,a.rhs=0,a.cfm=0,a.minImpulse=0,a.maxImpulse=0,a.motorSpeed=0,a.motorMaxImpulse=0,a.impulse=null,a.impulse=s,this.setSolverInfoRowAngular(a,this.swingError,this.dummySwingLm,Z,this._swingSd,i,o),w=a.jacobian,w.ang1X=this.swingAxisX,w.ang1Y=this.swingAxisY,w.ang1Z=this.swingAxisZ,w.ang2X=this.swingAxisX,w.ang2Y=this.swingAxisY,w.ang2Z=this.swingAxisZ}if(this._twistSd.frequency<=0||!o){let s=this._impulses[4],a=t.rows[t.numRows++],n=a.jacobian;n.lin1X=0,n.lin1Y=0,n.lin1Z=0,n.lin2X=0,n.lin2Y=0,n.lin2Z=0,n.ang1X=0,n.ang1Y=0,n.ang1Z=0,n.ang2X=0,n.ang2Y=0,n.ang2Z=0,a.rhs=0,a.cfm=0,a.minImpulse=0,a.maxImpulse=0,a.motorSpeed=0,a.motorMaxImpulse=0,a.impulse=null,a.impulse=s,this.setSolverInfoRowAngular(a,this._twistAngle,this._twistLm,M,this._twistSd,i,o),w=a.jacobian,w.ang1X=this.twistAxisX,w.ang1Y=this.twistAxisY,w.ang1Z=this.twistAxisZ,w.ang2X=this.twistAxisX,w.ang2Y=this.twistAxisY,w.ang2Z=this.twistAxisZ}}_syncAnchors(){let t,i,o,s,a,n,e,r,_,l,h,c,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w;super._syncAnchors(),t=this._basisX1X,i=this._basisX1Y,o=this._basisX1Z,s=this._basisX2X,a=this._basisX2Y,n=this._basisX2Z,e=this._basisX1X,r=this._basisY1X,_=this._basisZ1X,l=this._basisX1Y,h=this._basisY1Y,c=this._basisZ1Y,m=this._basisX1Z,b=this._basisY1Z,x=this._basisZ1Z;let k=t*s+i*a+o*n;if(k<-.999999999){let s,a,n,e,r=t,_=i,l=o,h=r*r,c=_*_,m=l*l;h<c?h<m?(e=1/Math.sqrt(c+m),s=0,a=l*e,n=-_*e):(e=1/Math.sqrt(h+c),s=_*e,a=-r*e,n=0):c<m?(e=1/Math.sqrt(m+h),s=-l*e,a=0,n=r*e):(e=1/Math.sqrt(h+c),s=_*e,a=-r*e,n=0),p=s,f=a,u=n,v=0}else{let e,r,_;e=i*n-o*a,r=o*s-t*n,_=t*a-i*s;let l=Math.sqrt(.5*(1+k));k=.5/l,e*=k,r*=k,_*=k,p=e,f=r,u=_,v=l}let B,A,P,S,T,C,j=2*p,R=2*f,q=2*u,E=p*j,D=f*R,F=u*q,N=p*R,W=f*q,G=p*q,J=v*j,O=v*R,H=v*q;X=1-D-F,y=N-H,g=G+O,d=N+H,Y=1-E-F,z=W-J,Z=G-O,M=W+J,I=1-E-D,this._swingAngle=2*(v<=-1?3.14159265358979:v>=1?0:Math.acos(v)),V=p,L=f,w=u,S=X*this._basisY2X+d*this._basisY2Y+Z*this._basisY2Z,T=y*this._basisY2X+Y*this._basisY2Y+M*this._basisY2Z,C=g*this._basisY2X+z*this._basisY2Y+I*this._basisY2Z,B=S,A=T,P=C,this._twistAngle=Math.atan2(this._basisZ1X*B+this._basisZ1Y*A+this._basisZ1Z*P,this._basisY1X*B+this._basisY1Y*A+this._basisY1Z*P),this.twistAxisX=this._basisX1X+this._basisX2X,this.twistAxisY=this._basisX1Y+this._basisX2Y,this.twistAxisZ=this._basisX1Z+this._basisX2Z;let U=this.twistAxisX*this.twistAxisX+this.twistAxisY*this.twistAxisY+this.twistAxisZ*this.twistAxisZ;U>0&&(U=1/Math.sqrt(U)),this.twistAxisX*=U,this.twistAxisY*=U,this.twistAxisZ*=U;let Q,K,$=Math.sqrt(V*V+L*L+w*w);$>0&&($=1/$),V*=$*this._swingAngle,L*=$*this._swingAngle,w*=$*this._swingAngle,Q=r*V+h*L+b*w,K=_*V+c*L+x*w,L=Q,w=K;let tt=L,it=w,ot=this._maxSwingAngle1,st=this._maxSwingAngle2,at=1/(ot*ot),nt=1/(st*st),et=tt*tt*at+it*it*nt;if(0==et)this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.swingError=0;else{let t=Math.sqrt(1/et),i=tt*t,o=it*t,s=i*at,a=o*nt;$=1/Math.sqrt(s*s+a*a),s*=$,a*=$;let n=(tt-i)*s+(it-o)*a;if(n>0){let t,i,o,p,f,u;this.swingError=n,this.swingAxisX=0,this.swingAxisY=s,this.swingAxisZ=a,t=e*this.swingAxisX+r*this.swingAxisY+_*this.swingAxisZ,i=l*this.swingAxisX+h*this.swingAxisY+c*this.swingAxisZ,o=m*this.swingAxisX+b*this.swingAxisY+x*this.swingAxisZ,this.swingAxisX=t,this.swingAxisY=i,this.swingAxisZ=o,p=X*this.swingAxisX+y*this.swingAxisY+g*this.swingAxisZ,f=d*this.swingAxisX+Y*this.swingAxisY+z*this.swingAxisZ,u=Z*this.swingAxisX+M*this.swingAxisY+I*this.swingAxisZ,this.swingAxisX=p,this.swingAxisY=f,this.swingAxisZ=u}else this.swingError=0}this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new oimo.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new oimo.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new oimo.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new oimo.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getTwistSpringDamper(){return this._twistSd}getTwistLimitMotor(){return this._twistLm}getSwingSpringDamper(){return this._swingSd}getSwingAxis(){let t=new oimo.common.Vec3;return t.x=this.swingAxisX,t.y=this.swingAxisY,t.z=this.swingAxisZ,t}getSwingAxisTo(t){t.x=this.swingAxisX,t.y=this.swingAxisY,t.z=this.swingAxisZ}getSwingAngle(){return this._swingAngle}getTwistAngle(){return this._twistAngle}},oimo.dynamics.constraint.joint.RagdollJointConfig=class extends oimo.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localTwistAxis1=new oimo.common.Vec3(1,0,0),this.localTwistAxis2=new oimo.common.Vec3(1,0,0),this.localSwingAxis1=new oimo.common.Vec3(0,1,0),this.twistSpringDamper=new oimo.dynamics.constraint.joint.SpringDamper,this.swingSpringDamper=new oimo.dynamics.constraint.joint.SpringDamper,this.twistLimitMotor=new oimo.dynamics.constraint.joint.RotationalLimitMotor,this.maxSwingAngle1=3.14159265358979,this.maxSwingAngle2=3.14159265358979}init(t,i,o,s,a){this._init(t,i,o);let n,e,r,_,l,h,c=this.localTwistAxis1;n=s.x,e=s.y,r=s.z,_=t._transform._rotation00*n+t._transform._rotation10*e+t._transform._rotation20*r,l=t._transform._rotation01*n+t._transform._rotation11*e+t._transform._rotation21*r,h=t._transform._rotation02*n+t._transform._rotation12*e+t._transform._rotation22*r,n=_,e=l,r=h,c.x=n,c.y=e,c.z=r;let m,b,x,p,f,u,v=this.localTwistAxis2;m=s.x,b=s.y,x=s.z,p=i._transform._rotation00*m+i._transform._rotation10*b+i._transform._rotation20*x,f=i._transform._rotation01*m+i._transform._rotation11*b+i._transform._rotation21*x,u=i._transform._rotation02*m+i._transform._rotation12*b+i._transform._rotation22*x,m=p,b=f,x=u,v.x=m,v.y=b,v.z=x;let X,y,g,d,Y,z,Z=this.localSwingAxis1;return X=a.x,y=a.y,g=a.z,d=t._transform._rotation00*X+t._transform._rotation10*y+t._transform._rotation20*g,Y=t._transform._rotation01*X+t._transform._rotation11*y+t._transform._rotation21*g,z=t._transform._rotation02*X+t._transform._rotation12*y+t._transform._rotation22*g,X=d,y=Y,g=z,Z.x=X,Z.y=y,Z.z=g,this}},oimo.dynamics.constraint.joint.RevoluteJoint=class extends oimo.dynamics.constraint.joint.Joint{constructor(t){super(t,1);let i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let o=t.localAxis2;this._localBasisX2X=o.x,this._localBasisX2Y=o.y,this._localBasisX2Z=o.z,this.buildLocalBasesFromX(),this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this._basis=new oimo.dynamics.constraint.joint.BasisTracker(this),this._sd=t.springDamper.clone(),this._lm=t.limitMotor.clone()}getInfo(t,i,o){let s,a,n,e=this.getErp(i,o);s=this.linearErrorX*e,a=this.linearErrorY*e,n=this.linearErrorZ*e;let r,_,l,h,c,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z=this.angularErrorY*e,M=this.angularErrorZ*e;r=0,_=-this._relativeAnchor1Z,l=this._relativeAnchor1Y,h=this._relativeAnchor1Z,c=0,m=-this._relativeAnchor1X,b=-this._relativeAnchor1Y,x=this._relativeAnchor1X,p=0,f=0,u=-this._relativeAnchor2Z,v=this._relativeAnchor2Y,X=this._relativeAnchor2Z,y=0,g=-this._relativeAnchor2X,d=-this._relativeAnchor2Y,Y=this._relativeAnchor2X,z=0,r=-r,_=-_,l=-l,h=-h,c=-c,m=-m,b=-b,x=-x,p=-p,f=-f,u=-u,v=-v,X=-X,y=-y,g=-g,d=-d,Y=-Y,z=-z;let I=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ),V=this._impulses[0],L=t.rows[t.numRows++],w=L.jacobian;w.lin1X=0,w.lin1Y=0,w.lin1Z=0,w.lin2X=0,w.lin2Y=0,w.lin2Z=0,w.ang1X=0,w.ang1Y=0,w.ang1Z=0,w.ang2X=0,w.ang2Y=0,w.ang2Z=0,L.rhs=0,L.cfm=0,L.minImpulse=0,L.maxImpulse=0,L.motorSpeed=0,L.motorMaxImpulse=0,L.impulse=null,L.impulse=V,L.rhs=s,L.cfm=0,L.minImpulse=-Infinity,L.maxImpulse=Infinity;let k=L.jacobian;k.lin1X=1,k.lin1Y=0,k.lin1Z=0,k.lin2X=1,k.lin2Y=0,k.lin2Z=0,k.ang1X=r,k.ang1Y=_,k.ang1Z=l,k.ang2X=f,k.ang2Y=u,k.ang2Z=v;let B=this._impulses[1],A=t.rows[t.numRows++],P=A.jacobian;P.lin1X=0,P.lin1Y=0,P.lin1Z=0,P.lin2X=0,P.lin2Y=0,P.lin2Z=0,P.ang1X=0,P.ang1Y=0,P.ang1Z=0,P.ang2X=0,P.ang2Y=0,P.ang2Z=0,A.rhs=0,A.cfm=0,A.minImpulse=0,A.maxImpulse=0,A.motorSpeed=0,A.motorMaxImpulse=0,A.impulse=null,A.impulse=B,A.rhs=a,A.cfm=0,A.minImpulse=-Infinity,A.maxImpulse=Infinity,k=A.jacobian,k.lin1X=0,k.lin1Y=1,k.lin1Z=0,k.lin2X=0,k.lin2Y=1,k.lin2Z=0,k.ang1X=h,k.ang1Y=c,k.ang1Z=m,k.ang2X=X,k.ang2Y=y,k.ang2Z=g;let S=this._impulses[2],T=t.rows[t.numRows++],C=T.jacobian;if(C.lin1X=0,C.lin1Y=0,C.lin1Z=0,C.lin2X=0,C.lin2Y=0,C.lin2Z=0,C.ang1X=0,C.ang1Y=0,C.ang1Z=0,C.ang2X=0,C.ang2Y=0,C.ang2Z=0,T.rhs=0,T.cfm=0,T.minImpulse=0,T.maxImpulse=0,T.motorSpeed=0,T.motorMaxImpulse=0,T.impulse=null,T.impulse=S,T.rhs=n,T.cfm=0,T.minImpulse=-Infinity,T.maxImpulse=Infinity,k=T.jacobian,k.lin1X=0,k.lin1Y=0,k.lin1Z=1,k.lin2X=0,k.lin2Y=0,k.lin2Z=1,k.ang1X=b,k.ang1Y=x,k.ang1Z=p,k.ang2X=d,k.ang2Y=Y,k.ang2Z=z,this._sd.frequency<=0||!o){let s=this._impulses[3],a=t.rows[t.numRows++],n=a.jacobian;n.lin1X=0,n.lin1Y=0,n.lin1Z=0,n.lin2X=0,n.lin2Y=0,n.lin2Z=0,n.ang1X=0,n.ang1Y=0,n.ang1Z=0,n.ang2X=0,n.ang2Y=0,n.ang2Z=0,a.rhs=0,a.cfm=0,a.minImpulse=0,a.maxImpulse=0,a.motorSpeed=0,a.motorMaxImpulse=0,a.impulse=null,a.impulse=s,this.setSolverInfoRowAngular(a,this.angle,this._lm,I,this._sd,i,o),k=a.jacobian,k.ang1X=this._basis.xX,k.ang1Y=this._basis.xY,k.ang1Z=this._basis.xZ,k.ang2X=this._basis.xX,k.ang2Y=this._basis.xY,k.ang2Z=this._basis.xZ}let j=this._impulses[4],R=t.rows[t.numRows++],q=R.jacobian;q.lin1X=0,q.lin1Y=0,q.lin1Z=0,q.lin2X=0,q.lin2Y=0,q.lin2Z=0,q.ang1X=0,q.ang1Y=0,q.ang1Z=0,q.ang2X=0,q.ang2Y=0,q.ang2Z=0,R.rhs=0,R.cfm=0,R.minImpulse=0,R.maxImpulse=0,R.motorSpeed=0,R.motorMaxImpulse=0,R.impulse=null,R.impulse=j,R.rhs=Z,R.cfm=0,R.minImpulse=-Infinity,R.maxImpulse=Infinity,k=R.jacobian,k.ang1X=this._basis.yX,k.ang1Y=this._basis.yY,k.ang1Z=this._basis.yZ,k.ang2X=this._basis.yX,k.ang2Y=this._basis.yY,k.ang2Z=this._basis.yZ;let E=this._impulses[5],D=t.rows[t.numRows++],F=D.jacobian;F.lin1X=0,F.lin1Y=0,F.lin1Z=0,F.lin2X=0,F.lin2Y=0,F.lin2Z=0,F.ang1X=0,F.ang1Y=0,F.ang1Z=0,F.ang2X=0,F.ang2Y=0,F.ang2Z=0,D.rhs=0,D.cfm=0,D.minImpulse=0,D.maxImpulse=0,D.motorSpeed=0,D.motorMaxImpulse=0,D.impulse=null,D.impulse=E,D.rhs=M,D.cfm=0,D.minImpulse=-Infinity,D.maxImpulse=Infinity,k=D.jacobian,k.ang1X=this._basis.zX,k.ang1Y=this._basis.zY,k.ang1Z=this._basis.zZ,k.ang2X=this._basis.zX,k.ang2Y=this._basis.zY,k.ang2Z=this._basis.zZ}_syncAnchors(){super._syncAnchors();let t,i,o,s,a,n,e,r,_,l,h,c,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A,P,S,T,C,j,R,q,E,D,F,N=this._basis,W=N.joint._b1._invMass,G=N.joint._b2._invMass,J=N.joint._basisX1X*N.joint._basisX2X+N.joint._basisX1Y*N.joint._basisX2Y+N.joint._basisX1Z*N.joint._basisX2Z;if(J<-.999999999){let a,n,e,r,_=N.joint._basisX1X,l=N.joint._basisX1Y,h=N.joint._basisX1Z,c=_*_,m=l*l,b=h*h;c<m?c<b?(r=1/Math.sqrt(m+b),a=0,n=h*r,e=-l*r):(r=1/Math.sqrt(c+m),a=l*r,n=-_*r,e=0):m<b?(r=1/Math.sqrt(b+c),a=-h*r,n=0,e=_*r):(r=1/Math.sqrt(c+m),a=l*r,n=-_*r,e=0),t=a,i=n,o=e,s=0}else{let a,n,e;a=N.joint._basisX1Y*N.joint._basisX2Z-N.joint._basisX1Z*N.joint._basisX2Y,n=N.joint._basisX1Z*N.joint._basisX2X-N.joint._basisX1X*N.joint._basisX2Z,e=N.joint._basisX1X*N.joint._basisX2Y-N.joint._basisX1Y*N.joint._basisX2X;let r=Math.sqrt(.5*(1+J));J=.5/r,a*=J,n*=J,e*=J,t=a,i=n,o=e,s=r}a=0,n=0,e=0,r=1,T=0,C=0,j=0,R=1,q=t,E=i,D=o,F=s;let O=T*q+C*E+j*D+R*F;if(O<0&&(O=-O,q=-q,E=-E,D=-D,F=-F),O>.999999){let t,i,o,s;t=q-T,i=E-C,o=D-j,s=F-R,q=T+t*(W/(W+G)),E=C+i*(W/(W+G)),D=j+o*(W/(W+G)),F=R+s*(W/(W+G));let a=q*q+E*E+D*D+F*F;a>1e-32&&(a=1/Math.sqrt(a)),_=q*a,l=E*a,h=D*a,c=F*a}else{let t=W/(W+G)*Math.acos(O);q+=T*-O,E+=C*-O,D+=j*-O,F+=R*-O;let i=q*q+E*E+D*D+F*F;i>1e-32&&(i=1/Math.sqrt(i)),q*=i,E*=i,D*=i,F*=i;let o=Math.sin(t),s=Math.cos(t);T*=s,C*=s,j*=s,R*=s,_=T+q*o,l=C+E*o,h=j+D*o,c=R+F*o}let H,U,Q,K=2*_,$=2*l,tt=2*h,it=_*K,ot=l*$,st=h*tt,at=_*$,nt=l*tt,et=_*tt,rt=c*K,_t=c*$,lt=c*tt;m=1-ot-st,b=at-lt,x=et+_t,p=at+lt,f=1-it-st,u=nt-rt,v=et-_t,X=nt+rt,y=1-it-ot,H=m*N.joint._basisX1X+b*N.joint._basisX1Y+x*N.joint._basisX1Z,U=p*N.joint._basisX1X+f*N.joint._basisX1Y+u*N.joint._basisX1Z,Q=v*N.joint._basisX1X+X*N.joint._basisX1Y+y*N.joint._basisX1Z,g=H,d=U,Y=Q,w=N.xX,k=N.xY,B=N.xZ,A=N.yX,P=N.yY,S=N.yZ;let ht=w*g+k*d+B*Y;if(ht<-.999999999){let t,i,o,s,a=w,n=k,e=B,r=a*a,m=n*n,b=e*e;r<m?r<b?(s=1/Math.sqrt(m+b),t=0,i=e*s,o=-n*s):(s=1/Math.sqrt(r+m),t=n*s,i=-a*s,o=0):m<b?(s=1/Math.sqrt(b+r),t=-e*s,i=0,o=a*s):(s=1/Math.sqrt(r+m),t=n*s,i=-a*s,o=0),_=t,l=i,h=o,c=0}else{let t,i,o;t=k*Y-B*d,i=B*g-w*Y,o=w*d-k*g;let s=Math.sqrt(.5*(1+ht));ht=.5/s,t*=ht,i*=ht,o*=ht,_=t,l=i,h=o,c=s}let ct,mt,bt,xt,pt,ft,ut=2*_,vt=2*l,Xt=2*h,yt=_*ut,gt=l*vt,dt=h*Xt,Yt=_*vt,zt=l*Xt,Zt=_*Xt,Mt=c*ut,It=c*vt,Vt=c*Xt;if(m=1-gt-dt,b=Yt-Vt,x=Zt+It,p=Yt+Vt,f=1-yt-dt,u=zt-Mt,v=Zt-It,X=zt+Mt,y=1-yt-gt,ct=m*A+b*P+x*S,mt=p*A+f*P+u*S,bt=v*A+X*P+y*S,z=ct,Z=mt,M=bt,I=d*M-Y*Z,V=Y*z-g*M,L=g*Z-d*z,I*I+V*V+L*L>1e-6){let t=I*I+V*V+L*L;t>0&&(t=1/Math.sqrt(t)),I*=t,V*=t,L*=t}else{let t,i=g,o=d,s=Y,a=i*i,n=o*o,e=s*s;a<n?a<e?(t=1/Math.sqrt(n+e),I=0,V=s*t,L=-o*t):(t=1/Math.sqrt(a+n),I=o*t,V=-i*t,L=0):n<e?(t=1/Math.sqrt(e+a),I=-s*t,V=0,L=i*t):(t=1/Math.sqrt(a+n),I=o*t,V=-i*t,L=0)}z=V*Y-L*d,Z=L*g-I*Y,M=I*d-V*g,N.xX=g,N.xY=d,N.xZ=Y,N.yX=z,N.yY=Z,N.yZ=M,N.zX=I,N.zY=V,N.zZ=L,xt=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,pt=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,ft=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;let Lt,wt,kt,Bt=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,At=Bt<=-1?3.14159265358979:Bt>=1?0:Math.acos(Bt),Pt=xt*xt+pt*pt+ft*ft;Pt>0&&(Pt=1/Math.sqrt(Pt)),xt*=Pt,pt*=Pt,ft*=Pt,xt*=At,pt*=At,ft*=At,this.angularErrorY=xt*this._basis.yX+pt*this._basis.yY+ft*this._basis.yZ,this.angularErrorZ=xt*this._basis.zX+pt*this._basis.zY+ft*this._basis.zZ,Lt=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,wt=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,kt=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,Bt=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=Bt<=-1?3.14159265358979:Bt>=1?0:Math.acos(Bt),Lt*this._basis.xX+wt*this._basis.xY+kt*this._basis.xZ<0&&(this.angle=-this.angle),this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new oimo.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new oimo.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new oimo.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new oimo.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getSpringDamper(){return this._sd}getLimitMotor(){return this._lm}getAngle(){return this.angle}},oimo.dynamics.constraint.joint.RevoluteJointConfig=class extends oimo.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new oimo.common.Vec3(1,0,0),this.localAxis2=new oimo.common.Vec3(1,0,0),this.springDamper=new oimo.dynamics.constraint.joint.SpringDamper,this.limitMotor=new oimo.dynamics.constraint.joint.RotationalLimitMotor}init(t,i,o,s){this._init(t,i,o);let a,n,e,r,_,l,h=this.localAxis1;a=s.x,n=s.y,e=s.z,r=t._transform._rotation00*a+t._transform._rotation10*n+t._transform._rotation20*e,_=t._transform._rotation01*a+t._transform._rotation11*n+t._transform._rotation21*e,l=t._transform._rotation02*a+t._transform._rotation12*n+t._transform._rotation22*e,a=r,n=_,e=l,h.x=a,h.y=n,h.z=e;let c,m,b,x,p,f,u=this.localAxis2;return c=s.x,m=s.y,b=s.z,x=i._transform._rotation00*c+i._transform._rotation10*m+i._transform._rotation20*b,p=i._transform._rotation01*c+i._transform._rotation11*m+i._transform._rotation21*b,f=i._transform._rotation02*c+i._transform._rotation12*m+i._transform._rotation22*b,c=x,m=p,b=f,u.x=c,u.y=m,u.z=b,this}},oimo.dynamics.constraint.joint.RotationalLimitMotor=class{constructor(){this.lowerLimit=1,this.upperLimit=0,this.motorTorque=0}setLimits(t,i){return this.lowerLimit=t,this.upperLimit=i,this}setMotor(t,i){return this.motorSpeed=t,this.motorTorque=i,this}clone(){let t=new oimo.dynamics.constraint.joint.RotationalLimitMotor;return t.lowerLimit=this.lowerLimit,t.upperLimit=this.upperLimit,t.motorSpeed=this.motorSpeed,t.motorTorque=this.motorTorque,t}},oimo.dynamics.constraint.joint.SphericalJoint=class extends oimo.dynamics.constraint.joint.Joint{constructor(t){super(t,0),this._sd=t.springDamper.clone()}getInfo(t,i,o){if(this._sd.frequency>0&&o)return;let s,a,n,e,r,_,l,h,c,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V;if(s=this._anchor2X-this._anchor1X,a=this._anchor2Y-this._anchor1Y,n=this._anchor2Z-this._anchor1Z,this._sd.frequency>0){let t=6.28318530717958*this._sd.frequency,o=this._sd.dampingRatio;o<oimo.common.Setting.minSpringDamperDampingRatio&&(o=oimo.common.Setting.minSpringDamperDampingRatio);let s=i.dt,a=2*o*t,n=t*t;this._sd.useSymplecticEuler?(e=1/(s*a),r=n/a):(e=1/(s*(s*n+a)),r=n/(s*n+a)),e*=this._b1._invMass+this._b2._invMass}else e=0,r=this.getErp(i,o);_=s*r,l=a*r,h=n*r,c=0,m=-this._relativeAnchor1Z,b=this._relativeAnchor1Y,x=this._relativeAnchor1Z,p=0,f=-this._relativeAnchor1X,u=-this._relativeAnchor1Y,v=this._relativeAnchor1X,X=0,y=0,g=-this._relativeAnchor2Z,d=this._relativeAnchor2Y,Y=this._relativeAnchor2Z,z=0,Z=-this._relativeAnchor2X,M=-this._relativeAnchor2Y,I=this._relativeAnchor2X,V=0,c=-c,m=-m,b=-b,x=-x,p=-p,f=-f,u=-u,v=-v,X=-X,y=-y,g=-g,d=-d,Y=-Y,z=-z,Z=-Z,M=-M,I=-I,V=-V;let L=this._impulses[0],w=t.rows[t.numRows++],k=w.jacobian;k.lin1X=0,k.lin1Y=0,k.lin1Z=0,k.lin2X=0,k.lin2Y=0,k.lin2Z=0,k.ang1X=0,k.ang1Y=0,k.ang1Z=0,k.ang2X=0,k.ang2Y=0,k.ang2Z=0,w.rhs=0,w.cfm=0,w.minImpulse=0,w.maxImpulse=0,w.motorSpeed=0,w.motorMaxImpulse=0,w.impulse=null,w.impulse=L,w.rhs=_,w.cfm=e,w.minImpulse=-Infinity,w.maxImpulse=Infinity;let B=w.jacobian;B.lin1X=1,B.lin1Y=0,B.lin1Z=0,B.lin2X=1,B.lin2Y=0,B.lin2Z=0,B.ang1X=c,B.ang1Y=m,B.ang1Z=b,B.ang2X=y,B.ang2Y=g,B.ang2Z=d;let A=this._impulses[1],P=t.rows[t.numRows++],S=P.jacobian;S.lin1X=0,S.lin1Y=0,S.lin1Z=0,S.lin2X=0,S.lin2Y=0,S.lin2Z=0,S.ang1X=0,S.ang1Y=0,S.ang1Z=0,S.ang2X=0,S.ang2Y=0,S.ang2Z=0,P.rhs=0,P.cfm=0,P.minImpulse=0,P.maxImpulse=0,P.motorSpeed=0,P.motorMaxImpulse=0,P.impulse=null,P.impulse=A,P.rhs=l,P.cfm=e,P.minImpulse=-Infinity,P.maxImpulse=Infinity,B=P.jacobian,B.lin1X=0,B.lin1Y=1,B.lin1Z=0,B.lin2X=0,B.lin2Y=1,B.lin2Z=0,B.ang1X=x,B.ang1Y=p,B.ang1Z=f,B.ang2X=Y,B.ang2Y=z,B.ang2Z=Z;let T=this._impulses[2],C=t.rows[t.numRows++],j=C.jacobian;j.lin1X=0,j.lin1Y=0,j.lin1Z=0,j.lin2X=0,j.lin2Y=0,j.lin2Z=0,j.ang1X=0,j.ang1Y=0,j.ang1Z=0,j.ang2X=0,j.ang2Y=0,j.ang2Z=0,C.rhs=0,C.cfm=0,C.minImpulse=0,C.maxImpulse=0,C.motorSpeed=0,C.motorMaxImpulse=0,C.impulse=null,C.impulse=T,C.rhs=h,C.cfm=e,C.minImpulse=-Infinity,C.maxImpulse=Infinity,B=C.jacobian,B.lin1X=0,B.lin1Y=0,B.lin1Z=1,B.lin2X=0,B.lin2Y=0,B.lin2Z=1,B.ang1X=u,B.ang1Y=v,B.ang1Z=X,B.ang2X=M,B.ang2Y=I,B.ang2Z=V}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getSpringDamper(){return this._sd}},oimo.dynamics.constraint.joint.SphericalJointConfig=class extends oimo.dynamics.constraint.joint.JointConfig{constructor(){super(),this.springDamper=new oimo.dynamics.constraint.joint.SpringDamper}init(t,i,o){return this._init(t,i,o),this}},oimo.dynamics.constraint.joint.SpringDamper=class{constructor(){this.frequency=0,this.dampingRatio=0,this.useSymplecticEuler=!1}setSpring(t,i){return this.frequency=t,this.dampingRatio=i,this}setSymplecticEuler(t){return this.useSymplecticEuler=t,this}clone(){let t=new oimo.dynamics.constraint.joint.SpringDamper;return t.frequency=this.frequency,t.dampingRatio=this.dampingRatio,t.useSymplecticEuler=this.useSymplecticEuler,t}},oimo.dynamics.constraint.joint.TranslationalLimitMotor=class{constructor(){this.lowerLimit=1,this.upperLimit=0,this.motorForce=0}setLimits(t,i){return this.lowerLimit=t,this.upperLimit=i,this}setMotor(t,i){return this.motorSpeed=t,this.motorForce=i,this}clone(){let t=new oimo.dynamics.constraint.joint.TranslationalLimitMotor;return t.lowerLimit=this.lowerLimit,t.upperLimit=this.upperLimit,t.motorSpeed=this.motorSpeed,t.motorForce=this.motorForce,t}},oimo.dynamics.constraint.joint.UniversalJoint=class extends oimo.dynamics.constraint.joint.Joint{constructor(t){super(t,oimo.dynamics.constraint.joint.JointType.UNIVERSAL);let i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let o=t.localAxis2;this._localBasisZ2X=o.x,this._localBasisZ2Y=o.y,this._localBasisZ2Z=o.z,this.buildLocalBasesFromX1Z2(),this._angleX=0,this._angleY=0,this._angleZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1,this._sd1=t.springDamper1.clone(),this._sd2=t.springDamper2.clone(),this._lm1=t.limitMotor1.clone(),this._lm2=t.limitMotor2.clone()}getInfo(t,i,o){let s,a,n,e=this.getErp(i,o);s=this.linearErrorX*e,a=this.linearErrorY*e,n=this.linearErrorZ*e;let r,_,l,h,c,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z=this._angleY*e;r=0,_=-this._relativeAnchor1Z,l=this._relativeAnchor1Y,h=this._relativeAnchor1Z,c=0,m=-this._relativeAnchor1X,b=-this._relativeAnchor1Y,x=this._relativeAnchor1X,p=0,f=0,u=-this._relativeAnchor2Z,v=this._relativeAnchor2Y,X=this._relativeAnchor2Z,y=0,g=-this._relativeAnchor2X,d=-this._relativeAnchor2Y,Y=this._relativeAnchor2X,z=0,r=-r,_=-_,l=-l,h=-h,c=-c,m=-m,b=-b,x=-x,p=-p,f=-f,u=-u,v=-v,X=-X,y=-y,g=-g,d=-d,Y=-Y,z=-z;let M=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),I=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ),V=this._impulses[0],L=t.rows[t.numRows++],w=L.jacobian;w.lin1X=0,w.lin1Y=0,w.lin1Z=0,w.lin2X=0,w.lin2Y=0,w.lin2Z=0,w.ang1X=0,w.ang1Y=0,w.ang1Z=0,w.ang2X=0,w.ang2Y=0,w.ang2Z=0,L.rhs=0,L.cfm=0,L.minImpulse=0,L.maxImpulse=0,L.motorSpeed=0,L.motorMaxImpulse=0,L.impulse=null,L.impulse=V,L.rhs=s,L.cfm=0,L.minImpulse=-Infinity,L.maxImpulse=Infinity;let k=L.jacobian;k.lin1X=1,k.lin1Y=0,k.lin1Z=0,k.lin2X=1,k.lin2Y=0,k.lin2Z=0,k.ang1X=r,k.ang1Y=_,k.ang1Z=l,k.ang2X=f,k.ang2Y=u,k.ang2Z=v;let B=this._impulses[1],A=t.rows[t.numRows++],P=A.jacobian;P.lin1X=0,P.lin1Y=0,P.lin1Z=0,P.lin2X=0,P.lin2Y=0,P.lin2Z=0,P.ang1X=0,P.ang1Y=0,P.ang1Z=0,P.ang2X=0,P.ang2Y=0,P.ang2Z=0,A.rhs=0,A.cfm=0,A.minImpulse=0,A.maxImpulse=0,A.motorSpeed=0,A.motorMaxImpulse=0,A.impulse=null,A.impulse=B,A.rhs=a,A.cfm=0,A.minImpulse=-Infinity,A.maxImpulse=Infinity,k=A.jacobian,k.lin1X=0,k.lin1Y=1,k.lin1Z=0,k.lin2X=0,k.lin2Y=1,k.lin2Z=0,k.ang1X=h,k.ang1Y=c,k.ang1Z=m,k.ang2X=X,k.ang2Y=y,k.ang2Z=g;let S=this._impulses[2],T=t.rows[t.numRows++],C=T.jacobian;if(C.lin1X=0,C.lin1Y=0,C.lin1Z=0,C.lin2X=0,C.lin2Y=0,C.lin2Z=0,C.ang1X=0,C.ang1Y=0,C.ang1Z=0,C.ang2X=0,C.ang2Y=0,C.ang2Z=0,T.rhs=0,T.cfm=0,T.minImpulse=0,T.maxImpulse=0,T.motorSpeed=0,T.motorMaxImpulse=0,T.impulse=null,T.impulse=S,T.rhs=n,T.cfm=0,T.minImpulse=-Infinity,T.maxImpulse=Infinity,k=T.jacobian,k.lin1X=0,k.lin1Y=0,k.lin1Z=1,k.lin2X=0,k.lin2Y=0,k.lin2Z=1,k.ang1X=b,k.ang1Y=x,k.ang1Z=p,k.ang2X=d,k.ang2Y=Y,k.ang2Z=z,!this.xSingular&&(this._sd1.frequency<=0||!o)){let s=this._impulses[3],a=t.rows[t.numRows++],n=a.jacobian;n.lin1X=0,n.lin1Y=0,n.lin1Z=0,n.lin2X=0,n.lin2Y=0,n.lin2Z=0,n.ang1X=0,n.ang1Y=0,n.ang1Z=0,n.ang2X=0,n.ang2Y=0,n.ang2Z=0,a.rhs=0,a.cfm=0,a.minImpulse=0,a.maxImpulse=0,a.motorSpeed=0,a.motorMaxImpulse=0,a.impulse=null,a.impulse=s,this.setSolverInfoRowAngular(a,this._angleX,this._lm1,M,this._sd1,i,o),k=a.jacobian,k.ang1X=this._axisXX,k.ang1Y=this._axisXY,k.ang1Z=this._axisXZ,k.ang2X=this._axisXX,k.ang2Y=this._axisXY,k.ang2Z=this._axisXZ}if(!this.ySingular){let i=this._impulses[4],o=t.rows[t.numRows++],s=o.jacobian;s.lin1X=0,s.lin1Y=0,s.lin1Z=0,s.lin2X=0,s.lin2Y=0,s.lin2Z=0,s.ang1X=0,s.ang1Y=0,s.ang1Z=0,s.ang2X=0,s.ang2Y=0,s.ang2Z=0,o.rhs=0,o.cfm=0,o.minImpulse=0,o.maxImpulse=0,o.motorSpeed=0,o.motorMaxImpulse=0,o.impulse=null,o.impulse=i,o.rhs=Z,o.cfm=0,o.minImpulse=-Infinity,o.maxImpulse=Infinity,k=o.jacobian,k.ang1X=this._axisYX,k.ang1Y=this._axisYY,k.ang1Z=this._axisYZ,k.ang2X=this._axisYX,k.ang2Y=this._axisYY,k.ang2Z=this._axisYZ}if(!this.zSingular&&(this._sd2.frequency<=0||!o)){let s=this._impulses[5],a=t.rows[t.numRows++],n=a.jacobian;n.lin1X=0,n.lin1Y=0,n.lin1Z=0,n.lin2X=0,n.lin2Y=0,n.lin2Z=0,n.ang1X=0,n.ang1Y=0,n.ang1Z=0,n.ang2X=0,n.ang2Y=0,n.ang2Z=0,a.rhs=0,a.cfm=0,a.minImpulse=0,a.maxImpulse=0,a.motorSpeed=0,a.motorMaxImpulse=0,a.impulse=null,a.impulse=s,this.setSolverInfoRowAngular(a,this._angleZ,this._lm2,I,this._sd2,i,o),k=a.jacobian,k.ang1X=this._axisZX,k.ang1Y=this._axisZY,k.ang1Z=this._axisZZ,k.ang2X=this._axisZX,k.ang2Y=this._axisZY,k.ang2Z=this._axisZZ}}_syncAnchors(){let t,i,o,s,a,n,e,r,_;super._syncAnchors(),t=this._basisX1X,i=this._basisX1Y,o=this._basisX1Z,e=this._basisZ2X,r=this._basisZ2Y,_=this._basisZ2Z,s=r*o-_*i,a=_*t-e*o,n=e*i-r*t,this._axisXX=a*_-n*r,this._axisXY=n*e-s*_,this._axisXZ=s*r-a*e,this._axisYX=s,this._axisYY=a,this._axisYZ=n,this._axisZX=i*n-o*a,this._axisZY=o*s-t*n,this._axisZZ=t*a-i*s;let l=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;l>0&&(l=1/Math.sqrt(l)),this._axisXX*=l,this._axisXY*=l,this._axisXZ*=l;let h=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;h>0&&(h=1/Math.sqrt(h)),this._axisYX*=h,this._axisYY*=h,this._axisYZ*=h;let c,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A,P,S,T,C,j,R,q,E,D,F,N,W,G=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;G>0&&(G=1/Math.sqrt(G)),this._axisZX*=G,this._axisZY*=G,this._axisZZ*=G,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0,c=this._basisX1X,m=this._basisY1X,b=this._basisZ1X,x=this._basisX1Y,p=this._basisY1Y,f=this._basisZ1Y,u=this._basisX1Z,v=this._basisY1Z,X=this._basisZ1Z,y=this._basisX2X,g=this._basisY2X,d=this._basisZ2X,Y=this._basisX2Y,z=this._basisY2Y,Z=this._basisZ2Y,M=this._basisX2Z,I=this._basisY2Z,V=this._basisZ2Z,T=c*y+x*Y+u*M,C=c*g+x*z+u*I,j=c*d+x*Z+u*V,R=m*g+p*z+v*I,q=m*d+p*Z+v*V,E=b*g+f*z+X*I,D=b*d+f*Z+X*V,L=T,w=C,k=j,B=R,A=q,P=E,S=D;let J=k;if(J<=-1){let t=Math.atan2(P,B);F=.5*t,N=-1.570796326794895,W=.5*-t}else if(J>=1){let t=Math.atan2(P,B);F=.5*t,N=1.570796326794895,W=.5*t}else F=Math.atan2(-A,S),N=Math.asin(J),W=Math.atan2(-w,L);this._angleX=F,this._angleY=N,this._angleZ=W,this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new oimo.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new oimo.common.Vec3;return t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z}getLocalAxis1(){let t=new oimo.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new oimo.common.Vec3;return t.x=this._localBasisZ2X,t.y=this._localBasisZ2Y,t.z=this._localBasisZ2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisZ2X,t.y=this._localBasisZ2Y,t.z=this._localBasisZ2Z}getSpringDamper1(){return this._sd1}getSpringDamper2(){return this._sd2}getLimitMotor1(){return this._lm1}getLimitMotor2(){return this._lm2}getAngle1(){return this._angleX}getAngle2(){return this._angleZ}},oimo.dynamics.constraint.joint.UniversalJointConfig=class extends oimo.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new oimo.common.Vec3(1,0,0),this.localAxis2=new oimo.common.Vec3(1,0,0),this.springDamper1=new oimo.dynamics.constraint.joint.SpringDamper,this.springDamper2=new oimo.dynamics.constraint.joint.SpringDamper,this.limitMotor1=new oimo.dynamics.constraint.joint.RotationalLimitMotor,this.limitMotor2=new oimo.dynamics.constraint.joint.RotationalLimitMotor}init(t,i,o,s,a){this._init(t,i,o);let n,e,r,_,l,h,c=this.localAxis1;n=s.x,e=s.y,r=s.z,_=t._transform._rotation00*n+t._transform._rotation10*e+t._transform._rotation20*r,l=t._transform._rotation01*n+t._transform._rotation11*e+t._transform._rotation21*r,h=t._transform._rotation02*n+t._transform._rotation12*e+t._transform._rotation22*r,n=_,e=l,r=h,c.x=n,c.y=e,c.z=r;let m,b,x,p,f,u,v=this.localAxis2;return m=a.x,b=a.y,x=a.z,p=i._transform._rotation00*m+i._transform._rotation10*b+i._transform._rotation20*x,f=i._transform._rotation01*m+i._transform._rotation11*b+i._transform._rotation21*x,u=i._transform._rotation02*m+i._transform._rotation12*b+i._transform._rotation22*x,m=p,b=f,x=u,v.x=m,v.y=b,v.z=x,this}},oimo.dynamics.constraint.solver||(oimo.dynamics.constraint.solver={}),oimo.dynamics.constraint.solver.ConstraintSolverType=class{},oimo.dynamics.constraint.solver.common||(oimo.dynamics.constraint.solver.common={}),oimo.dynamics.constraint.solver.common.ContactSolverMassDataRow=class{constructor(){this.invMLinN1X=0,this.invMLinN1Y=0,this.invMLinN1Z=0,this.invMLinN2X=0,this.invMLinN2Y=0,this.invMLinN2Z=0,this.invMAngN1X=0,this.invMAngN1Y=0,this.invMAngN1Z=0,this.invMAngN2X=0,this.invMAngN2Y=0,this.invMAngN2Z=0,this.invMLinT1X=0,this.invMLinT1Y=0,this.invMLinT1Z=0,this.invMLinT2X=0,this.invMLinT2Y=0,this.invMLinT2Z=0,this.invMAngT1X=0,this.invMAngT1Y=0,this.invMAngT1Z=0,this.invMAngT2X=0,this.invMAngT2Y=0,this.invMAngT2Z=0,this.invMLinB1X=0,this.invMLinB1Y=0,this.invMLinB1Z=0,this.invMLinB2X=0,this.invMLinB2Y=0,this.invMLinB2Z=0,this.invMAngB1X=0,this.invMAngB1Y=0,this.invMAngB1Z=0,this.invMAngB2X=0,this.invMAngB2Y=0,this.invMAngB2Z=0,this.massN=0,this.massTB00=0,this.massTB01=0,this.massTB10=0,this.massTB11=0}},oimo.dynamics.constraint.solver.common.JointSolverMassDataRow=class{constructor(){this.invMLin1X=0,this.invMLin1Y=0,this.invMLin1Z=0,this.invMLin2X=0,this.invMLin2Y=0,this.invMLin2Z=0,this.invMAng1X=0,this.invMAng1Y=0,this.invMAng1Z=0,this.invMAng2X=0,this.invMAng2Y=0,this.invMAng2Z=0,this.mass=0,this.massWithoutCfm=0}},oimo.dynamics.constraint.solver.direct||(oimo.dynamics.constraint.solver.direct={}),oimo.dynamics.constraint.solver.direct.Boundary=class{constructor(t){this.iBounded=new Array(t),this.iUnbounded=new Array(t),this.signs=new Array(t),this.b=new Array(t),this.numBounded=0,this.numUnbounded=0,this.matrixId=0}init(t){this.numBounded=t.numBounded;let i=0,o=this.numBounded;for(;i<o;){let o=i++;this.iBounded[o]=t.iBounded[o],this.signs[o]=t.signs[o]}this.numUnbounded=t.numUnbounded,this.matrixId=0;let s=0,a=this.numUnbounded;for(;s<a;){let i=s++,o=t.iUnbounded[i];this.iUnbounded[i]=o,this.matrixId|=1<<o}}computeImpulses(t,i,o,s,a,n,e){let r=0,_=this.numUnbounded;for(;r<_;){let i=this.iUnbounded[r++],a=t.rows[i];this.b[i]=a.rhs*n-o[i]-a.cfm*s[i]}let l=i._invMassWithoutCfm,h=0,c=this.numBounded;for(;h<c;){let i=h++,o=this.iBounded[i],n=this.signs[i],e=t.rows[o],r=(n<0?e.minImpulse:n>0?e.maxImpulse:0)-s[o];if(a[o]=r,0!=r){let t=0,i=this.numUnbounded;for(;t<i;){let i=this.iUnbounded[t++];this.b[i]-=l[o][i]*r}}}let m,b=this.iUnbounded,x=this.numUnbounded,p=0,f=0;for(;f<x;)p|=1<<b[f++];i._cacheComputed[p]||(i.computeSubmatrix(p,b,x),i._cacheComputed[p]=!0),m=i._cachedSubmatrices[p];let u=!0,v=0,X=this.numUnbounded;for(;v<X;){let i=v++,o=this.iUnbounded[i],n=t.rows[o],e=s[o],r=e,_=0,l=this.numUnbounded;for(;_<l;){let t=_++;r+=this.b[this.iUnbounded[t]]*m[i][t]}if(r<n.minImpulse-oimo.common.Setting.directMlcpSolverEps||r>n.maxImpulse+oimo.common.Setting.directMlcpSolverEps){u=!1;break}a[o]=r-e}if(e)return!0;if(!u)return!1;let y=0,g=this.numBounded;for(;y<g;){let i=y++,e=this.iBounded[i],r=t.rows[e],_=this.signs[i],h=0,c=s[e]+a[e],m=o[e],b=0,x=t.numRows;for(;b<x;){let t=b++;m+=l[e][t]*a[t]}if(h=r.rhs*n-m-r.cfm*c,_<0&&h>oimo.common.Setting.directMlcpSolverEps||_>0&&h<-oimo.common.Setting.directMlcpSolverEps){u=!1;break}}return u}},oimo.dynamics.constraint.solver.direct.BoundaryBuildInfo=class{constructor(t){this.size=t,this.numBounded=0,this.iBounded=new Array(t),this.signs=new Array(t),this.numUnbounded=0,this.iUnbounded=new Array(t)}},oimo.dynamics.constraint.solver.direct.BoundaryBuilder=class{constructor(t){this.maxRows=t,this.numBoundaries=0,this.boundaries=new Array(1<<t),this.bbInfo=new oimo.dynamics.constraint.solver.direct.BoundaryBuildInfo(t)}buildBoundariesRecursive(t,i){if(i==t.numRows)return null==this.boundaries[this.numBoundaries]&&(this.boundaries[this.numBoundaries]=new oimo.dynamics.constraint.solver.direct.Boundary(this.maxRows)),void this.boundaries[this.numBoundaries++].init(this.bbInfo);let o=t.rows[i],s=o.minImpulse>-Infinity,a=o.maxImpulse<Infinity;if(0==o.minImpulse&&0==o.maxImpulse){let o=this.bbInfo;return o.iBounded[o.numBounded]=i,o.signs[o.numBounded]=0,o.numBounded++,this.buildBoundariesRecursive(t,i+1),void this.bbInfo.numBounded--}let n=this.bbInfo;if(n.iUnbounded[n.numUnbounded]=i,n.numUnbounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numUnbounded--,s){let o=this.bbInfo;o.iBounded[o.numBounded]=i,o.signs[o.numBounded]=-1,o.numBounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numBounded--}if(a){let o=this.bbInfo;o.iBounded[o.numBounded]=i,o.signs[o.numBounded]=1,o.numBounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numBounded--}}buildBoundaries(t){this.numBoundaries=0;let i=this.bbInfo;i.numBounded=0,i.numUnbounded=0,this.buildBoundariesRecursive(t,0)}},oimo.dynamics.constraint.solver.direct.BoundarySelector=class{constructor(t){this.n=t,this.indices=new Array(t),this.tmpIndices=new Array(t);let i=0;for(;i<t;){let t=i++;this.indices[t]=t}}getIndex(t){return this.indices[t]}select(t){let i=0;for(;this.indices[i]!=t;)++i;for(;i>0;){let t=this.indices[i];this.indices[i]=this.indices[i-1],this.indices[i-1]=t,--i}}setSize(t){let i=0,o=0,s=0,a=this.n;for(;s<a;){let a=this.indices[s++];a<t?(this.tmpIndices[i]=a,++i):(this.tmpIndices[t+o]=a,++o)}let n=this.indices;this.indices=this.tmpIndices,this.tmpIndices=n}},oimo.dynamics.constraint.solver.direct.DirectJointConstraintSolver=class extends oimo.dynamics.constraint.ConstraintSolver{constructor(t){super(),this.joint=t,this.info=new oimo.dynamics.constraint.info.joint.JointSolverInfo;let i=oimo.common.Setting.maxJacobianRows;this.massMatrix=new oimo.dynamics.constraint.solver.direct.MassMatrix(i),this.boundaryBuilder=new oimo.dynamics.constraint.solver.direct.BoundaryBuilder(i),this.massData=new Array(i);let o=0,s=this.massData.length;for(;o<s;)this.massData[o++]=new oimo.dynamics.constraint.solver.common.JointSolverMassDataRow;let a=this.boundaryBuilder.boundaries.length;this.velBoundarySelector=new oimo.dynamics.constraint.solver.direct.BoundarySelector(a),this.posBoundarySelector=new oimo.dynamics.constraint.solver.direct.BoundarySelector(a),this.relVels=new Array(i),this.impulses=new Array(i),this.dImpulses=new Array(i),this.dTotalImpulses=new Array(i);let n=0;for(;n<i;){let t=n++;this.relVels[t]=0,this.impulses[t]=0,this.dImpulses[t]=0,this.dTotalImpulses[t]=0}}preSolveVelocity(t){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);let i=this.boundaryBuilder;i.numBoundaries=0;let o=i.bbInfo;o.numBounded=0,o.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);let s=this.velBoundarySelector,a=this.boundaryBuilder.numBoundaries,n=0,e=0,r=0,_=s.n;for(;r<_;){let t=s.indices[r++];t<a?(s.tmpIndices[n]=t,++n):(s.tmpIndices[a+e]=t,++e)}let l=s.indices;s.indices=s.tmpIndices,s.tmpIndices=l}warmStart(t){let i=this.joint._positionCorrectionAlgorithm==oimo.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?oimo.common.Setting.jointWarmStartingFactorForBaungarte:oimo.common.Setting.jointWarmStartingFactor;if(i*=t.dtRatio,i<=0){let t=0,i=this.info.numRows;for(;t<i;){let i=this.info.rows[t++].impulse;i.impulse=0,i.impulseM=0,i.impulseP=0}return}let o=0,s=this.info.numRows;for(;o<s;){let t=o++,s=this.info.rows[t],a=s.impulse,n=a.impulse*i;if(n<s.minImpulse?n=s.minImpulse:n>s.maxImpulse&&(n=s.maxImpulse),a.impulse=n,s.motorMaxImpulse>0){let t=a.impulseM*i,o=s.motorMaxImpulse;t<-o?t=-o:t>o&&(t=o),a.impulseM=t}else a.impulseM=0;this.dImpulses[t]=a.impulse+a.impulseM}let a,n,e,r,_,l,h,c,m,b,x,p,f=this.dImpulses,u=!1,v=!1;a=this._b1._velX,n=this._b1._velY,e=this._b1._velZ,r=this._b2._velX,_=this._b2._velY,l=this._b2._velZ,h=this._b1._angVelX,c=this._b1._angVelY,m=this._b1._angVelZ,b=this._b2._angVelX,x=this._b2._angVelY,p=this._b2._angVelZ;let X=0,y=this.info.numRows;for(;X<y;){let t=X++,i=this.info.rows[t].jacobian,o=this.massData[t],s=f[t];0!=(1&i.flag)&&(a+=o.invMLin1X*s,n+=o.invMLin1Y*s,e+=o.invMLin1Z*s,r+=o.invMLin2X*-s,_+=o.invMLin2Y*-s,l+=o.invMLin2Z*-s,u=!0),0!=(2&i.flag)&&(h+=o.invMAng1X*s,c+=o.invMAng1Y*s,m+=o.invMAng1Z*s,b+=o.invMAng2X*-s,x+=o.invMAng2Y*-s,p+=o.invMAng2Z*-s,v=!0)}u&&(this._b1._velX=a,this._b1._velY=n,this._b1._velZ=e,this._b2._velX=r,this._b2._velY=_,this._b2._velZ=l),v&&(this._b1._angVelX=h,this._b1._angVelY=c,this._b1._angVelZ=m,this._b2._angVelX=b,this._b2._angVelY=x,this._b2._angVelZ=p)}solveVelocity(){let t,i,o,s,a,n,e,r,_,l,h,c,m=this.info.numRows;t=this._b1._velX,i=this._b1._velY,o=this._b1._velZ,s=this._b2._velX,a=this._b2._velY,n=this._b2._velZ,e=this._b1._angVelX,r=this._b1._angVelY,_=this._b1._angVelZ,l=this._b2._angVelX,h=this._b2._angVelY,c=this._b2._angVelZ;let b=0;for(;b<m;){let m=b++,x=this.info.rows[m],p=x.jacobian,f=0;f+=t*p.lin1X+i*p.lin1Y+o*p.lin1Z,f-=s*p.lin2X+a*p.lin2Y+n*p.lin2Z,f+=e*p.ang1X+r*p.ang1Y+_*p.ang1Z,f-=l*p.ang2X+h*p.ang2Y+c*p.ang2Z,this.relVels[m]=f,this.impulses[m]=x.impulse.impulse,this.dTotalImpulses[m]=0}let x=this.massMatrix._invMassWithoutCfm,p=0;for(;p<m;){let t=p++,i=this.info.rows[t],o=i.impulse;if(i.motorMaxImpulse>0){let s=o.impulseM,a=s+this.massData[t].massWithoutCfm*(-i.motorSpeed-this.relVels[t]),n=i.motorMaxImpulse;a<-n?a=-n:a>n&&(a=n),o.impulseM=a;let e=a-s;this.dTotalImpulses[t]=e;let r=0;for(;r<m;){let i=r++;this.relVels[i]+=e*x[t][i]}}}let f=!1,u=0,v=this.boundaryBuilder.numBoundaries;for(;u<v;){let t=this.velBoundarySelector.indices[u++];if(this.boundaryBuilder.boundaries[t].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,1,!1)){let i=0;for(;i<m;){let t=i++,o=this.dImpulses[t];this.info.rows[t].impulse.impulse+=o,this.dTotalImpulses[t]+=o}let o,s,a,n,e,r,_,l,h,c,b,x,p=this.dTotalImpulses,u=!1,v=!1;o=this._b1._velX,s=this._b1._velY,a=this._b1._velZ,n=this._b2._velX,e=this._b2._velY,r=this._b2._velZ,_=this._b1._angVelX,l=this._b1._angVelY,h=this._b1._angVelZ,c=this._b2._angVelX,b=this._b2._angVelY,x=this._b2._angVelZ;let X=0,y=this.info.numRows;for(;X<y;){let t=X++,i=this.info.rows[t].jacobian,m=this.massData[t],f=p[t];0!=(1&i.flag)&&(o+=m.invMLin1X*f,s+=m.invMLin1Y*f,a+=m.invMLin1Z*f,n+=m.invMLin2X*-f,e+=m.invMLin2Y*-f,r+=m.invMLin2Z*-f,u=!0),0!=(2&i.flag)&&(_+=m.invMAng1X*f,l+=m.invMAng1Y*f,h+=m.invMAng1Z*f,c+=m.invMAng2X*-f,b+=m.invMAng2Y*-f,x+=m.invMAng2Z*-f,v=!0)}u&&(this._b1._velX=o,this._b1._velY=s,this._b1._velZ=a,this._b2._velX=n,this._b2._velY=e,this._b2._velZ=r),v&&(this._b1._angVelX=_,this._b1._angVelY=l,this._b1._angVelZ=h,this._b2._angVelX=c,this._b2._angVelY=b,this._b2._angVelZ=x);let g=this.velBoundarySelector,d=0;for(;g.indices[d]!=t;)++d;for(;d>0;){let t=g.indices[d];g.indices[d]=g.indices[d-1],g.indices[d-1]=t,--d}f=!0;break}}f||console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:335:","could not find solution. (velocity)")}postSolveVelocity(t){let i,o,s,a,n,e;i=0,o=0,s=0,a=0,n=0,e=0;let r=0,_=this.info.numRows;for(;r<_;){let t=this.info.rows[r++],_=t.impulse,l=t.jacobian;0!=(1&l.flag)?(i+=l.lin1X*_.impulse,o+=l.lin1Y*_.impulse,s+=l.lin1Z*_.impulse):0!=(2&l.flag)&&(a+=l.ang1X*_.impulse,n+=l.ang1Y*_.impulse,e+=l.ang1Z*_.impulse)}this.joint._appliedForceX=i*t.invDt,this.joint._appliedForceY=o*t.invDt,this.joint._appliedForceZ=s*t.invDt,this.joint._appliedTorqueX=a*t.invDt,this.joint._appliedTorqueY=n*t.invDt,this.joint._appliedTorqueZ=e*t.invDt}preSolvePosition(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);let i=this.boundaryBuilder;i.numBoundaries=0;let o=i.bbInfo;o.numBounded=0,o.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);let s=this.posBoundarySelector,a=this.boundaryBuilder.numBoundaries,n=0,e=0,r=0,_=s.n;for(;r<_;){let t=s.indices[r++];t<a?(s.tmpIndices[n]=t,++n):(s.tmpIndices[a+e]=t,++e)}let l=s.indices;s.indices=s.tmpIndices,s.tmpIndices=l;let h=0,c=this.info.numRows;for(;h<c;)this.info.rows[h++].impulse.impulseP=0}solvePositionSplitImpulse(){let t,i,o,s,a,n,e,r,_,l,h,c,m=this.info.numRows;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,o=this._b1._pseudoVelZ,s=this._b2._pseudoVelX,a=this._b2._pseudoVelY,n=this._b2._pseudoVelZ,e=this._b1._angPseudoVelX,r=this._b1._angPseudoVelY,_=this._b1._angPseudoVelZ,l=this._b2._angPseudoVelX,h=this._b2._angPseudoVelY,c=this._b2._angPseudoVelZ;let b=0;for(;b<m;){let m=b++,x=this.info.rows[m],p=x.jacobian,f=0;f+=t*p.lin1X+i*p.lin1Y+o*p.lin1Z,f-=s*p.lin2X+a*p.lin2Y+n*p.lin2Z,f+=e*p.ang1X+r*p.ang1Y+_*p.ang1Z,f-=l*p.ang2X+h*p.ang2Y+c*p.ang2Z,this.relVels[m]=f,this.impulses[m]=x.impulse.impulseP}let x=!1,p=0,f=this.boundaryBuilder.numBoundaries;for(;p<f;){let t=this.posBoundarySelector.indices[p++];if(this.boundaryBuilder.boundaries[t].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,oimo.common.Setting.positionSplitImpulseBaumgarte,!1)){let i=0;for(;i<m;){let t=i++;this.info.rows[t].impulse.impulseP+=this.dImpulses[t]}let o,s,a,n,e,r,_,l,h,c,b,p,f=this.dImpulses,u=!1,v=!1;o=this._b1._pseudoVelX,s=this._b1._pseudoVelY,a=this._b1._pseudoVelZ,n=this._b2._pseudoVelX,e=this._b2._pseudoVelY,r=this._b2._pseudoVelZ,_=this._b1._angPseudoVelX,l=this._b1._angPseudoVelY,h=this._b1._angPseudoVelZ,c=this._b2._angPseudoVelX,b=this._b2._angPseudoVelY,p=this._b2._angPseudoVelZ;let X=0,y=this.info.numRows;for(;X<y;){let t=X++,i=this.info.rows[t].jacobian,m=this.massData[t],x=f[t];0!=(1&i.flag)&&(o+=m.invMLin1X*x,s+=m.invMLin1Y*x,a+=m.invMLin1Z*x,n+=m.invMLin2X*-x,e+=m.invMLin2Y*-x,r+=m.invMLin2Z*-x,u=!0),0!=(2&i.flag)&&(_+=m.invMAng1X*x,l+=m.invMAng1Y*x,h+=m.invMAng1Z*x,c+=m.invMAng2X*-x,b+=m.invMAng2Y*-x,p+=m.invMAng2Z*-x,v=!0)}u&&(this._b1._pseudoVelX=o,this._b1._pseudoVelY=s,this._b1._pseudoVelZ=a,this._b2._pseudoVelX=n,this._b2._pseudoVelY=e,this._b2._pseudoVelZ=r),v&&(this._b1._angPseudoVelX=_,this._b1._angPseudoVelY=l,this._b1._angPseudoVelZ=h,this._b2._angPseudoVelX=c,this._b2._angPseudoVelY=b,this._b2._angPseudoVelZ=p);let g=this.posBoundarySelector,d=0;for(;g.indices[d]!=t;)++d;for(;d>0;){let t=g.indices[d];g.indices[d]=g.indices[d-1],g.indices[d-1]=t,--d}x=!0;break}}x||console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:450:","could not find solution. (split impulse)")}solvePositionNgs(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);let i=this.boundaryBuilder;i.numBoundaries=0;let o=i.bbInfo;o.numBounded=0,o.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);let s=this.posBoundarySelector,a=this.boundaryBuilder.numBoundaries,n=0,e=0,r=0,_=s.n;for(;r<_;){let t=s.indices[r++];t<a?(s.tmpIndices[n]=t,++n):(s.tmpIndices[a+e]=t,++e)}let l=s.indices;s.indices=s.tmpIndices,s.tmpIndices=l;let h=this.info.numRows,c=0;for(;c<h;){let t=c++,i=this.info.rows[t].impulse;this.relVels[t]=0,this.impulses[t]=i.impulseP}let m=!1,b=0,x=this.boundaryBuilder.numBoundaries;for(;b<x;){let t=this.posBoundarySelector.indices[b++];if(this.boundaryBuilder.boundaries[t].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,oimo.common.Setting.positionNgsBaumgarte,!1)){let i=0;for(;i<h;){let t=i++;this.info.rows[t].impulse.impulseP+=this.dImpulses[t]}let o,s,a,n,e,r,_,l,c,b,x,p,f=this.dImpulses,u=!1,v=!1;o=0,s=0,a=0,n=0,e=0,r=0,_=0,l=0,c=0,b=0,x=0,p=0;let X=0,y=this.info.numRows;for(;X<y;){let t=X++,i=this.info.rows[t].jacobian,h=this.massData[t],m=f[t];0!=(1&i.flag)&&(o+=h.invMLin1X*m,s+=h.invMLin1Y*m,a+=h.invMLin1Z*m,n+=h.invMLin2X*-m,e+=h.invMLin2Y*-m,r+=h.invMLin2Z*-m,u=!0),0!=(2&i.flag)&&(_+=h.invMAng1X*m,l+=h.invMAng1Y*m,c+=h.invMAng1Z*m,b+=h.invMAng2X*-m,x+=h.invMAng2Y*-m,p+=h.invMAng2Z*-m,v=!0)}if(u){let t=this._b1;t._transform._positionX+=o,t._transform._positionY+=s,t._transform._positionZ+=a;let i=this._b2;i._transform._positionX+=n,i._transform._positionY+=e,i._transform._positionZ+=r}if(v){let t,i,o,s,a,n,e,r,h,m,f,u,v,X=this._b1,y=Math.sqrt(_*_+l*l+c*c),g=.5*y;if(g<.5){let o=g*g;t=.5*(1-.16666666666666666*o+o*o*.008333333333333333),i=1-.5*o+o*o*.041666666666666664}else t=Math.sin(g)/y,i=Math.cos(g);o=_*t,s=l*t,a=c*t,n=o,e=s,r=a,h=i;let d,Y=X._transform._rotation00,z=X._transform._rotation11,Z=X._transform._rotation22,M=Y+z+Z;M>0?(d=Math.sqrt(M+1),v=.5*d,d=.5/d,m=(X._transform._rotation21-X._transform._rotation12)*d,f=(X._transform._rotation02-X._transform._rotation20)*d,u=(X._transform._rotation10-X._transform._rotation01)*d):Y>z?Y>Z?(d=Math.sqrt(Y-z-Z+1),m=.5*d,d=.5/d,f=(X._transform._rotation01+X._transform._rotation10)*d,u=(X._transform._rotation02+X._transform._rotation20)*d,v=(X._transform._rotation21-X._transform._rotation12)*d):(d=Math.sqrt(Z-Y-z+1),u=.5*d,d=.5/d,m=(X._transform._rotation02+X._transform._rotation20)*d,f=(X._transform._rotation12+X._transform._rotation21)*d,v=(X._transform._rotation10-X._transform._rotation01)*d):z>Z?(d=Math.sqrt(z-Z-Y+1),f=.5*d,d=.5/d,m=(X._transform._rotation01+X._transform._rotation10)*d,u=(X._transform._rotation12+X._transform._rotation21)*d,v=(X._transform._rotation02-X._transform._rotation20)*d):(d=Math.sqrt(Z-Y-z+1),u=.5*d,d=.5/d,m=(X._transform._rotation02+X._transform._rotation20)*d,f=(X._transform._rotation12+X._transform._rotation21)*d,v=(X._transform._rotation10-X._transform._rotation01)*d),m=h*m+n*v+e*u-r*f,f=h*f-n*u+e*v+r*m,u=h*u+n*f-e*m+r*v,v=h*v-n*m-e*f-r*u;let I=m*m+f*f+u*u+v*v;I>1e-32&&(I=1/Math.sqrt(I)),m*=I,f*=I,u*=I,v*=I;let V,L,w,k,B,A,P,S,T,C,j,R,q,E,D,F,N,W,G=2*m,J=2*f,O=2*u,H=m*G,U=f*J,Q=u*O,K=m*J,$=f*O,tt=m*O,it=v*G,ot=v*J,st=v*O;X._transform._rotation00=1-U-Q,X._transform._rotation01=K-st,X._transform._rotation02=tt+ot,X._transform._rotation10=K+st,X._transform._rotation11=1-H-Q,X._transform._rotation12=$-it,X._transform._rotation20=tt-ot,X._transform._rotation21=$+it,X._transform._rotation22=1-H-U,V=X._transform._rotation00*X._invLocalInertia00+X._transform._rotation01*X._invLocalInertia10+X._transform._rotation02*X._invLocalInertia20,L=X._transform._rotation00*X._invLocalInertia01+X._transform._rotation01*X._invLocalInertia11+X._transform._rotation02*X._invLocalInertia21,w=X._transform._rotation00*X._invLocalInertia02+X._transform._rotation01*X._invLocalInertia12+X._transform._rotation02*X._invLocalInertia22,k=X._transform._rotation10*X._invLocalInertia00+X._transform._rotation11*X._invLocalInertia10+X._transform._rotation12*X._invLocalInertia20,B=X._transform._rotation10*X._invLocalInertia01+X._transform._rotation11*X._invLocalInertia11+X._transform._rotation12*X._invLocalInertia21,A=X._transform._rotation10*X._invLocalInertia02+X._transform._rotation11*X._invLocalInertia12+X._transform._rotation12*X._invLocalInertia22,P=X._transform._rotation20*X._invLocalInertia00+X._transform._rotation21*X._invLocalInertia10+X._transform._rotation22*X._invLocalInertia20,S=X._transform._rotation20*X._invLocalInertia01+X._transform._rotation21*X._invLocalInertia11+X._transform._rotation22*X._invLocalInertia21,T=X._transform._rotation20*X._invLocalInertia02+X._transform._rotation21*X._invLocalInertia12+X._transform._rotation22*X._invLocalInertia22,X._invInertia00=V,X._invInertia01=L,X._invInertia02=w,X._invInertia10=k,X._invInertia11=B,X._invInertia12=A,X._invInertia20=P,X._invInertia21=S,X._invInertia22=T,C=X._invInertia00*X._transform._rotation00+X._invInertia01*X._transform._rotation01+X._invInertia02*X._transform._rotation02,j=X._invInertia00*X._transform._rotation10+X._invInertia01*X._transform._rotation11+X._invInertia02*X._transform._rotation12,R=X._invInertia00*X._transform._rotation20+X._invInertia01*X._transform._rotation21+X._invInertia02*X._transform._rotation22,q=X._invInertia10*X._transform._rotation00+X._invInertia11*X._transform._rotation01+X._invInertia12*X._transform._rotation02,E=X._invInertia10*X._transform._rotation10+X._invInertia11*X._transform._rotation11+X._invInertia12*X._transform._rotation12,D=X._invInertia10*X._transform._rotation20+X._invInertia11*X._transform._rotation21+X._invInertia12*X._transform._rotation22,F=X._invInertia20*X._transform._rotation00+X._invInertia21*X._transform._rotation01+X._invInertia22*X._transform._rotation02,N=X._invInertia20*X._transform._rotation10+X._invInertia21*X._transform._rotation11+X._invInertia22*X._transform._rotation12,W=X._invInertia20*X._transform._rotation20+X._invInertia21*X._transform._rotation21+X._invInertia22*X._transform._rotation22,X._invInertia00=C,X._invInertia01=j,X._invInertia02=R,X._invInertia10=q,X._invInertia11=E,X._invInertia12=D,X._invInertia20=F,X._invInertia21=N,X._invInertia22=W,X._invInertia00*=X._rotFactor.x,X._invInertia01*=X._rotFactor.x,X._invInertia02*=X._rotFactor.x,X._invInertia10*=X._rotFactor.y,X._invInertia11*=X._rotFactor.y,X._invInertia12*=X._rotFactor.y,X._invInertia20*=X._rotFactor.z,X._invInertia21*=X._rotFactor.z,X._invInertia22*=X._rotFactor.z;let at,nt,et,rt,_t,lt,ht,ct,mt,bt,xt,pt,ft,ut=this._b2,vt=Math.sqrt(b*b+x*x+p*p),Xt=.5*vt;if(Xt<.5){let t=Xt*Xt;at=.5*(1-.16666666666666666*t+t*t*.008333333333333333),nt=1-.5*t+t*t*.041666666666666664}else at=Math.sin(Xt)/vt,nt=Math.cos(Xt);et=b*at,rt=x*at,_t=p*at,lt=et,ht=rt,ct=_t,mt=nt;let yt,gt=ut._transform._rotation00,dt=ut._transform._rotation11,Yt=ut._transform._rotation22,zt=gt+dt+Yt;zt>0?(yt=Math.sqrt(zt+1),ft=.5*yt,yt=.5/yt,bt=(ut._transform._rotation21-ut._transform._rotation12)*yt,xt=(ut._transform._rotation02-ut._transform._rotation20)*yt,pt=(ut._transform._rotation10-ut._transform._rotation01)*yt):gt>dt?gt>Yt?(yt=Math.sqrt(gt-dt-Yt+1),bt=.5*yt,yt=.5/yt,xt=(ut._transform._rotation01+ut._transform._rotation10)*yt,pt=(ut._transform._rotation02+ut._transform._rotation20)*yt,ft=(ut._transform._rotation21-ut._transform._rotation12)*yt):(yt=Math.sqrt(Yt-gt-dt+1),pt=.5*yt,yt=.5/yt,bt=(ut._transform._rotation02+ut._transform._rotation20)*yt,xt=(ut._transform._rotation12+ut._transform._rotation21)*yt,ft=(ut._transform._rotation10-ut._transform._rotation01)*yt):dt>Yt?(yt=Math.sqrt(dt-Yt-gt+1),xt=.5*yt,yt=.5/yt,bt=(ut._transform._rotation01+ut._transform._rotation10)*yt,pt=(ut._transform._rotation12+ut._transform._rotation21)*yt,ft=(ut._transform._rotation02-ut._transform._rotation20)*yt):(yt=Math.sqrt(Yt-gt-dt+1),pt=.5*yt,yt=.5/yt,bt=(ut._transform._rotation02+ut._transform._rotation20)*yt,xt=(ut._transform._rotation12+ut._transform._rotation21)*yt,ft=(ut._transform._rotation10-ut._transform._rotation01)*yt),bt=mt*bt+lt*ft+ht*pt-ct*xt,xt=mt*xt-lt*pt+ht*ft+ct*bt,pt=mt*pt+lt*xt-ht*bt+ct*ft,ft=mt*ft-lt*bt-ht*xt-ct*pt;let Zt=bt*bt+xt*xt+pt*pt+ft*ft;Zt>1e-32&&(Zt=1/Math.sqrt(Zt)),bt*=Zt,xt*=Zt,pt*=Zt,ft*=Zt;let Mt,It,Vt,Lt,wt,kt,Bt,At,Pt,St,Tt,Ct,jt,Rt,qt,Et,Dt,Ft,Nt=2*bt,Wt=2*xt,Gt=2*pt,Jt=bt*Nt,Ot=xt*Wt,Ht=pt*Gt,Ut=bt*Wt,Qt=xt*Gt,Kt=bt*Gt,$t=ft*Nt,ti=ft*Wt,ii=ft*Gt;ut._transform._rotation00=1-Ot-Ht,ut._transform._rotation01=Ut-ii,ut._transform._rotation02=Kt+ti,ut._transform._rotation10=Ut+ii,ut._transform._rotation11=1-Jt-Ht,ut._transform._rotation12=Qt-$t,ut._transform._rotation20=Kt-ti,ut._transform._rotation21=Qt+$t,ut._transform._rotation22=1-Jt-Ot,Mt=ut._transform._rotation00*ut._invLocalInertia00+ut._transform._rotation01*ut._invLocalInertia10+ut._transform._rotation02*ut._invLocalInertia20,It=ut._transform._rotation00*ut._invLocalInertia01+ut._transform._rotation01*ut._invLocalInertia11+ut._transform._rotation02*ut._invLocalInertia21,Vt=ut._transform._rotation00*ut._invLocalInertia02+ut._transform._rotation01*ut._invLocalInertia12+ut._transform._rotation02*ut._invLocalInertia22,Lt=ut._transform._rotation10*ut._invLocalInertia00+ut._transform._rotation11*ut._invLocalInertia10+ut._transform._rotation12*ut._invLocalInertia20,wt=ut._transform._rotation10*ut._invLocalInertia01+ut._transform._rotation11*ut._invLocalInertia11+ut._transform._rotation12*ut._invLocalInertia21,kt=ut._transform._rotation10*ut._invLocalInertia02+ut._transform._rotation11*ut._invLocalInertia12+ut._transform._rotation12*ut._invLocalInertia22,Bt=ut._transform._rotation20*ut._invLocalInertia00+ut._transform._rotation21*ut._invLocalInertia10+ut._transform._rotation22*ut._invLocalInertia20,At=ut._transform._rotation20*ut._invLocalInertia01+ut._transform._rotation21*ut._invLocalInertia11+ut._transform._rotation22*ut._invLocalInertia21,Pt=ut._transform._rotation20*ut._invLocalInertia02+ut._transform._rotation21*ut._invLocalInertia12+ut._transform._rotation22*ut._invLocalInertia22,ut._invInertia00=Mt,ut._invInertia01=It,ut._invInertia02=Vt,ut._invInertia10=Lt,ut._invInertia11=wt,ut._invInertia12=kt,ut._invInertia20=Bt,ut._invInertia21=At,ut._invInertia22=Pt,St=ut._invInertia00*ut._transform._rotation00+ut._invInertia01*ut._transform._rotation01+ut._invInertia02*ut._transform._rotation02,Tt=ut._invInertia00*ut._transform._rotation10+ut._invInertia01*ut._transform._rotation11+ut._invInertia02*ut._transform._rotation12,Ct=ut._invInertia00*ut._transform._rotation20+ut._invInertia01*ut._transform._rotation21+ut._invInertia02*ut._transform._rotation22,jt=ut._invInertia10*ut._transform._rotation00+ut._invInertia11*ut._transform._rotation01+ut._invInertia12*ut._transform._rotation02,Rt=ut._invInertia10*ut._transform._rotation10+ut._invInertia11*ut._transform._rotation11+ut._invInertia12*ut._transform._rotation12,qt=ut._invInertia10*ut._transform._rotation20+ut._invInertia11*ut._transform._rotation21+ut._invInertia12*ut._transform._rotation22,Et=ut._invInertia20*ut._transform._rotation00+ut._invInertia21*ut._transform._rotation01+ut._invInertia22*ut._transform._rotation02,Dt=ut._invInertia20*ut._transform._rotation10+ut._invInertia21*ut._transform._rotation11+ut._invInertia22*ut._transform._rotation12,Ft=ut._invInertia20*ut._transform._rotation20+ut._invInertia21*ut._transform._rotation21+ut._invInertia22*ut._transform._rotation22,ut._invInertia00=St,ut._invInertia01=Tt,ut._invInertia02=Ct,ut._invInertia10=jt,ut._invInertia11=Rt,ut._invInertia12=qt,ut._invInertia20=Et,ut._invInertia21=Dt,ut._invInertia22=Ft,ut._invInertia00*=ut._rotFactor.x,ut._invInertia01*=ut._rotFactor.x,ut._invInertia02*=ut._rotFactor.x,ut._invInertia10*=ut._rotFactor.y,ut._invInertia11*=ut._rotFactor.y,ut._invInertia12*=ut._rotFactor.y,ut._invInertia20*=ut._rotFactor.z,ut._invInertia21*=ut._rotFactor.z,ut._invInertia22*=ut._rotFactor.z}let g=this.posBoundarySelector,d=0;for(;g.indices[d]!=t;)++d;for(;d>0;){let t=g.indices[d];g.indices[d]=g.indices[d-1],g.indices[d-1]=t,--d}m=!0;break}}m||console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:502:","could not find solution. (NGS)")}postSolve(){this.joint._syncAnchors(),this.joint._checkDestruction()}},oimo.dynamics.constraint.solver.direct.MassMatrix=class{constructor(t){this._size=t,this.tmpMatrix=new Array(this._size),this._invMass=new Array(this._size),this._invMassWithoutCfm=new Array(this._size);let i=0,o=this._size;for(;i<o;){let t=i++;this.tmpMatrix[t]=new Array(this._size),this._invMass[t]=new Array(this._size),this._invMassWithoutCfm[t]=new Array(this._size);let o=0,s=this._size;for(;o<s;){let i=o++;this.tmpMatrix[t][i]=0,this._invMass[t][i]=0,this._invMassWithoutCfm[t][i]=0}}this._maxSubmatrixId=1<<this._size,this._cacheComputed=new Array(this._maxSubmatrixId),this._cachedSubmatrices=new Array(this._maxSubmatrixId);let s=0,a=this._maxSubmatrixId;for(;s<a;){let t,i=s++;t=(85&i)+(i>>1&85),t=(51&t)+(t>>2&51),t=(15&t)+(t>>4&15);let o=t,a=new Array(o),n=0;for(;n<o;){let t=n++;a[t]=new Array(o);let i=0;for(;i<o;)a[t][i++]=0}this._cacheComputed[i]=!1,this._cachedSubmatrices[i]=a}}computeSubmatrix(t,i,o){let s=0;for(;s<o;){let t=s++,a=i[t],n=0;for(;n<o;){let o=n++;this.tmpMatrix[t][o]=this._invMass[a][i[o]]}}let a,n,e,r,_,l=this.tmpMatrix,h=this._cachedSubmatrices[t];switch(o){case 4:a=l[0],n=h[0],_=1/a[0],n[0]=_,a[1]*=_,a[2]*=_,a[3]*=_,e=l[1],r=h[1],r[0]=-_*e[0],e[1]-=a[1]*e[0],e[2]-=a[2]*e[0],e[3]-=a[3]*e[0],e=l[2],r=h[2],r[0]=-_*e[0],e[1]-=a[1]*e[0],e[2]-=a[2]*e[0],e[3]-=a[3]*e[0],e=l[3],r=h[3],r[0]=-_*e[0],e[1]-=a[1]*e[0],e[2]-=a[2]*e[0],e[3]-=a[3]*e[0],a=l[1],n=h[1],_=1/a[1],n[1]=_,n[0]*=_,a[2]*=_,a[3]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[1],e[2]-=a[2]*e[1],e[3]-=a[3]*e[1],e=l[2],r=h[2],r[0]-=n[0]*e[1],r[1]=-_*e[1],e[2]-=a[2]*e[1],e[3]-=a[3]*e[1],e=l[3],r=h[3],r[0]-=n[0]*e[1],r[1]=-_*e[1],e[2]-=a[2]*e[1],e[3]-=a[3]*e[1],a=l[2],n=h[2],_=1/a[2],n[2]=_,n[0]*=_,n[1]*=_,a[3]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[2],e[3]-=a[3]*e[2],e=l[1],r=h[1],r[0]-=n[0]*e[2],r[1]-=n[1]*e[2],e[3]-=a[3]*e[2],e=l[3],r=h[3],r[0]-=n[0]*e[2],r[1]-=n[1]*e[2],r[2]=-_*e[2],e[3]-=a[3]*e[2],a=l[3],n=h[3],_=1/a[3],n[3]=_,n[0]*=_,n[1]*=_,n[2]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[3],e=l[1],r=h[1],r[0]-=n[0]*e[3],r[1]-=n[1]*e[3],e=l[2],r=h[2],r[0]-=n[0]*e[3],r[1]-=n[1]*e[3],r[2]-=n[2]*e[3],n=h[1],h[0][1]=n[0],n=h[2],h[0][2]=n[0],h[1][2]=n[1],n=h[3],h[0][3]=n[0],h[1][3]=n[1],h[2][3]=n[2];break;case 5:a=l[0],n=h[0],_=1/a[0],n[0]=_,a[1]*=_,a[2]*=_,a[3]*=_,a[4]*=_,e=l[1],r=h[1],r[0]=-_*e[0],e[1]-=a[1]*e[0],e[2]-=a[2]*e[0],e[3]-=a[3]*e[0],e[4]-=a[4]*e[0],e=l[2],r=h[2],r[0]=-_*e[0],e[1]-=a[1]*e[0],e[2]-=a[2]*e[0],e[3]-=a[3]*e[0],e[4]-=a[4]*e[0],e=l[3],r=h[3],r[0]=-_*e[0],e[1]-=a[1]*e[0],e[2]-=a[2]*e[0],e[3]-=a[3]*e[0],e[4]-=a[4]*e[0],e=l[4],r=h[4],r[0]=-_*e[0],e[1]-=a[1]*e[0],e[2]-=a[2]*e[0],e[3]-=a[3]*e[0],e[4]-=a[4]*e[0],a=l[1],n=h[1],_=1/a[1],n[1]=_,n[0]*=_,a[2]*=_,a[3]*=_,a[4]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[1],e[2]-=a[2]*e[1],e[3]-=a[3]*e[1],e[4]-=a[4]*e[1],e=l[2],r=h[2],r[0]-=n[0]*e[1],r[1]=-_*e[1],e[2]-=a[2]*e[1],e[3]-=a[3]*e[1],e[4]-=a[4]*e[1],e=l[3],r=h[3],r[0]-=n[0]*e[1],r[1]=-_*e[1],e[2]-=a[2]*e[1],e[3]-=a[3]*e[1],e[4]-=a[4]*e[1],e=l[4],r=h[4],r[0]-=n[0]*e[1],r[1]=-_*e[1],e[2]-=a[2]*e[1],e[3]-=a[3]*e[1],e[4]-=a[4]*e[1],a=l[2],n=h[2],_=1/a[2],n[2]=_,n[0]*=_,n[1]*=_,a[3]*=_,a[4]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[2],e[3]-=a[3]*e[2],e[4]-=a[4]*e[2],e=l[1],r=h[1],r[0]-=n[0]*e[2],r[1]-=n[1]*e[2],e[3]-=a[3]*e[2],e[4]-=a[4]*e[2],e=l[3],r=h[3],r[0]-=n[0]*e[2],r[1]-=n[1]*e[2],r[2]=-_*e[2],e[3]-=a[3]*e[2],e[4]-=a[4]*e[2],e=l[4],r=h[4],r[0]-=n[0]*e[2],r[1]-=n[1]*e[2],r[2]=-_*e[2],e[3]-=a[3]*e[2],e[4]-=a[4]*e[2],a=l[3],n=h[3],_=1/a[3],n[3]=_,n[0]*=_,n[1]*=_,n[2]*=_,a[4]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[3],e[4]-=a[4]*e[3],e=l[1],r=h[1],r[0]-=n[0]*e[3],r[1]-=n[1]*e[3],e[4]-=a[4]*e[3],e=l[2],r=h[2],r[0]-=n[0]*e[3],r[1]-=n[1]*e[3],r[2]-=n[2]*e[3],e[4]-=a[4]*e[3],e=l[4],r=h[4],r[0]-=n[0]*e[3],r[1]-=n[1]*e[3],r[2]-=n[2]*e[3],r[3]=-_*e[3],e[4]-=a[4]*e[3],a=l[4],n=h[4],_=1/a[4],n[4]=_,n[0]*=_,n[1]*=_,n[2]*=_,n[3]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[4],e=l[1],r=h[1],r[0]-=n[0]*e[4],r[1]-=n[1]*e[4],e=l[2],r=h[2],r[0]-=n[0]*e[4],r[1]-=n[1]*e[4],r[2]-=n[2]*e[4],e=l[3],r=h[3],r[0]-=n[0]*e[4],r[1]-=n[1]*e[4],r[2]-=n[2]*e[4],r[3]-=n[3]*e[4],n=h[1],h[0][1]=n[0],n=h[2],h[0][2]=n[0],h[1][2]=n[1],n=h[3],h[0][3]=n[0],h[1][3]=n[1],h[2][3]=n[2],n=h[4],h[0][4]=n[0],h[1][4]=n[1],h[2][4]=n[2],h[3][4]=n[3];break;case 6:a=l[0],n=h[0],_=1/a[0],n[0]=_,a[1]*=_,a[2]*=_,a[3]*=_,a[4]*=_,a[5]*=_,e=l[1],r=h[1],r[0]=-_*e[0],e[1]-=a[1]*e[0],e[2]-=a[2]*e[0],e[3]-=a[3]*e[0],e[4]-=a[4]*e[0],e[5]-=a[5]*e[0],e=l[2],r=h[2],r[0]=-_*e[0],e[1]-=a[1]*e[0],e[2]-=a[2]*e[0],e[3]-=a[3]*e[0],e[4]-=a[4]*e[0],e[5]-=a[5]*e[0],e=l[3],r=h[3],r[0]=-_*e[0],e[1]-=a[1]*e[0],e[2]-=a[2]*e[0],e[3]-=a[3]*e[0],e[4]-=a[4]*e[0],e[5]-=a[5]*e[0],e=l[4],r=h[4],r[0]=-_*e[0],e[1]-=a[1]*e[0],e[2]-=a[2]*e[0],e[3]-=a[3]*e[0],e[4]-=a[4]*e[0],e[5]-=a[5]*e[0],e=l[5],r=h[5],r[0]=-_*e[0],e[1]-=a[1]*e[0],e[2]-=a[2]*e[0],e[3]-=a[3]*e[0],e[4]-=a[4]*e[0],e[5]-=a[5]*e[0],a=l[1],n=h[1],_=1/a[1],n[1]=_,n[0]*=_,a[2]*=_,a[3]*=_,a[4]*=_,a[5]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[1],e[2]-=a[2]*e[1],e[3]-=a[3]*e[1],e[4]-=a[4]*e[1],e[5]-=a[5]*e[1],e=l[2],r=h[2],r[0]-=n[0]*e[1],r[1]=-_*e[1],e[2]-=a[2]*e[1],e[3]-=a[3]*e[1],e[4]-=a[4]*e[1],e[5]-=a[5]*e[1],e=l[3],r=h[3],r[0]-=n[0]*e[1],r[1]=-_*e[1],e[2]-=a[2]*e[1],e[3]-=a[3]*e[1],e[4]-=a[4]*e[1],e[5]-=a[5]*e[1],e=l[4],r=h[4],r[0]-=n[0]*e[1],r[1]=-_*e[1],e[2]-=a[2]*e[1],e[3]-=a[3]*e[1],e[4]-=a[4]*e[1],e[5]-=a[5]*e[1],e=l[5],r=h[5],r[0]-=n[0]*e[1],r[1]=-_*e[1],e[2]-=a[2]*e[1],e[3]-=a[3]*e[1],e[4]-=a[4]*e[1],e[5]-=a[5]*e[1],a=l[2],n=h[2],_=1/a[2],n[2]=_,n[0]*=_,n[1]*=_,a[3]*=_,a[4]*=_,a[5]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[2],e[3]-=a[3]*e[2],e[4]-=a[4]*e[2],e[5]-=a[5]*e[2],e=l[1],r=h[1],r[0]-=n[0]*e[2],r[1]-=n[1]*e[2],e[3]-=a[3]*e[2],e[4]-=a[4]*e[2],e[5]-=a[5]*e[2],e=l[3],r=h[3],r[0]-=n[0]*e[2],r[1]-=n[1]*e[2],r[2]=-_*e[2],e[3]-=a[3]*e[2],e[4]-=a[4]*e[2],e[5]-=a[5]*e[2],e=l[4],r=h[4],r[0]-=n[0]*e[2],r[1]-=n[1]*e[2],r[2]=-_*e[2],e[3]-=a[3]*e[2],e[4]-=a[4]*e[2],e[5]-=a[5]*e[2],e=l[5],r=h[5],r[0]-=n[0]*e[2],r[1]-=n[1]*e[2],r[2]=-_*e[2],e[3]-=a[3]*e[2],e[4]-=a[4]*e[2],e[5]-=a[5]*e[2],a=l[3],n=h[3],_=1/a[3],n[3]=_,n[0]*=_,n[1]*=_,n[2]*=_,a[4]*=_,a[5]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[3],e[4]-=a[4]*e[3],e[5]-=a[5]*e[3],e=l[1],r=h[1],r[0]-=n[0]*e[3],r[1]-=n[1]*e[3],e[4]-=a[4]*e[3],e[5]-=a[5]*e[3],e=l[2],r=h[2],r[0]-=n[0]*e[3],r[1]-=n[1]*e[3],r[2]-=n[2]*e[3],e[4]-=a[4]*e[3],e[5]-=a[5]*e[3],e=l[4],r=h[4],r[0]-=n[0]*e[3],r[1]-=n[1]*e[3],r[2]-=n[2]*e[3],r[3]=-_*e[3],e[4]-=a[4]*e[3],e[5]-=a[5]*e[3],e=l[5],r=h[5],r[0]-=n[0]*e[3],r[1]-=n[1]*e[3],r[2]-=n[2]*e[3],r[3]=-_*e[3],e[4]-=a[4]*e[3],e[5]-=a[5]*e[3],a=l[4],n=h[4],_=1/a[4],n[4]=_,n[0]*=_,n[1]*=_,n[2]*=_,n[3]*=_,a[5]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[4],e[5]-=a[5]*e[4],e=l[1],r=h[1],r[0]-=n[0]*e[4],r[1]-=n[1]*e[4],e[5]-=a[5]*e[4],e=l[2],r=h[2],r[0]-=n[0]*e[4],r[1]-=n[1]*e[4],r[2]-=n[2]*e[4],e[5]-=a[5]*e[4],e=l[3],r=h[3],r[0]-=n[0]*e[4],r[1]-=n[1]*e[4],r[2]-=n[2]*e[4],r[3]-=n[3]*e[4],e[5]-=a[5]*e[4],e=l[5],r=h[5],r[0]-=n[0]*e[4],r[1]-=n[1]*e[4],r[2]-=n[2]*e[4],r[3]-=n[3]*e[4],r[4]=-_*e[4],e[5]-=a[5]*e[4],a=l[5],n=h[5],_=1/a[5],n[5]=_,n[0]*=_,n[1]*=_,n[2]*=_,n[3]*=_,n[4]*=_,e=l[0],r=h[0],r[0]-=n[0]*e[5],e=l[1],r=h[1],r[0]-=n[0]*e[5],r[1]-=n[1]*e[5],e=l[2],r=h[2],r[0]-=n[0]*e[5],r[1]-=n[1]*e[5],r[2]-=n[2]*e[5],e=l[3],r=h[3],r[0]-=n[0]*e[5],r[1]-=n[1]*e[5],r[2]-=n[2]*e[5],r[3]-=n[3]*e[5],e=l[4],r=h[4],r[0]-=n[0]*e[5],r[1]-=n[1]*e[5],r[2]-=n[2]*e[5],r[3]-=n[3]*e[5],r[4]-=n[4]*e[5],n=h[1],h[0][1]=n[0],n=h[2],h[0][2]=n[0],h[1][2]=n[1],n=h[3],h[0][3]=n[0],h[1][3]=n[1],h[2][3]=n[2],n=h[4],h[0][4]=n[0],h[1][4]=n[1],h[2][4]=n[2],h[3][4]=n[3],n=h[5],h[0][5]=n[0],h[1][5]=n[1],h[2][5]=n[2],h[3][5]=n[3],h[4][5]=n[4];break;default:let t=0;for(;t<o;){let i=t++;a=l[i],n=h[i];let s=1/a[i];n[i]=s;let _=0;for(;_<i;)n[_++]*=s;let c=i+1;for(;c<o;)a[c++]*=s;let m=0;for(;m<i;){let t=m++;e=l[t],r=h[t];let s=0,_=t+1;for(;s<_;){let t=s++;r[t]-=n[t]*e[i]}let c=i+1;for(;c<o;){let t=c++;e[t]-=a[t]*e[i]}}let b=i+1;for(;b<o;){let t=b++;e=l[t],r=h[t];let _=0;for(;_<i;){let t=_++;r[t]-=n[t]*e[i]}r[i]=-s*e[i];let c=i+1;for(;c<o;){let t=c++;e[t]-=a[t]*e[i]}}}let i=1;for(;i<o;){let t=i++;n=h[t];let o=0;for(;o<t;){let i=o++;h[i][t]=n[i]}}}}computeInvMass(t,i){let o,s,a,n,e,r,_,l,h,c,m,b,x,p,f,u,v,X,y=this._invMass,g=this._invMassWithoutCfm,d=t.numRows,Y=t.b1,z=t.b2,Z=Y._invMass,M=z._invMass;o=Y._invInertia00,s=Y._invInertia01,a=Y._invInertia02,n=Y._invInertia10,e=Y._invInertia11,r=Y._invInertia12,_=Y._invInertia20,l=Y._invInertia21,h=Y._invInertia22,c=z._invInertia00,m=z._invInertia01,b=z._invInertia02,x=z._invInertia10,p=z._invInertia11,f=z._invInertia12,u=z._invInertia20,v=z._invInertia21,X=z._invInertia22;let I=0;for(;I<d;){let y=I++,g=t.rows[y].jacobian,d=i[y];if(g.updateSparsity(),0!=(1&g.flag)?(d.invMLin1X=g.lin1X*Z,d.invMLin1Y=g.lin1Y*Z,d.invMLin1Z=g.lin1Z*Z,d.invMLin2X=g.lin2X*M,d.invMLin2Y=g.lin2Y*M,d.invMLin2Z=g.lin2Z*M):(d.invMLin1X=0,d.invMLin1Y=0,d.invMLin1Z=0,d.invMLin2X=0,d.invMLin2Y=0,d.invMLin2Z=0),0!=(2&g.flag)){let t,i,y,Y,z,Z;t=o*g.ang1X+s*g.ang1Y+a*g.ang1Z,i=n*g.ang1X+e*g.ang1Y+r*g.ang1Z,y=_*g.ang1X+l*g.ang1Y+h*g.ang1Z,d.invMAng1X=t,d.invMAng1Y=i,d.invMAng1Z=y,Y=c*g.ang2X+m*g.ang2Y+b*g.ang2Z,z=x*g.ang2X+p*g.ang2Y+f*g.ang2Z,Z=u*g.ang2X+v*g.ang2Y+X*g.ang2Z,d.invMAng2X=Y,d.invMAng2Y=z,d.invMAng2Z=Z}else d.invMAng1X=0,d.invMAng1Y=0,d.invMAng1Z=0,d.invMAng2X=0,d.invMAng2Y=0,d.invMAng2Z=0}let V=0;for(;V<d;){let o=V++,s=t.rows[o].jacobian,a=o;for(;a<d;){let n=a++,e=i[n],r=s.lin1X*e.invMLin1X+s.lin1Y*e.invMLin1Y+s.lin1Z*e.invMLin1Z+(s.ang1X*e.invMAng1X+s.ang1Y*e.invMAng1Y+s.ang1Z*e.invMAng1Z)+(s.lin2X*e.invMLin2X+s.lin2Y*e.invMLin2Y+s.lin2Z*e.invMLin2Z)+(s.ang2X*e.invMAng2X+s.ang2Y*e.invMAng2Y+s.ang2Z*e.invMAng2Z);o==n?(y[o][n]=r+t.rows[o].cfm,g[o][n]=r,e.mass=r+t.rows[o].cfm,e.massWithoutCfm=r,0!=e.mass&&(e.mass=1/e.mass),0!=e.massWithoutCfm&&(e.massWithoutCfm=1/e.massWithoutCfm)):(y[o][n]=r,y[n][o]=r,g[o][n]=r,g[n][o]=r)}}let L=0,w=this._maxSubmatrixId;for(;L<w;)this._cacheComputed[L++]=!1}},oimo.dynamics.constraint.solver.pgs||(oimo.dynamics.constraint.solver.pgs={}),oimo.dynamics.constraint.solver.pgs.PgsContactConstraintSolver=class extends oimo.dynamics.constraint.ConstraintSolver{constructor(t){super(),this.constraint=t,this.info=new oimo.dynamics.constraint.info.contact.ContactSolverInfo,this.massData=new Array(oimo.common.Setting.maxManifoldPoints);let i=0,o=this.massData.length;for(;i<o;)this.massData[i++]=new oimo.dynamics.constraint.solver.common.ContactSolverMassDataRow}preSolveVelocity(t){this.constraint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2;let i,o,s,a,n,e,r,_,l,h,c,m,b,x,p,f,u,v,X=this._b1._invMass,y=this._b2._invMass;i=this._b1._invInertia00,o=this._b1._invInertia01,s=this._b1._invInertia02,a=this._b1._invInertia10,n=this._b1._invInertia11,e=this._b1._invInertia12,r=this._b1._invInertia20,_=this._b1._invInertia21,l=this._b1._invInertia22,h=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,b=this._b2._invInertia10,x=this._b2._invInertia11,p=this._b2._invInertia12,f=this._b2._invInertia20,u=this._b2._invInertia21,v=this._b2._invInertia22;let g=0,d=this.info.numRows;for(;g<d;){let t,d,Y,z,Z,M,I=g++,V=this.info.rows[I],L=this.massData[I],w=V.jacobianN;L.invMLinN1X=w.lin1X*X,L.invMLinN1Y=w.lin1Y*X,L.invMLinN1Z=w.lin1Z*X,L.invMLinN2X=w.lin2X*y,L.invMLinN2Y=w.lin2Y*y,L.invMLinN2Z=w.lin2Z*y,t=i*w.ang1X+o*w.ang1Y+s*w.ang1Z,d=a*w.ang1X+n*w.ang1Y+e*w.ang1Z,Y=r*w.ang1X+_*w.ang1Y+l*w.ang1Z,L.invMAngN1X=t,L.invMAngN1Y=d,L.invMAngN1Z=Y,z=h*w.ang2X+c*w.ang2Y+m*w.ang2Z,Z=b*w.ang2X+x*w.ang2Y+p*w.ang2Z,M=f*w.ang2X+u*w.ang2Y+v*w.ang2Z,L.invMAngN2X=z,L.invMAngN2Y=Z,L.invMAngN2Z=M,L.massN=X+y+(L.invMAngN1X*w.ang1X+L.invMAngN1Y*w.ang1Y+L.invMAngN1Z*w.ang1Z)+(L.invMAngN2X*w.ang2X+L.invMAngN2Y*w.ang2Y+L.invMAngN2Z*w.ang2Z),0!=L.massN&&(L.massN=1/L.massN);let k,B,A,P,S,T,C,j,R,q,E,D,F=V.jacobianT,N=V.jacobianB;L.invMLinT1X=F.lin1X*X,L.invMLinT1Y=F.lin1Y*X,L.invMLinT1Z=F.lin1Z*X,L.invMLinT2X=F.lin2X*y,L.invMLinT2Y=F.lin2Y*y,L.invMLinT2Z=F.lin2Z*y,L.invMLinB1X=N.lin1X*X,L.invMLinB1Y=N.lin1Y*X,L.invMLinB1Z=N.lin1Z*X,L.invMLinB2X=N.lin2X*y,L.invMLinB2Y=N.lin2Y*y,L.invMLinB2Z=N.lin2Z*y,k=i*F.ang1X+o*F.ang1Y+s*F.ang1Z,B=a*F.ang1X+n*F.ang1Y+e*F.ang1Z,A=r*F.ang1X+_*F.ang1Y+l*F.ang1Z,L.invMAngT1X=k,L.invMAngT1Y=B,L.invMAngT1Z=A,P=h*F.ang2X+c*F.ang2Y+m*F.ang2Z,S=b*F.ang2X+x*F.ang2Y+p*F.ang2Z,T=f*F.ang2X+u*F.ang2Y+v*F.ang2Z,L.invMAngT2X=P,L.invMAngT2Y=S,L.invMAngT2Z=T,C=i*N.ang1X+o*N.ang1Y+s*N.ang1Z,j=a*N.ang1X+n*N.ang1Y+e*N.ang1Z,R=r*N.ang1X+_*N.ang1Y+l*N.ang1Z,L.invMAngB1X=C,L.invMAngB1Y=j,L.invMAngB1Z=R,q=h*N.ang2X+c*N.ang2Y+m*N.ang2Z,E=b*N.ang2X+x*N.ang2Y+p*N.ang2Z,D=f*N.ang2X+u*N.ang2Y+v*N.ang2Z,L.invMAngB2X=q,L.invMAngB2Y=E,L.invMAngB2Z=D;let W=X+y+(L.invMAngT1X*F.ang1X+L.invMAngT1Y*F.ang1Y+L.invMAngT1Z*F.ang1Z)+(L.invMAngT2X*F.ang2X+L.invMAngT2Y*F.ang2Y+L.invMAngT2Z*F.ang2Z),G=L.invMAngT1X*N.ang1X+L.invMAngT1Y*N.ang1Y+L.invMAngT1Z*N.ang1Z+(L.invMAngT2X*N.ang2X+L.invMAngT2Y*N.ang2Y+L.invMAngT2Z*N.ang2Z),J=X+y+(L.invMAngB1X*N.ang1X+L.invMAngB1Y*N.ang1Y+L.invMAngB1Z*N.ang1Z)+(L.invMAngB2X*N.ang2X+L.invMAngB2Y*N.ang2Y+L.invMAngB2Z*N.ang2Z),O=W*J-G*G;0!=O&&(O=1/O),L.massTB00=J*O,L.massTB01=-G*O,L.massTB10=-G*O,L.massTB11=W*O}}warmStart(t){let i,o,s,a,n,e,r,_,l,h,c,m;i=this._b1._velX,o=this._b1._velY,s=this._b1._velZ,a=this._b2._velX,n=this._b2._velY,e=this._b2._velZ,r=this._b1._angVelX,_=this._b1._angVelY,l=this._b1._angVelZ,h=this._b2._angVelX,c=this._b2._angVelY,m=this._b2._angVelZ;let b=0,x=this.info.numRows;for(;b<x;){let x=b++,p=this.info.rows[x],f=p.impulse,u=this.massData[x],v=p.jacobianT,X=p.jacobianB,y=f.impulseN,g=f.impulseLX*v.lin1X+f.impulseLY*v.lin1Y+f.impulseLZ*v.lin1Z,d=f.impulseLX*X.lin1X+f.impulseLY*X.lin1Y+f.impulseLZ*X.lin1Z;f.impulseT=g,f.impulseB=d,f.impulseN*=t.dtRatio,f.impulseT*=t.dtRatio,f.impulseB*=t.dtRatio,i+=u.invMLinN1X*y,o+=u.invMLinN1Y*y,s+=u.invMLinN1Z*y,i+=u.invMLinT1X*g,o+=u.invMLinT1Y*g,s+=u.invMLinT1Z*g,i+=u.invMLinB1X*d,o+=u.invMLinB1Y*d,s+=u.invMLinB1Z*d,a+=u.invMLinN2X*-y,n+=u.invMLinN2Y*-y,e+=u.invMLinN2Z*-y,a+=u.invMLinT2X*-g,n+=u.invMLinT2Y*-g,e+=u.invMLinT2Z*-g,a+=u.invMLinB2X*-d,n+=u.invMLinB2Y*-d,e+=u.invMLinB2Z*-d,r+=u.invMAngN1X*y,_+=u.invMAngN1Y*y,l+=u.invMAngN1Z*y,r+=u.invMAngT1X*g,_+=u.invMAngT1Y*g,l+=u.invMAngT1Z*g,r+=u.invMAngB1X*d,_+=u.invMAngB1Y*d,l+=u.invMAngB1Z*d,h+=u.invMAngN2X*-y,c+=u.invMAngN2Y*-y,m+=u.invMAngN2Z*-y,h+=u.invMAngT2X*-g,c+=u.invMAngT2Y*-g,m+=u.invMAngT2Z*-g,h+=u.invMAngB2X*-d,c+=u.invMAngB2Y*-d,m+=u.invMAngB2Z*-d}this._b1._velX=i,this._b1._velY=o,this._b1._velZ=s,this._b2._velX=a,this._b2._velY=n,this._b2._velZ=e,this._b1._angVelX=r,this._b1._angVelY=_,this._b1._angVelZ=l,this._b2._angVelX=h,this._b2._angVelY=c,this._b2._angVelZ=m}solveVelocity(){let t,i,o,s,a,n,e,r,_,l,h,c;t=this._b1._velX,i=this._b1._velY,o=this._b1._velZ,s=this._b2._velX,a=this._b2._velY,n=this._b2._velZ,e=this._b1._angVelX,r=this._b1._angVelY,_=this._b1._angVelZ,l=this._b2._angVelX,h=this._b2._angVelY,c=this._b2._angVelZ;let m=0,b=this.info.numRows;for(;m<b;){let b=m++,x=this.info.rows[b],p=this.massData[b],f=x.impulse,u=0,v=x.jacobianT;u+=t*v.lin1X+i*v.lin1Y+o*v.lin1Z,u-=s*v.lin2X+a*v.lin2Y+n*v.lin2Z,u+=e*v.ang1X+r*v.ang1Y+_*v.ang1Z,u-=l*v.ang2X+h*v.ang2Y+c*v.ang2Z;let X=0;v=x.jacobianB,X+=t*v.lin1X+i*v.lin1Y+o*v.lin1Z,X-=s*v.lin2X+a*v.lin2Y+n*v.lin2Z,X+=e*v.ang1X+r*v.ang1Y+_*v.ang1Z,X-=l*v.ang2X+h*v.ang2Y+c*v.ang2Z;let y=-(u*p.massTB00+X*p.massTB01),g=-(u*p.massTB10+X*p.massTB11),d=f.impulseT,Y=f.impulseB;f.impulseT+=y,f.impulseB+=g;let z=x.friction*f.impulseN;if(0==z)f.impulseT=0,f.impulseB=0;else{let t=f.impulseT*f.impulseT+f.impulseB*f.impulseB;if(t>z*z){let i=z/Math.sqrt(t);f.impulseT*=i,f.impulseB*=i}}y=f.impulseT-d,g=f.impulseB-Y,t+=p.invMLinT1X*y,i+=p.invMLinT1Y*y,o+=p.invMLinT1Z*y,t+=p.invMLinB1X*g,i+=p.invMLinB1Y*g,o+=p.invMLinB1Z*g,s+=p.invMLinT2X*-y,a+=p.invMLinT2Y*-y,n+=p.invMLinT2Z*-y,s+=p.invMLinB2X*-g,a+=p.invMLinB2Y*-g,n+=p.invMLinB2Z*-g,e+=p.invMAngT1X*y,r+=p.invMAngT1Y*y,_+=p.invMAngT1Z*y,e+=p.invMAngB1X*g,r+=p.invMAngB1Y*g,_+=p.invMAngB1Z*g,l+=p.invMAngT2X*-y,h+=p.invMAngT2Y*-y,c+=p.invMAngT2Z*-y,l+=p.invMAngB2X*-g,h+=p.invMAngB2Y*-g,c+=p.invMAngB2Z*-g}let x=0,p=this.info.numRows;for(;x<p;){let m=x++,b=this.info.rows[m],p=this.massData[m],f=b.impulse,u=0,v=b.jacobianN;u+=t*v.lin1X+i*v.lin1Y+o*v.lin1Z,u-=s*v.lin2X+a*v.lin2Y+n*v.lin2Z,u+=e*v.ang1X+r*v.ang1Y+_*v.ang1Z,u-=l*v.ang2X+h*v.ang2Y+c*v.ang2Z;let X=(b.rhs-u)*p.massN,y=f.impulseN;f.impulseN+=X,f.impulseN<0&&(f.impulseN=0),X=f.impulseN-y,t+=p.invMLinN1X*X,i+=p.invMLinN1Y*X,o+=p.invMLinN1Z*X,s+=p.invMLinN2X*-X,a+=p.invMLinN2Y*-X,n+=p.invMLinN2Z*-X,e+=p.invMAngN1X*X,r+=p.invMAngN1Y*X,_+=p.invMAngN1Z*X,l+=p.invMAngN2X*-X,h+=p.invMAngN2Y*-X,c+=p.invMAngN2Z*-X}this._b1._velX=t,this._b1._velY=i,this._b1._velZ=o,this._b2._velX=s,this._b2._velY=a,this._b2._velZ=n,this._b1._angVelX=e,this._b1._angVelY=r,this._b1._angVelZ=_,this._b2._angVelX=l,this._b2._angVelY=h,this._b2._angVelZ=c}preSolvePosition(t){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);let i,o,s,a,n,e,r,_,l,h,c,m,b,x,p,f,u,v,X=this._b1._invMass,y=this._b2._invMass;i=this._b1._invInertia00,o=this._b1._invInertia01,s=this._b1._invInertia02,a=this._b1._invInertia10,n=this._b1._invInertia11,e=this._b1._invInertia12,r=this._b1._invInertia20,_=this._b1._invInertia21,l=this._b1._invInertia22,h=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,b=this._b2._invInertia10,x=this._b2._invInertia11,p=this._b2._invInertia12,f=this._b2._invInertia20,u=this._b2._invInertia21,v=this._b2._invInertia22;let g=0,d=this.info.numRows;for(;g<d;){let t,d,Y,z,Z,M,I=g++,V=this.massData[I],L=this.info.rows[I].jacobianN;V.invMLinN1X=L.lin1X*X,V.invMLinN1Y=L.lin1Y*X,V.invMLinN1Z=L.lin1Z*X,V.invMLinN2X=L.lin2X*y,V.invMLinN2Y=L.lin2Y*y,V.invMLinN2Z=L.lin2Z*y,t=i*L.ang1X+o*L.ang1Y+s*L.ang1Z,d=a*L.ang1X+n*L.ang1Y+e*L.ang1Z,Y=r*L.ang1X+_*L.ang1Y+l*L.ang1Z,V.invMAngN1X=t,V.invMAngN1Y=d,V.invMAngN1Z=Y,z=h*L.ang2X+c*L.ang2Y+m*L.ang2Z,Z=b*L.ang2X+x*L.ang2Y+p*L.ang2Z,M=f*L.ang2X+u*L.ang2Y+v*L.ang2Z,V.invMAngN2X=z,V.invMAngN2Y=Z,V.invMAngN2Z=M,V.massN=X+y+(V.invMAngN1X*L.ang1X+V.invMAngN1Y*L.ang1Y+V.invMAngN1Z*L.ang1Z)+(V.invMAngN2X*L.ang2X+V.invMAngN2Y*L.ang2Y+V.invMAngN2Z*L.ang2Z),0!=V.massN&&(V.massN=1/V.massN)}let Y=0,z=this.info.numRows;for(;Y<z;)this.info.rows[Y++].impulse.impulseP=0}solvePositionSplitImpulse(){let t,i,o,s,a,n,e,r,_,l,h,c;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,o=this._b1._pseudoVelZ,s=this._b2._pseudoVelX,a=this._b2._pseudoVelY,n=this._b2._pseudoVelZ,e=this._b1._angPseudoVelX,r=this._b1._angPseudoVelY,_=this._b1._angPseudoVelZ,l=this._b2._angPseudoVelX,h=this._b2._angPseudoVelY,c=this._b2._angPseudoVelZ;let m=0,b=this.info.numRows;for(;m<b;){let b=m++,x=this.info.rows[b],p=this.massData[b],f=x.impulse,u=x.jacobianN,v=0;v+=t*u.lin1X+i*u.lin1Y+o*u.lin1Z,v-=s*u.lin2X+a*u.lin2Y+n*u.lin2Z,v+=e*u.ang1X+r*u.ang1Y+_*u.ang1Z,v-=l*u.ang2X+h*u.ang2Y+c*u.ang2Z;let X=(x.rhs-v)*p.massN*oimo.common.Setting.positionSplitImpulseBaumgarte,y=f.impulseP;f.impulseP+=X,f.impulseP<0&&(f.impulseP=0),X=f.impulseP-y,t+=p.invMLinN1X*X,i+=p.invMLinN1Y*X,o+=p.invMLinN1Z*X,s+=p.invMLinN2X*-X,a+=p.invMLinN2Y*-X,n+=p.invMLinN2Z*-X,e+=p.invMAngN1X*X,r+=p.invMAngN1Y*X,_+=p.invMAngN1Z*X,l+=p.invMAngN2X*-X,h+=p.invMAngN2Y*-X,c+=p.invMAngN2Z*-X}this._b1._pseudoVelX=t,this._b1._pseudoVelY=i,this._b1._pseudoVelZ=o,this._b2._pseudoVelX=s,this._b2._pseudoVelY=a,this._b2._pseudoVelZ=n,this._b1._angPseudoVelX=e,this._b1._angPseudoVelY=r,this._b1._angPseudoVelZ=_,this._b2._angPseudoVelX=l,this._b2._angPseudoVelY=h,this._b2._angPseudoVelZ=c}solvePositionNgs(t){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);let i,o,s,a,n,e,r,_,l,h,c,m,b,x,p,f,u,v,X=this._b1._invMass,y=this._b2._invMass;i=this._b1._invInertia00,o=this._b1._invInertia01,s=this._b1._invInertia02,a=this._b1._invInertia10,n=this._b1._invInertia11,e=this._b1._invInertia12,r=this._b1._invInertia20,_=this._b1._invInertia21,l=this._b1._invInertia22,h=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,b=this._b2._invInertia10,x=this._b2._invInertia11,p=this._b2._invInertia12,f=this._b2._invInertia20,u=this._b2._invInertia21,v=this._b2._invInertia22;let g,d,Y,z,Z,M,I,V,L,w,k,B,A=0,P=this.info.numRows;for(;A<P;){let t,g,d,Y,z,Z,M=A++,I=this.massData[M],V=this.info.rows[M].jacobianN;I.invMLinN1X=V.lin1X*X,I.invMLinN1Y=V.lin1Y*X,I.invMLinN1Z=V.lin1Z*X,I.invMLinN2X=V.lin2X*y,I.invMLinN2Y=V.lin2Y*y,I.invMLinN2Z=V.lin2Z*y,t=i*V.ang1X+o*V.ang1Y+s*V.ang1Z,g=a*V.ang1X+n*V.ang1Y+e*V.ang1Z,d=r*V.ang1X+_*V.ang1Y+l*V.ang1Z,I.invMAngN1X=t,I.invMAngN1Y=g,I.invMAngN1Z=d,Y=h*V.ang2X+c*V.ang2Y+m*V.ang2Z,z=b*V.ang2X+x*V.ang2Y+p*V.ang2Z,Z=f*V.ang2X+u*V.ang2Y+v*V.ang2Z,I.invMAngN2X=Y,I.invMAngN2Y=z,I.invMAngN2Z=Z,I.massN=X+y+(I.invMAngN1X*V.ang1X+I.invMAngN1Y*V.ang1Y+I.invMAngN1Z*V.ang1Z)+(I.invMAngN2X*V.ang2X+I.invMAngN2Y*V.ang2Y+I.invMAngN2Z*V.ang2Z),0!=I.massN&&(I.massN=1/I.massN)}g=0,d=0,Y=0,z=0,Z=0,M=0,I=0,V=0,L=0,w=0,k=0,B=0;let S=0,T=this.info.numRows;for(;S<T;){let t=S++,i=this.info.rows[t],o=this.massData[t],s=i.impulse,a=i.jacobianN,n=0;n+=g*a.lin1X+d*a.lin1Y+Y*a.lin1Z,n-=z*a.lin2X+Z*a.lin2Y+M*a.lin2Z,n+=I*a.ang1X+V*a.ang1Y+L*a.ang1Z,n-=w*a.ang2X+k*a.ang2Y+B*a.ang2Z;let e=(i.rhs-n)*o.massN*oimo.common.Setting.positionNgsBaumgarte,r=s.impulseP;s.impulseP+=e,s.impulseP<0&&(s.impulseP=0),e=s.impulseP-r,g+=o.invMLinN1X*e,d+=o.invMLinN1Y*e,Y+=o.invMLinN1Z*e,z+=o.invMLinN2X*-e,Z+=o.invMLinN2Y*-e,M+=o.invMLinN2Z*-e,I+=o.invMAngN1X*e,V+=o.invMAngN1Y*e,L+=o.invMAngN1Z*e,w+=o.invMAngN2X*-e,k+=o.invMAngN2Y*-e,B+=o.invMAngN2Z*-e}let C=this._b1;C._transform._positionX+=g,C._transform._positionY+=d,C._transform._positionZ+=Y;let j=this._b2;j._transform._positionX+=z,j._transform._positionY+=Z,j._transform._positionZ+=M;let R,q,E,D,F,N,W,G,J,O,H,U,Q,K=this._b1,$=Math.sqrt(I*I+V*V+L*L),tt=.5*$;if(tt<.5){let t=tt*tt;R=.5*(1-.16666666666666666*t+t*t*.008333333333333333),q=1-.5*t+t*t*.041666666666666664}else R=Math.sin(tt)/$,q=Math.cos(tt);E=I*R,D=V*R,F=L*R,N=E,W=D,G=F,J=q;let it,ot=K._transform._rotation00,st=K._transform._rotation11,at=K._transform._rotation22,nt=ot+st+at;nt>0?(it=Math.sqrt(nt+1),Q=.5*it,it=.5/it,O=(K._transform._rotation21-K._transform._rotation12)*it,H=(K._transform._rotation02-K._transform._rotation20)*it,U=(K._transform._rotation10-K._transform._rotation01)*it):ot>st?ot>at?(it=Math.sqrt(ot-st-at+1),O=.5*it,it=.5/it,H=(K._transform._rotation01+K._transform._rotation10)*it,U=(K._transform._rotation02+K._transform._rotation20)*it,Q=(K._transform._rotation21-K._transform._rotation12)*it):(it=Math.sqrt(at-ot-st+1),U=.5*it,it=.5/it,O=(K._transform._rotation02+K._transform._rotation20)*it,H=(K._transform._rotation12+K._transform._rotation21)*it,Q=(K._transform._rotation10-K._transform._rotation01)*it):st>at?(it=Math.sqrt(st-at-ot+1),H=.5*it,it=.5/it,O=(K._transform._rotation01+K._transform._rotation10)*it,U=(K._transform._rotation12+K._transform._rotation21)*it,Q=(K._transform._rotation02-K._transform._rotation20)*it):(it=Math.sqrt(at-ot-st+1),U=.5*it,it=.5/it,O=(K._transform._rotation02+K._transform._rotation20)*it,H=(K._transform._rotation12+K._transform._rotation21)*it,Q=(K._transform._rotation10-K._transform._rotation01)*it),O=J*O+N*Q+W*U-G*H,H=J*H-N*U+W*Q+G*O,U=J*U+N*H-W*O+G*Q,Q=J*Q-N*O-W*H-G*U;let et=O*O+H*H+U*U+Q*Q;et>1e-32&&(et=1/Math.sqrt(et)),O*=et,H*=et,U*=et,Q*=et;let rt,_t,lt,ht,ct,mt,bt,xt,pt,ft,ut,vt,Xt,yt,gt,dt,Yt,zt,Zt=2*O,Mt=2*H,It=2*U,Vt=O*Zt,Lt=H*Mt,wt=U*It,kt=O*Mt,Bt=H*It,At=O*It,Pt=Q*Zt,St=Q*Mt,Tt=Q*It;K._transform._rotation00=1-Lt-wt,K._transform._rotation01=kt-Tt,K._transform._rotation02=At+St,K._transform._rotation10=kt+Tt,K._transform._rotation11=1-Vt-wt,K._transform._rotation12=Bt-Pt,K._transform._rotation20=At-St,K._transform._rotation21=Bt+Pt,K._transform._rotation22=1-Vt-Lt,rt=K._transform._rotation00*K._invLocalInertia00+K._transform._rotation01*K._invLocalInertia10+K._transform._rotation02*K._invLocalInertia20,_t=K._transform._rotation00*K._invLocalInertia01+K._transform._rotation01*K._invLocalInertia11+K._transform._rotation02*K._invLocalInertia21,lt=K._transform._rotation00*K._invLocalInertia02+K._transform._rotation01*K._invLocalInertia12+K._transform._rotation02*K._invLocalInertia22,ht=K._transform._rotation10*K._invLocalInertia00+K._transform._rotation11*K._invLocalInertia10+K._transform._rotation12*K._invLocalInertia20,ct=K._transform._rotation10*K._invLocalInertia01+K._transform._rotation11*K._invLocalInertia11+K._transform._rotation12*K._invLocalInertia21,mt=K._transform._rotation10*K._invLocalInertia02+K._transform._rotation11*K._invLocalInertia12+K._transform._rotation12*K._invLocalInertia22,bt=K._transform._rotation20*K._invLocalInertia00+K._transform._rotation21*K._invLocalInertia10+K._transform._rotation22*K._invLocalInertia20,xt=K._transform._rotation20*K._invLocalInertia01+K._transform._rotation21*K._invLocalInertia11+K._transform._rotation22*K._invLocalInertia21,pt=K._transform._rotation20*K._invLocalInertia02+K._transform._rotation21*K._invLocalInertia12+K._transform._rotation22*K._invLocalInertia22,K._invInertia00=rt,K._invInertia01=_t,K._invInertia02=lt,K._invInertia10=ht,K._invInertia11=ct,K._invInertia12=mt,K._invInertia20=bt,K._invInertia21=xt,K._invInertia22=pt,ft=K._invInertia00*K._transform._rotation00+K._invInertia01*K._transform._rotation01+K._invInertia02*K._transform._rotation02,ut=K._invInertia00*K._transform._rotation10+K._invInertia01*K._transform._rotation11+K._invInertia02*K._transform._rotation12,vt=K._invInertia00*K._transform._rotation20+K._invInertia01*K._transform._rotation21+K._invInertia02*K._transform._rotation22,Xt=K._invInertia10*K._transform._rotation00+K._invInertia11*K._transform._rotation01+K._invInertia12*K._transform._rotation02,yt=K._invInertia10*K._transform._rotation10+K._invInertia11*K._transform._rotation11+K._invInertia12*K._transform._rotation12,gt=K._invInertia10*K._transform._rotation20+K._invInertia11*K._transform._rotation21+K._invInertia12*K._transform._rotation22,dt=K._invInertia20*K._transform._rotation00+K._invInertia21*K._transform._rotation01+K._invInertia22*K._transform._rotation02,Yt=K._invInertia20*K._transform._rotation10+K._invInertia21*K._transform._rotation11+K._invInertia22*K._transform._rotation12,zt=K._invInertia20*K._transform._rotation20+K._invInertia21*K._transform._rotation21+K._invInertia22*K._transform._rotation22,K._invInertia00=ft,K._invInertia01=ut,K._invInertia02=vt,K._invInertia10=Xt,K._invInertia11=yt,K._invInertia12=gt,K._invInertia20=dt,K._invInertia21=Yt,K._invInertia22=zt,K._invInertia00*=K._rotFactor.x,K._invInertia01*=K._rotFactor.x,K._invInertia02*=K._rotFactor.x,K._invInertia10*=K._rotFactor.y,K._invInertia11*=K._rotFactor.y,K._invInertia12*=K._rotFactor.y,K._invInertia20*=K._rotFactor.z,K._invInertia21*=K._rotFactor.z,K._invInertia22*=K._rotFactor.z;let Ct,jt,Rt,qt,Et,Dt,Ft,Nt,Wt,Gt,Jt,Ot,Ht,Ut=this._b2,Qt=Math.sqrt(w*w+k*k+B*B),Kt=.5*Qt;if(Kt<.5){let t=Kt*Kt;Ct=.5*(1-.16666666666666666*t+t*t*.008333333333333333),jt=1-.5*t+t*t*.041666666666666664}else Ct=Math.sin(Kt)/Qt,jt=Math.cos(Kt);Rt=w*Ct,qt=k*Ct,Et=B*Ct,Dt=Rt,Ft=qt,Nt=Et,Wt=jt;let $t,ti=Ut._transform._rotation00,ii=Ut._transform._rotation11,oi=Ut._transform._rotation22,si=ti+ii+oi;si>0?($t=Math.sqrt(si+1),Ht=.5*$t,$t=.5/$t,Gt=(Ut._transform._rotation21-Ut._transform._rotation12)*$t,Jt=(Ut._transform._rotation02-Ut._transform._rotation20)*$t,Ot=(Ut._transform._rotation10-Ut._transform._rotation01)*$t):ti>ii?ti>oi?($t=Math.sqrt(ti-ii-oi+1),Gt=.5*$t,$t=.5/$t,Jt=(Ut._transform._rotation01+Ut._transform._rotation10)*$t,Ot=(Ut._transform._rotation02+Ut._transform._rotation20)*$t,Ht=(Ut._transform._rotation21-Ut._transform._rotation12)*$t):($t=Math.sqrt(oi-ti-ii+1),Ot=.5*$t,$t=.5/$t,Gt=(Ut._transform._rotation02+Ut._transform._rotation20)*$t,Jt=(Ut._transform._rotation12+Ut._transform._rotation21)*$t,Ht=(Ut._transform._rotation10-Ut._transform._rotation01)*$t):ii>oi?($t=Math.sqrt(ii-oi-ti+1),Jt=.5*$t,$t=.5/$t,Gt=(Ut._transform._rotation01+Ut._transform._rotation10)*$t,Ot=(Ut._transform._rotation12+Ut._transform._rotation21)*$t,Ht=(Ut._transform._rotation02-Ut._transform._rotation20)*$t):($t=Math.sqrt(oi-ti-ii+1),Ot=.5*$t,$t=.5/$t,Gt=(Ut._transform._rotation02+Ut._transform._rotation20)*$t,Jt=(Ut._transform._rotation12+Ut._transform._rotation21)*$t,Ht=(Ut._transform._rotation10-Ut._transform._rotation01)*$t),Gt=Wt*Gt+Dt*Ht+Ft*Ot-Nt*Jt,Jt=Wt*Jt-Dt*Ot+Ft*Ht+Nt*Gt,Ot=Wt*Ot+Dt*Jt-Ft*Gt+Nt*Ht,Ht=Wt*Ht-Dt*Gt-Ft*Jt-Nt*Ot;let ai=Gt*Gt+Jt*Jt+Ot*Ot+Ht*Ht;ai>1e-32&&(ai=1/Math.sqrt(ai)),Gt*=ai,Jt*=ai,Ot*=ai,Ht*=ai;let ni,ei,ri,_i,li,hi,ci,mi,bi,xi,pi,fi,ui,vi,Xi,yi,gi,di,Yi=2*Gt,zi=2*Jt,Zi=2*Ot,Mi=Gt*Yi,Ii=Jt*zi,Vi=Ot*Zi,Li=Gt*zi,wi=Jt*Zi,ki=Gt*Zi,Bi=Ht*Yi,Ai=Ht*zi,Pi=Ht*Zi;Ut._transform._rotation00=1-Ii-Vi,Ut._transform._rotation01=Li-Pi,Ut._transform._rotation02=ki+Ai,Ut._transform._rotation10=Li+Pi,Ut._transform._rotation11=1-Mi-Vi,Ut._transform._rotation12=wi-Bi,Ut._transform._rotation20=ki-Ai,Ut._transform._rotation21=wi+Bi,Ut._transform._rotation22=1-Mi-Ii,ni=Ut._transform._rotation00*Ut._invLocalInertia00+Ut._transform._rotation01*Ut._invLocalInertia10+Ut._transform._rotation02*Ut._invLocalInertia20,ei=Ut._transform._rotation00*Ut._invLocalInertia01+Ut._transform._rotation01*Ut._invLocalInertia11+Ut._transform._rotation02*Ut._invLocalInertia21,ri=Ut._transform._rotation00*Ut._invLocalInertia02+Ut._transform._rotation01*Ut._invLocalInertia12+Ut._transform._rotation02*Ut._invLocalInertia22,_i=Ut._transform._rotation10*Ut._invLocalInertia00+Ut._transform._rotation11*Ut._invLocalInertia10+Ut._transform._rotation12*Ut._invLocalInertia20,li=Ut._transform._rotation10*Ut._invLocalInertia01+Ut._transform._rotation11*Ut._invLocalInertia11+Ut._transform._rotation12*Ut._invLocalInertia21,hi=Ut._transform._rotation10*Ut._invLocalInertia02+Ut._transform._rotation11*Ut._invLocalInertia12+Ut._transform._rotation12*Ut._invLocalInertia22,ci=Ut._transform._rotation20*Ut._invLocalInertia00+Ut._transform._rotation21*Ut._invLocalInertia10+Ut._transform._rotation22*Ut._invLocalInertia20,mi=Ut._transform._rotation20*Ut._invLocalInertia01+Ut._transform._rotation21*Ut._invLocalInertia11+Ut._transform._rotation22*Ut._invLocalInertia21,bi=Ut._transform._rotation20*Ut._invLocalInertia02+Ut._transform._rotation21*Ut._invLocalInertia12+Ut._transform._rotation22*Ut._invLocalInertia22,Ut._invInertia00=ni,Ut._invInertia01=ei,Ut._invInertia02=ri,Ut._invInertia10=_i,Ut._invInertia11=li,Ut._invInertia12=hi,Ut._invInertia20=ci,Ut._invInertia21=mi,Ut._invInertia22=bi,xi=Ut._invInertia00*Ut._transform._rotation00+Ut._invInertia01*Ut._transform._rotation01+Ut._invInertia02*Ut._transform._rotation02,pi=Ut._invInertia00*Ut._transform._rotation10+Ut._invInertia01*Ut._transform._rotation11+Ut._invInertia02*Ut._transform._rotation12,fi=Ut._invInertia00*Ut._transform._rotation20+Ut._invInertia01*Ut._transform._rotation21+Ut._invInertia02*Ut._transform._rotation22,ui=Ut._invInertia10*Ut._transform._rotation00+Ut._invInertia11*Ut._transform._rotation01+Ut._invInertia12*Ut._transform._rotation02,vi=Ut._invInertia10*Ut._transform._rotation10+Ut._invInertia11*Ut._transform._rotation11+Ut._invInertia12*Ut._transform._rotation12,Xi=Ut._invInertia10*Ut._transform._rotation20+Ut._invInertia11*Ut._transform._rotation21+Ut._invInertia12*Ut._transform._rotation22,yi=Ut._invInertia20*Ut._transform._rotation00+Ut._invInertia21*Ut._transform._rotation01+Ut._invInertia22*Ut._transform._rotation02,gi=Ut._invInertia20*Ut._transform._rotation10+Ut._invInertia21*Ut._transform._rotation11+Ut._invInertia22*Ut._transform._rotation12,di=Ut._invInertia20*Ut._transform._rotation20+Ut._invInertia21*Ut._transform._rotation21+Ut._invInertia22*Ut._transform._rotation22,Ut._invInertia00=xi,Ut._invInertia01=pi,Ut._invInertia02=fi,Ut._invInertia10=ui,Ut._invInertia11=vi,Ut._invInertia12=Xi,Ut._invInertia20=yi,Ut._invInertia21=gi,Ut._invInertia22=di,Ut._invInertia00*=Ut._rotFactor.x,Ut._invInertia01*=Ut._rotFactor.x,Ut._invInertia02*=Ut._rotFactor.x,Ut._invInertia10*=Ut._rotFactor.y,Ut._invInertia11*=Ut._rotFactor.y,Ut._invInertia12*=Ut._rotFactor.y,Ut._invInertia20*=Ut._rotFactor.z,Ut._invInertia21*=Ut._rotFactor.z,Ut._invInertia22*=Ut._rotFactor.z}postSolve(){let t,i,o,s,a,n,e,r,_;t=0,i=0,o=0,s=0,a=0,n=0,e=0,r=0,_=0;let l=0,h=this.info.numRows;for(;l<h;){let h,c,m,b=this.info.rows[l++],x=b.impulse,p=b.jacobianN,f=b.jacobianT,u=b.jacobianB,v=x.impulseN,X=x.impulseT,y=x.impulseB;h=0,c=0,m=0,h+=f.lin1X*X,c+=f.lin1Y*X,m+=f.lin1Z*X,h+=u.lin1X*y,c+=u.lin1Y*y,m+=u.lin1Z*y,x.impulseLX=h,x.impulseLY=c,x.impulseLZ=m,t+=p.lin1X*v,i+=p.lin1Y*v,o+=p.lin1Z*v,s+=p.ang1X*v,a+=p.ang1Y*v,n+=p.ang1Z*v,e+=p.ang2X*v,r+=p.ang2Y*v,_+=p.ang2Z*v,t+=f.lin1X*X,i+=f.lin1Y*X,o+=f.lin1Z*X,s+=f.ang1X*X,a+=f.ang1Y*X,n+=f.ang1Z*X,e+=f.ang2X*X,r+=f.ang2Y*X,_+=f.ang2Z*X,t+=u.lin1X*y,i+=u.lin1Y*y,o+=u.lin1Z*y,s+=u.ang1X*y,a+=u.ang1Y*y,n+=u.ang1Z*y,e+=u.ang2X*y,r+=u.ang2Y*y,_+=u.ang2Z*y}this._b1._linearContactImpulseX+=t,this._b1._linearContactImpulseY+=i,this._b1._linearContactImpulseZ+=o,this._b1._angularContactImpulseX+=s,this._b1._angularContactImpulseY+=a,this._b1._angularContactImpulseZ+=n,this._b2._linearContactImpulseX-=t,this._b2._linearContactImpulseY-=i,this._b2._linearContactImpulseZ-=o,this._b2._angularContactImpulseX-=e,this._b2._angularContactImpulseY-=r,this._b2._angularContactImpulseZ-=_,this.constraint._syncManifold()}},oimo.dynamics.constraint.solver.pgs.PgsJointConstraintSolver=class extends oimo.dynamics.constraint.ConstraintSolver{constructor(t){super(),this.joint=t,this.info=new oimo.dynamics.constraint.info.joint.JointSolverInfo,this.massData=new Array(oimo.common.Setting.maxJacobianRows);let i=0,o=this.massData.length;for(;i<o;)this.massData[i++]=new oimo.dynamics.constraint.solver.common.JointSolverMassDataRow}preSolveVelocity(t){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2;let i,o,s,a,n,e,r,_,l,h,c,m,b,x,p,f,u,v,X=this._b1._invMass,y=this._b2._invMass;i=this._b1._invInertia00,o=this._b1._invInertia01,s=this._b1._invInertia02,a=this._b1._invInertia10,n=this._b1._invInertia11,e=this._b1._invInertia12,r=this._b1._invInertia20,_=this._b1._invInertia21,l=this._b1._invInertia22,h=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,b=this._b2._invInertia10,x=this._b2._invInertia11,p=this._b2._invInertia12,f=this._b2._invInertia20,u=this._b2._invInertia21,v=this._b2._invInertia22;let g=0,d=this.info.numRows;for(;g<d;){let t=g++,d=this.info.rows[t],Y=this.massData[t],z=d.jacobian;if(z.updateSparsity(),0!=(1&z.flag)?(Y.invMLin1X=z.lin1X*X,Y.invMLin1Y=z.lin1Y*X,Y.invMLin1Z=z.lin1Z*X,Y.invMLin2X=z.lin2X*y,Y.invMLin2Y=z.lin2Y*y,Y.invMLin2Z=z.lin2Z*y):(Y.invMLin1X=0,Y.invMLin1Y=0,Y.invMLin1Z=0,Y.invMLin2X=0,Y.invMLin2Y=0,Y.invMLin2Z=0),0!=(2&z.flag)){let t,X,y,g,d,Z;t=i*z.ang1X+o*z.ang1Y+s*z.ang1Z,X=a*z.ang1X+n*z.ang1Y+e*z.ang1Z,y=r*z.ang1X+_*z.ang1Y+l*z.ang1Z,Y.invMAng1X=t,Y.invMAng1Y=X,Y.invMAng1Z=y,g=h*z.ang2X+c*z.ang2Y+m*z.ang2Z,d=b*z.ang2X+x*z.ang2Y+p*z.ang2Z,Z=f*z.ang2X+u*z.ang2Y+v*z.ang2Z,Y.invMAng2X=g,Y.invMAng2Y=d,Y.invMAng2Z=Z}else Y.invMAng1X=0,Y.invMAng1Y=0,Y.invMAng1Z=0,Y.invMAng2X=0,Y.invMAng2Y=0,Y.invMAng2Z=0;Y.massWithoutCfm=Y.invMLin1X*z.lin1X+Y.invMLin1Y*z.lin1Y+Y.invMLin1Z*z.lin1Z+(Y.invMLin2X*z.lin2X+Y.invMLin2Y*z.lin2Y+Y.invMLin2Z*z.lin2Z)+(Y.invMAng1X*z.ang1X+Y.invMAng1Y*z.ang1Y+Y.invMAng1Z*z.ang1Z)+(Y.invMAng2X*z.ang2X+Y.invMAng2Y*z.ang2Y+Y.invMAng2Z*z.ang2Z),Y.mass=Y.massWithoutCfm+d.cfm,0!=Y.massWithoutCfm&&(Y.massWithoutCfm=1/Y.massWithoutCfm),0!=Y.mass&&(Y.mass=1/Y.mass)}}warmStart(t){let i,o,s,a,n,e,r,_,l,h,c,m,b=this.joint._positionCorrectionAlgorithm==oimo.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?oimo.common.Setting.jointWarmStartingFactorForBaungarte:oimo.common.Setting.jointWarmStartingFactor;if(b*=t.dtRatio,b<=0){let t=0,i=this.info.numRows;for(;t<i;){let i=this.info.rows[t++].impulse;i.impulse=0,i.impulseM=0,i.impulseP=0}return}i=this._b1._velX,o=this._b1._velY,s=this._b1._velZ,a=this._b2._velX,n=this._b2._velY,e=this._b2._velZ,r=this._b1._angVelX,_=this._b1._angVelY,l=this._b1._angVelZ,h=this._b2._angVelX,c=this._b2._angVelY,m=this._b2._angVelZ;let x=0,p=this.info.numRows;for(;x<p;){let t=x++,p=this.massData[t],f=this.info.rows[t].impulse;f.impulse*=b,f.impulseM*=b;let u=f.impulse+f.impulseM;i+=p.invMLin1X*u,o+=p.invMLin1Y*u,s+=p.invMLin1Z*u,a+=p.invMLin2X*-u,n+=p.invMLin2Y*-u,e+=p.invMLin2Z*-u,r+=p.invMAng1X*u,_+=p.invMAng1Y*u,l+=p.invMAng1Z*u,h+=p.invMAng2X*-u,c+=p.invMAng2Y*-u,m+=p.invMAng2Z*-u}this._b1._velX=i,this._b1._velY=o,this._b1._velZ=s,this._b2._velX=a,this._b2._velY=n,this._b2._velZ=e,this._b1._angVelX=r,this._b1._angVelY=_,this._b1._angVelZ=l,this._b2._angVelX=h,this._b2._angVelY=c,this._b2._angVelZ=m}solveVelocity(){let t,i,o,s,a,n,e,r,_,l,h,c;t=this._b1._velX,i=this._b1._velY,o=this._b1._velZ,s=this._b2._velX,a=this._b2._velY,n=this._b2._velZ,e=this._b1._angVelX,r=this._b1._angVelY,_=this._b1._angVelZ,l=this._b2._angVelX,h=this._b2._angVelY,c=this._b2._angVelZ;let m=0,b=this.info.numRows;for(;m<b;){let b=m++,x=this.info.rows[b],p=this.massData[b],f=x.impulse,u=x.jacobian;if(0==x.motorMaxImpulse)continue;let v=0;v+=t*u.lin1X+i*u.lin1Y+o*u.lin1Z,v-=s*u.lin2X+a*u.lin2Y+n*u.lin2Z,v+=e*u.ang1X+r*u.ang1Y+_*u.ang1Z,v-=l*u.ang2X+h*u.ang2Y+c*u.ang2Z;let X=(-x.motorSpeed-v)*p.massWithoutCfm,y=f.impulseM;f.impulseM+=X,f.impulseM<-x.motorMaxImpulse?f.impulseM=-x.motorMaxImpulse:f.impulseM>x.motorMaxImpulse&&(f.impulseM=x.motorMaxImpulse),X=f.impulseM-y,0!=(1&u.flag)&&(t+=p.invMLin1X*X,i+=p.invMLin1Y*X,o+=p.invMLin1Z*X,s+=p.invMLin2X*-X,a+=p.invMLin2Y*-X,n+=p.invMLin2Z*-X),0!=(2&u.flag)&&(e+=p.invMAng1X*X,r+=p.invMAng1Y*X,_+=p.invMAng1Z*X,l+=p.invMAng2X*-X,h+=p.invMAng2Y*-X,c+=p.invMAng2Z*-X)}let x=0,p=this.info.numRows;for(;x<p;){let m=x++,b=this.info.rows[m],p=this.massData[m],f=b.impulse,u=b.jacobian,v=0;v+=t*u.lin1X+i*u.lin1Y+o*u.lin1Z,v-=s*u.lin2X+a*u.lin2Y+n*u.lin2Z,v+=e*u.ang1X+r*u.ang1Y+_*u.ang1Z,v-=l*u.ang2X+h*u.ang2Y+c*u.ang2Z;let X=(b.rhs-v-f.impulse*b.cfm)*p.mass,y=f.impulse;f.impulse+=X,f.impulse<b.minImpulse?f.impulse=b.minImpulse:f.impulse>b.maxImpulse&&(f.impulse=b.maxImpulse),X=f.impulse-y,0!=(1&u.flag)&&(t+=p.invMLin1X*X,i+=p.invMLin1Y*X,o+=p.invMLin1Z*X,s+=p.invMLin2X*-X,a+=p.invMLin2Y*-X,n+=p.invMLin2Z*-X),0!=(2&u.flag)&&(e+=p.invMAng1X*X,r+=p.invMAng1Y*X,_+=p.invMAng1Z*X,l+=p.invMAng2X*-X,h+=p.invMAng2Y*-X,c+=p.invMAng2Z*-X)}this._b1._velX=t,this._b1._velY=i,this._b1._velZ=o,this._b2._velX=s,this._b2._velY=a,this._b2._velZ=n,this._b1._angVelX=e,this._b1._angVelY=r,this._b1._angVelZ=_,this._b2._angVelX=l,this._b2._angVelY=h,this._b2._angVelZ=c}postSolveVelocity(t){let i,o,s,a,n,e;i=0,o=0,s=0,a=0,n=0,e=0;let r=0,_=this.info.numRows;for(;r<_;){let t=this.info.rows[r++],_=t.impulse,l=t.jacobian;0!=(1&l.flag)?(i+=l.lin1X*_.impulse,o+=l.lin1Y*_.impulse,s+=l.lin1Z*_.impulse):0!=(2&l.flag)&&(a+=l.ang1X*_.impulse,n+=l.ang1Y*_.impulse,e+=l.ang1Z*_.impulse)}this.joint._appliedForceX=i*t.invDt,this.joint._appliedForceY=o*t.invDt,this.joint._appliedForceZ=s*t.invDt,this.joint._appliedTorqueX=a*t.invDt,this.joint._appliedTorqueY=n*t.invDt,this.joint._appliedTorqueZ=e*t.invDt}preSolvePosition(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;let i,o,s,a,n,e,r,_,l,h,c,m,b,x,p,f,u,v,X=this._b1._invMass,y=this._b2._invMass;i=this._b1._invInertia00,o=this._b1._invInertia01,s=this._b1._invInertia02,a=this._b1._invInertia10,n=this._b1._invInertia11,e=this._b1._invInertia12,r=this._b1._invInertia20,_=this._b1._invInertia21,l=this._b1._invInertia22,h=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,b=this._b2._invInertia10,x=this._b2._invInertia11,p=this._b2._invInertia12,f=this._b2._invInertia20,u=this._b2._invInertia21,v=this._b2._invInertia22;let g=0,d=this.info.numRows;for(;g<d;){let t,d,Y,z,Z,M,I=g++,V=this.massData[I],L=this.info.rows[I].jacobian;V.invMLin1X=L.lin1X*X,V.invMLin1Y=L.lin1Y*X,V.invMLin1Z=L.lin1Z*X,V.invMLin2X=L.lin2X*y,V.invMLin2Y=L.lin2Y*y,V.invMLin2Z=L.lin2Z*y,t=i*L.ang1X+o*L.ang1Y+s*L.ang1Z,d=a*L.ang1X+n*L.ang1Y+e*L.ang1Z,Y=r*L.ang1X+_*L.ang1Y+l*L.ang1Z,V.invMAng1X=t,V.invMAng1Y=d,V.invMAng1Z=Y,z=h*L.ang2X+c*L.ang2Y+m*L.ang2Z,Z=b*L.ang2X+x*L.ang2Y+p*L.ang2Z,M=f*L.ang2X+u*L.ang2Y+v*L.ang2Z,V.invMAng2X=z,V.invMAng2Y=Z,V.invMAng2Z=M,V.mass=V.invMLin1X*L.lin1X+V.invMLin1Y*L.lin1Y+V.invMLin1Z*L.lin1Z+(V.invMLin2X*L.lin2X+V.invMLin2Y*L.lin2Y+V.invMLin2Z*L.lin2Z)+(V.invMAng1X*L.ang1X+V.invMAng1Y*L.ang1Y+V.invMAng1Z*L.ang1Z)+(V.invMAng2X*L.ang2X+V.invMAng2Y*L.ang2Y+V.invMAng2Z*L.ang2Z),0!=V.mass&&(V.mass=1/V.mass)}let Y=0,z=this.info.numRows;for(;Y<z;)this.info.rows[Y++].impulse.impulseP=0}solvePositionSplitImpulse(){let t,i,o,s,a,n,e,r,_,l,h,c;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,o=this._b1._pseudoVelZ,s=this._b2._pseudoVelX,a=this._b2._pseudoVelY,n=this._b2._pseudoVelZ,e=this._b1._angPseudoVelX,r=this._b1._angPseudoVelY,_=this._b1._angPseudoVelZ,l=this._b2._angPseudoVelX,h=this._b2._angPseudoVelY,c=this._b2._angPseudoVelZ;let m=0,b=this.info.numRows;for(;m<b;){let b=m++,x=this.info.rows[b],p=this.massData[b],f=x.impulse,u=x.jacobian,v=0;v+=t*u.lin1X+i*u.lin1Y+o*u.lin1Z,v-=s*u.lin2X+a*u.lin2Y+n*u.lin2Z,v+=e*u.ang1X+r*u.ang1Y+_*u.ang1Z,v-=l*u.ang2X+h*u.ang2Y+c*u.ang2Z;let X=(x.rhs*oimo.common.Setting.positionSplitImpulseBaumgarte-v)*p.mass,y=f.impulseP;f.impulseP+=X,f.impulseP<x.minImpulse?f.impulseP=x.minImpulse:f.impulseP>x.maxImpulse&&(f.impulseP=x.maxImpulse),X=f.impulseP-y,t+=p.invMLin1X*X,i+=p.invMLin1Y*X,o+=p.invMLin1Z*X,s+=p.invMLin2X*-X,a+=p.invMLin2Y*-X,n+=p.invMLin2Z*-X,e+=p.invMAng1X*X,r+=p.invMAng1Y*X,_+=p.invMAng1Z*X,l+=p.invMAng2X*-X,h+=p.invMAng2Y*-X,c+=p.invMAng2Z*-X}this._b1._pseudoVelX=t,this._b1._pseudoVelY=i,this._b1._pseudoVelZ=o,this._b2._pseudoVelX=s,this._b2._pseudoVelY=a,this._b2._pseudoVelZ=n,this._b1._angPseudoVelX=e,this._b1._angPseudoVelY=r,this._b1._angPseudoVelZ=_,this._b2._angPseudoVelX=l,this._b2._angPseudoVelY=h,this._b2._angPseudoVelZ=c}solvePositionNgs(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;let i,o,s,a,n,e,r,_,l,h,c,m,b,x,p,f,u,v,X=this._b1._invMass,y=this._b2._invMass;i=this._b1._invInertia00,o=this._b1._invInertia01,s=this._b1._invInertia02,a=this._b1._invInertia10,n=this._b1._invInertia11,e=this._b1._invInertia12,r=this._b1._invInertia20,_=this._b1._invInertia21,l=this._b1._invInertia22,h=this._b2._invInertia00,c=this._b2._invInertia01,m=this._b2._invInertia02,b=this._b2._invInertia10,x=this._b2._invInertia11,p=this._b2._invInertia12,f=this._b2._invInertia20,u=this._b2._invInertia21,v=this._b2._invInertia22;let g,d,Y,z,Z,M,I,V,L,w,k,B,A=0,P=this.info.numRows;for(;A<P;){let t,g,d,Y,z,Z,M=A++,I=this.massData[M],V=this.info.rows[M].jacobian;I.invMLin1X=V.lin1X*X,I.invMLin1Y=V.lin1Y*X,I.invMLin1Z=V.lin1Z*X,I.invMLin2X=V.lin2X*y,I.invMLin2Y=V.lin2Y*y,I.invMLin2Z=V.lin2Z*y,t=i*V.ang1X+o*V.ang1Y+s*V.ang1Z,g=a*V.ang1X+n*V.ang1Y+e*V.ang1Z,d=r*V.ang1X+_*V.ang1Y+l*V.ang1Z,I.invMAng1X=t,I.invMAng1Y=g,I.invMAng1Z=d,Y=h*V.ang2X+c*V.ang2Y+m*V.ang2Z,z=b*V.ang2X+x*V.ang2Y+p*V.ang2Z,Z=f*V.ang2X+u*V.ang2Y+v*V.ang2Z,I.invMAng2X=Y,I.invMAng2Y=z,I.invMAng2Z=Z,I.mass=I.invMLin1X*V.lin1X+I.invMLin1Y*V.lin1Y+I.invMLin1Z*V.lin1Z+(I.invMLin2X*V.lin2X+I.invMLin2Y*V.lin2Y+I.invMLin2Z*V.lin2Z)+(I.invMAng1X*V.ang1X+I.invMAng1Y*V.ang1Y+I.invMAng1Z*V.ang1Z)+(I.invMAng2X*V.ang2X+I.invMAng2Y*V.ang2Y+I.invMAng2Z*V.ang2Z),0!=I.mass&&(I.mass=1/I.mass)}g=0,d=0,Y=0,z=0,Z=0,M=0,I=0,V=0,L=0,w=0,k=0,B=0;let S=0,T=this.info.numRows;for(;S<T;){let t=S++,i=this.info.rows[t],o=this.massData[t],s=i.impulse,a=i.jacobian,n=0;n+=g*a.lin1X+d*a.lin1Y+Y*a.lin1Z,n-=z*a.lin2X+Z*a.lin2Y+M*a.lin2Z,n+=I*a.ang1X+V*a.ang1Y+L*a.ang1Z,n-=w*a.ang2X+k*a.ang2Y+B*a.ang2Z;let e=(i.rhs*oimo.common.Setting.positionNgsBaumgarte-n)*o.mass,r=s.impulseP;s.impulseP+=e,s.impulseP<i.minImpulse?s.impulseP=i.minImpulse:s.impulseP>i.maxImpulse&&(s.impulseP=i.maxImpulse),e=s.impulseP-r,g+=o.invMLin1X*e,d+=o.invMLin1Y*e,Y+=o.invMLin1Z*e,z+=o.invMLin2X*-e,Z+=o.invMLin2Y*-e,M+=o.invMLin2Z*-e,I+=o.invMAng1X*e,V+=o.invMAng1Y*e,L+=o.invMAng1Z*e,w+=o.invMAng2X*-e,k+=o.invMAng2Y*-e,B+=o.invMAng2Z*-e}let C=this._b1;C._transform._positionX+=g,C._transform._positionY+=d,C._transform._positionZ+=Y;let j=this._b2;j._transform._positionX+=z,j._transform._positionY+=Z,j._transform._positionZ+=M;let R,q,E,D,F,N,W,G,J,O,H,U,Q,K=this._b1,$=Math.sqrt(I*I+V*V+L*L),tt=.5*$;if(tt<.5){let t=tt*tt;R=.5*(1-.16666666666666666*t+t*t*.008333333333333333),q=1-.5*t+t*t*.041666666666666664}else R=Math.sin(tt)/$,q=Math.cos(tt);E=I*R,D=V*R,F=L*R,N=E,W=D,G=F,J=q;let it,ot=K._transform._rotation00,st=K._transform._rotation11,at=K._transform._rotation22,nt=ot+st+at;nt>0?(it=Math.sqrt(nt+1),Q=.5*it,it=.5/it,O=(K._transform._rotation21-K._transform._rotation12)*it,H=(K._transform._rotation02-K._transform._rotation20)*it,U=(K._transform._rotation10-K._transform._rotation01)*it):ot>st?ot>at?(it=Math.sqrt(ot-st-at+1),O=.5*it,it=.5/it,H=(K._transform._rotation01+K._transform._rotation10)*it,U=(K._transform._rotation02+K._transform._rotation20)*it,Q=(K._transform._rotation21-K._transform._rotation12)*it):(it=Math.sqrt(at-ot-st+1),U=.5*it,it=.5/it,O=(K._transform._rotation02+K._transform._rotation20)*it,H=(K._transform._rotation12+K._transform._rotation21)*it,Q=(K._transform._rotation10-K._transform._rotation01)*it):st>at?(it=Math.sqrt(st-at-ot+1),H=.5*it,it=.5/it,O=(K._transform._rotation01+K._transform._rotation10)*it,U=(K._transform._rotation12+K._transform._rotation21)*it,Q=(K._transform._rotation02-K._transform._rotation20)*it):(it=Math.sqrt(at-ot-st+1),U=.5*it,it=.5/it,O=(K._transform._rotation02+K._transform._rotation20)*it,H=(K._transform._rotation12+K._transform._rotation21)*it,Q=(K._transform._rotation10-K._transform._rotation01)*it),O=J*O+N*Q+W*U-G*H,H=J*H-N*U+W*Q+G*O,U=J*U+N*H-W*O+G*Q,Q=J*Q-N*O-W*H-G*U;let et=O*O+H*H+U*U+Q*Q;et>1e-32&&(et=1/Math.sqrt(et)),O*=et,H*=et,U*=et,Q*=et;let rt,_t,lt,ht,ct,mt,bt,xt,pt,ft,ut,vt,Xt,yt,gt,dt,Yt,zt,Zt=2*O,Mt=2*H,It=2*U,Vt=O*Zt,Lt=H*Mt,wt=U*It,kt=O*Mt,Bt=H*It,At=O*It,Pt=Q*Zt,St=Q*Mt,Tt=Q*It;K._transform._rotation00=1-Lt-wt,K._transform._rotation01=kt-Tt,K._transform._rotation02=At+St,K._transform._rotation10=kt+Tt,K._transform._rotation11=1-Vt-wt,K._transform._rotation12=Bt-Pt,K._transform._rotation20=At-St,K._transform._rotation21=Bt+Pt,K._transform._rotation22=1-Vt-Lt,rt=K._transform._rotation00*K._invLocalInertia00+K._transform._rotation01*K._invLocalInertia10+K._transform._rotation02*K._invLocalInertia20,_t=K._transform._rotation00*K._invLocalInertia01+K._transform._rotation01*K._invLocalInertia11+K._transform._rotation02*K._invLocalInertia21,lt=K._transform._rotation00*K._invLocalInertia02+K._transform._rotation01*K._invLocalInertia12+K._transform._rotation02*K._invLocalInertia22,ht=K._transform._rotation10*K._invLocalInertia00+K._transform._rotation11*K._invLocalInertia10+K._transform._rotation12*K._invLocalInertia20,ct=K._transform._rotation10*K._invLocalInertia01+K._transform._rotation11*K._invLocalInertia11+K._transform._rotation12*K._invLocalInertia21,mt=K._transform._rotation10*K._invLocalInertia02+K._transform._rotation11*K._invLocalInertia12+K._transform._rotation12*K._invLocalInertia22,bt=K._transform._rotation20*K._invLocalInertia00+K._transform._rotation21*K._invLocalInertia10+K._transform._rotation22*K._invLocalInertia20,xt=K._transform._rotation20*K._invLocalInertia01+K._transform._rotation21*K._invLocalInertia11+K._transform._rotation22*K._invLocalInertia21,pt=K._transform._rotation20*K._invLocalInertia02+K._transform._rotation21*K._invLocalInertia12+K._transform._rotation22*K._invLocalInertia22,K._invInertia00=rt,K._invInertia01=_t,K._invInertia02=lt,K._invInertia10=ht,K._invInertia11=ct,K._invInertia12=mt,K._invInertia20=bt,K._invInertia21=xt,K._invInertia22=pt,ft=K._invInertia00*K._transform._rotation00+K._invInertia01*K._transform._rotation01+K._invInertia02*K._transform._rotation02,ut=K._invInertia00*K._transform._rotation10+K._invInertia01*K._transform._rotation11+K._invInertia02*K._transform._rotation12,vt=K._invInertia00*K._transform._rotation20+K._invInertia01*K._transform._rotation21+K._invInertia02*K._transform._rotation22,Xt=K._invInertia10*K._transform._rotation00+K._invInertia11*K._transform._rotation01+K._invInertia12*K._transform._rotation02,yt=K._invInertia10*K._transform._rotation10+K._invInertia11*K._transform._rotation11+K._invInertia12*K._transform._rotation12,gt=K._invInertia10*K._transform._rotation20+K._invInertia11*K._transform._rotation21+K._invInertia12*K._transform._rotation22,dt=K._invInertia20*K._transform._rotation00+K._invInertia21*K._transform._rotation01+K._invInertia22*K._transform._rotation02,Yt=K._invInertia20*K._transform._rotation10+K._invInertia21*K._transform._rotation11+K._invInertia22*K._transform._rotation12,zt=K._invInertia20*K._transform._rotation20+K._invInertia21*K._transform._rotation21+K._invInertia22*K._transform._rotation22,K._invInertia00=ft,K._invInertia01=ut,K._invInertia02=vt,K._invInertia10=Xt,K._invInertia11=yt,K._invInertia12=gt,K._invInertia20=dt,K._invInertia21=Yt,K._invInertia22=zt,K._invInertia00*=K._rotFactor.x,K._invInertia01*=K._rotFactor.x,K._invInertia02*=K._rotFactor.x,K._invInertia10*=K._rotFactor.y,K._invInertia11*=K._rotFactor.y,K._invInertia12*=K._rotFactor.y,K._invInertia20*=K._rotFactor.z,K._invInertia21*=K._rotFactor.z,K._invInertia22*=K._rotFactor.z;let Ct,jt,Rt,qt,Et,Dt,Ft,Nt,Wt,Gt,Jt,Ot,Ht,Ut=this._b2,Qt=Math.sqrt(w*w+k*k+B*B),Kt=.5*Qt;if(Kt<.5){let t=Kt*Kt;Ct=.5*(1-.16666666666666666*t+t*t*.008333333333333333),jt=1-.5*t+t*t*.041666666666666664}else Ct=Math.sin(Kt)/Qt,jt=Math.cos(Kt);Rt=w*Ct,qt=k*Ct,Et=B*Ct,Dt=Rt,Ft=qt,Nt=Et,Wt=jt;let $t,ti=Ut._transform._rotation00,ii=Ut._transform._rotation11,oi=Ut._transform._rotation22,si=ti+ii+oi;si>0?($t=Math.sqrt(si+1),Ht=.5*$t,$t=.5/$t,Gt=(Ut._transform._rotation21-Ut._transform._rotation12)*$t,Jt=(Ut._transform._rotation02-Ut._transform._rotation20)*$t,Ot=(Ut._transform._rotation10-Ut._transform._rotation01)*$t):ti>ii?ti>oi?($t=Math.sqrt(ti-ii-oi+1),Gt=.5*$t,$t=.5/$t,Jt=(Ut._transform._rotation01+Ut._transform._rotation10)*$t,Ot=(Ut._transform._rotation02+Ut._transform._rotation20)*$t,Ht=(Ut._transform._rotation21-Ut._transform._rotation12)*$t):($t=Math.sqrt(oi-ti-ii+1),Ot=.5*$t,$t=.5/$t,Gt=(Ut._transform._rotation02+Ut._transform._rotation20)*$t,Jt=(Ut._transform._rotation12+Ut._transform._rotation21)*$t,Ht=(Ut._transform._rotation10-Ut._transform._rotation01)*$t):ii>oi?($t=Math.sqrt(ii-oi-ti+1),Jt=.5*$t,$t=.5/$t,Gt=(Ut._transform._rotation01+Ut._transform._rotation10)*$t,Ot=(Ut._transform._rotation12+Ut._transform._rotation21)*$t,Ht=(Ut._transform._rotation02-Ut._transform._rotation20)*$t):($t=Math.sqrt(oi-ti-ii+1),Ot=.5*$t,$t=.5/$t,Gt=(Ut._transform._rotation02+Ut._transform._rotation20)*$t,Jt=(Ut._transform._rotation12+Ut._transform._rotation21)*$t,Ht=(Ut._transform._rotation10-Ut._transform._rotation01)*$t),Gt=Wt*Gt+Dt*Ht+Ft*Ot-Nt*Jt,Jt=Wt*Jt-Dt*Ot+Ft*Ht+Nt*Gt,Ot=Wt*Ot+Dt*Jt-Ft*Gt+Nt*Ht,Ht=Wt*Ht-Dt*Gt-Ft*Jt-Nt*Ot;let ai=Gt*Gt+Jt*Jt+Ot*Ot+Ht*Ht;ai>1e-32&&(ai=1/Math.sqrt(ai)),Gt*=ai,Jt*=ai,Ot*=ai,Ht*=ai;let ni,ei,ri,_i,li,hi,ci,mi,bi,xi,pi,fi,ui,vi,Xi,yi,gi,di,Yi=2*Gt,zi=2*Jt,Zi=2*Ot,Mi=Gt*Yi,Ii=Jt*zi,Vi=Ot*Zi,Li=Gt*zi,wi=Jt*Zi,ki=Gt*Zi,Bi=Ht*Yi,Ai=Ht*zi,Pi=Ht*Zi;Ut._transform._rotation00=1-Ii-Vi,Ut._transform._rotation01=Li-Pi,Ut._transform._rotation02=ki+Ai,Ut._transform._rotation10=Li+Pi,Ut._transform._rotation11=1-Mi-Vi,Ut._transform._rotation12=wi-Bi,Ut._transform._rotation20=ki-Ai,Ut._transform._rotation21=wi+Bi,Ut._transform._rotation22=1-Mi-Ii,ni=Ut._transform._rotation00*Ut._invLocalInertia00+Ut._transform._rotation01*Ut._invLocalInertia10+Ut._transform._rotation02*Ut._invLocalInertia20,ei=Ut._transform._rotation00*Ut._invLocalInertia01+Ut._transform._rotation01*Ut._invLocalInertia11+Ut._transform._rotation02*Ut._invLocalInertia21,ri=Ut._transform._rotation00*Ut._invLocalInertia02+Ut._transform._rotation01*Ut._invLocalInertia12+Ut._transform._rotation02*Ut._invLocalInertia22,_i=Ut._transform._rotation10*Ut._invLocalInertia00+Ut._transform._rotation11*Ut._invLocalInertia10+Ut._transform._rotation12*Ut._invLocalInertia20,li=Ut._transform._rotation10*Ut._invLocalInertia01+Ut._transform._rotation11*Ut._invLocalInertia11+Ut._transform._rotation12*Ut._invLocalInertia21,hi=Ut._transform._rotation10*Ut._invLocalInertia02+Ut._transform._rotation11*Ut._invLocalInertia12+Ut._transform._rotation12*Ut._invLocalInertia22,ci=Ut._transform._rotation20*Ut._invLocalInertia00+Ut._transform._rotation21*Ut._invLocalInertia10+Ut._transform._rotation22*Ut._invLocalInertia20,mi=Ut._transform._rotation20*Ut._invLocalInertia01+Ut._transform._rotation21*Ut._invLocalInertia11+Ut._transform._rotation22*Ut._invLocalInertia21,bi=Ut._transform._rotation20*Ut._invLocalInertia02+Ut._transform._rotation21*Ut._invLocalInertia12+Ut._transform._rotation22*Ut._invLocalInertia22,Ut._invInertia00=ni,Ut._invInertia01=ei,Ut._invInertia02=ri,Ut._invInertia10=_i,Ut._invInertia11=li,Ut._invInertia12=hi,Ut._invInertia20=ci,Ut._invInertia21=mi,Ut._invInertia22=bi,xi=Ut._invInertia00*Ut._transform._rotation00+Ut._invInertia01*Ut._transform._rotation01+Ut._invInertia02*Ut._transform._rotation02,pi=Ut._invInertia00*Ut._transform._rotation10+Ut._invInertia01*Ut._transform._rotation11+Ut._invInertia02*Ut._transform._rotation12,fi=Ut._invInertia00*Ut._transform._rotation20+Ut._invInertia01*Ut._transform._rotation21+Ut._invInertia02*Ut._transform._rotation22,ui=Ut._invInertia10*Ut._transform._rotation00+Ut._invInertia11*Ut._transform._rotation01+Ut._invInertia12*Ut._transform._rotation02,vi=Ut._invInertia10*Ut._transform._rotation10+Ut._invInertia11*Ut._transform._rotation11+Ut._invInertia12*Ut._transform._rotation12,Xi=Ut._invInertia10*Ut._transform._rotation20+Ut._invInertia11*Ut._transform._rotation21+Ut._invInertia12*Ut._transform._rotation22,yi=Ut._invInertia20*Ut._transform._rotation00+Ut._invInertia21*Ut._transform._rotation01+Ut._invInertia22*Ut._transform._rotation02,gi=Ut._invInertia20*Ut._transform._rotation10+Ut._invInertia21*Ut._transform._rotation11+Ut._invInertia22*Ut._transform._rotation12,di=Ut._invInertia20*Ut._transform._rotation20+Ut._invInertia21*Ut._transform._rotation21+Ut._invInertia22*Ut._transform._rotation22,Ut._invInertia00=xi,Ut._invInertia01=pi,Ut._invInertia02=fi,Ut._invInertia10=ui,Ut._invInertia11=vi,Ut._invInertia12=Xi,Ut._invInertia20=yi,Ut._invInertia21=gi,Ut._invInertia22=di,Ut._invInertia00*=Ut._rotFactor.x,Ut._invInertia01*=Ut._rotFactor.x,Ut._invInertia02*=Ut._rotFactor.x,Ut._invInertia10*=Ut._rotFactor.y,Ut._invInertia11*=Ut._rotFactor.y,Ut._invInertia12*=Ut._rotFactor.y,Ut._invInertia20*=Ut._rotFactor.z,Ut._invInertia21*=Ut._rotFactor.z,Ut._invInertia22*=Ut._rotFactor.z}postSolve(){this.joint._syncAnchors(),this.joint._checkDestruction()}},oimo.dynamics.rigidbody||(oimo.dynamics.rigidbody={}),oimo.dynamics.rigidbody.MassData=class{constructor(){this.mass=0,this.localInertia=new oimo.common.Mat3}},oimo.dynamics.rigidbody.RigidBody=class{constructor(t){this._next=null,this._prev=null,this._shapeList=null,this._shapeListLast=null,this._numShapes=0,this._contactLinkList=null,this._contactLinkListLast=null,this._numContactLinks=0,this._jointLinkList=null,this._jointLinkListLast=null,this._numJointLinks=0;let i=t.linearVelocity;this._velX=i.x,this._velY=i.y,this._velZ=i.z;let o=t.angularVelocity;this._angVelX=o.x,this._angVelY=o.y,this._angVelZ=o.z,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._ptransform=new oimo.common.Transform,this._transform=new oimo.common.Transform;let s=t.position;this._ptransform._positionX=s.x,this._ptransform._positionY=s.y,this._ptransform._positionZ=s.z;let a=t.rotation;this._ptransform._rotation00=a.e00,this._ptransform._rotation01=a.e01,this._ptransform._rotation02=a.e02,this._ptransform._rotation10=a.e10,this._ptransform._rotation11=a.e11,this._ptransform._rotation12=a.e12,this._ptransform._rotation20=a.e20,this._ptransform._rotation21=a.e21,this._ptransform._rotation22=a.e22;let n=this._transform,e=this._ptransform;n._positionX=e._positionX,n._positionY=e._positionY,n._positionZ=e._positionZ,n._rotation00=e._rotation00,n._rotation01=e._rotation01,n._rotation02=e._rotation02,n._rotation10=e._rotation10,n._rotation11=e._rotation11,n._rotation12=e._rotation12,n._rotation20=e._rotation20,n._rotation21=e._rotation21,n._rotation22=e._rotation22,this._type=t.type,this._sleepTime=0,this._sleeping=!1,this._autoSleep=t.autoSleep,this._mass=0,this._invMass=0,this._localInertia00=0,this._localInertia01=0,this._localInertia02=0,this._localInertia10=0,this._localInertia11=0,this._localInertia12=0,this._localInertia20=0,this._localInertia21=0,this._localInertia22=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._invInertia00=0,this._invInertia01=0,this._invInertia02=0,this._invInertia10=0,this._invInertia11=0,this._invInertia12=0,this._invInertia20=0,this._invInertia21=0,this._invInertia22=0,this._linearDamping=t.linearDamping,this._angularDamping=t.angularDamping,this._forceX=0,this._forceY=0,this._forceZ=0,this._torqueX=0,this._torqueY=0,this._torqueZ=0,this._linearContactImpulseX=0,this._linearContactImpulseY=0,this._linearContactImpulseZ=0,this._angularContactImpulseX=0,this._angularContactImpulseY=0,this._angularContactImpulseZ=0,this._rotFactor=new oimo.common.Vec3(1,1,1),this._addedToIsland=!1,this._gravityScale=1,this._world=null}_integrate(t){switch(this._type){case 1:this._velX=0,this._velY=0,this._velZ=0,this._angVelX=0,this._angVelY=0,this._angVelZ=0,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:let i,o,s,a,n,e;i=this._velX*t,o=this._velY*t,s=this._velZ*t,a=this._angVelX*t,n=this._angVelY*t,e=this._angVelZ*t;let r=i*i+o*o+s*s,_=a*a+n*n+e*e;if(0==r&&0==_)return;if(r>oimo.common.Setting.maxTranslationPerStep*oimo.common.Setting.maxTranslationPerStep){let t=oimo.common.Setting.maxTranslationPerStep/Math.sqrt(r);this._velX*=t,this._velY*=t,this._velZ*=t,i*=t,o*=t,s*=t}if(_>oimo.common.Setting.maxRotationPerStep*oimo.common.Setting.maxRotationPerStep){let t=oimo.common.Setting.maxRotationPerStep/Math.sqrt(_);this._angVelX*=t,this._angVelY*=t,this._angVelZ*=t,a*=t,n*=t,e*=t}this._transform._positionX+=i,this._transform._positionY+=o,this._transform._positionZ+=s;let l,h,c,m,b,x,p,f,u,v,X,y,g,d=Math.sqrt(a*a+n*n+e*e),Y=.5*d;if(Y<.5){let t=Y*Y;l=.5*(1-.16666666666666666*t+t*t*.008333333333333333),h=1-.5*t+t*t*.041666666666666664}else l=Math.sin(Y)/d,h=Math.cos(Y);c=a*l,m=n*l,b=e*l,x=c,p=m,f=b,u=h;let z,Z=this._transform._rotation00,M=this._transform._rotation11,I=this._transform._rotation22,V=Z+M+I;V>0?(z=Math.sqrt(V+1),g=.5*z,z=.5/z,v=(this._transform._rotation21-this._transform._rotation12)*z,X=(this._transform._rotation02-this._transform._rotation20)*z,y=(this._transform._rotation10-this._transform._rotation01)*z):Z>M?Z>I?(z=Math.sqrt(Z-M-I+1),v=.5*z,z=.5/z,X=(this._transform._rotation01+this._transform._rotation10)*z,y=(this._transform._rotation02+this._transform._rotation20)*z,g=(this._transform._rotation21-this._transform._rotation12)*z):(z=Math.sqrt(I-Z-M+1),y=.5*z,z=.5/z,v=(this._transform._rotation02+this._transform._rotation20)*z,X=(this._transform._rotation12+this._transform._rotation21)*z,g=(this._transform._rotation10-this._transform._rotation01)*z):M>I?(z=Math.sqrt(M-I-Z+1),X=.5*z,z=.5/z,v=(this._transform._rotation01+this._transform._rotation10)*z,y=(this._transform._rotation12+this._transform._rotation21)*z,g=(this._transform._rotation02-this._transform._rotation20)*z):(z=Math.sqrt(I-Z-M+1),y=.5*z,z=.5/z,v=(this._transform._rotation02+this._transform._rotation20)*z,X=(this._transform._rotation12+this._transform._rotation21)*z,g=(this._transform._rotation10-this._transform._rotation01)*z),v=u*v+x*g+p*y-f*X,X=u*X-x*y+p*g+f*v,y=u*y+x*X-p*v+f*g,g=u*g-x*v-p*X-f*y;let L=v*v+X*X+y*y+g*g;L>1e-32&&(L=1/Math.sqrt(L)),v*=L,X*=L,y*=L,g*=L;let w,k,B,A,P,S,T,C,j,R,q,E,D,F,N,W,G,J,O=2*v,H=2*X,U=2*y,Q=v*O,K=X*H,$=y*U,tt=v*H,it=X*U,ot=v*U,st=g*O,at=g*H,nt=g*U;this._transform._rotation00=1-K-$,this._transform._rotation01=tt-nt,this._transform._rotation02=ot+at,this._transform._rotation10=tt+nt,this._transform._rotation11=1-Q-$,this._transform._rotation12=it-st,this._transform._rotation20=ot-at,this._transform._rotation21=it+st,this._transform._rotation22=1-Q-K,w=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,k=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,B=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,A=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,P=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,S=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,T=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,C=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,j=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=w,this._invInertia01=k,this._invInertia02=B,this._invInertia10=A,this._invInertia11=P,this._invInertia12=S,this._invInertia20=T,this._invInertia21=C,this._invInertia22=j,R=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,q=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,E=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,D=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,F=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,N=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,W=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,G=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,J=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=R,this._invInertia01=q,this._invInertia02=E,this._invInertia10=D,this._invInertia11=F,this._invInertia12=N,this._invInertia20=W,this._invInertia21=G,this._invInertia22=J,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z}}_integratePseudoVelocity(){if(this._pseudoVelX*this._pseudoVelX+this._pseudoVelY*this._pseudoVelY+this._pseudoVelZ*this._pseudoVelZ!=0||this._angPseudoVelX*this._angPseudoVelX+this._angPseudoVelY*this._angPseudoVelY+this._angPseudoVelZ*this._angPseudoVelZ!=0)switch(this._type){case 1:this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:let t,i,o,s,a,n;t=this._pseudoVelX,i=this._pseudoVelY,o=this._pseudoVelZ,s=this._angPseudoVelX,a=this._angPseudoVelY,n=this._angPseudoVelZ,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._transform._positionX+=t,this._transform._positionY+=i,this._transform._positionZ+=o;let e,r,_,l,h,c,m,b,x,p,f,u,v,X=Math.sqrt(s*s+a*a+n*n),y=.5*X;if(y<.5){let t=y*y;e=.5*(1-.16666666666666666*t+t*t*.008333333333333333),r=1-.5*t+t*t*.041666666666666664}else e=Math.sin(y)/X,r=Math.cos(y);_=s*e,l=a*e,h=n*e,c=_,m=l,b=h,x=r;let g,d=this._transform._rotation00,Y=this._transform._rotation11,z=this._transform._rotation22,Z=d+Y+z;Z>0?(g=Math.sqrt(Z+1),v=.5*g,g=.5/g,p=(this._transform._rotation21-this._transform._rotation12)*g,f=(this._transform._rotation02-this._transform._rotation20)*g,u=(this._transform._rotation10-this._transform._rotation01)*g):d>Y?d>z?(g=Math.sqrt(d-Y-z+1),p=.5*g,g=.5/g,f=(this._transform._rotation01+this._transform._rotation10)*g,u=(this._transform._rotation02+this._transform._rotation20)*g,v=(this._transform._rotation21-this._transform._rotation12)*g):(g=Math.sqrt(z-d-Y+1),u=.5*g,g=.5/g,p=(this._transform._rotation02+this._transform._rotation20)*g,f=(this._transform._rotation12+this._transform._rotation21)*g,v=(this._transform._rotation10-this._transform._rotation01)*g):Y>z?(g=Math.sqrt(Y-z-d+1),f=.5*g,g=.5/g,p=(this._transform._rotation01+this._transform._rotation10)*g,u=(this._transform._rotation12+this._transform._rotation21)*g,v=(this._transform._rotation02-this._transform._rotation20)*g):(g=Math.sqrt(z-d-Y+1),u=.5*g,g=.5/g,p=(this._transform._rotation02+this._transform._rotation20)*g,f=(this._transform._rotation12+this._transform._rotation21)*g,v=(this._transform._rotation10-this._transform._rotation01)*g),p=x*p+c*v+m*u-b*f,f=x*f-c*u+m*v+b*p,u=x*u+c*f-m*p+b*v,v=x*v-c*p-m*f-b*u;let M=p*p+f*f+u*u+v*v;M>1e-32&&(M=1/Math.sqrt(M)),p*=M,f*=M,u*=M,v*=M;let I,V,L,w,k,B,A,P,S,T,C,j,R,q,E,D,F,N,W=2*p,G=2*f,J=2*u,O=p*W,H=f*G,U=u*J,Q=p*G,K=f*J,$=p*J,tt=v*W,it=v*G,ot=v*J;this._transform._rotation00=1-H-U,this._transform._rotation01=Q-ot,this._transform._rotation02=$+it,this._transform._rotation10=Q+ot,this._transform._rotation11=1-O-U,this._transform._rotation12=K-tt,this._transform._rotation20=$-it,this._transform._rotation21=K+tt,this._transform._rotation22=1-O-H,I=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,V=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,L=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,w=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,k=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,B=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,A=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,P=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,S=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=I,this._invInertia01=V,this._invInertia02=L,this._invInertia10=w,this._invInertia11=k,this._invInertia12=B,this._invInertia20=A,this._invInertia21=P,this._invInertia22=S,T=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,C=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,j=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,R=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,q=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,E=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,D=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,F=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,N=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=T,this._invInertia01=C,this._invInertia02=j,this._invInertia10=R,this._invInertia11=q,this._invInertia12=E,this._invInertia20=D,this._invInertia21=F,this._invInertia22=N,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z}}updateMass(){let t,i,o,s,a,n,e,r,_;t=0,i=0,o=0,s=0,a=0,n=0,e=0,r=0,_=0;let l,h,c,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I=0,V=this._shapeList;for(;null!=V;){let l=V._next,h=V._geom;h._updateMass();let c,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,L,w,k,B,A,P,S,T,C,j,R,q,E,D,F,N,W,G,J,O,H=V._density*h._volume;y=V._localTransform._rotation00*h._inertiaCoeff00+V._localTransform._rotation01*h._inertiaCoeff10+V._localTransform._rotation02*h._inertiaCoeff20,g=V._localTransform._rotation00*h._inertiaCoeff01+V._localTransform._rotation01*h._inertiaCoeff11+V._localTransform._rotation02*h._inertiaCoeff21,d=V._localTransform._rotation00*h._inertiaCoeff02+V._localTransform._rotation01*h._inertiaCoeff12+V._localTransform._rotation02*h._inertiaCoeff22,Y=V._localTransform._rotation10*h._inertiaCoeff00+V._localTransform._rotation11*h._inertiaCoeff10+V._localTransform._rotation12*h._inertiaCoeff20,z=V._localTransform._rotation10*h._inertiaCoeff01+V._localTransform._rotation11*h._inertiaCoeff11+V._localTransform._rotation12*h._inertiaCoeff21,Z=V._localTransform._rotation10*h._inertiaCoeff02+V._localTransform._rotation11*h._inertiaCoeff12+V._localTransform._rotation12*h._inertiaCoeff22,M=V._localTransform._rotation20*h._inertiaCoeff00+V._localTransform._rotation21*h._inertiaCoeff10+V._localTransform._rotation22*h._inertiaCoeff20,L=V._localTransform._rotation20*h._inertiaCoeff01+V._localTransform._rotation21*h._inertiaCoeff11+V._localTransform._rotation22*h._inertiaCoeff21,w=V._localTransform._rotation20*h._inertiaCoeff02+V._localTransform._rotation21*h._inertiaCoeff12+V._localTransform._rotation22*h._inertiaCoeff22,c=y,m=g,b=d,x=Y,p=z,f=Z,u=M,v=L,X=w,k=c*V._localTransform._rotation00+m*V._localTransform._rotation01+b*V._localTransform._rotation02,B=c*V._localTransform._rotation10+m*V._localTransform._rotation11+b*V._localTransform._rotation12,A=c*V._localTransform._rotation20+m*V._localTransform._rotation21+b*V._localTransform._rotation22,P=x*V._localTransform._rotation00+p*V._localTransform._rotation01+f*V._localTransform._rotation02,S=x*V._localTransform._rotation10+p*V._localTransform._rotation11+f*V._localTransform._rotation12,T=x*V._localTransform._rotation20+p*V._localTransform._rotation21+f*V._localTransform._rotation22,C=u*V._localTransform._rotation00+v*V._localTransform._rotation01+X*V._localTransform._rotation02,j=u*V._localTransform._rotation10+v*V._localTransform._rotation11+X*V._localTransform._rotation12,R=u*V._localTransform._rotation20+v*V._localTransform._rotation21+X*V._localTransform._rotation22,c=k,m=B,b=A,x=P,p=S,f=T,u=C,v=j,X=R,c*=H,m*=H,b*=H,x*=H,p*=H,f*=H,u*=H,v*=H,X*=H;let U=V._localTransform._positionX*V._localTransform._positionX,Q=V._localTransform._positionY*V._localTransform._positionY,K=V._localTransform._positionZ*V._localTransform._positionZ,$=-V._localTransform._positionX*V._localTransform._positionY,tt=-V._localTransform._positionY*V._localTransform._positionZ,it=-V._localTransform._positionZ*V._localTransform._positionX;q=Q+K,E=$,D=it,F=$,N=U+K,W=tt,G=it,J=tt,O=U+Q,c+=q*H,m+=E*H,b+=D*H,x+=F*H,p+=N*H,f+=W*H,u+=G*H,v+=J*H,X+=O*H,I+=H,t+=c,i+=m,o+=b,s+=x,a+=p,n+=f,e+=u,r+=v,_+=X,V=l}if(this._mass=I,this._localInertia00=t,this._localInertia01=i,this._localInertia02=o,this._localInertia10=s,this._localInertia11=a,this._localInertia12=n,this._localInertia20=e,this._localInertia21=r,this._localInertia22=_,this._mass>0&&this._localInertia00*(this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21)-this._localInertia01*(this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20)+this._localInertia02*(this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20)>0&&0==this._type){this._invMass=1/this._mass;let t=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,i=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,o=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,s=this._localInertia00*t-this._localInertia01*i+this._localInertia02*o;(s<-1e-32||s>1e-32)&&(s=1/s),this._invLocalInertia00=t*s,this._invLocalInertia01=-(this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21)*s,this._invLocalInertia02=(this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11)*s,this._invLocalInertia10=-i*s,this._invLocalInertia11=(this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20)*s,this._invLocalInertia12=-(this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10)*s,this._invLocalInertia20=o*s,this._invLocalInertia21=-(this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20)*s,this._invLocalInertia22=(this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10)*s,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,0==this._type&&(this._type=1);l=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,h=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,c=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,m=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,b=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,x=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,p=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,f=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,u=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=l,this._invInertia01=h,this._invInertia02=c,this._invInertia10=m,this._invInertia11=b,this._invInertia12=x,this._invInertia20=p,this._invInertia21=f,this._invInertia22=u,v=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,X=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,y=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,g=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,d=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,Y=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,z=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,Z=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,M=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=v,this._invInertia01=X,this._invInertia02=y,this._invInertia10=g,this._invInertia11=d,this._invInertia12=Y,this._invInertia20=z,this._invInertia21=Z,this._invInertia22=M,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getPosition(){let t=new oimo.common.Vec3;return t.x=this._transform._positionX,t.y=this._transform._positionY,t.z=this._transform._positionZ,t}getPositionTo(t){t.x=this._transform._positionX,t.y=this._transform._positionY,t.z=this._transform._positionZ}setPosition(t){this._transform._positionX=t.x,this._transform._positionY=t.y,this._transform._positionZ=t.z;let i=this._ptransform,o=this._transform;i._positionX=o._positionX,i._positionY=o._positionY,i._positionZ=o._positionZ,i._rotation00=o._rotation00,i._rotation01=o._rotation01,i._rotation02=o._rotation02,i._rotation10=o._rotation10,i._rotation11=o._rotation11,i._rotation12=o._rotation12,i._rotation20=o._rotation20,i._rotation21=o._rotation21,i._rotation22=o._rotation22;let s=this._shapeList;for(;null!=s;){let t,i,o,a,n,e,r,_,l,h,c,m,b=s._next,x=this._ptransform,p=this._transform,f=s._ptransform,u=s._localTransform;t=x._rotation00*u._rotation00+x._rotation01*u._rotation10+x._rotation02*u._rotation20,i=x._rotation00*u._rotation01+x._rotation01*u._rotation11+x._rotation02*u._rotation21,o=x._rotation00*u._rotation02+x._rotation01*u._rotation12+x._rotation02*u._rotation22,a=x._rotation10*u._rotation00+x._rotation11*u._rotation10+x._rotation12*u._rotation20,n=x._rotation10*u._rotation01+x._rotation11*u._rotation11+x._rotation12*u._rotation21,e=x._rotation10*u._rotation02+x._rotation11*u._rotation12+x._rotation12*u._rotation22,r=x._rotation20*u._rotation00+x._rotation21*u._rotation10+x._rotation22*u._rotation20,_=x._rotation20*u._rotation01+x._rotation21*u._rotation11+x._rotation22*u._rotation21,l=x._rotation20*u._rotation02+x._rotation21*u._rotation12+x._rotation22*u._rotation22,f._rotation00=t,f._rotation01=i,f._rotation02=o,f._rotation10=a,f._rotation11=n,f._rotation12=e,f._rotation20=r,f._rotation21=_,f._rotation22=l,h=x._rotation00*u._positionX+x._rotation01*u._positionY+x._rotation02*u._positionZ,c=x._rotation10*u._positionX+x._rotation11*u._positionY+x._rotation12*u._positionZ,m=x._rotation20*u._positionX+x._rotation21*u._positionY+x._rotation22*u._positionZ,f._positionX=h,f._positionY=c,f._positionZ=m,f._positionX+=x._positionX,f._positionY+=x._positionY,f._positionZ+=x._positionZ;let v,X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A,P,S,T=s._transform,C=s._localTransform;if(v=p._rotation00*C._rotation00+p._rotation01*C._rotation10+p._rotation02*C._rotation20,X=p._rotation00*C._rotation01+p._rotation01*C._rotation11+p._rotation02*C._rotation21,y=p._rotation00*C._rotation02+p._rotation01*C._rotation12+p._rotation02*C._rotation22,g=p._rotation10*C._rotation00+p._rotation11*C._rotation10+p._rotation12*C._rotation20,d=p._rotation10*C._rotation01+p._rotation11*C._rotation11+p._rotation12*C._rotation21,Y=p._rotation10*C._rotation02+p._rotation11*C._rotation12+p._rotation12*C._rotation22,z=p._rotation20*C._rotation00+p._rotation21*C._rotation10+p._rotation22*C._rotation20,Z=p._rotation20*C._rotation01+p._rotation21*C._rotation11+p._rotation22*C._rotation21,M=p._rotation20*C._rotation02+p._rotation21*C._rotation12+p._rotation22*C._rotation22,T._rotation00=v,T._rotation01=X,T._rotation02=y,T._rotation10=g,T._rotation11=d,T._rotation12=Y,T._rotation20=z,T._rotation21=Z,T._rotation22=M,I=p._rotation00*C._positionX+p._rotation01*C._positionY+p._rotation02*C._positionZ,V=p._rotation10*C._positionX+p._rotation11*C._positionY+p._rotation12*C._positionZ,L=p._rotation20*C._positionX+p._rotation21*C._positionY+p._rotation22*C._positionZ,T._positionX=I,T._positionY=V,T._positionZ=L,T._positionX+=p._positionX,T._positionY+=p._positionY,T._positionZ+=p._positionZ,s._geom._computeAabb(s._aabb,s._ptransform),w=s._aabb._minX,k=s._aabb._minY,B=s._aabb._minZ,A=s._aabb._maxX,P=s._aabb._maxY,S=s._aabb._maxZ,s._geom._computeAabb(s._aabb,s._transform),s._aabb._minX=w<s._aabb._minX?w:s._aabb._minX,s._aabb._minY=k<s._aabb._minY?k:s._aabb._minY,s._aabb._minZ=B<s._aabb._minZ?B:s._aabb._minZ,s._aabb._maxX=A>s._aabb._maxX?A:s._aabb._maxX,s._aabb._maxY=P>s._aabb._maxY?P:s._aabb._maxY,s._aabb._maxZ=S>s._aabb._maxZ?S:s._aabb._maxZ,null!=s._proxy){let t,i,o;t=s._transform._positionX-s._ptransform._positionX,i=s._transform._positionY-s._ptransform._positionY,o=s._transform._positionZ-s._ptransform._positionZ;let a=s.displacement;a.x=t,a.y=i,a.z=o,s._rigidBody._world._broadPhase.moveProxy(s._proxy,s._aabb,s.displacement)}s=b}this._sleeping=!1,this._sleepTime=0}translate(t){let i,o,s;i=t.x,o=t.y,s=t.z,this._transform._positionX+=i,this._transform._positionY+=o,this._transform._positionZ+=s;let a=this._ptransform,n=this._transform;a._positionX=n._positionX,a._positionY=n._positionY,a._positionZ=n._positionZ,a._rotation00=n._rotation00,a._rotation01=n._rotation01,a._rotation02=n._rotation02,a._rotation10=n._rotation10,a._rotation11=n._rotation11,a._rotation12=n._rotation12,a._rotation20=n._rotation20,a._rotation21=n._rotation21,a._rotation22=n._rotation22;let e=this._shapeList;for(;null!=e;){let t,i,o,s,a,n,r,_,l,h,c,m,b=e._next,x=this._ptransform,p=this._transform,f=e._ptransform,u=e._localTransform;t=x._rotation00*u._rotation00+x._rotation01*u._rotation10+x._rotation02*u._rotation20,i=x._rotation00*u._rotation01+x._rotation01*u._rotation11+x._rotation02*u._rotation21,o=x._rotation00*u._rotation02+x._rotation01*u._rotation12+x._rotation02*u._rotation22,s=x._rotation10*u._rotation00+x._rotation11*u._rotation10+x._rotation12*u._rotation20,a=x._rotation10*u._rotation01+x._rotation11*u._rotation11+x._rotation12*u._rotation21,n=x._rotation10*u._rotation02+x._rotation11*u._rotation12+x._rotation12*u._rotation22,r=x._rotation20*u._rotation00+x._rotation21*u._rotation10+x._rotation22*u._rotation20,_=x._rotation20*u._rotation01+x._rotation21*u._rotation11+x._rotation22*u._rotation21,l=x._rotation20*u._rotation02+x._rotation21*u._rotation12+x._rotation22*u._rotation22,f._rotation00=t,f._rotation01=i,f._rotation02=o,f._rotation10=s,f._rotation11=a,f._rotation12=n,f._rotation20=r,f._rotation21=_,f._rotation22=l,h=x._rotation00*u._positionX+x._rotation01*u._positionY+x._rotation02*u._positionZ,c=x._rotation10*u._positionX+x._rotation11*u._positionY+x._rotation12*u._positionZ,m=x._rotation20*u._positionX+x._rotation21*u._positionY+x._rotation22*u._positionZ,f._positionX=h,f._positionY=c,f._positionZ=m,f._positionX+=x._positionX,f._positionY+=x._positionY,f._positionZ+=x._positionZ;let v,X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A,P,S,T=e._transform,C=e._localTransform;if(v=p._rotation00*C._rotation00+p._rotation01*C._rotation10+p._rotation02*C._rotation20,X=p._rotation00*C._rotation01+p._rotation01*C._rotation11+p._rotation02*C._rotation21,y=p._rotation00*C._rotation02+p._rotation01*C._rotation12+p._rotation02*C._rotation22,g=p._rotation10*C._rotation00+p._rotation11*C._rotation10+p._rotation12*C._rotation20,d=p._rotation10*C._rotation01+p._rotation11*C._rotation11+p._rotation12*C._rotation21,Y=p._rotation10*C._rotation02+p._rotation11*C._rotation12+p._rotation12*C._rotation22,z=p._rotation20*C._rotation00+p._rotation21*C._rotation10+p._rotation22*C._rotation20,Z=p._rotation20*C._rotation01+p._rotation21*C._rotation11+p._rotation22*C._rotation21,M=p._rotation20*C._rotation02+p._rotation21*C._rotation12+p._rotation22*C._rotation22,T._rotation00=v,T._rotation01=X,T._rotation02=y,T._rotation10=g,T._rotation11=d,T._rotation12=Y,T._rotation20=z,T._rotation21=Z,T._rotation22=M,I=p._rotation00*C._positionX+p._rotation01*C._positionY+p._rotation02*C._positionZ,V=p._rotation10*C._positionX+p._rotation11*C._positionY+p._rotation12*C._positionZ,L=p._rotation20*C._positionX+p._rotation21*C._positionY+p._rotation22*C._positionZ,T._positionX=I,T._positionY=V,T._positionZ=L,T._positionX+=p._positionX,T._positionY+=p._positionY,T._positionZ+=p._positionZ,e._geom._computeAabb(e._aabb,e._ptransform),w=e._aabb._minX,k=e._aabb._minY,B=e._aabb._minZ,A=e._aabb._maxX,P=e._aabb._maxY,S=e._aabb._maxZ,e._geom._computeAabb(e._aabb,e._transform),e._aabb._minX=w<e._aabb._minX?w:e._aabb._minX,e._aabb._minY=k<e._aabb._minY?k:e._aabb._minY,e._aabb._minZ=B<e._aabb._minZ?B:e._aabb._minZ,e._aabb._maxX=A>e._aabb._maxX?A:e._aabb._maxX,e._aabb._maxY=P>e._aabb._maxY?P:e._aabb._maxY,e._aabb._maxZ=S>e._aabb._maxZ?S:e._aabb._maxZ,null!=e._proxy){let t,i,o;t=e._transform._positionX-e._ptransform._positionX,i=e._transform._positionY-e._ptransform._positionY,o=e._transform._positionZ-e._ptransform._positionZ;let s=e.displacement;s.x=t,s.y=i,s.z=o,e._rigidBody._world._broadPhase.moveProxy(e._proxy,e._aabb,e.displacement)}e=b}this._sleeping=!1,this._sleepTime=0}getRotation(){let t=new oimo.common.Mat3;return t.e00=this._transform._rotation00,t.e01=this._transform._rotation01,t.e02=this._transform._rotation02,t.e10=this._transform._rotation10,t.e11=this._transform._rotation11,t.e12=this._transform._rotation12,t.e20=this._transform._rotation20,t.e21=this._transform._rotation21,t.e22=this._transform._rotation22,t}getRotationTo(t){t.e00=this._transform._rotation00,t.e01=this._transform._rotation01,t.e02=this._transform._rotation02,t.e10=this._transform._rotation10,t.e11=this._transform._rotation11,t.e12=this._transform._rotation12,t.e20=this._transform._rotation20,t.e21=this._transform._rotation21,t.e22=this._transform._rotation22}setRotation(t){let i,o,s,a,n,e,r,_,l,h,c,m,b,x,p,f,u,v;this._transform._rotation00=t.e00,this._transform._rotation01=t.e01,this._transform._rotation02=t.e02,this._transform._rotation10=t.e10,this._transform._rotation11=t.e11,this._transform._rotation12=t.e12,this._transform._rotation20=t.e20,this._transform._rotation21=t.e21,this._transform._rotation22=t.e22,i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,o=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,s=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,a=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,n=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,e=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,r=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,l=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=o,this._invInertia02=s,this._invInertia10=a,this._invInertia11=n,this._invInertia12=e,this._invInertia20=r,this._invInertia21=_,this._invInertia22=l,h=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,b=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,x=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,p=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,f=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,u=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,v=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=h,this._invInertia01=c,this._invInertia02=m,this._invInertia10=b,this._invInertia11=x,this._invInertia12=p,this._invInertia20=f,this._invInertia21=u,this._invInertia22=v,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let X=this._ptransform,y=this._transform;X._positionX=y._positionX,X._positionY=y._positionY,X._positionZ=y._positionZ,X._rotation00=y._rotation00,X._rotation01=y._rotation01,X._rotation02=y._rotation02,X._rotation10=y._rotation10,X._rotation11=y._rotation11,X._rotation12=y._rotation12,X._rotation20=y._rotation20,X._rotation21=y._rotation21,X._rotation22=y._rotation22;let g=this._shapeList;for(;null!=g;){let t,i,o,s,a,n,e,r,_,l,h,c,m=g._next,b=this._ptransform,x=this._transform,p=g._ptransform,f=g._localTransform;t=b._rotation00*f._rotation00+b._rotation01*f._rotation10+b._rotation02*f._rotation20,i=b._rotation00*f._rotation01+b._rotation01*f._rotation11+b._rotation02*f._rotation21,o=b._rotation00*f._rotation02+b._rotation01*f._rotation12+b._rotation02*f._rotation22,s=b._rotation10*f._rotation00+b._rotation11*f._rotation10+b._rotation12*f._rotation20,a=b._rotation10*f._rotation01+b._rotation11*f._rotation11+b._rotation12*f._rotation21,n=b._rotation10*f._rotation02+b._rotation11*f._rotation12+b._rotation12*f._rotation22,e=b._rotation20*f._rotation00+b._rotation21*f._rotation10+b._rotation22*f._rotation20,r=b._rotation20*f._rotation01+b._rotation21*f._rotation11+b._rotation22*f._rotation21,_=b._rotation20*f._rotation02+b._rotation21*f._rotation12+b._rotation22*f._rotation22,p._rotation00=t,p._rotation01=i,p._rotation02=o,p._rotation10=s,p._rotation11=a,p._rotation12=n,p._rotation20=e,p._rotation21=r,p._rotation22=_,l=b._rotation00*f._positionX+b._rotation01*f._positionY+b._rotation02*f._positionZ,h=b._rotation10*f._positionX+b._rotation11*f._positionY+b._rotation12*f._positionZ,c=b._rotation20*f._positionX+b._rotation21*f._positionY+b._rotation22*f._positionZ,p._positionX=l,p._positionY=h,p._positionZ=c,p._positionX+=b._positionX,p._positionY+=b._positionY,p._positionZ+=b._positionZ;let u,v,X,y,d,Y,z,Z,M,I,V,L,w,k,B,A,P,S,T=g._transform,C=g._localTransform;if(u=x._rotation00*C._rotation00+x._rotation01*C._rotation10+x._rotation02*C._rotation20,v=x._rotation00*C._rotation01+x._rotation01*C._rotation11+x._rotation02*C._rotation21,X=x._rotation00*C._rotation02+x._rotation01*C._rotation12+x._rotation02*C._rotation22,y=x._rotation10*C._rotation00+x._rotation11*C._rotation10+x._rotation12*C._rotation20,d=x._rotation10*C._rotation01+x._rotation11*C._rotation11+x._rotation12*C._rotation21,Y=x._rotation10*C._rotation02+x._rotation11*C._rotation12+x._rotation12*C._rotation22,z=x._rotation20*C._rotation00+x._rotation21*C._rotation10+x._rotation22*C._rotation20,Z=x._rotation20*C._rotation01+x._rotation21*C._rotation11+x._rotation22*C._rotation21,M=x._rotation20*C._rotation02+x._rotation21*C._rotation12+x._rotation22*C._rotation22,T._rotation00=u,T._rotation01=v,T._rotation02=X,T._rotation10=y,T._rotation11=d,T._rotation12=Y,T._rotation20=z,T._rotation21=Z,T._rotation22=M,I=x._rotation00*C._positionX+x._rotation01*C._positionY+x._rotation02*C._positionZ,V=x._rotation10*C._positionX+x._rotation11*C._positionY+x._rotation12*C._positionZ,L=x._rotation20*C._positionX+x._rotation21*C._positionY+x._rotation22*C._positionZ,T._positionX=I,T._positionY=V,T._positionZ=L,T._positionX+=x._positionX,T._positionY+=x._positionY,T._positionZ+=x._positionZ,g._geom._computeAabb(g._aabb,g._ptransform),w=g._aabb._minX,k=g._aabb._minY,B=g._aabb._minZ,A=g._aabb._maxX,P=g._aabb._maxY,S=g._aabb._maxZ,g._geom._computeAabb(g._aabb,g._transform),g._aabb._minX=w<g._aabb._minX?w:g._aabb._minX,g._aabb._minY=k<g._aabb._minY?k:g._aabb._minY,g._aabb._minZ=B<g._aabb._minZ?B:g._aabb._minZ,g._aabb._maxX=A>g._aabb._maxX?A:g._aabb._maxX,g._aabb._maxY=P>g._aabb._maxY?P:g._aabb._maxY,g._aabb._maxZ=S>g._aabb._maxZ?S:g._aabb._maxZ,null!=g._proxy){let t,i,o;t=g._transform._positionX-g._ptransform._positionX,i=g._transform._positionY-g._ptransform._positionY,o=g._transform._positionZ-g._ptransform._positionZ;let s=g.displacement;s.x=t,s.y=i,s.z=o,g._rigidBody._world._broadPhase.moveProxy(g._proxy,g._aabb,g.displacement)}g=m}this._sleeping=!1,this._sleepTime=0}setRotationXyz(t){let i,o,s;i=t.x,o=t.y,s=t.z;let a,n,e,r,_,l,h,c,m,b,x,p,f,u,v,X,y,g,d=Math.sin(i),Y=Math.sin(o),z=Math.sin(s),Z=Math.cos(i),M=Math.cos(o),I=Math.cos(s);this._transform._rotation00=M*I,this._transform._rotation01=-M*z,this._transform._rotation02=Y,this._transform._rotation10=Z*z+I*d*Y,this._transform._rotation11=Z*I-d*Y*z,this._transform._rotation12=-M*d,this._transform._rotation20=d*z-Z*I*Y,this._transform._rotation21=I*d+Z*Y*z,this._transform._rotation22=Z*M,a=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,n=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,e=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,r=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,_=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,l=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,h=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,c=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,m=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=a,this._invInertia01=n,this._invInertia02=e,this._invInertia10=r,this._invInertia11=_,this._invInertia12=l,this._invInertia20=h,this._invInertia21=c,this._invInertia22=m,b=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,x=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,p=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,f=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,u=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,v=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,X=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,y=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,g=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=b,this._invInertia01=x,this._invInertia02=p,this._invInertia10=f,this._invInertia11=u,this._invInertia12=v,this._invInertia20=X,this._invInertia21=y,this._invInertia22=g,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let V=this._ptransform,L=this._transform;V._positionX=L._positionX,V._positionY=L._positionY,V._positionZ=L._positionZ,V._rotation00=L._rotation00,V._rotation01=L._rotation01,V._rotation02=L._rotation02,V._rotation10=L._rotation10,V._rotation11=L._rotation11,V._rotation12=L._rotation12,V._rotation20=L._rotation20,V._rotation21=L._rotation21,V._rotation22=L._rotation22;let w=this._shapeList;for(;null!=w;){let t,i,o,s,a,n,e,r,_,l,h,c,m=w._next,b=this._ptransform,x=this._transform,p=w._ptransform,f=w._localTransform;t=b._rotation00*f._rotation00+b._rotation01*f._rotation10+b._rotation02*f._rotation20,i=b._rotation00*f._rotation01+b._rotation01*f._rotation11+b._rotation02*f._rotation21,o=b._rotation00*f._rotation02+b._rotation01*f._rotation12+b._rotation02*f._rotation22,s=b._rotation10*f._rotation00+b._rotation11*f._rotation10+b._rotation12*f._rotation20,a=b._rotation10*f._rotation01+b._rotation11*f._rotation11+b._rotation12*f._rotation21,n=b._rotation10*f._rotation02+b._rotation11*f._rotation12+b._rotation12*f._rotation22,e=b._rotation20*f._rotation00+b._rotation21*f._rotation10+b._rotation22*f._rotation20,r=b._rotation20*f._rotation01+b._rotation21*f._rotation11+b._rotation22*f._rotation21,_=b._rotation20*f._rotation02+b._rotation21*f._rotation12+b._rotation22*f._rotation22,p._rotation00=t,p._rotation01=i,p._rotation02=o,p._rotation10=s,p._rotation11=a,p._rotation12=n,p._rotation20=e,p._rotation21=r,p._rotation22=_,l=b._rotation00*f._positionX+b._rotation01*f._positionY+b._rotation02*f._positionZ,h=b._rotation10*f._positionX+b._rotation11*f._positionY+b._rotation12*f._positionZ,c=b._rotation20*f._positionX+b._rotation21*f._positionY+b._rotation22*f._positionZ,p._positionX=l,p._positionY=h,p._positionZ=c,p._positionX+=b._positionX,p._positionY+=b._positionY,p._positionZ+=b._positionZ;let u,v,X,y,g,d,Y,z,Z,M,I,V,L,k,B,A,P,S,T=w._transform,C=w._localTransform;if(u=x._rotation00*C._rotation00+x._rotation01*C._rotation10+x._rotation02*C._rotation20,v=x._rotation00*C._rotation01+x._rotation01*C._rotation11+x._rotation02*C._rotation21,X=x._rotation00*C._rotation02+x._rotation01*C._rotation12+x._rotation02*C._rotation22,y=x._rotation10*C._rotation00+x._rotation11*C._rotation10+x._rotation12*C._rotation20,g=x._rotation10*C._rotation01+x._rotation11*C._rotation11+x._rotation12*C._rotation21,d=x._rotation10*C._rotation02+x._rotation11*C._rotation12+x._rotation12*C._rotation22,Y=x._rotation20*C._rotation00+x._rotation21*C._rotation10+x._rotation22*C._rotation20,z=x._rotation20*C._rotation01+x._rotation21*C._rotation11+x._rotation22*C._rotation21,Z=x._rotation20*C._rotation02+x._rotation21*C._rotation12+x._rotation22*C._rotation22,T._rotation00=u,T._rotation01=v,T._rotation02=X,T._rotation10=y,T._rotation11=g,T._rotation12=d,T._rotation20=Y,T._rotation21=z,T._rotation22=Z,M=x._rotation00*C._positionX+x._rotation01*C._positionY+x._rotation02*C._positionZ,I=x._rotation10*C._positionX+x._rotation11*C._positionY+x._rotation12*C._positionZ,V=x._rotation20*C._positionX+x._rotation21*C._positionY+x._rotation22*C._positionZ,T._positionX=M,T._positionY=I,T._positionZ=V,T._positionX+=x._positionX,T._positionY+=x._positionY,T._positionZ+=x._positionZ,w._geom._computeAabb(w._aabb,w._ptransform),L=w._aabb._minX,k=w._aabb._minY,B=w._aabb._minZ,A=w._aabb._maxX,P=w._aabb._maxY,S=w._aabb._maxZ,w._geom._computeAabb(w._aabb,w._transform),w._aabb._minX=L<w._aabb._minX?L:w._aabb._minX,w._aabb._minY=k<w._aabb._minY?k:w._aabb._minY,w._aabb._minZ=B<w._aabb._minZ?B:w._aabb._minZ,w._aabb._maxX=A>w._aabb._maxX?A:w._aabb._maxX,w._aabb._maxY=P>w._aabb._maxY?P:w._aabb._maxY,w._aabb._maxZ=S>w._aabb._maxZ?S:w._aabb._maxZ,null!=w._proxy){let t,i,o;t=w._transform._positionX-w._ptransform._positionX,i=w._transform._positionY-w._ptransform._positionY,o=w._transform._positionZ-w._ptransform._positionZ;let s=w.displacement;s.x=t,s.y=i,s.z=o,w._rigidBody._world._broadPhase.moveProxy(w._proxy,w._aabb,w.displacement)}w=m}this._sleeping=!1,this._sleepTime=0}rotate(t){let i,o,s,a,n,e,r,_,l,h,c,m,b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A,P,S,T;i=t.e00,o=t.e01,s=t.e02,a=t.e10,n=t.e11,e=t.e12,r=t.e20,_=t.e21,l=t.e22,h=i*this._transform._rotation00+o*this._transform._rotation10+s*this._transform._rotation20,c=i*this._transform._rotation01+o*this._transform._rotation11+s*this._transform._rotation21,m=i*this._transform._rotation02+o*this._transform._rotation12+s*this._transform._rotation22,b=a*this._transform._rotation00+n*this._transform._rotation10+e*this._transform._rotation20,x=a*this._transform._rotation01+n*this._transform._rotation11+e*this._transform._rotation21,p=a*this._transform._rotation02+n*this._transform._rotation12+e*this._transform._rotation22,f=r*this._transform._rotation00+_*this._transform._rotation10+l*this._transform._rotation20,u=r*this._transform._rotation01+_*this._transform._rotation11+l*this._transform._rotation21,v=r*this._transform._rotation02+_*this._transform._rotation12+l*this._transform._rotation22,this._transform._rotation00=h,this._transform._rotation01=c,this._transform._rotation02=m,this._transform._rotation10=b,this._transform._rotation11=x,this._transform._rotation12=p,this._transform._rotation20=f,this._transform._rotation21=u,this._transform._rotation22=v,X=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,y=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,g=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,d=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,Y=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,z=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,Z=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,M=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,I=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=X,this._invInertia01=y,this._invInertia02=g,this._invInertia10=d,this._invInertia11=Y,this._invInertia12=z,this._invInertia20=Z,this._invInertia21=M,this._invInertia22=I,V=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,L=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,w=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,k=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,B=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,A=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,P=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,S=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,T=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=V,this._invInertia01=L,this._invInertia02=w,this._invInertia10=k,this._invInertia11=B,this._invInertia12=A,this._invInertia20=P,this._invInertia21=S,this._invInertia22=T,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let C=this._ptransform,j=this._transform;C._positionX=j._positionX,C._positionY=j._positionY,C._positionZ=j._positionZ,C._rotation00=j._rotation00,C._rotation01=j._rotation01,C._rotation02=j._rotation02,C._rotation10=j._rotation10,C._rotation11=j._rotation11,C._rotation12=j._rotation12,C._rotation20=j._rotation20,C._rotation21=j._rotation21,C._rotation22=j._rotation22;let R=this._shapeList;for(;null!=R;){let t,i,o,s,a,n,e,r,_,l,h,c,m=R._next,b=this._ptransform,x=this._transform,p=R._ptransform,f=R._localTransform;t=b._rotation00*f._rotation00+b._rotation01*f._rotation10+b._rotation02*f._rotation20,i=b._rotation00*f._rotation01+b._rotation01*f._rotation11+b._rotation02*f._rotation21,o=b._rotation00*f._rotation02+b._rotation01*f._rotation12+b._rotation02*f._rotation22,s=b._rotation10*f._rotation00+b._rotation11*f._rotation10+b._rotation12*f._rotation20,a=b._rotation10*f._rotation01+b._rotation11*f._rotation11+b._rotation12*f._rotation21,n=b._rotation10*f._rotation02+b._rotation11*f._rotation12+b._rotation12*f._rotation22,e=b._rotation20*f._rotation00+b._rotation21*f._rotation10+b._rotation22*f._rotation20,r=b._rotation20*f._rotation01+b._rotation21*f._rotation11+b._rotation22*f._rotation21,_=b._rotation20*f._rotation02+b._rotation21*f._rotation12+b._rotation22*f._rotation22,p._rotation00=t,p._rotation01=i,p._rotation02=o,p._rotation10=s,p._rotation11=a,p._rotation12=n,p._rotation20=e,p._rotation21=r,p._rotation22=_,l=b._rotation00*f._positionX+b._rotation01*f._positionY+b._rotation02*f._positionZ,h=b._rotation10*f._positionX+b._rotation11*f._positionY+b._rotation12*f._positionZ,c=b._rotation20*f._positionX+b._rotation21*f._positionY+b._rotation22*f._positionZ,p._positionX=l,p._positionY=h,p._positionZ=c,p._positionX+=b._positionX,p._positionY+=b._positionY,p._positionZ+=b._positionZ;let u,v,X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A,P,S=R._transform,T=R._localTransform;if(u=x._rotation00*T._rotation00+x._rotation01*T._rotation10+x._rotation02*T._rotation20,v=x._rotation00*T._rotation01+x._rotation01*T._rotation11+x._rotation02*T._rotation21,X=x._rotation00*T._rotation02+x._rotation01*T._rotation12+x._rotation02*T._rotation22,y=x._rotation10*T._rotation00+x._rotation11*T._rotation10+x._rotation12*T._rotation20,g=x._rotation10*T._rotation01+x._rotation11*T._rotation11+x._rotation12*T._rotation21,d=x._rotation10*T._rotation02+x._rotation11*T._rotation12+x._rotation12*T._rotation22,Y=x._rotation20*T._rotation00+x._rotation21*T._rotation10+x._rotation22*T._rotation20,z=x._rotation20*T._rotation01+x._rotation21*T._rotation11+x._rotation22*T._rotation21,Z=x._rotation20*T._rotation02+x._rotation21*T._rotation12+x._rotation22*T._rotation22,S._rotation00=u,S._rotation01=v,S._rotation02=X,S._rotation10=y,S._rotation11=g,S._rotation12=d,S._rotation20=Y,S._rotation21=z,S._rotation22=Z,M=x._rotation00*T._positionX+x._rotation01*T._positionY+x._rotation02*T._positionZ,I=x._rotation10*T._positionX+x._rotation11*T._positionY+x._rotation12*T._positionZ,V=x._rotation20*T._positionX+x._rotation21*T._positionY+x._rotation22*T._positionZ,S._positionX=M,S._positionY=I,S._positionZ=V,S._positionX+=x._positionX,S._positionY+=x._positionY,S._positionZ+=x._positionZ,R._geom._computeAabb(R._aabb,R._ptransform),L=R._aabb._minX,w=R._aabb._minY,k=R._aabb._minZ,B=R._aabb._maxX,A=R._aabb._maxY,P=R._aabb._maxZ,R._geom._computeAabb(R._aabb,R._transform),R._aabb._minX=L<R._aabb._minX?L:R._aabb._minX,R._aabb._minY=w<R._aabb._minY?w:R._aabb._minY,R._aabb._minZ=k<R._aabb._minZ?k:R._aabb._minZ,R._aabb._maxX=B>R._aabb._maxX?B:R._aabb._maxX,R._aabb._maxY=A>R._aabb._maxY?A:R._aabb._maxY,R._aabb._maxZ=P>R._aabb._maxZ?P:R._aabb._maxZ,null!=R._proxy){let t,i,o;t=R._transform._positionX-R._ptransform._positionX,i=R._transform._positionY-R._ptransform._positionY,o=R._transform._positionZ-R._ptransform._positionZ;let s=R.displacement;s.x=t,s.y=i,s.z=o,R._rigidBody._world._broadPhase.moveProxy(R._proxy,R._aabb,R.displacement)}R=m}this._sleeping=!1,this._sleepTime=0}rotateXyz(t){let i,o,s,a,n,e,r,_,l,h,c,m;i=t.x,o=t.y,s=t.z;let b,x,p,f,u,v,X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A,P,S,T,C,j,R,q=Math.sin(i),E=Math.sin(o),D=Math.sin(s),F=Math.cos(i),N=Math.cos(o),W=Math.cos(s);a=N*W,n=-N*D,e=E,r=F*D+W*q*E,_=F*W-q*E*D,l=-N*q,h=q*D-F*W*E,c=W*q+F*E*D,m=F*N,b=a*this._transform._rotation00+n*this._transform._rotation10+e*this._transform._rotation20,x=a*this._transform._rotation01+n*this._transform._rotation11+e*this._transform._rotation21,p=a*this._transform._rotation02+n*this._transform._rotation12+e*this._transform._rotation22,f=r*this._transform._rotation00+_*this._transform._rotation10+l*this._transform._rotation20,u=r*this._transform._rotation01+_*this._transform._rotation11+l*this._transform._rotation21,v=r*this._transform._rotation02+_*this._transform._rotation12+l*this._transform._rotation22,X=h*this._transform._rotation00+c*this._transform._rotation10+m*this._transform._rotation20,y=h*this._transform._rotation01+c*this._transform._rotation11+m*this._transform._rotation21,g=h*this._transform._rotation02+c*this._transform._rotation12+m*this._transform._rotation22,this._transform._rotation00=b,this._transform._rotation01=x,this._transform._rotation02=p,this._transform._rotation10=f,this._transform._rotation11=u,this._transform._rotation12=v,this._transform._rotation20=X,this._transform._rotation21=y,this._transform._rotation22=g,d=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,Y=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,z=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,Z=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,M=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,I=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,V=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,L=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,w=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=d,this._invInertia01=Y,this._invInertia02=z,this._invInertia10=Z,this._invInertia11=M,this._invInertia12=I,this._invInertia20=V,this._invInertia21=L,this._invInertia22=w,k=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,B=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,A=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,P=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,S=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,T=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,C=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,j=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,R=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=k,this._invInertia01=B,this._invInertia02=A,this._invInertia10=P,this._invInertia11=S,this._invInertia12=T,this._invInertia20=C,this._invInertia21=j,this._invInertia22=R,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let G=this._ptransform,J=this._transform;G._positionX=J._positionX,G._positionY=J._positionY,G._positionZ=J._positionZ,G._rotation00=J._rotation00,G._rotation01=J._rotation01,G._rotation02=J._rotation02,G._rotation10=J._rotation10,G._rotation11=J._rotation11,G._rotation12=J._rotation12,G._rotation20=J._rotation20,G._rotation21=J._rotation21,G._rotation22=J._rotation22;let O=this._shapeList;for(;null!=O;){let t,i,o,s,a,n,e,r,_,l,h,c,m=O._next,b=this._ptransform,x=this._transform,p=O._ptransform,f=O._localTransform;t=b._rotation00*f._rotation00+b._rotation01*f._rotation10+b._rotation02*f._rotation20,i=b._rotation00*f._rotation01+b._rotation01*f._rotation11+b._rotation02*f._rotation21,o=b._rotation00*f._rotation02+b._rotation01*f._rotation12+b._rotation02*f._rotation22,s=b._rotation10*f._rotation00+b._rotation11*f._rotation10+b._rotation12*f._rotation20,a=b._rotation10*f._rotation01+b._rotation11*f._rotation11+b._rotation12*f._rotation21,n=b._rotation10*f._rotation02+b._rotation11*f._rotation12+b._rotation12*f._rotation22,e=b._rotation20*f._rotation00+b._rotation21*f._rotation10+b._rotation22*f._rotation20,r=b._rotation20*f._rotation01+b._rotation21*f._rotation11+b._rotation22*f._rotation21,_=b._rotation20*f._rotation02+b._rotation21*f._rotation12+b._rotation22*f._rotation22,p._rotation00=t,p._rotation01=i,p._rotation02=o,p._rotation10=s,p._rotation11=a,p._rotation12=n,p._rotation20=e,p._rotation21=r,p._rotation22=_,l=b._rotation00*f._positionX+b._rotation01*f._positionY+b._rotation02*f._positionZ,h=b._rotation10*f._positionX+b._rotation11*f._positionY+b._rotation12*f._positionZ,c=b._rotation20*f._positionX+b._rotation21*f._positionY+b._rotation22*f._positionZ,p._positionX=l,p._positionY=h,p._positionZ=c,p._positionX+=b._positionX,p._positionY+=b._positionY,p._positionZ+=b._positionZ;let u,v,X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A,P,S=O._transform,T=O._localTransform;if(u=x._rotation00*T._rotation00+x._rotation01*T._rotation10+x._rotation02*T._rotation20,v=x._rotation00*T._rotation01+x._rotation01*T._rotation11+x._rotation02*T._rotation21,X=x._rotation00*T._rotation02+x._rotation01*T._rotation12+x._rotation02*T._rotation22,y=x._rotation10*T._rotation00+x._rotation11*T._rotation10+x._rotation12*T._rotation20,g=x._rotation10*T._rotation01+x._rotation11*T._rotation11+x._rotation12*T._rotation21,d=x._rotation10*T._rotation02+x._rotation11*T._rotation12+x._rotation12*T._rotation22,Y=x._rotation20*T._rotation00+x._rotation21*T._rotation10+x._rotation22*T._rotation20,z=x._rotation20*T._rotation01+x._rotation21*T._rotation11+x._rotation22*T._rotation21,Z=x._rotation20*T._rotation02+x._rotation21*T._rotation12+x._rotation22*T._rotation22,S._rotation00=u,S._rotation01=v,S._rotation02=X,S._rotation10=y,S._rotation11=g,S._rotation12=d,S._rotation20=Y,S._rotation21=z,S._rotation22=Z,M=x._rotation00*T._positionX+x._rotation01*T._positionY+x._rotation02*T._positionZ,I=x._rotation10*T._positionX+x._rotation11*T._positionY+x._rotation12*T._positionZ,V=x._rotation20*T._positionX+x._rotation21*T._positionY+x._rotation22*T._positionZ,S._positionX=M,S._positionY=I,S._positionZ=V,S._positionX+=x._positionX,S._positionY+=x._positionY,S._positionZ+=x._positionZ,O._geom._computeAabb(O._aabb,O._ptransform),L=O._aabb._minX,w=O._aabb._minY,k=O._aabb._minZ,B=O._aabb._maxX,A=O._aabb._maxY,P=O._aabb._maxZ,O._geom._computeAabb(O._aabb,O._transform),O._aabb._minX=L<O._aabb._minX?L:O._aabb._minX,O._aabb._minY=w<O._aabb._minY?w:O._aabb._minY,O._aabb._minZ=k<O._aabb._minZ?k:O._aabb._minZ,O._aabb._maxX=B>O._aabb._maxX?B:O._aabb._maxX,O._aabb._maxY=A>O._aabb._maxY?A:O._aabb._maxY,O._aabb._maxZ=P>O._aabb._maxZ?P:O._aabb._maxZ,null!=O._proxy){let t,i,o;t=O._transform._positionX-O._ptransform._positionX,i=O._transform._positionY-O._ptransform._positionY,o=O._transform._positionZ-O._ptransform._positionZ;let s=O.displacement;s.x=t,s.y=i,s.z=o,O._rigidBody._world._broadPhase.moveProxy(O._proxy,O._aabb,O.displacement)}O=m}this._sleeping=!1,this._sleepTime=0}getOrientation(){let t,i,o,s,a,n=new oimo.common.Quat,e=this._transform._rotation00,r=this._transform._rotation11,_=this._transform._rotation22,l=e+r+_;return l>0?(a=Math.sqrt(l+1),s=.5*a,a=.5/a,t=(this._transform._rotation21-this._transform._rotation12)*a,i=(this._transform._rotation02-this._transform._rotation20)*a,o=(this._transform._rotation10-this._transform._rotation01)*a):e>r?e>_?(a=Math.sqrt(e-r-_+1),t=.5*a,a=.5/a,i=(this._transform._rotation01+this._transform._rotation10)*a,o=(this._transform._rotation02+this._transform._rotation20)*a,s=(this._transform._rotation21-this._transform._rotation12)*a):(a=Math.sqrt(_-e-r+1),o=.5*a,a=.5/a,t=(this._transform._rotation02+this._transform._rotation20)*a,i=(this._transform._rotation12+this._transform._rotation21)*a,s=(this._transform._rotation10-this._transform._rotation01)*a):r>_?(a=Math.sqrt(r-_-e+1),i=.5*a,a=.5/a,t=(this._transform._rotation01+this._transform._rotation10)*a,o=(this._transform._rotation12+this._transform._rotation21)*a,s=(this._transform._rotation02-this._transform._rotation20)*a):(a=Math.sqrt(_-e-r+1),o=.5*a,a=.5/a,t=(this._transform._rotation02+this._transform._rotation20)*a,i=(this._transform._rotation12+this._transform._rotation21)*a,s=(this._transform._rotation10-this._transform._rotation01)*a),n.x=t,n.y=i,n.z=o,n.w=s,n}getOrientationTo(t){let i,o,s,a,n,e=this._transform._rotation00,r=this._transform._rotation11,_=this._transform._rotation22,l=e+r+_;l>0?(n=Math.sqrt(l+1),a=.5*n,n=.5/n,i=(this._transform._rotation21-this._transform._rotation12)*n,o=(this._transform._rotation02-this._transform._rotation20)*n,s=(this._transform._rotation10-this._transform._rotation01)*n):e>r?e>_?(n=Math.sqrt(e-r-_+1),i=.5*n,n=.5/n,o=(this._transform._rotation01+this._transform._rotation10)*n,s=(this._transform._rotation02+this._transform._rotation20)*n,a=(this._transform._rotation21-this._transform._rotation12)*n):(n=Math.sqrt(_-e-r+1),s=.5*n,n=.5/n,i=(this._transform._rotation02+this._transform._rotation20)*n,o=(this._transform._rotation12+this._transform._rotation21)*n,a=(this._transform._rotation10-this._transform._rotation01)*n):r>_?(n=Math.sqrt(r-_-e+1),o=.5*n,n=.5/n,i=(this._transform._rotation01+this._transform._rotation10)*n,s=(this._transform._rotation12+this._transform._rotation21)*n,a=(this._transform._rotation02-this._transform._rotation20)*n):(n=Math.sqrt(_-e-r+1),s=.5*n,n=.5/n,i=(this._transform._rotation02+this._transform._rotation20)*n,o=(this._transform._rotation12+this._transform._rotation21)*n,a=(this._transform._rotation10-this._transform._rotation01)*n),t.x=i,t.y=o,t.z=s,t.w=a}setOrientation(t){let i,o,s,a;i=t.x,o=t.y,s=t.z,a=t.w;let n,e,r,_,l,h,c,m,b,x,p,f,u,v,X,y,g,d,Y=2*i,z=2*o,Z=2*s,M=i*Y,I=o*z,V=s*Z,L=i*z,w=o*Z,k=i*Z,B=a*Y,A=a*z,P=a*Z;this._transform._rotation00=1-I-V,this._transform._rotation01=L-P,this._transform._rotation02=k+A,this._transform._rotation10=L+P,this._transform._rotation11=1-M-V,this._transform._rotation12=w-B,this._transform._rotation20=k-A,this._transform._rotation21=w+B,this._transform._rotation22=1-M-I,n=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,e=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,r=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,_=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,l=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,h=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,c=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,m=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,b=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=n,this._invInertia01=e,this._invInertia02=r,this._invInertia10=_,this._invInertia11=l,this._invInertia12=h,this._invInertia20=c,this._invInertia21=m,this._invInertia22=b,x=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,p=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,f=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,u=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,v=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,X=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,y=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,g=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,d=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=x,this._invInertia01=p,this._invInertia02=f,this._invInertia10=u,this._invInertia11=v,this._invInertia12=X,this._invInertia20=y,this._invInertia21=g,this._invInertia22=d,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let S=this._ptransform,T=this._transform;S._positionX=T._positionX,S._positionY=T._positionY,S._positionZ=T._positionZ,S._rotation00=T._rotation00,S._rotation01=T._rotation01,S._rotation02=T._rotation02,S._rotation10=T._rotation10,S._rotation11=T._rotation11,S._rotation12=T._rotation12,S._rotation20=T._rotation20,S._rotation21=T._rotation21,S._rotation22=T._rotation22;let C=this._shapeList;for(;null!=C;){let t,i,o,s,a,n,e,r,_,l,h,c,m=C._next,b=this._ptransform,x=this._transform,p=C._ptransform,f=C._localTransform;t=b._rotation00*f._rotation00+b._rotation01*f._rotation10+b._rotation02*f._rotation20,i=b._rotation00*f._rotation01+b._rotation01*f._rotation11+b._rotation02*f._rotation21,o=b._rotation00*f._rotation02+b._rotation01*f._rotation12+b._rotation02*f._rotation22,s=b._rotation10*f._rotation00+b._rotation11*f._rotation10+b._rotation12*f._rotation20,a=b._rotation10*f._rotation01+b._rotation11*f._rotation11+b._rotation12*f._rotation21,n=b._rotation10*f._rotation02+b._rotation11*f._rotation12+b._rotation12*f._rotation22,e=b._rotation20*f._rotation00+b._rotation21*f._rotation10+b._rotation22*f._rotation20,r=b._rotation20*f._rotation01+b._rotation21*f._rotation11+b._rotation22*f._rotation21,_=b._rotation20*f._rotation02+b._rotation21*f._rotation12+b._rotation22*f._rotation22,p._rotation00=t,p._rotation01=i,p._rotation02=o,p._rotation10=s,p._rotation11=a,p._rotation12=n,p._rotation20=e,p._rotation21=r,p._rotation22=_,l=b._rotation00*f._positionX+b._rotation01*f._positionY+b._rotation02*f._positionZ,h=b._rotation10*f._positionX+b._rotation11*f._positionY+b._rotation12*f._positionZ,c=b._rotation20*f._positionX+b._rotation21*f._positionY+b._rotation22*f._positionZ,p._positionX=l,p._positionY=h,p._positionZ=c,p._positionX+=b._positionX,p._positionY+=b._positionY,p._positionZ+=b._positionZ;let u,v,X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A,P,S=C._transform,T=C._localTransform;if(u=x._rotation00*T._rotation00+x._rotation01*T._rotation10+x._rotation02*T._rotation20,v=x._rotation00*T._rotation01+x._rotation01*T._rotation11+x._rotation02*T._rotation21,X=x._rotation00*T._rotation02+x._rotation01*T._rotation12+x._rotation02*T._rotation22,y=x._rotation10*T._rotation00+x._rotation11*T._rotation10+x._rotation12*T._rotation20,g=x._rotation10*T._rotation01+x._rotation11*T._rotation11+x._rotation12*T._rotation21,d=x._rotation10*T._rotation02+x._rotation11*T._rotation12+x._rotation12*T._rotation22,Y=x._rotation20*T._rotation00+x._rotation21*T._rotation10+x._rotation22*T._rotation20,z=x._rotation20*T._rotation01+x._rotation21*T._rotation11+x._rotation22*T._rotation21,Z=x._rotation20*T._rotation02+x._rotation21*T._rotation12+x._rotation22*T._rotation22,S._rotation00=u,S._rotation01=v,S._rotation02=X,S._rotation10=y,S._rotation11=g,S._rotation12=d,S._rotation20=Y,S._rotation21=z,S._rotation22=Z,M=x._rotation00*T._positionX+x._rotation01*T._positionY+x._rotation02*T._positionZ,I=x._rotation10*T._positionX+x._rotation11*T._positionY+x._rotation12*T._positionZ,V=x._rotation20*T._positionX+x._rotation21*T._positionY+x._rotation22*T._positionZ,S._positionX=M,S._positionY=I,S._positionZ=V,S._positionX+=x._positionX,S._positionY+=x._positionY,S._positionZ+=x._positionZ,C._geom._computeAabb(C._aabb,C._ptransform),L=C._aabb._minX,w=C._aabb._minY,k=C._aabb._minZ,B=C._aabb._maxX,A=C._aabb._maxY,P=C._aabb._maxZ,C._geom._computeAabb(C._aabb,C._transform),C._aabb._minX=L<C._aabb._minX?L:C._aabb._minX,C._aabb._minY=w<C._aabb._minY?w:C._aabb._minY,C._aabb._minZ=k<C._aabb._minZ?k:C._aabb._minZ,C._aabb._maxX=B>C._aabb._maxX?B:C._aabb._maxX,C._aabb._maxY=A>C._aabb._maxY?A:C._aabb._maxY,C._aabb._maxZ=P>C._aabb._maxZ?P:C._aabb._maxZ,null!=C._proxy){let t,i,o;t=C._transform._positionX-C._ptransform._positionX,i=C._transform._positionY-C._ptransform._positionY,o=C._transform._positionZ-C._ptransform._positionZ;let s=C.displacement;s.x=t,s.y=i,s.z=o,C._rigidBody._world._broadPhase.moveProxy(C._proxy,C._aabb,C.displacement)}C=m}this._sleeping=!1,this._sleepTime=0}getTransform(){let t=this._transform,i=new oimo.common.Transform;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i}getTransformTo(t){let i=this._transform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22}setTransform(t){let i,o,s,a,n,e,r,_,l,h,c,m,b,x,p,f,u,v;this._transform._positionX=t._positionX,this._transform._positionY=t._positionY,this._transform._positionZ=t._positionZ,this._transform._rotation00=t._rotation00,this._transform._rotation01=t._rotation01,this._transform._rotation02=t._rotation02,this._transform._rotation10=t._rotation10,this._transform._rotation11=t._rotation11,this._transform._rotation12=t._rotation12,this._transform._rotation20=t._rotation20,this._transform._rotation21=t._rotation21,this._transform._rotation22=t._rotation22,i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,o=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,s=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,a=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,n=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,e=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,r=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,l=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=o,this._invInertia02=s,this._invInertia10=a,this._invInertia11=n,this._invInertia12=e,this._invInertia20=r,this._invInertia21=_,this._invInertia22=l,h=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,b=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,x=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,p=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,f=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,u=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,v=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=h,this._invInertia01=c,this._invInertia02=m,this._invInertia10=b,this._invInertia11=x,this._invInertia12=p,this._invInertia20=f,this._invInertia21=u,this._invInertia22=v,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let X=this._ptransform,y=this._transform;X._positionX=y._positionX,X._positionY=y._positionY,X._positionZ=y._positionZ,X._rotation00=y._rotation00,X._rotation01=y._rotation01,X._rotation02=y._rotation02,X._rotation10=y._rotation10,X._rotation11=y._rotation11,X._rotation12=y._rotation12,X._rotation20=y._rotation20,X._rotation21=y._rotation21,X._rotation22=y._rotation22;let g=this._shapeList;for(;null!=g;){let t,i,o,s,a,n,e,r,_,l,h,c,m=g._next,b=this._ptransform,x=this._transform,p=g._ptransform,f=g._localTransform;t=b._rotation00*f._rotation00+b._rotation01*f._rotation10+b._rotation02*f._rotation20,i=b._rotation00*f._rotation01+b._rotation01*f._rotation11+b._rotation02*f._rotation21,o=b._rotation00*f._rotation02+b._rotation01*f._rotation12+b._rotation02*f._rotation22,s=b._rotation10*f._rotation00+b._rotation11*f._rotation10+b._rotation12*f._rotation20,a=b._rotation10*f._rotation01+b._rotation11*f._rotation11+b._rotation12*f._rotation21,n=b._rotation10*f._rotation02+b._rotation11*f._rotation12+b._rotation12*f._rotation22,e=b._rotation20*f._rotation00+b._rotation21*f._rotation10+b._rotation22*f._rotation20,r=b._rotation20*f._rotation01+b._rotation21*f._rotation11+b._rotation22*f._rotation21,_=b._rotation20*f._rotation02+b._rotation21*f._rotation12+b._rotation22*f._rotation22,p._rotation00=t,p._rotation01=i,p._rotation02=o,p._rotation10=s,p._rotation11=a,p._rotation12=n,p._rotation20=e,p._rotation21=r,p._rotation22=_,l=b._rotation00*f._positionX+b._rotation01*f._positionY+b._rotation02*f._positionZ,h=b._rotation10*f._positionX+b._rotation11*f._positionY+b._rotation12*f._positionZ,c=b._rotation20*f._positionX+b._rotation21*f._positionY+b._rotation22*f._positionZ,p._positionX=l,p._positionY=h,p._positionZ=c,p._positionX+=b._positionX,p._positionY+=b._positionY,p._positionZ+=b._positionZ;let u,v,X,y,d,Y,z,Z,M,I,V,L,w,k,B,A,P,S,T=g._transform,C=g._localTransform;if(u=x._rotation00*C._rotation00+x._rotation01*C._rotation10+x._rotation02*C._rotation20,v=x._rotation00*C._rotation01+x._rotation01*C._rotation11+x._rotation02*C._rotation21,X=x._rotation00*C._rotation02+x._rotation01*C._rotation12+x._rotation02*C._rotation22,y=x._rotation10*C._rotation00+x._rotation11*C._rotation10+x._rotation12*C._rotation20,d=x._rotation10*C._rotation01+x._rotation11*C._rotation11+x._rotation12*C._rotation21,Y=x._rotation10*C._rotation02+x._rotation11*C._rotation12+x._rotation12*C._rotation22,z=x._rotation20*C._rotation00+x._rotation21*C._rotation10+x._rotation22*C._rotation20,Z=x._rotation20*C._rotation01+x._rotation21*C._rotation11+x._rotation22*C._rotation21,M=x._rotation20*C._rotation02+x._rotation21*C._rotation12+x._rotation22*C._rotation22,T._rotation00=u,T._rotation01=v,T._rotation02=X,T._rotation10=y,T._rotation11=d,T._rotation12=Y,T._rotation20=z,T._rotation21=Z,T._rotation22=M,I=x._rotation00*C._positionX+x._rotation01*C._positionY+x._rotation02*C._positionZ,V=x._rotation10*C._positionX+x._rotation11*C._positionY+x._rotation12*C._positionZ,L=x._rotation20*C._positionX+x._rotation21*C._positionY+x._rotation22*C._positionZ,T._positionX=I,T._positionY=V,T._positionZ=L,T._positionX+=x._positionX,T._positionY+=x._positionY,T._positionZ+=x._positionZ,g._geom._computeAabb(g._aabb,g._ptransform),w=g._aabb._minX,k=g._aabb._minY,B=g._aabb._minZ,A=g._aabb._maxX,P=g._aabb._maxY,S=g._aabb._maxZ,g._geom._computeAabb(g._aabb,g._transform),g._aabb._minX=w<g._aabb._minX?w:g._aabb._minX,g._aabb._minY=k<g._aabb._minY?k:g._aabb._minY,g._aabb._minZ=B<g._aabb._minZ?B:g._aabb._minZ,g._aabb._maxX=A>g._aabb._maxX?A:g._aabb._maxX,g._aabb._maxY=P>g._aabb._maxY?P:g._aabb._maxY,g._aabb._maxZ=S>g._aabb._maxZ?S:g._aabb._maxZ,null!=g._proxy){let t,i,o;t=g._transform._positionX-g._ptransform._positionX,i=g._transform._positionY-g._ptransform._positionY,o=g._transform._positionZ-g._ptransform._positionZ;let s=g.displacement;s.x=t,s.y=i,s.z=o,g._rigidBody._world._broadPhase.moveProxy(g._proxy,g._aabb,g.displacement)}g=m}this._sleeping=!1,this._sleepTime=0}getMass(){return this._mass}getLocalInertia(){let t=new oimo.common.Mat3;return t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22,t}getLocalInertiaTo(t){t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22}getMassData(){let t=new oimo.dynamics.rigidbody.MassData;t.mass=this._mass;let i=t.localInertia;return i.e00=this._localInertia00,i.e01=this._localInertia01,i.e02=this._localInertia02,i.e10=this._localInertia10,i.e11=this._localInertia11,i.e12=this._localInertia12,i.e20=this._localInertia20,i.e21=this._localInertia21,i.e22=this._localInertia22,t}getMassDataTo(t){t.mass=this._mass;let i=t.localInertia;i.e00=this._localInertia00,i.e01=this._localInertia01,i.e02=this._localInertia02,i.e10=this._localInertia10,i.e11=this._localInertia11,i.e12=this._localInertia12,i.e20=this._localInertia20,i.e21=this._localInertia21,i.e22=this._localInertia22}setMassData(t){this._mass=t.mass;let i,o,s,a,n,e,r,_,l,h,c,m,b,x,p,f,u,v,X=t.localInertia;if(this._localInertia00=X.e00,this._localInertia01=X.e01,this._localInertia02=X.e02,this._localInertia10=X.e10,this._localInertia11=X.e11,this._localInertia12=X.e12,this._localInertia20=X.e20,this._localInertia21=X.e21,this._localInertia22=X.e22,this._mass>0&&this._localInertia00*(this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21)-this._localInertia01*(this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20)+this._localInertia02*(this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20)>0&&0==this._type){this._invMass=1/this._mass;let t=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,i=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,o=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,s=this._localInertia00*t-this._localInertia01*i+this._localInertia02*o;(s<-1e-32||s>1e-32)&&(s=1/s),this._invLocalInertia00=t*s,this._invLocalInertia01=-(this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21)*s,this._invLocalInertia02=(this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11)*s,this._invLocalInertia10=-i*s,this._invLocalInertia11=(this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20)*s,this._invLocalInertia12=-(this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10)*s,this._invLocalInertia20=o*s,this._invLocalInertia21=-(this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20)*s,this._invLocalInertia22=(this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10)*s,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,0==this._type&&(this._type=1);i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,o=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,s=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,a=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,n=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,e=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,r=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,l=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=o,this._invInertia02=s,this._invInertia10=a,this._invInertia11=n,this._invInertia12=e,this._invInertia20=r,this._invInertia21=_,this._invInertia22=l,h=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,b=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,x=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,p=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,f=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,u=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,v=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=h,this._invInertia01=c,this._invInertia02=m,this._invInertia10=b,this._invInertia11=x,this._invInertia12=p,this._invInertia20=f,this._invInertia21=u,this._invInertia22=v,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getRotationFactor(){let t=this._rotFactor;return new oimo.common.Vec3(t.x,t.y,t.z)}setRotationFactor(t){let i,o,s,a,n,e,r,_,l,h,c,m,b,x,p,f,u,v,X=this._rotFactor;X.x=t.x,X.y=t.y,X.z=t.z,i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,o=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,s=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,a=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,n=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,e=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,r=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,_=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,l=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=o,this._invInertia02=s,this._invInertia10=a,this._invInertia11=n,this._invInertia12=e,this._invInertia20=r,this._invInertia21=_,this._invInertia22=l,h=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,c=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,m=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,b=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,x=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,p=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,f=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,u=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,v=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=h,this._invInertia01=c,this._invInertia02=m,this._invInertia10=b,this._invInertia11=x,this._invInertia12=p,this._invInertia20=f,this._invInertia21=u,this._invInertia22=v,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getLinearVelocity(){let t=new oimo.common.Vec3;return t.x=this._velX,t.y=this._velY,t.z=this._velZ,t}getLinearVelocityTo(t){t.x=this._velX,t.y=this._velY,t.z=this._velZ}setLinearVelocity(t){1==this._type?(this._velX=0,this._velY=0,this._velZ=0):(this._velX=t.x,this._velY=t.y,this._velZ=t.z),this._sleeping=!1,this._sleepTime=0}getAngularVelocity(){let t=new oimo.common.Vec3;return t.x=this._angVelX,t.y=this._angVelY,t.z=this._angVelZ,t}getAngularVelocityTo(t){t.x=this._velX,t.y=this._velY,t.z=this._velZ}setAngularVelocity(t){1==this._type?(this._angVelX=0,this._angVelY=0,this._angVelZ=0):(this._angVelX=t.x,this._angVelY=t.y,this._angVelZ=t.z),this._sleeping=!1,this._sleepTime=0}addLinearVelocity(t){if(1!=this._type){let i,o,s;i=t.x,o=t.y,s=t.z,this._velX+=i,this._velY+=o,this._velZ+=s}this._sleeping=!1,this._sleepTime=0}addAngularVelocity(t){if(1!=this._type){let i,o,s;i=t.x,o=t.y,s=t.z,this._angVelX+=i,this._angVelY+=o,this._angVelZ+=s}this._sleeping=!1,this._sleepTime=0}applyImpulse(t,i){let o,s,a,n,e,r,_,l,h,c,m,b;o=t.x,s=t.y,a=t.z,this._velX+=o*this._invMass,this._velY+=s*this._invMass,this._velZ+=a*this._invMass,_=i.x,l=i.y,h=i.z,_-=this._transform._positionX,l-=this._transform._positionY,h-=this._transform._positionZ,n=l*a-h*s,e=h*o-_*a,r=_*s-l*o,c=this._invInertia00*n+this._invInertia01*e+this._invInertia02*r,m=this._invInertia10*n+this._invInertia11*e+this._invInertia12*r,b=this._invInertia20*n+this._invInertia21*e+this._invInertia22*r,n=c,e=m,r=b,this._angVelX+=n,this._angVelY+=e,this._angVelZ+=r,this._sleeping=!1,this._sleepTime=0}applyLinearImpulse(t){let i,o,s;i=t.x,o=t.y,s=t.z,this._velX+=i*this._invMass,this._velY+=o*this._invMass,this._velZ+=s*this._invMass,this._sleeping=!1,this._sleepTime=0}applyAngularImpulse(t){let i,o,s,a,n,e;i=t.x,o=t.y,s=t.z,a=this._invInertia00*i+this._invInertia01*o+this._invInertia02*s,n=this._invInertia10*i+this._invInertia11*o+this._invInertia12*s,e=this._invInertia20*i+this._invInertia21*o+this._invInertia22*s,i=a,o=n,s=e,this._angVelX+=i,this._angVelY+=o,this._angVelZ+=s,this._sleeping=!1,this._sleepTime=0}applyForce(t,i){let o,s,a,n,e,r,_,l,h;o=t.x,s=t.y,a=t.z,this._forceX+=o,this._forceY+=s,this._forceZ+=a,_=i.x,l=i.y,h=i.z,_-=this._transform._positionX,l-=this._transform._positionY,h-=this._transform._positionZ,n=l*a-h*s,e=h*o-_*a,r=_*s-l*o,this._torqueX+=n,this._torqueY+=e,this._torqueZ+=r,this._sleeping=!1,this._sleepTime=0}applyForceToCenter(t){let i,o,s;i=t.x,o=t.y,s=t.z,this._forceX+=i,this._forceY+=o,this._forceZ+=s,this._sleeping=!1,this._sleepTime=0}applyTorque(t){let i,o,s;i=t.x,o=t.y,s=t.z,this._torqueX+=i,this._torqueY+=o,this._torqueZ+=s,this._sleeping=!1,this._sleepTime=0}getLinearContactImpulse(){let t=new oimo.common.Vec3;return t.x=this._linearContactImpulseX,t.y=this._linearContactImpulseY,t.z=this._linearContactImpulseZ,t}getLinearContactImpulseTo(t){t.x=this._linearContactImpulseX,t.y=this._linearContactImpulseY,t.z=this._linearContactImpulseZ}getAngularContactImpulse(){let t=new oimo.common.Vec3;return t.x=this._angularContactImpulseX,t.y=this._angularContactImpulseY,t.z=this._angularContactImpulseZ,t}getAngularContactImpulseTo(t){t.x=this._angularContactImpulseX,t.y=this._angularContactImpulseY,t.z=this._angularContactImpulseZ}getGravityScale(){return this._gravityScale}setGravityScale(t){this._gravityScale=t,this._sleeping=!1,this._sleepTime=0}getLocalPoint(t){let i,o,s,a,n,e;i=t.x,o=t.y,s=t.z,i-=this._transform._positionX,o-=this._transform._positionY,s-=this._transform._positionZ,a=this._transform._rotation00*i+this._transform._rotation10*o+this._transform._rotation20*s,n=this._transform._rotation01*i+this._transform._rotation11*o+this._transform._rotation21*s,e=this._transform._rotation02*i+this._transform._rotation12*o+this._transform._rotation22*s,i=a,o=n,s=e;let r=new oimo.common.Vec3;return r.x=i,r.y=o,r.z=s,r}getLocalPointTo(t,i){let o,s,a,n,e,r;o=t.x,s=t.y,a=t.z,o-=this._transform._positionX,s-=this._transform._positionY,a-=this._transform._positionZ,n=this._transform._rotation00*o+this._transform._rotation10*s+this._transform._rotation20*a,e=this._transform._rotation01*o+this._transform._rotation11*s+this._transform._rotation21*a,r=this._transform._rotation02*o+this._transform._rotation12*s+this._transform._rotation22*a,o=n,s=e,a=r,i.x=o,i.y=s,i.z=a}getLocalVector(t){let i,o,s,a,n,e;i=t.x,o=t.y,s=t.z,a=this._transform._rotation00*i+this._transform._rotation10*o+this._transform._rotation20*s,n=this._transform._rotation01*i+this._transform._rotation11*o+this._transform._rotation21*s,e=this._transform._rotation02*i+this._transform._rotation12*o+this._transform._rotation22*s,i=a,o=n,s=e;let r=new oimo.common.Vec3;return r.x=i,r.y=o,r.z=s,r}getLocalVectorTo(t,i){let o,s,a,n,e,r;o=t.x,s=t.y,a=t.z,n=this._transform._rotation00*o+this._transform._rotation10*s+this._transform._rotation20*a,e=this._transform._rotation01*o+this._transform._rotation11*s+this._transform._rotation21*a,r=this._transform._rotation02*o+this._transform._rotation12*s+this._transform._rotation22*a,o=n,s=e,a=r,i.x=o,i.y=s,i.z=a}getWorldPoint(t){let i,o,s,a,n,e;i=t.x,o=t.y,s=t.z,a=this._transform._rotation00*i+this._transform._rotation01*o+this._transform._rotation02*s,n=this._transform._rotation10*i+this._transform._rotation11*o+this._transform._rotation12*s,e=this._transform._rotation20*i+this._transform._rotation21*o+this._transform._rotation22*s,i=a,o=n,s=e,i+=this._transform._positionX,o+=this._transform._positionY,s+=this._transform._positionZ;let r=new oimo.common.Vec3;return r.x=i,r.y=o,r.z=s,r}getWorldPointTo(t,i){let o,s,a,n,e,r;o=t.x,s=t.y,a=t.z,n=this._transform._rotation00*o+this._transform._rotation01*s+this._transform._rotation02*a,e=this._transform._rotation10*o+this._transform._rotation11*s+this._transform._rotation12*a,r=this._transform._rotation20*o+this._transform._rotation21*s+this._transform._rotation22*a,o=n,s=e,a=r,o+=this._transform._positionX,s+=this._transform._positionY,a+=this._transform._positionZ,i.x=o,i.y=s,i.z=a}getWorldVector(t){let i,o,s,a,n,e;i=t.x,o=t.y,s=t.z,a=this._transform._rotation00*i+this._transform._rotation01*o+this._transform._rotation02*s,n=this._transform._rotation10*i+this._transform._rotation11*o+this._transform._rotation12*s,e=this._transform._rotation20*i+this._transform._rotation21*o+this._transform._rotation22*s,i=a,o=n,s=e;let r=new oimo.common.Vec3;return r.x=i,r.y=o,r.z=s,r}getWorldVectorTo(t,i){let o,s,a,n,e,r;o=t.x,s=t.y,a=t.z,n=this._transform._rotation00*o+this._transform._rotation01*s+this._transform._rotation02*a,e=this._transform._rotation10*o+this._transform._rotation11*s+this._transform._rotation12*a,r=this._transform._rotation20*o+this._transform._rotation21*s+this._transform._rotation22*a,o=n,s=e,a=r,i.x=o,i.y=s,i.z=a}getNumShapes(){return this._numShapes}getShapeList(){return this._shapeList}getNumContectLinks(){return this._numContactLinks}getContactLinkList(){return this._contactLinkList}getNumJointLinks(){return this._numJointLinks}getJointLinkList(){return this._jointLinkList}addShape(t){if(null==this._shapeList?(this._shapeList=t,this._shapeListLast=t):(this._shapeListLast._next=t,t._prev=this._shapeListLast,this._shapeListLast=t),this._numShapes++,t._rigidBody=this,null!=this._world){let i=this._world;t._proxy=i._broadPhase.createProxy(t,t._aabb),t._id=i._shapeIdCount++,i._numShapes++}this.updateMass();let i=this._shapeList;for(;null!=i;){let t,o,s,a,n,e,r,_,l,h,c,m,b=i._next,x=this._ptransform,p=this._transform,f=i._ptransform,u=i._localTransform;t=x._rotation00*u._rotation00+x._rotation01*u._rotation10+x._rotation02*u._rotation20,o=x._rotation00*u._rotation01+x._rotation01*u._rotation11+x._rotation02*u._rotation21,s=x._rotation00*u._rotation02+x._rotation01*u._rotation12+x._rotation02*u._rotation22,a=x._rotation10*u._rotation00+x._rotation11*u._rotation10+x._rotation12*u._rotation20,n=x._rotation10*u._rotation01+x._rotation11*u._rotation11+x._rotation12*u._rotation21,e=x._rotation10*u._rotation02+x._rotation11*u._rotation12+x._rotation12*u._rotation22,r=x._rotation20*u._rotation00+x._rotation21*u._rotation10+x._rotation22*u._rotation20,_=x._rotation20*u._rotation01+x._rotation21*u._rotation11+x._rotation22*u._rotation21,l=x._rotation20*u._rotation02+x._rotation21*u._rotation12+x._rotation22*u._rotation22,f._rotation00=t,f._rotation01=o,f._rotation02=s,f._rotation10=a,f._rotation11=n,f._rotation12=e,f._rotation20=r,f._rotation21=_,f._rotation22=l,h=x._rotation00*u._positionX+x._rotation01*u._positionY+x._rotation02*u._positionZ,c=x._rotation10*u._positionX+x._rotation11*u._positionY+x._rotation12*u._positionZ,m=x._rotation20*u._positionX+x._rotation21*u._positionY+x._rotation22*u._positionZ,f._positionX=h,f._positionY=c,f._positionZ=m,f._positionX+=x._positionX,f._positionY+=x._positionY,f._positionZ+=x._positionZ;let v,X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A,P,S,T=i._transform,C=i._localTransform;if(v=p._rotation00*C._rotation00+p._rotation01*C._rotation10+p._rotation02*C._rotation20,X=p._rotation00*C._rotation01+p._rotation01*C._rotation11+p._rotation02*C._rotation21,y=p._rotation00*C._rotation02+p._rotation01*C._rotation12+p._rotation02*C._rotation22,g=p._rotation10*C._rotation00+p._rotation11*C._rotation10+p._rotation12*C._rotation20,d=p._rotation10*C._rotation01+p._rotation11*C._rotation11+p._rotation12*C._rotation21,Y=p._rotation10*C._rotation02+p._rotation11*C._rotation12+p._rotation12*C._rotation22,z=p._rotation20*C._rotation00+p._rotation21*C._rotation10+p._rotation22*C._rotation20,Z=p._rotation20*C._rotation01+p._rotation21*C._rotation11+p._rotation22*C._rotation21,M=p._rotation20*C._rotation02+p._rotation21*C._rotation12+p._rotation22*C._rotation22,T._rotation00=v,T._rotation01=X,T._rotation02=y,T._rotation10=g,T._rotation11=d,T._rotation12=Y,T._rotation20=z,T._rotation21=Z,T._rotation22=M,I=p._rotation00*C._positionX+p._rotation01*C._positionY+p._rotation02*C._positionZ,V=p._rotation10*C._positionX+p._rotation11*C._positionY+p._rotation12*C._positionZ,L=p._rotation20*C._positionX+p._rotation21*C._positionY+p._rotation22*C._positionZ,T._positionX=I,T._positionY=V,T._positionZ=L,T._positionX+=p._positionX,T._positionY+=p._positionY,T._positionZ+=p._positionZ,i._geom._computeAabb(i._aabb,i._ptransform),w=i._aabb._minX,k=i._aabb._minY,B=i._aabb._minZ,A=i._aabb._maxX,P=i._aabb._maxY,S=i._aabb._maxZ,i._geom._computeAabb(i._aabb,i._transform),i._aabb._minX=w<i._aabb._minX?w:i._aabb._minX,i._aabb._minY=k<i._aabb._minY?k:i._aabb._minY,i._aabb._minZ=B<i._aabb._minZ?B:i._aabb._minZ,i._aabb._maxX=A>i._aabb._maxX?A:i._aabb._maxX,i._aabb._maxY=P>i._aabb._maxY?P:i._aabb._maxY,i._aabb._maxZ=S>i._aabb._maxZ?S:i._aabb._maxZ,null!=i._proxy){let t,o,s;t=i._transform._positionX-i._ptransform._positionX,o=i._transform._positionY-i._ptransform._positionY,s=i._transform._positionZ-i._ptransform._positionZ;let a=i.displacement;a.x=t,a.y=o,a.z=s,i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=b}}removeShape(t){let i=t._prev,o=t._next;if(null!=i&&(i._next=o),null!=o&&(o._prev=i),t==this._shapeList&&(this._shapeList=this._shapeList._next),t==this._shapeListLast&&(this._shapeListLast=this._shapeListLast._prev),t._next=null,t._prev=null,this._numShapes--,t._rigidBody=null,null!=this._world){let i=this._world;i._broadPhase.destroyProxy(t._proxy),t._proxy=null,t._id=-1;let o=t._rigidBody._contactLinkList;for(;null!=o;){let s=o._next,a=o._contact;if(a._s1==t||a._s2==t){let t=o._other;t._sleeping=!1,t._sleepTime=0;let s=i._contactManager,n=a._prev,e=a._next;if(null!=n&&(n._next=e),null!=e&&(e._prev=n),a==s._contactList&&(s._contactList=s._contactList._next),a==s._contactListLast&&(s._contactListLast=s._contactListLast._prev),a._next=null,a._prev=null,a._touching){let t=a._s1._contactCallback,i=a._s2._contactCallback;t==i&&(i=null),null!=t&&t.endContact(a),null!=i&&i.endContact(a)}let r=a._link1._prev,_=a._link1._next;null!=r&&(r._next=_),null!=_&&(_._prev=r),a._link1==a._b1._contactLinkList&&(a._b1._contactLinkList=a._b1._contactLinkList._next),a._link1==a._b1._contactLinkListLast&&(a._b1._contactLinkListLast=a._b1._contactLinkListLast._prev),a._link1._next=null,a._link1._prev=null;let l=a._link2._prev,h=a._link2._next;null!=l&&(l._next=h),null!=h&&(h._prev=l),a._link2==a._b2._contactLinkList&&(a._b2._contactLinkList=a._b2._contactLinkList._next),a._link2==a._b2._contactLinkListLast&&(a._b2._contactLinkListLast=a._b2._contactLinkListLast._prev),a._link2._next=null,a._link2._prev=null,a._b1._numContactLinks--,a._b2._numContactLinks--,a._link1._other=null,a._link2._other=null,a._link1._contact=null,a._link2._contact=null,a._s1=null,a._s2=null,a._b1=null,a._b2=null,a._touching=!1,a._cachedDetectorData._clear(),a._manifold._clear(),a._detector=null;let c=a._contactConstraint;c._s1=null,c._s2=null,c._b1=null,c._b2=null,c._tf1=null,c._tf2=null,a._next=s._contactPool,s._contactPool=a,s._numContacts--}o=s}i._numShapes--}this.updateMass();let s=this._shapeList;for(;null!=s;){let t,i,o,a,n,e,r,_,l,h,c,m,b=s._next,x=this._ptransform,p=this._transform,f=s._ptransform,u=s._localTransform;t=x._rotation00*u._rotation00+x._rotation01*u._rotation10+x._rotation02*u._rotation20,i=x._rotation00*u._rotation01+x._rotation01*u._rotation11+x._rotation02*u._rotation21,o=x._rotation00*u._rotation02+x._rotation01*u._rotation12+x._rotation02*u._rotation22,a=x._rotation10*u._rotation00+x._rotation11*u._rotation10+x._rotation12*u._rotation20,n=x._rotation10*u._rotation01+x._rotation11*u._rotation11+x._rotation12*u._rotation21,e=x._rotation10*u._rotation02+x._rotation11*u._rotation12+x._rotation12*u._rotation22,r=x._rotation20*u._rotation00+x._rotation21*u._rotation10+x._rotation22*u._rotation20,_=x._rotation20*u._rotation01+x._rotation21*u._rotation11+x._rotation22*u._rotation21,l=x._rotation20*u._rotation02+x._rotation21*u._rotation12+x._rotation22*u._rotation22,f._rotation00=t,f._rotation01=i,f._rotation02=o,f._rotation10=a,f._rotation11=n,f._rotation12=e,f._rotation20=r,f._rotation21=_,f._rotation22=l,h=x._rotation00*u._positionX+x._rotation01*u._positionY+x._rotation02*u._positionZ,c=x._rotation10*u._positionX+x._rotation11*u._positionY+x._rotation12*u._positionZ,m=x._rotation20*u._positionX+x._rotation21*u._positionY+x._rotation22*u._positionZ,f._positionX=h,f._positionY=c,f._positionZ=m,f._positionX+=x._positionX,f._positionY+=x._positionY,f._positionZ+=x._positionZ;let v,X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A,P,S,T=s._transform,C=s._localTransform;if(v=p._rotation00*C._rotation00+p._rotation01*C._rotation10+p._rotation02*C._rotation20,X=p._rotation00*C._rotation01+p._rotation01*C._rotation11+p._rotation02*C._rotation21,y=p._rotation00*C._rotation02+p._rotation01*C._rotation12+p._rotation02*C._rotation22,g=p._rotation10*C._rotation00+p._rotation11*C._rotation10+p._rotation12*C._rotation20,d=p._rotation10*C._rotation01+p._rotation11*C._rotation11+p._rotation12*C._rotation21,Y=p._rotation10*C._rotation02+p._rotation11*C._rotation12+p._rotation12*C._rotation22,z=p._rotation20*C._rotation00+p._rotation21*C._rotation10+p._rotation22*C._rotation20,Z=p._rotation20*C._rotation01+p._rotation21*C._rotation11+p._rotation22*C._rotation21,M=p._rotation20*C._rotation02+p._rotation21*C._rotation12+p._rotation22*C._rotation22,T._rotation00=v,T._rotation01=X,T._rotation02=y,T._rotation10=g,T._rotation11=d,T._rotation12=Y,T._rotation20=z,T._rotation21=Z,T._rotation22=M,I=p._rotation00*C._positionX+p._rotation01*C._positionY+p._rotation02*C._positionZ,V=p._rotation10*C._positionX+p._rotation11*C._positionY+p._rotation12*C._positionZ,L=p._rotation20*C._positionX+p._rotation21*C._positionY+p._rotation22*C._positionZ,T._positionX=I,T._positionY=V,T._positionZ=L,T._positionX+=p._positionX,T._positionY+=p._positionY,T._positionZ+=p._positionZ,s._geom._computeAabb(s._aabb,s._ptransform),w=s._aabb._minX,k=s._aabb._minY,B=s._aabb._minZ,A=s._aabb._maxX,P=s._aabb._maxY,S=s._aabb._maxZ,s._geom._computeAabb(s._aabb,s._transform),s._aabb._minX=w<s._aabb._minX?w:s._aabb._minX,s._aabb._minY=k<s._aabb._minY?k:s._aabb._minY,s._aabb._minZ=B<s._aabb._minZ?B:s._aabb._minZ,s._aabb._maxX=A>s._aabb._maxX?A:s._aabb._maxX,s._aabb._maxY=P>s._aabb._maxY?P:s._aabb._maxY,s._aabb._maxZ=S>s._aabb._maxZ?S:s._aabb._maxZ,null!=s._proxy){let t,i,o;t=s._transform._positionX-s._ptransform._positionX,i=s._transform._positionY-s._ptransform._positionY,o=s._transform._positionZ-s._ptransform._positionZ;let a=s.displacement;a.x=t,a.y=i,a.z=o,s._rigidBody._world._broadPhase.moveProxy(s._proxy,s._aabb,s.displacement)}s=b}}getType(){return this._type}setType(t){this._type=t,this.updateMass()}wakeUp(){this._sleeping=!1,this._sleepTime=0}sleep(){this._sleeping=!0,this._sleepTime=0}isSleeping(){return this._sleeping}getSleepTime(){return this._sleepTime}setAutoSleep(t){this._autoSleep=t,this._sleeping=!1,this._sleepTime=0}getLinearDamping(){return this._linearDamping}setLinearDamping(t){this._linearDamping=t}getAngularDamping(){return this._angularDamping}setAngularDamping(t){this._angularDamping=t}getPrev(){return this._prev}getNext(){return this._next}},oimo.dynamics.rigidbody.RigidBodyConfig=class{constructor(){this.position=new oimo.common.Vec3,this.rotation=new oimo.common.Mat3,this.linearVelocity=new oimo.common.Vec3,this.angularVelocity=new oimo.common.Vec3,this.type=0,this.autoSleep=!0,this.linearDamping=0,this.angularDamping=0}},oimo.dynamics.rigidbody.RigidBodyType=class{},oimo.dynamics.rigidbody.Shape=class{constructor(t){this._id=-1,this._localTransform=new oimo.common.Transform,this._ptransform=new oimo.common.Transform,this._transform=new oimo.common.Transform;let i=t.position;this._localTransform._positionX=i.x,this._localTransform._positionY=i.y,this._localTransform._positionZ=i.z;let o=t.rotation;this._localTransform._rotation00=o.e00,this._localTransform._rotation01=o.e01,this._localTransform._rotation02=o.e02,this._localTransform._rotation10=o.e10,this._localTransform._rotation11=o.e11,this._localTransform._rotation12=o.e12,this._localTransform._rotation20=o.e20,this._localTransform._rotation21=o.e21,this._localTransform._rotation22=o.e22;let s=this._ptransform,a=this._localTransform;s._positionX=a._positionX,s._positionY=a._positionY,s._positionZ=a._positionZ,s._rotation00=a._rotation00,s._rotation01=a._rotation01,s._rotation02=a._rotation02,s._rotation10=a._rotation10,s._rotation11=a._rotation11,s._rotation12=a._rotation12,s._rotation20=a._rotation20,s._rotation21=a._rotation21,s._rotation22=a._rotation22;let n=this._transform,e=this._localTransform;n._positionX=e._positionX,n._positionY=e._positionY,n._positionZ=e._positionZ,n._rotation00=e._rotation00,n._rotation01=e._rotation01,n._rotation02=e._rotation02,n._rotation10=e._rotation10,n._rotation11=e._rotation11,n._rotation12=e._rotation12,n._rotation20=e._rotation20,n._rotation21=e._rotation21,n._rotation22=e._rotation22,this._restitution=t.restitution,this._friction=t.friction,this._density=t.density,this._geom=t.geometry,this._collisionGroup=t.collisionGroup,this._collisionMask=t.collisionMask,this._contactCallback=t.contactCallback,this._aabb=new oimo.collision.geometry.Aabb,this._proxy=null,this.displacement=new oimo.common.Vec3}getFriction(){return this._friction}setFriction(t){this._friction=t}getRestitution(){return this._restitution}setRestitution(t){this._restitution=t}getLocalTransform(){let t=this._localTransform,i=new oimo.common.Transform;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i}getLocalTransformTo(t){let i=this._localTransform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22}getTransform(){let t=this._transform,i=new oimo.common.Transform;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i}getTransformTo(t){let i=this._transform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22}setLocalTransform(t){let i=this._localTransform;if(i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,null!=this._rigidBody){let t=this._rigidBody;t.updateMass();let i=t._shapeList;for(;null!=i;){let o,s,a,n,e,r,_,l,h,c,m,b,x=i._next,p=t._ptransform,f=t._transform,u=i._ptransform,v=i._localTransform;o=p._rotation00*v._rotation00+p._rotation01*v._rotation10+p._rotation02*v._rotation20,s=p._rotation00*v._rotation01+p._rotation01*v._rotation11+p._rotation02*v._rotation21,a=p._rotation00*v._rotation02+p._rotation01*v._rotation12+p._rotation02*v._rotation22,n=p._rotation10*v._rotation00+p._rotation11*v._rotation10+p._rotation12*v._rotation20,e=p._rotation10*v._rotation01+p._rotation11*v._rotation11+p._rotation12*v._rotation21,r=p._rotation10*v._rotation02+p._rotation11*v._rotation12+p._rotation12*v._rotation22,_=p._rotation20*v._rotation00+p._rotation21*v._rotation10+p._rotation22*v._rotation20,l=p._rotation20*v._rotation01+p._rotation21*v._rotation11+p._rotation22*v._rotation21,h=p._rotation20*v._rotation02+p._rotation21*v._rotation12+p._rotation22*v._rotation22,u._rotation00=o,u._rotation01=s,u._rotation02=a,u._rotation10=n,u._rotation11=e,u._rotation12=r,u._rotation20=_,u._rotation21=l,u._rotation22=h,c=p._rotation00*v._positionX+p._rotation01*v._positionY+p._rotation02*v._positionZ,m=p._rotation10*v._positionX+p._rotation11*v._positionY+p._rotation12*v._positionZ,b=p._rotation20*v._positionX+p._rotation21*v._positionY+p._rotation22*v._positionZ,u._positionX=c,u._positionY=m,u._positionZ=b,u._positionX+=p._positionX,u._positionY+=p._positionY,u._positionZ+=p._positionZ;let X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A,P,S,T,C=i._transform,j=i._localTransform;if(X=f._rotation00*j._rotation00+f._rotation01*j._rotation10+f._rotation02*j._rotation20,y=f._rotation00*j._rotation01+f._rotation01*j._rotation11+f._rotation02*j._rotation21,g=f._rotation00*j._rotation02+f._rotation01*j._rotation12+f._rotation02*j._rotation22,d=f._rotation10*j._rotation00+f._rotation11*j._rotation10+f._rotation12*j._rotation20,Y=f._rotation10*j._rotation01+f._rotation11*j._rotation11+f._rotation12*j._rotation21,z=f._rotation10*j._rotation02+f._rotation11*j._rotation12+f._rotation12*j._rotation22,Z=f._rotation20*j._rotation00+f._rotation21*j._rotation10+f._rotation22*j._rotation20,M=f._rotation20*j._rotation01+f._rotation21*j._rotation11+f._rotation22*j._rotation21,I=f._rotation20*j._rotation02+f._rotation21*j._rotation12+f._rotation22*j._rotation22,C._rotation00=X,C._rotation01=y,C._rotation02=g,C._rotation10=d,C._rotation11=Y,C._rotation12=z,C._rotation20=Z,C._rotation21=M,C._rotation22=I,V=f._rotation00*j._positionX+f._rotation01*j._positionY+f._rotation02*j._positionZ,L=f._rotation10*j._positionX+f._rotation11*j._positionY+f._rotation12*j._positionZ,w=f._rotation20*j._positionX+f._rotation21*j._positionY+f._rotation22*j._positionZ,C._positionX=V,C._positionY=L,C._positionZ=w,C._positionX+=f._positionX,C._positionY+=f._positionY,C._positionZ+=f._positionZ,i._geom._computeAabb(i._aabb,i._ptransform),k=i._aabb._minX,B=i._aabb._minY,A=i._aabb._minZ,P=i._aabb._maxX,S=i._aabb._maxY,T=i._aabb._maxZ,i._geom._computeAabb(i._aabb,i._transform),i._aabb._minX=k<i._aabb._minX?k:i._aabb._minX,i._aabb._minY=B<i._aabb._minY?B:i._aabb._minY,i._aabb._minZ=A<i._aabb._minZ?A:i._aabb._minZ,i._aabb._maxX=P>i._aabb._maxX?P:i._aabb._maxX,i._aabb._maxY=S>i._aabb._maxY?S:i._aabb._maxY,i._aabb._maxZ=T>i._aabb._maxZ?T:i._aabb._maxZ,null!=i._proxy){let t,o,s;t=i._transform._positionX-i._ptransform._positionX,o=i._transform._positionY-i._ptransform._positionY,s=i._transform._positionZ-i._ptransform._positionZ;let a=i.displacement;a.x=t,a.y=o,a.z=s,i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=x}}}getDensity(){return this._density}setDensity(t){if(this._density=t,null!=this._rigidBody){let t=this._rigidBody;t.updateMass();let i=t._shapeList;for(;null!=i;){let o,s,a,n,e,r,_,l,h,c,m,b,x=i._next,p=t._ptransform,f=t._transform,u=i._ptransform,v=i._localTransform;o=p._rotation00*v._rotation00+p._rotation01*v._rotation10+p._rotation02*v._rotation20,s=p._rotation00*v._rotation01+p._rotation01*v._rotation11+p._rotation02*v._rotation21,a=p._rotation00*v._rotation02+p._rotation01*v._rotation12+p._rotation02*v._rotation22,n=p._rotation10*v._rotation00+p._rotation11*v._rotation10+p._rotation12*v._rotation20,e=p._rotation10*v._rotation01+p._rotation11*v._rotation11+p._rotation12*v._rotation21,r=p._rotation10*v._rotation02+p._rotation11*v._rotation12+p._rotation12*v._rotation22,_=p._rotation20*v._rotation00+p._rotation21*v._rotation10+p._rotation22*v._rotation20,l=p._rotation20*v._rotation01+p._rotation21*v._rotation11+p._rotation22*v._rotation21,h=p._rotation20*v._rotation02+p._rotation21*v._rotation12+p._rotation22*v._rotation22,u._rotation00=o,u._rotation01=s,u._rotation02=a,u._rotation10=n,u._rotation11=e,u._rotation12=r,u._rotation20=_,u._rotation21=l,u._rotation22=h,c=p._rotation00*v._positionX+p._rotation01*v._positionY+p._rotation02*v._positionZ,m=p._rotation10*v._positionX+p._rotation11*v._positionY+p._rotation12*v._positionZ,b=p._rotation20*v._positionX+p._rotation21*v._positionY+p._rotation22*v._positionZ,u._positionX=c,u._positionY=m,u._positionZ=b,u._positionX+=p._positionX,u._positionY+=p._positionY,u._positionZ+=p._positionZ;let X,y,g,d,Y,z,Z,M,I,V,L,w,k,B,A,P,S,T,C=i._transform,j=i._localTransform;if(X=f._rotation00*j._rotation00+f._rotation01*j._rotation10+f._rotation02*j._rotation20,y=f._rotation00*j._rotation01+f._rotation01*j._rotation11+f._rotation02*j._rotation21,g=f._rotation00*j._rotation02+f._rotation01*j._rotation12+f._rotation02*j._rotation22,d=f._rotation10*j._rotation00+f._rotation11*j._rotation10+f._rotation12*j._rotation20,Y=f._rotation10*j._rotation01+f._rotation11*j._rotation11+f._rotation12*j._rotation21,z=f._rotation10*j._rotation02+f._rotation11*j._rotation12+f._rotation12*j._rotation22,Z=f._rotation20*j._rotation00+f._rotation21*j._rotation10+f._rotation22*j._rotation20,M=f._rotation20*j._rotation01+f._rotation21*j._rotation11+f._rotation22*j._rotation21,I=f._rotation20*j._rotation02+f._rotation21*j._rotation12+f._rotation22*j._rotation22,C._rotation00=X,C._rotation01=y,C._rotation02=g,C._rotation10=d,C._rotation11=Y,C._rotation12=z,C._rotation20=Z,C._rotation21=M,C._rotation22=I,V=f._rotation00*j._positionX+f._rotation01*j._positionY+f._rotation02*j._positionZ,L=f._rotation10*j._positionX+f._rotation11*j._positionY+f._rotation12*j._positionZ,w=f._rotation20*j._positionX+f._rotation21*j._positionY+f._rotation22*j._positionZ,C._positionX=V,C._positionY=L,C._positionZ=w,C._positionX+=f._positionX,C._positionY+=f._positionY,C._positionZ+=f._positionZ,i._geom._computeAabb(i._aabb,i._ptransform),k=i._aabb._minX,B=i._aabb._minY,A=i._aabb._minZ,P=i._aabb._maxX,S=i._aabb._maxY,T=i._aabb._maxZ,i._geom._computeAabb(i._aabb,i._transform),i._aabb._minX=k<i._aabb._minX?k:i._aabb._minX,i._aabb._minY=B<i._aabb._minY?B:i._aabb._minY,i._aabb._minZ=A<i._aabb._minZ?A:i._aabb._minZ,i._aabb._maxX=P>i._aabb._maxX?P:i._aabb._maxX,i._aabb._maxY=S>i._aabb._maxY?S:i._aabb._maxY,i._aabb._maxZ=T>i._aabb._maxZ?T:i._aabb._maxZ,null!=i._proxy){let t,o,s;t=i._transform._positionX-i._ptransform._positionX,o=i._transform._positionY-i._ptransform._positionY,s=i._transform._positionZ-i._ptransform._positionZ;let a=i.displacement;a.x=t,a.y=o,a.z=s,i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=x}}}getAabb(){return this._aabb.clone()}getAabbTo(t){t.copyFrom(this._aabb)}getGeometry(){return this._geom}getRigidBody(){return this._rigidBody}getCollisionGroup(){return this._collisionGroup}setCollisionGroup(t){this._collisionGroup=t}getCollisionMask(){return this._collisionMask}setCollisionMask(t){this._collisionMask=t}getContactCallback(){return this._contactCallback}setContactCallback(t){this._contactCallback=t}getPrev(){return this._prev}getNext(){return this._next}},oimo.dynamics.rigidbody.ShapeConfig=class{constructor(){this.position=new oimo.common.Vec3,this.rotation=new oimo.common.Mat3,this.friction=oimo.common.Setting.defaultFriction,this.restitution=oimo.common.Setting.defaultRestitution,this.density=oimo.common.Setting.defaultDensity,this.collisionGroup=oimo.common.Setting.defaultCollisionGroup,this.collisionMask=oimo.common.Setting.defaultCollisionMask,this.geometry=null,this.contactCallback=null}},oimo.m||(oimo.m={}),oimo.m.M=class{},oimo.collision.broadphase.BroadPhaseType._BRUTE_FORCE=1,oimo.collision.broadphase.BroadPhaseType._BVH=2,oimo.collision.broadphase.BroadPhaseType.BRUTE_FORCE=1,oimo.collision.broadphase.BroadPhaseType.BVH=2,oimo.collision.broadphase.bvh.BvhInsertionStrategy.SIMPLE=0,oimo.collision.broadphase.bvh.BvhInsertionStrategy.MINIMIZE_SURFACE_AREA=1,oimo.collision.geometry.GeometryType._SPHERE=0,oimo.collision.geometry.GeometryType._BOX=1,oimo.collision.geometry.GeometryType._CYLINDER=2,oimo.collision.geometry.GeometryType._CONE=3,oimo.collision.geometry.GeometryType._CAPSULE=4,oimo.collision.geometry.GeometryType._CONVEX_HULL=5,oimo.collision.geometry.GeometryType._CONVEX_MIN=0,oimo.collision.geometry.GeometryType._CONVEX_MAX=5,oimo.collision.geometry.GeometryType.SPHERE=0,oimo.collision.geometry.GeometryType.BOX=1,oimo.collision.geometry.GeometryType.CYLINDER=2,oimo.collision.geometry.GeometryType.CONE=3,oimo.collision.geometry.GeometryType.CAPSULE=4,oimo.collision.geometry.GeometryType.CONVEX_HULL=5,oimo.collision.narrowphase.detector.BoxBoxDetector.EDGE_BIAS_MULT=1,oimo.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.OK=0,oimo.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.INVALID_TRIANGLE=1,oimo.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_PAIR_INDEX=2,oimo.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_TRIANGLE=3,oimo.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.EDGE_LOOP_BROKEN=4,oimo.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_OUTER_TRIANGLE=5,oimo.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.TRIANGLE_INVISIBLE=6,oimo.collision.narrowphase.detector.gjkepa.EpaTriangle.count=0,oimo.common.Vec3.numCreations=0,oimo.common.Setting.defaultFriction=.2,oimo.common.Setting.defaultRestitution=.2,oimo.common.Setting.defaultDensity=1,oimo.common.Setting.defaultCollisionGroup=1,oimo.common.Setting.defaultCollisionMask=1,oimo.common.Setting.maxTranslationPerStep=20,oimo.common.Setting.maxRotationPerStep=3.14159265358979,oimo.common.Setting.bvhProxyPadding=.1,oimo.common.Setting.bvhIncrementalCollisionThreshold=.45,oimo.common.Setting.defaultGJKMargin=.05,oimo.common.Setting.enableGJKCaching=!0,oimo.common.Setting.maxEPAVertices=128,oimo.common.Setting.maxEPAPolyhedronFaces=128,oimo.common.Setting.contactEnableBounceThreshold=.5,oimo.common.Setting.velocityBaumgarte=.2,oimo.common.Setting.positionSplitImpulseBaumgarte=.4,oimo.common.Setting.positionNgsBaumgarte=1,oimo.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold=.05,oimo.common.Setting.defaultContactPositionCorrectionAlgorithm=0,oimo.common.Setting.alternativeContactPositionCorrectionAlgorithm=1,oimo.common.Setting.contactPersistenceThreshold=.05,oimo.common.Setting.maxManifoldPoints=4,oimo.common.Setting.defaultJointConstraintSolverType=0,oimo.common.Setting.defaultJointPositionCorrectionAlgorithm=0,oimo.common.Setting.jointWarmStartingFactorForBaungarte=.8,oimo.common.Setting.jointWarmStartingFactor=.95,oimo.common.Setting.minSpringDamperDampingRatio=1e-6,oimo.common.Setting.minRagdollMaxSwingAngle=1e-6,oimo.common.Setting.maxJacobianRows=6,oimo.common.Setting.directMlcpSolverEps=1e-9,oimo.common.Setting.islandInitialRigidBodyArraySize=128,oimo.common.Setting.islandInitialConstraintArraySize=128,oimo.common.Setting.sleepingVelocityThreshold=.2,oimo.common.Setting.sleepingAngularVelocityThreshold=.5,oimo.common.Setting.sleepingTimeThreshold=1,oimo.common.Setting.disableSleeping=!1,oimo.common.Setting.linearSlop=.005,oimo.common.Setting.angularSlop=.017453292519943278,oimo.collision.narrowphase.detector.gjkepa.GjkEpa.instance=new oimo.collision.narrowphase.detector.gjkepa.GjkEpa,oimo.collision.narrowphase.detector.gjkepa.GjkEpaResultState._SUCCEEDED=0,oimo.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_FAILED_TO_MAKE_TETRAHEDRON=1,oimo.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_DID_NOT_CONVERGE=2,oimo.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_INIT=257,oimo.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_ADD_VERTEX=258,oimo.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_DID_NOT_CONVERGE=259,oimo.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED=0,oimo.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_FAILED_TO_MAKE_TETRAHEDRON=1,oimo.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_DID_NOT_CONVERGE=2,oimo.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT=257,oimo.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX=258,oimo.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE=259,oimo.common.Mat3.numCreations=0,oimo.common.Mat4.numCreations=0,oimo.common.MathUtil.POSITIVE_INFINITY=Infinity,oimo.common.MathUtil.NEGATIVE_INFINITY=-Infinity,oimo.common.MathUtil.PI=3.14159265358979,oimo.common.MathUtil.TWO_PI=6.28318530717958,oimo.common.MathUtil.HALF_PI=1.570796326794895,oimo.common.MathUtil.TO_RADIANS=.017453292519943278,oimo.common.MathUtil.TO_DEGREES=57.29577951308238,oimo.common.Quat.numCreations=0,oimo.dynamics.common.DebugDraw.SPHERE_PHI_DIVISION=8,oimo.dynamics.common.DebugDraw.SPHERE_THETA_DIVISION=4,oimo.dynamics.common.DebugDraw.CIRCLE_THETA_DIVISION=8,oimo.dynamics.common.Performance.broadPhaseCollisionTime=0,oimo.dynamics.common.Performance.narrowPhaseCollisionTime=0,oimo.dynamics.common.Performance.dynamicsTime=0,oimo.dynamics.common.Performance.totalTime=0,oimo.dynamics.constraint.PositionCorrectionAlgorithm._BAUMGARTE=0,oimo.dynamics.constraint.PositionCorrectionAlgorithm._SPLIT_IMPULSE=1,oimo.dynamics.constraint.PositionCorrectionAlgorithm._NGS=2,oimo.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE=0,oimo.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE=1,oimo.dynamics.constraint.PositionCorrectionAlgorithm.NGS=2,oimo.dynamics.constraint.info.JacobianRow.BIT_LINEAR_SET=1,oimo.dynamics.constraint.info.JacobianRow.BIT_ANGULAR_SET=2,oimo.dynamics.constraint.joint.JointType._SPHERICAL=0,oimo.dynamics.constraint.joint.JointType._REVOLUTE=1,oimo.dynamics.constraint.joint.JointType._CYLINDRICAL=2,oimo.dynamics.constraint.joint.JointType._PRISMATIC=3,oimo.dynamics.constraint.joint.JointType._UNIVERSAL=4,oimo.dynamics.constraint.joint.JointType._RAGDOLL=5,oimo.dynamics.constraint.joint.JointType._GENERIC=6,oimo.dynamics.constraint.joint.JointType.SPHERICAL=0,oimo.dynamics.constraint.joint.JointType.REVOLUTE=1,oimo.dynamics.constraint.joint.JointType.CYLINDRICAL=2,oimo.dynamics.constraint.joint.JointType.PRISMATIC=3,oimo.dynamics.constraint.joint.JointType.UNIVERSAL=4,oimo.dynamics.constraint.joint.JointType.RAGDOLL=5,oimo.dynamics.constraint.joint.JointType.GENERIC=6,oimo.dynamics.constraint.solver.ConstraintSolverType._ITERATIVE=0,oimo.dynamics.constraint.solver.ConstraintSolverType._DIRECT=1,oimo.dynamics.constraint.solver.ConstraintSolverType.ITERATIVE=0,oimo.dynamics.constraint.solver.ConstraintSolverType.DIRECT=1,oimo.dynamics.rigidbody.RigidBodyType._DYNAMIC=0,oimo.dynamics.rigidbody.RigidBodyType._STATIC=1,oimo.dynamics.rigidbody.RigidBodyType._KINEMATIC=2,oimo.dynamics.rigidbody.RigidBodyType.DYNAMIC=0,oimo.dynamics.rigidbody.RigidBodyType.STATIC=1,oimo.dynamics.rigidbody.RigidBodyType.KINEMATIC=2;export{oimo};