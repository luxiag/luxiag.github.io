"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[209],{19708:(e,a,i)=>{i.r(a),i.d(a,{default:()=>A});var t=i(71534);const l=i.p+"assets/img/436001504121912222.0543645b.png",r=i.p+"assets/img/860003804121912222.8a09bc65.png",h=i.p+"assets/img/129185334.28889419.png",n=i.p+"assets/img/129185527.3feca329.png",d=i.p+"assets/img/129193904.5e4d7ae1.png",p=i.p+"assets/img/131212140.71f4a6c3.png",s=i.p+"assets/img/131213335.c4492dbb.png",c=i.p+"assets/img/131213701.6a56d898.png",o=i.p+"assets/img/131214322.4dad2207.png",g=i.p+"assets/img/131215826.9fea067d.png",u=i.p+"assets/img/131220539.7a1f9c1d.png",m=i.p+"assets/img/131220918.1d70fc34.png",b=i.p+"assets/img/131221251.3a44781b.png",k=[(0,t.uE)('<table><thead><tr><th>参考</th><th>《网络是怎样连接的》</th></tr></thead></table><h2 id="信号在网线和集线器中传输" tabindex="-1"><a class="header-anchor" href="#信号在网线和集线器中传输" aria-hidden="true">#</a> 信号在网线和集线器中传输</h2><p>信号从计算机中流出之后，会在网线中经过集线器等设备前进。此时， 信号是如何在网线和集线器传输的，就是我们的第一个看点。信号在传输 过程中会衰减，还会受到噪声干扰而失真，如何抑制这些影响是我们的另 一个看点。</p><h3 id="每个包都是独立传输的" tabindex="-1"><a class="header-anchor" href="#每个包都是独立传输的" aria-hidden="true">#</a> 每个包都是独立传输的</h3><p>从计算机发送出来的网络包会通过集线器、路由器等设备被转发，最终到达目的地。 <strong>实际上，路由器已经集成了集线器和交换机的功能</strong><img src="'+l+'" alt=""></p><p>信号到达集线器的时候并不是跟刚发送出去的时候一模一样。集线器收到的信号有时会出现衰减。信号在网线的传输过程中，能量会逐渐损失。网线越长，信号衰减就越严重。</p><h3 id="防止网线中的信号衰减很重要" tabindex="-1"><a class="header-anchor" href="#防止网线中的信号衰减很重要" aria-hidden="true">#</a> 防止网线中的信号衰减很重要</h3><p>网卡中的 PHY(MAU)A 模 块负责将包转换成电信号，信号通过 RJ-45 接口进入双绞线以太网信号的本质是正负变化的电压</p><p><strong>以太网信号的本质是正负变化的电压，网卡的 PHY（MAU）模块就是一个从正负两个信号端子输出信号的电路</strong></p><p><img src="'+r+'" alt=""></p><p>信号从这个接口中的 1 号和 2 号针脚流入网线。然后，信号会通过网线到达集线器的接口，这个过程就是单纯地传输电信号而已</p><p><strong>网线越长,信号衰减就越严重,高频信号更容易损失能量</strong></p><h3 id="双绞-是为了抑制噪声" tabindex="-1"><a class="header-anchor" href="#双绞-是为了抑制噪声" aria-hidden="true">#</a> “双绞”是为了抑制噪声</h3><p>局域网网线使用的是双绞线，其中“双绞”的意思就是以两根信号线为一组缠绕在一起，这种拧麻花一样的设计是为了抑制噪声的影响。</p><blockquote><p>噪声是如何产生的 产生噪声的原因是网线周围的电磁波，当电磁波接触到金属等导体时，在其中就会产生电流。因此，如果网线周围存在电磁波，就会在网线中产生和原本的信号不同的电流。信号和噪声的电流就会混杂在一起，导致信号的波形发生失真，这就是噪声的影响</p></blockquote><p>将信号线缠绕在一起，信号线就变成了螺旋形，其中两根信号线中产生的噪声电流方向就会相反，从而使得噪声电流相互抵消，噪声就得到了抑制</p><p><img src="'+h+'" alt=""></p><p><img src="'+n+'" alt=""></p><h3 id="集线器将信号发往所有线路" tabindex="-1"><a class="header-anchor" href="#集线器将信号发往所有线路" aria-hidden="true">#</a> 集线器将信号发往所有线路</h3><p>当信号到达集线器后，会被广播到整个网络中。</p><blockquote><p>以太网的基本架构就是将包发到所有的设备，然后由设备根据接收方 MAC 地址来判断应该接收哪些包，而集线器就是这一架构的忠实体现</p></blockquote><p>信号到达集线器的 PHY（MAU）模块后，会进入中继电路。中继电路的基本功能就是将输入的信号广播到集线器的所有端口上</p><p><img src="'+d+'" alt=""></p><p>信号到达集线器的 PHY（MAU）模块后，会进入中继电路。中继电路的基本功能就是将输入的信号广播到集线器的所有端口上,信号到达集线器的 PHY（MAU）模块后，会进入中继电路。中继电路的基本功能就是将输入的信号广播到集线器的所有端口上</p><p><strong>集线器只是原封不动地将信号广播出去，所以即便信号受到噪声的干扰发生了失真，也会原样发送到目的地。接收信号的设备，也就是交换机、路由器、服务器等，会在将信号转换成数字信息后通过 FCSA 校验发现错误，并将出错的包丢弃。</strong></p><h2 id="交换机的包转发操作" tabindex="-1"><a class="header-anchor" href="#交换机的包转发操作" aria-hidden="true">#</a> 交换机的包转发操作</h2><h3 id="交换机根据地址表进行转发" tabindex="-1"><a class="header-anchor" href="#交换机根据地址表进行转发" aria-hidden="true">#</a> 交换机根据地址表进行转发</h3><p>交换机并不只是简单地让信号流过，而是先接收信号并将其还原为数字信息，然后再重新转换成信号并发送出去的过程。 <img src="'+p+'" alt=""></p><p>交换机的端口不核对接收方 MAC 地址，而是直接接收所有的包并存放到缓冲区中</p><p>将包存入缓冲区后，接下来需要查询一下这个包的接收方 MAC 地址是否已经在 MAC 地址表中有记录了。MAC 地址表主要包含两个信息，一个是设备的 MAC 地址，另一个是该设备连接在交换机的哪个端口上。然后就可以通过交换电路将包发送到相应的端口了</p><h3 id="mac-地址表的维护" tabindex="-1"><a class="header-anchor" href="#mac-地址表的维护" aria-hidden="true">#</a> MAC 地址表的维护</h3><p>交换机在转发包的过程中，还需要对 MAC 地址表的内容进行维护，维护操作分为两种。</p><ul><li>第一种是收到包时，将发送方 MAC 地址以及其输入端口的号码写入 MAC 地址表中。</li><li>另一种是删除地址表中某条记录的操作，这是为了防止设备移动时产生问题。</li></ul><h3 id="特殊操作" tabindex="-1"><a class="header-anchor" href="#特殊操作" aria-hidden="true">#</a> 特殊操作</h3><ul><li><p>地址表中找不到指定的 MAC 地址，交换机无法判断应该把包转发到哪个端口，只能将包转发到除了源端口之外的所有端口上</p></li><li><p>记录中的目标端口和这个包的源端口是同一个端口，就会直接丢弃这个包</p></li></ul><h3 id="全双工模式可以同时进行发送和接收" tabindex="-1"><a class="header-anchor" href="#全双工模式可以同时进行发送和接收" aria-hidden="true">#</a> 全双工模式可以同时进行发送和接收</h3><p>全双工模式是交换机特有的工作模式，它可以同时进行发送和接收操作，集线器不具备这样的特性</p><h3 id="自动协商-确定最优的传输速率" tabindex="-1"><a class="header-anchor" href="#自动协商-确定最优的传输速率" aria-hidden="true">#</a> 自动协商：确定最优的传输速率</h3><p><img src="'+s+'" alt=""></p><p>自动协商功能就利用了这样的脉冲信号，即通过这种信号将自己能够支持的工作模式 A 和传输速率相互告知对方，并从中选择一个最优的组合</p><h2 id="路由器的包转发操作" tabindex="-1"><a class="header-anchor" href="#路由器的包转发操作" aria-hidden="true">#</a> 路由器的包转发操作</h2><p>路由器和交换机一样也负责对包进行转发，但它们的工作方式有一些 差异。交换机是基于以太网规格工作的设备，而路由器是基于 IP 工作的</p><h3 id="路由器的基本知识" tabindex="-1"><a class="header-anchor" href="#路由器的基本知识" aria-hidden="true">#</a> 路由器的基本知识</h3><p><img src="'+c+'" alt=""></p><p>路由器在转发包时，首先会通过端口将发过来的包接收进来，转发模块会根据接收到的包的 IP 头部中记录的接收方 IP 地址，在路由表中进行查询，以此判断转发目标。</p><p><strong>路由器的各个端口都具有 MAC 地址和 IP 地址。</strong></p><h3 id="路由表中的信息" tabindex="-1"><a class="header-anchor" href="#路由表中的信息" aria-hidden="true">#</a> 路由表中的信息</h3><p>交换机是通过 MAC 头部中的接收方 MAC 地址来判断转发目标的，而路由器则是根据 IP 头部中的 IP 地址来判断的。</p><p><img src="'+o+'" alt=""></p><p>对路由表进行维护的方法</p><ul><li>由人手动维护路由记录</li><li>根据路由协议机制，通过路由器之间的信息交换由路由器自行维护路由表的记录</li></ul><h3 id="路由器的包接收操作" tabindex="-1"><a class="header-anchor" href="#路由器的包接收操作" aria-hidden="true">#</a> 路由器的包接收操作</h3><blockquote><p>信号到达网线接口部分，其中的 PHY（MAU）模块和 MAC 模块将信号转换为数字信息，然后通过包末尾的 FCS 进行错误校验，如果没问题则检查 MAC 头部中的接收方 MAC 地址，看看是不是发给自己的包，如果是就放到接收缓冲区中，否则就丢弃这个包。</p></blockquote><p>路由器的端口都具有 MAC 地址，只接收与自身地址匹配的包，遇到不匹配的包则直接丢弃</p><h3 id="查询路由表确定输出端口" tabindex="-1"><a class="header-anchor" href="#查询路由表确定输出端口" aria-hidden="true">#</a> 查询路由表确定输出端口</h3><p>完成包接收操作之后，路由器就会丢弃包开头的 MAC 头部。MAC 头部的作用就是将包送达路由器，其中的接收方 MAC 地址就是路由器端口的 MAC 地址。</p><p>路由器会根据 MAC 头部后方的 IP 头部中的内容进行包的转发操作。</p><h3 id="找不到匹配路由时选择默认路由" tabindex="-1"><a class="header-anchor" href="#找不到匹配路由时选择默认路由" aria-hidden="true">#</a> 找不到匹配路由时选择默认路由</h3><p>路由表中子网掩码为 0.0.0.0 的记录表示“默认路由”</p><h3 id="包的有效期" tabindex="-1"><a class="header-anchor" href="#包的有效期" aria-hidden="true">#</a> 包的有效期</h3><p>路由器进行发送前</p><ul><li>更新 IP 头部中的 TTL（Time to Live，生存时间）字段。TTL 字段表示包的有效期，包每经过一个路由器的转发，这个值就会减 1，当这个值变成 0 时，就表示超过了有效期，这个包就会被丢弃</li></ul><h3 id="通过分片功能拆分大网络包" tabindex="-1"><a class="header-anchor" href="#通过分片功能拆分大网络包" aria-hidden="true">#</a> 通过分片功能拆分大网络包</h3><p><img src="'+g+'" alt=""></p><h3 id="路由器的发送操作和计算机相同" tabindex="-1"><a class="header-anchor" href="#路由器的发送操作和计算机相同" aria-hidden="true">#</a> 路由器的发送操作和计算机相同</h3><p>路由器判断下一个转发目标的方法如下。 ● 如果路由表的网关列内容为 IP 地址，则该地址就是下一个转 发目标。 ● 如果路由表的网关列内容为空，则 IP 头部中的接收方 IP 地址 就是下一个转发目标。</p><p>路由器也会使用 ARP 来查询下一个转发目标的 MAC 地址。</p><h3 id="路由器与交换机的关系" tabindex="-1"><a class="header-anchor" href="#路由器与交换机的关系" aria-hidden="true">#</a> 路由器与交换机的关系</h3><p>要理解两者之间的关系，关键点在于计算机在发送网络包时，或者是路由器在转发网络包时，都需要在前面加上 MAC 头部。</p><p>路由器是基于 IP 设计的，而交换机是基于以太网设计的，因此 IP 与以太网的关系也就是路由器与交换机的关系</p><p>IP（路由器）负责将包送达通信对象这一整体过程，而其中将包传输到下一个路由器的过程则是由以太网（交换机）来负责的。</p><h2 id="路由器的附加功能" tabindex="-1"><a class="header-anchor" href="#路由器的附加功能" aria-hidden="true">#</a> 路由器的附加功能</h2><p>位于互联网接入端的路由器通常还会提供一些附加功能，例如将私有 地址转换为公有地址的地址转换功能，以及阻止危险网络包的包过滤功 能等。</p><h3 id="通过地址转换有效利用-ip-地址" tabindex="-1"><a class="header-anchor" href="#通过地址转换有效利用-ip-地址" aria-hidden="true">#</a> 通过地址转换有效利用 IP 地址</h3><p><img src="'+u+'" alt=""></p><p>内网部分则分配私有地址，内网中的设备不能和互联网直接收发网络包，而是通过一种特别的机制进行连接，这个机制就叫地址转换。</p><h3 id="地址转换的基本原理" tabindex="-1"><a class="header-anchor" href="#地址转换的基本原理" aria-hidden="true">#</a> 地址转换的基本原理</h3><p>地址转换的基本原理是在转发网络包时对 IP 头部中的 IP 地址和端口号进行改写。</p><p><img src="'+m+'" alt=""></p><p>改写发送方 IP 地址和端口号之后，包就被发往互联网，最终到达服务器，然后服务器会返回一个包。服务器返回的包的接收包是原始包的发送方，因此返回的包的接收方就是改写后的公有地址和端口号。</p><h3 id="改写端口号的原因" tabindex="-1"><a class="header-anchor" href="#改写端口号的原因" aria-hidden="true">#</a> 改写端口号的原因</h3><p>端口号是一个 16 比特的数值，总共可以分配出几万个端口 A，因此如果用公有地址加上端口的组合对应一个私有地址，一个公有地址就可以对应几万个私有地址，这种方法提高了公有地址的利用率</p><h3 id="从互联网访问公司内网" tabindex="-1"><a class="header-anchor" href="#从互联网访问公司内网" aria-hidden="true">#</a> 从互联网访问公司内网</h3><p><img src="'+b+'" alt=""></p><p>只要事先将地址和端口的关联信息添加到地址转换设备的对应表中，就可以从互联网访问内网中的设备了。</p><h3 id="路由器的包过滤功能" tabindex="-1"><a class="header-anchor" href="#路由器的包过滤功能" aria-hidden="true">#</a> 路由器的包过滤功能</h3><p>包过滤就是在对包进行转发时，根据 MAC 头部、IP 头部、TCP 头部的内容 A，按照事先设置好的规则决定是转发这个包，还是丢弃这个包。</p>',87)],f={},A=(0,i(61935).Z)(f,[["render",function(e,a){return(0,t.wg)(),(0,t.iD)("div",null,k)}]])},61935:(e,a)=>{a.Z=(e,a)=>{const i=e.__vccOpts||e;for(const[e,t]of a)i[e]=t;return i}},98522:(e,a,i)=>{i.r(a),i.d(a,{data:()=>t});const t=JSON.parse('{"key":"v-6c11d378","path":"/network/how-networks-work-part3.html","title":"从网线到网络设备","lang":"zh-CN","frontmatter":{"title":"从网线到网络设备","category":["Network"],"tag":["网络是怎样连接的"],"date":"2021-11-21T00:00:00.000Z","summary":"参考 《网络是怎样连接的》 ---- -------------------- 信号在网线和集线器中传输 信号从计算机中流出之后，会在网线中经过集线器等设备前进。此时， 信号是如何在网线和集线器传输的，就是我们的第一个看点。信号在传输 过程中会衰减，还会受到噪声干扰而失真，如何抑制这些影响是我们的另 一个看点。 每个包都是独立传输的 从计算机发送出来的网络包","head":[["meta",{"property":"og:url","content":"https://luxiag.github.io/network/how-networks-work-part3.html"}],["meta",{"property":"og:title","content":"从网线到网络设备"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://luxiag.github.io/"}],["meta",{"property":"og:updated_time","content":"2023-04-18T09:01:52.000Z"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"name":"twitter:card","content":"summary_large_image"}],["meta",{"name":"twitter:image:alt","content":"从网线到网络设备"}],["meta",{"property":"article:tag","content":"网络是怎样连接的"}],["meta",{"property":"article:published_time","content":"2021-11-21T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2023-04-18T09:01:52.000Z"}]]},"excerpt":"","headers":[{"level":2,"title":"信号在网线和集线器中传输","slug":"信号在网线和集线器中传输","link":"#信号在网线和集线器中传输","children":[{"level":3,"title":"每个包都是独立传输的","slug":"每个包都是独立传输的","link":"#每个包都是独立传输的","children":[]},{"level":3,"title":"防止网线中的信号衰减很重要","slug":"防止网线中的信号衰减很重要","link":"#防止网线中的信号衰减很重要","children":[]},{"level":3,"title":"“双绞”是为了抑制噪声","slug":"双绞-是为了抑制噪声","link":"#双绞-是为了抑制噪声","children":[]},{"level":3,"title":"集线器将信号发往所有线路","slug":"集线器将信号发往所有线路","link":"#集线器将信号发往所有线路","children":[]}]},{"level":2,"title":"交换机的包转发操作","slug":"交换机的包转发操作","link":"#交换机的包转发操作","children":[{"level":3,"title":"交换机根据地址表进行转发","slug":"交换机根据地址表进行转发","link":"#交换机根据地址表进行转发","children":[]},{"level":3,"title":"MAC 地址表的维护","slug":"mac-地址表的维护","link":"#mac-地址表的维护","children":[]},{"level":3,"title":"特殊操作","slug":"特殊操作","link":"#特殊操作","children":[]},{"level":3,"title":"全双工模式可以同时进行发送和接收","slug":"全双工模式可以同时进行发送和接收","link":"#全双工模式可以同时进行发送和接收","children":[]},{"level":3,"title":"自动协商：确定最优的传输速率","slug":"自动协商-确定最优的传输速率","link":"#自动协商-确定最优的传输速率","children":[]}]},{"level":2,"title":"路由器的包转发操作","slug":"路由器的包转发操作","link":"#路由器的包转发操作","children":[{"level":3,"title":"路由器的基本知识","slug":"路由器的基本知识","link":"#路由器的基本知识","children":[]},{"level":3,"title":"路由表中的信息","slug":"路由表中的信息","link":"#路由表中的信息","children":[]},{"level":3,"title":"路由器的包接收操作","slug":"路由器的包接收操作","link":"#路由器的包接收操作","children":[]},{"level":3,"title":"查询路由表确定输出端口","slug":"查询路由表确定输出端口","link":"#查询路由表确定输出端口","children":[]},{"level":3,"title":"找不到匹配路由时选择默认路由","slug":"找不到匹配路由时选择默认路由","link":"#找不到匹配路由时选择默认路由","children":[]},{"level":3,"title":"包的有效期","slug":"包的有效期","link":"#包的有效期","children":[]},{"level":3,"title":"通过分片功能拆分大网络包","slug":"通过分片功能拆分大网络包","link":"#通过分片功能拆分大网络包","children":[]},{"level":3,"title":"路由器的发送操作和计算机相同","slug":"路由器的发送操作和计算机相同","link":"#路由器的发送操作和计算机相同","children":[]},{"level":3,"title":"路由器与交换机的关系","slug":"路由器与交换机的关系","link":"#路由器与交换机的关系","children":[]}]},{"level":2,"title":"路由器的附加功能","slug":"路由器的附加功能","link":"#路由器的附加功能","children":[{"level":3,"title":"通过地址转换有效利用 IP 地址","slug":"通过地址转换有效利用-ip-地址","link":"#通过地址转换有效利用-ip-地址","children":[]},{"level":3,"title":"地址转换的基本原理","slug":"地址转换的基本原理","link":"#地址转换的基本原理","children":[]},{"level":3,"title":"改写端口号的原因","slug":"改写端口号的原因","link":"#改写端口号的原因","children":[]},{"level":3,"title":"从互联网访问公司内网","slug":"从互联网访问公司内网","link":"#从互联网访问公司内网","children":[]},{"level":3,"title":"路由器的包过滤功能","slug":"路由器的包过滤功能","link":"#路由器的包过滤功能","children":[]}]}],"git":{"createdTime":1671674066000,"updatedTime":1681808512000,"contributors":[{"name":"luxiag","email":"luxiag@qq.com","commits":2},{"name":"卢祥","email":"example@qq.com","commits":2}]},"readingTime":{"minutes":9.88,"words":2964},"filePathRelative":"network/how-networks-work-part3.md","localizedDate":"2021年11月21日"}')}}]);