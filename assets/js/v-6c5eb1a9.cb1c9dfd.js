"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[9157],{41984:(a,n,s)=>{s.r(n),s.d(n,{default:()=>k});var t=s(71534),d=s(32049),e=s(86171),p=s(97630),o=s(7132),c=s(33344),l=s(82783),i=s(99759),v=s(54636);const r={href:"https://threejs.org/",target:"_blank",rel:"noopener noreferrer"},u=(0,t.uE)('<div class="language-javascript line-numbers-mode" data-ext="js" data-v-4b2fd967><pre class="language-javascript" data-v-4b2fd967><code data-v-4b2fd967><span class="token keyword" data-v-4b2fd967>import</span> <span class="token punctuation" data-v-4b2fd967>{</span> Water <span class="token punctuation" data-v-4b2fd967>}</span> <span class="token keyword" data-v-4b2fd967>from</span> <span class="token string" data-v-4b2fd967>&quot;three/examples/jsm/objects/Water2&quot;</span><span class="token punctuation" data-v-4b2fd967>;</span>\n\n<span class="token comment" data-v-4b2fd967>// 创建用于水面的平面几何体</span>\n<span class="token keyword" data-v-4b2fd967>const</span> waterGeometry <span class="token operator" data-v-4b2fd967>=</span> <span class="token keyword" data-v-4b2fd967>new</span> <span class="token class-name" data-v-4b2fd967>THREE<span class="token punctuation" data-v-4b2fd967>.</span>PlaneGeometry</span><span class="token punctuation" data-v-4b2fd967>(</span><span class="token number" data-v-4b2fd967>10000</span><span class="token punctuation" data-v-4b2fd967>,</span> <span class="token number" data-v-4b2fd967>10000</span><span class="token punctuation" data-v-4b2fd967>)</span><span class="token punctuation" data-v-4b2fd967>;</span>\n\n<span class="token comment" data-v-4b2fd967>// 创建 Water 对象所需的选项</span>\n<span class="token keyword" data-v-4b2fd967>const</span> waterOptions <span class="token operator" data-v-4b2fd967>=</span> <span class="token punctuation" data-v-4b2fd967>{</span>\n  <span class="token literal-property property" data-v-4b2fd967>color</span><span class="token operator" data-v-4b2fd967>:</span> <span class="token string" data-v-4b2fd967>&#39;#abcdef&#39;</span><span class="token punctuation" data-v-4b2fd967>,</span> <span class="token comment" data-v-4b2fd967>// 水体颜色</span>\n  <span class="token literal-property property" data-v-4b2fd967>scale</span><span class="token operator" data-v-4b2fd967>:</span> <span class="token number" data-v-4b2fd967>4</span><span class="token punctuation" data-v-4b2fd967>,</span> <span class="token comment" data-v-4b2fd967>// 波浪大小</span>\n  <span class="token literal-property property" data-v-4b2fd967>flowDirection</span><span class="token operator" data-v-4b2fd967>:</span> <span class="token keyword" data-v-4b2fd967>new</span> <span class="token class-name" data-v-4b2fd967>THREE<span class="token punctuation" data-v-4b2fd967>.</span>Vector2</span><span class="token punctuation" data-v-4b2fd967>(</span><span class="token number" data-v-4b2fd967>1</span><span class="token punctuation" data-v-4b2fd967>,</span> <span class="token number" data-v-4b2fd967>1</span><span class="token punctuation" data-v-4b2fd967>)</span><span class="token punctuation" data-v-4b2fd967>,</span> <span class="token comment" data-v-4b2fd967>// 水流方向</span>\n  <span class="token literal-property property" data-v-4b2fd967>textureWidth</span><span class="token operator" data-v-4b2fd967>:</span> <span class="token number" data-v-4b2fd967>1024</span><span class="token punctuation" data-v-4b2fd967>,</span> <span class="token comment" data-v-4b2fd967>// 纹理宽度</span>\n  <span class="token literal-property property" data-v-4b2fd967>textureHeight</span><span class="token operator" data-v-4b2fd967>:</span> <span class="token number" data-v-4b2fd967>1024</span><span class="token punctuation" data-v-4b2fd967>,</span> <span class="token comment" data-v-4b2fd967>// 纹理高度</span>\n  <span class="token comment" data-v-4b2fd967>// 水面的法线贴图。其作用是用于模拟水面波浪之间的交互以及光照效果，增加水面的真实感。</span>\n  <span class="token literal-property property" data-v-4b2fd967>normalMap0</span><span class="token operator" data-v-4b2fd967>:</span> normalTexture<span class="token punctuation" data-v-4b2fd967>,</span> \n  <span class="token comment" data-v-4b2fd967>// 法线贴图是一种让表面产生凹凸感觉的纹理，用以增加真实感</span>\n  <span class="token literal-property property" data-v-4b2fd967>normalMapUrl0</span><span class="token operator" data-v-4b2fd967>:</span> <span class="token string" data-v-4b2fd967>&#39;textures/waternormals.jpg&#39;</span><span class="token punctuation" data-v-4b2fd967>,</span>\n  <span class="token comment" data-v-4b2fd967>// 这里也可以直接将贴图赋值给 normalMap0</span>\n  <span class="token literal-property property" data-v-4b2fd967>envMap</span><span class="token operator" data-v-4b2fd967>:</span> cubeRenderTarget<span class="token punctuation" data-v-4b2fd967>.</span>texture<span class="token punctuation" data-v-4b2fd967>,</span> <span class="token comment" data-v-4b2fd967>// 反射天空盒的立方体纹理</span>\n  <span class="token literal-property property" data-v-4b2fd967>receiveShadow</span><span class="token operator" data-v-4b2fd967>:</span> <span class="token boolean" data-v-4b2fd967>true</span><span class="token punctuation" data-v-4b2fd967>,</span> <span class="token comment" data-v-4b2fd967>// 是否接收阴影</span>\n  <span class="token literal-property property" data-v-4b2fd967>distortionScale</span><span class="token operator" data-v-4b2fd967>:</span> <span class="token number" data-v-4b2fd967>3.7</span><span class="token punctuation" data-v-4b2fd967>,</span> <span class="token comment" data-v-4b2fd967>// 扭曲效果的大小</span>\n  <span class="token literal-property property" data-v-4b2fd967>fog</span><span class="token operator" data-v-4b2fd967>:</span> scene<span class="token punctuation" data-v-4b2fd967>.</span>fog <span class="token operator" data-v-4b2fd967>!==</span> <span class="token keyword" data-v-4b2fd967>undefined</span> <span class="token comment" data-v-4b2fd967>// 是否启用雾效果 </span>\n<span class="token punctuation" data-v-4b2fd967>}</span><span class="token punctuation" data-v-4b2fd967>;</span>\n\n<span class="token comment" data-v-4b2fd967>// 创建 Water 对象</span>\n<span class="token keyword" data-v-4b2fd967>const</span> water <span class="token operator" data-v-4b2fd967>=</span> <span class="token keyword" data-v-4b2fd967>new</span> <span class="token class-name" data-v-4b2fd967>THREE<span class="token punctuation" data-v-4b2fd967>.</span>Water</span><span class="token punctuation" data-v-4b2fd967>(</span>waterGeometry<span class="token punctuation" data-v-4b2fd967>,</span> waterOptions<span class="token punctuation" data-v-4b2fd967>)</span><span class="token punctuation" data-v-4b2fd967>;</span>\n\n<span class="token comment" data-v-4b2fd967>// 将 Water 对象添加到场景中</span>\nscene<span class="token punctuation" data-v-4b2fd967>.</span><span class="token function" data-v-4b2fd967>add</span><span class="token punctuation" data-v-4b2fd967>(</span>water<span class="token punctuation" data-v-4b2fd967>)</span><span class="token punctuation" data-v-4b2fd967>;</span>\n</code></pre><div class="line-numbers" aria-hidden="true" data-v-4b2fd967><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div></div></div>',1),b=(0,t.uE)('<div class="language-javascript line-numbers-mode" data-ext="js" data-v-4b2fd967><pre class="language-javascript" data-v-4b2fd967><code data-v-4b2fd967><span class="token keyword" data-v-4b2fd967>import</span> <span class="token punctuation" data-v-4b2fd967>{</span> Water <span class="token punctuation" data-v-4b2fd967>}</span> <span class="token keyword" data-v-4b2fd967>from</span> <span class="token string" data-v-4b2fd967>&#39;three/addons/objects/Water.js&#39;</span><span class="token punctuation" data-v-4b2fd967>;</span>\n<span class="token keyword" data-v-4b2fd967>const</span> waterGeometry <span class="token operator" data-v-4b2fd967>=</span> <span class="token keyword" data-v-4b2fd967>new</span> <span class="token class-name" data-v-4b2fd967>THREE<span class="token punctuation" data-v-4b2fd967>.</span>PlaneGeometry</span><span class="token punctuation" data-v-4b2fd967>(</span> <span class="token number" data-v-4b2fd967>10000</span><span class="token punctuation" data-v-4b2fd967>,</span> <span class="token number" data-v-4b2fd967>10000</span> <span class="token punctuation" data-v-4b2fd967>)</span><span class="token punctuation" data-v-4b2fd967>;</span>\nwater <span class="token operator" data-v-4b2fd967>=</span> <span class="token keyword" data-v-4b2fd967>new</span> <span class="token class-name" data-v-4b2fd967>Water</span><span class="token punctuation" data-v-4b2fd967>(</span>\n\twaterGeometry<span class="token punctuation" data-v-4b2fd967>,</span>\n\t<span class="token punctuation" data-v-4b2fd967>{</span>\n\t\t<span class="token literal-property property" data-v-4b2fd967>textureWidth</span><span class="token operator" data-v-4b2fd967>:</span> <span class="token number" data-v-4b2fd967>512</span><span class="token punctuation" data-v-4b2fd967>,</span>\n\t\t<span class="token literal-property property" data-v-4b2fd967>textureHeight</span><span class="token operator" data-v-4b2fd967>:</span> <span class="token number" data-v-4b2fd967>512</span><span class="token punctuation" data-v-4b2fd967>,</span>\n\t\t<span class="token literal-property property" data-v-4b2fd967>waterNormals</span><span class="token operator" data-v-4b2fd967>:</span> <span class="token keyword" data-v-4b2fd967>new</span> <span class="token class-name" data-v-4b2fd967>THREE<span class="token punctuation" data-v-4b2fd967>.</span>TextureLoader</span><span class="token punctuation" data-v-4b2fd967>(</span><span class="token punctuation" data-v-4b2fd967>)</span><span class="token punctuation" data-v-4b2fd967>.</span><span class="token function" data-v-4b2fd967>load</span><span class="token punctuation" data-v-4b2fd967>(</span> <span class="token string" data-v-4b2fd967>&#39;textures/waternormals.jpg&#39;</span><span class="token punctuation" data-v-4b2fd967>,</span> <span class="token keyword" data-v-4b2fd967>function</span> <span class="token punctuation" data-v-4b2fd967>(</span> <span class="token parameter" data-v-4b2fd967>texture</span> <span class="token punctuation" data-v-4b2fd967>)</span> <span class="token punctuation" data-v-4b2fd967>{</span>\n\t\t\ttexture<span class="token punctuation" data-v-4b2fd967>.</span>wrapS <span class="token operator" data-v-4b2fd967>=</span> texture<span class="token punctuation" data-v-4b2fd967>.</span>wrapT <span class="token operator" data-v-4b2fd967>=</span> <span class="token constant" data-v-4b2fd967>THREE</span><span class="token punctuation" data-v-4b2fd967>.</span>RepeatWrapping<span class="token punctuation" data-v-4b2fd967>;</span>\n\t\t<span class="token punctuation" data-v-4b2fd967>}</span> <span class="token punctuation" data-v-4b2fd967>)</span><span class="token punctuation" data-v-4b2fd967>,</span>\n\t\t<span class="token literal-property property" data-v-4b2fd967>sunDirection</span><span class="token operator" data-v-4b2fd967>:</span> <span class="token keyword" data-v-4b2fd967>new</span> <span class="token class-name" data-v-4b2fd967>THREE<span class="token punctuation" data-v-4b2fd967>.</span>Vector3</span><span class="token punctuation" data-v-4b2fd967>(</span><span class="token punctuation" data-v-4b2fd967>)</span><span class="token punctuation" data-v-4b2fd967>,</span>\n\t\t<span class="token literal-property property" data-v-4b2fd967>sunColor</span><span class="token operator" data-v-4b2fd967>:</span> <span class="token number" data-v-4b2fd967>0xffffff</span><span class="token punctuation" data-v-4b2fd967>,</span>\n\t\t<span class="token literal-property property" data-v-4b2fd967>waterColor</span><span class="token operator" data-v-4b2fd967>:</span> <span class="token number" data-v-4b2fd967>0x001e0f</span><span class="token punctuation" data-v-4b2fd967>,</span>\n\t\t<span class="token literal-property property" data-v-4b2fd967>distortionScale</span><span class="token operator" data-v-4b2fd967>:</span> <span class="token number" data-v-4b2fd967>3.7</span><span class="token punctuation" data-v-4b2fd967>,</span>\n\t\t<span class="token literal-property property" data-v-4b2fd967>fog</span><span class="token operator" data-v-4b2fd967>:</span> scene<span class="token punctuation" data-v-4b2fd967>.</span>fog <span class="token operator" data-v-4b2fd967>!==</span> <span class="token keyword" data-v-4b2fd967>undefined</span>\n\t<span class="token punctuation" data-v-4b2fd967>}</span>\n<span class="token punctuation" data-v-4b2fd967>)</span><span class="token punctuation" data-v-4b2fd967>;</span>\nwater<span class="token punctuation" data-v-4b2fd967>.</span>rotation<span class="token punctuation" data-v-4b2fd967>.</span>x <span class="token operator" data-v-4b2fd967>=</span> <span class="token operator" data-v-4b2fd967>-</span> Math<span class="token punctuation" data-v-4b2fd967>.</span><span class="token constant" data-v-4b2fd967>PI</span> <span class="token operator" data-v-4b2fd967>/</span><span class="token number" data-v-4b2fd967>2</span>\n<span class="token keyword" data-v-4b2fd967>function</span> <span class="token function" data-v-4b2fd967>render</span><span class="token punctuation" data-v-4b2fd967>(</span><span class="token punctuation" data-v-4b2fd967>)</span><span class="token punctuation" data-v-4b2fd967>{</span>\n  water<span class="token punctuation" data-v-4b2fd967>.</span>material<span class="token punctuation" data-v-4b2fd967>.</span>uniforms<span class="token punctuation" data-v-4b2fd967>[</span> <span class="token string" data-v-4b2fd967>&#39;time&#39;</span> <span class="token punctuation" data-v-4b2fd967>]</span><span class="token punctuation" data-v-4b2fd967>.</span>value <span class="token operator" data-v-4b2fd967>+=</span> <span class="token number" data-v-4b2fd967>1.0</span> <span class="token operator" data-v-4b2fd967>/</span> <span class="token number" data-v-4b2fd967>60.0</span><span class="token punctuation" data-v-4b2fd967>;</span>\n<span class="token punctuation" data-v-4b2fd967>}</span>\n\n<span class="token comment" data-v-4b2fd967>// 落日</span>\n<span class="token keyword" data-v-4b2fd967>import</span> <span class="token punctuation" data-v-4b2fd967>{</span> Sky <span class="token punctuation" data-v-4b2fd967>}</span> <span class="token keyword" data-v-4b2fd967>from</span> <span class="token string" data-v-4b2fd967>&#39;three/addons/objects/Sky.js&#39;</span><span class="token punctuation" data-v-4b2fd967>;</span>\nsun <span class="token operator" data-v-4b2fd967>=</span> <span class="token keyword" data-v-4b2fd967>new</span> <span class="token class-name" data-v-4b2fd967>THREE<span class="token punctuation" data-v-4b2fd967>.</span>Vector3</span><span class="token punctuation" data-v-4b2fd967>(</span><span class="token punctuation" data-v-4b2fd967>)</span><span class="token punctuation" data-v-4b2fd967>;</span>\n<span class="token keyword" data-v-4b2fd967>const</span> sky <span class="token operator" data-v-4b2fd967>=</span> <span class="token keyword" data-v-4b2fd967>new</span> <span class="token class-name" data-v-4b2fd967>Sky</span><span class="token punctuation" data-v-4b2fd967>(</span><span class="token punctuation" data-v-4b2fd967>)</span><span class="token punctuation" data-v-4b2fd967>;</span>\nsky<span class="token punctuation" data-v-4b2fd967>.</span>scale<span class="token punctuation" data-v-4b2fd967>.</span><span class="token function" data-v-4b2fd967>setScalar</span><span class="token punctuation" data-v-4b2fd967>(</span> <span class="token number" data-v-4b2fd967>10000</span> <span class="token punctuation" data-v-4b2fd967>)</span><span class="token punctuation" data-v-4b2fd967>;</span>\nscene<span class="token punctuation" data-v-4b2fd967>.</span><span class="token function" data-v-4b2fd967>add</span><span class="token punctuation" data-v-4b2fd967>(</span> sky <span class="token punctuation" data-v-4b2fd967>)</span><span class="token punctuation" data-v-4b2fd967>;</span>\n\n<span class="token keyword" data-v-4b2fd967>const</span> skyUniforms <span class="token operator" data-v-4b2fd967>=</span> sky<span class="token punctuation" data-v-4b2fd967>.</span>material<span class="token punctuation" data-v-4b2fd967>.</span>unifor\nskyUniforms<span class="token punctuation" data-v-4b2fd967>[</span> <span class="token string" data-v-4b2fd967>&#39;turbidity&#39;</span> <span class="token punctuation" data-v-4b2fd967>]</span><span class="token punctuation" data-v-4b2fd967>.</span>value <span class="token operator" data-v-4b2fd967>=</span> <span class="token number" data-v-4b2fd967>10</span><span class="token punctuation" data-v-4b2fd967>;</span>\nskyUniforms<span class="token punctuation" data-v-4b2fd967>[</span> <span class="token string" data-v-4b2fd967>&#39;rayleigh&#39;</span> <span class="token punctuation" data-v-4b2fd967>]</span><span class="token punctuation" data-v-4b2fd967>.</span>value <span class="token operator" data-v-4b2fd967>=</span> <span class="token number" data-v-4b2fd967>2</span><span class="token punctuation" data-v-4b2fd967>;</span>\nskyUniforms<span class="token punctuation" data-v-4b2fd967>[</span> <span class="token string" data-v-4b2fd967>&#39;mieCoefficient&#39;</span> <span class="token punctuation" data-v-4b2fd967>]</span><span class="token punctuation" data-v-4b2fd967>.</span>value <span class="token operator" data-v-4b2fd967>=</span> <span class="token number" data-v-4b2fd967>0.005</span><span class="token punctuation" data-v-4b2fd967>;</span>\nskyUniforms<span class="token punctuation" data-v-4b2fd967>[</span> <span class="token string" data-v-4b2fd967>&#39;mieDirectionalG&#39;</span> <span class="token punctuation" data-v-4b2fd967>]</span><span class="token punctuation" data-v-4b2fd967>.</span>value <span class="token operator" data-v-4b2fd967>=</span> <span class="token number" data-v-4b2fd967>0.8</span><span class="token punctuation" data-v-4b2fd967>;</span>\n\n<span class="token comment" data-v-4b2fd967>/*\n创建了一个预计算辐射度环境贴图（pre-computed radiance environment map，PMREM）生成器。\nPMREMGenerator 是 Three.js 物体材质中用于实现基于物理的渲染（PBR）的重要组件之一。\n\n在 Three.js 中，PBR 材质需要使用辐射度环境贴图来提供场景的照明信息，\n而预计算辐射度环境贴图是一种预先计算和缓存辐射度环境贴图的技术，可以提高实时渲染的效率和质量。\n\n通过传递渲染器对象作为参数，PMREMGenerator 可以根据当前场景和光照计算出辐射度环境贴图，\n并将其缓存在内存中，方便后续使用。在使用 PBR 材质时，\n我们可以通过调用 PMREMGenerator 的相关方法来获取需要的辐射度环境贴图。\n\n*/</span> \n<span class="token keyword" data-v-4b2fd967>const</span> pmremGenerator <span class="token operator" data-v-4b2fd967>=</span> <span class="token keyword" data-v-4b2fd967>new</span> <span class="token class-name" data-v-4b2fd967>THREE<span class="token punctuation" data-v-4b2fd967>.</span>PMREMGenerator</span><span class="token punctuation" data-v-4b2fd967>(</span> renderer <span class="token punctuation" data-v-4b2fd967>)</span><span class="token punctuation" data-v-4b2fd967>;</span>\n\n<span class="token keyword" data-v-4b2fd967>const</span> parameters <span class="token operator" data-v-4b2fd967>=</span> <span class="token punctuation" data-v-4b2fd967>{</span>\n\t<span class="token literal-property property" data-v-4b2fd967>elevation</span><span class="token operator" data-v-4b2fd967>:</span> <span class="token number" data-v-4b2fd967>2</span><span class="token punctuation" data-v-4b2fd967>,</span>\n\t<span class="token literal-property property" data-v-4b2fd967>azimuth</span><span class="token operator" data-v-4b2fd967>:</span> <span class="token number" data-v-4b2fd967>180</span>\n<span class="token punctuation" data-v-4b2fd967>}</span><span class="token punctuation" data-v-4b2fd967>;</span>\n<span class="token keyword" data-v-4b2fd967>let</span> renderTarget<span class="token punctuation" data-v-4b2fd967>;</span>\n<span class="token comment" data-v-4b2fd967>//根据当前的太阳方位和高度来更新天空和水面的着色，使其看起来仿佛是在现实世界中受到了真实的自然光照射。</span>\n<span class="token keyword" data-v-4b2fd967>function</span> <span class="token function" data-v-4b2fd967>updateSun</span><span class="token punctuation" data-v-4b2fd967>(</span><span class="token punctuation" data-v-4b2fd967>)</span> <span class="token punctuation" data-v-4b2fd967>{</span>\n  <span class="token comment" data-v-4b2fd967>//将 phi 和 theta 转换为弧度制</span>\n\t<span class="token keyword" data-v-4b2fd967>const</span> phi <span class="token operator" data-v-4b2fd967>=</span> <span class="token constant" data-v-4b2fd967>THREE</span><span class="token punctuation" data-v-4b2fd967>.</span>MathUtils<span class="token punctuation" data-v-4b2fd967>.</span><span class="token function" data-v-4b2fd967>degToRad</span><span class="token punctuation" data-v-4b2fd967>(</span> <span class="token number" data-v-4b2fd967>90</span> <span class="token operator" data-v-4b2fd967>-</span> parameters<span class="token punctuation" data-v-4b2fd967>.</span>elevation <span class="token punctuation" data-v-4b2fd967>)</span><span class="token punctuation" data-v-4b2fd967>;</span>\n\t<span class="token keyword" data-v-4b2fd967>const</span> theta <span class="token operator" data-v-4b2fd967>=</span> <span class="token constant" data-v-4b2fd967>THREE</span><span class="token punctuation" data-v-4b2fd967>.</span>MathUtils<span class="token punctuation" data-v-4b2fd967>.</span><span class="token function" data-v-4b2fd967>degToRad</span><span class="token punctuation" data-v-4b2fd967>(</span> parameters<span class="token punctuation" data-v-4b2fd967>.</span>azimuth <span class="token punctuation" data-v-4b2fd967>)</span><span class="token punctuation" data-v-4b2fd967>;</span>\n  <span class="token comment" data-v-4b2fd967>// 计算太阳位置</span>\n\tsun<span class="token punctuation" data-v-4b2fd967>.</span><span class="token function" data-v-4b2fd967>setFromSphericalCoords</span><span class="token punctuation" data-v-4b2fd967>(</span> <span class="token number" data-v-4b2fd967>1</span><span class="token punctuation" data-v-4b2fd967>,</span> phi<span class="token punctuation" data-v-4b2fd967>,</span> theta <span class="token punctuation" data-v-4b2fd967>)</span><span class="token punctuation" data-v-4b2fd967>;</span>\n  <span class="token comment" data-v-4b2fd967>// 将太阳位置应用到天空和水面</span>\n\tsky<span class="token punctuation" data-v-4b2fd967>.</span>material<span class="token punctuation" data-v-4b2fd967>.</span>uniforms<span class="token punctuation" data-v-4b2fd967>[</span> <span class="token string" data-v-4b2fd967>&#39;sunPosition&#39;</span> <span class="token punctuation" data-v-4b2fd967>]</span><span class="token punctuation" data-v-4b2fd967>.</span>value<span class="token punctuation" data-v-4b2fd967>.</span><span class="token function" data-v-4b2fd967>copy</span><span class="token punctuation" data-v-4b2fd967>(</span> sun <span class="token punctuation" data-v-4b2fd967>)</span><span class="token punctuation" data-v-4b2fd967>;</span>\n\twater<span class="token punctuation" data-v-4b2fd967>.</span>material<span class="token punctuation" data-v-4b2fd967>.</span>uniforms<span class="token punctuation" data-v-4b2fd967>[</span> <span class="token string" data-v-4b2fd967>&#39;sunDirection&#39;</span> <span class="token punctuation" data-v-4b2fd967>]</span><span class="token punctuation" data-v-4b2fd967>.</span>value<span class="token punctuation" data-v-4b2fd967>.</span><span class="token function" data-v-4b2fd967>copy</span><span class="token punctuation" data-v-4b2fd967>(</span> sun <span class="token punctuation" data-v-4b2fd967>)</span><span class="token punctuation" data-v-4b2fd967>.</span><span class="token function" data-v-4b2fd967>normalize</span><span class="token punctuation" data-v-4b2fd967>(</span><span class="token punctuation" data-v-4b2fd967>)</span><span class="token punctuation" data-v-4b2fd967>;</span>\n  <span class="token comment" data-v-4b2fd967>// 释放之前的渲染</span>\n\t<span class="token keyword" data-v-4b2fd967>if</span> <span class="token punctuation" data-v-4b2fd967>(</span> renderTarget <span class="token operator" data-v-4b2fd967>!==</span> <span class="token keyword" data-v-4b2fd967>undefined</span> <span class="token punctuation" data-v-4b2fd967>)</span> renderTarget<span class="token punctuation" data-v-4b2fd967>.</span><span class="token function" data-v-4b2fd967>dispose</span><span class="token punctuation" data-v-4b2fd967>(</span><span class="token punctuation" data-v-4b2fd967>)</span><span class="token punctuation" data-v-4b2fd967>;</span>\n  <span class="token comment" data-v-4b2fd967>//使用 fromScene 方法从 sky 中生成一个新的渲染目标对象。</span>\n  <span class="token comment" data-v-4b2fd967>//这个渲染目标对象是通过预计算辐射度环境贴图生成器 pmremGenerator 计算出来的</span>\n\trenderTarget <span class="token operator" data-v-4b2fd967>=</span> pmremGenerator<span class="token punctuation" data-v-4b2fd967>.</span><span class="token function" data-v-4b2fd967>fromScene</span><span class="token punctuation" data-v-4b2fd967>(</span> sky <span class="token punctuation" data-v-4b2fd967>)</span><span class="token punctuation" data-v-4b2fd967>;</span>\n  <span class="token comment" data-v-4b2fd967>//将渲染目标的材质设置为场景的环境贴图。</span>\n\tscene<span class="token punctuation" data-v-4b2fd967>.</span>environment <span class="token operator" data-v-4b2fd967>=</span> renderTarget<span class="token punctuation" data-v-4b2fd967>.</span>texture<span class="token punctuation" data-v-4b2fd967>;</span>\n<span class="token punctuation" data-v-4b2fd967>}</span>\n</code></pre><div class="line-numbers" aria-hidden="true" data-v-4b2fd967><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div><div class="line-number" data-v-4b2fd967></div></div></div>',1),f={__name:"threejs-water.html",setup(a){let n;const f=(0,d.iH)(),k=(0,d.iH)();return(0,t.bv)((async()=>{n=await s.e(464).then(s.bind(s,70464)),(()=>{const a=new e.xsS,n=new e.cPb(90,2,.1,1e3);n.position.set(5,5,5),a.add(n),(new o.x).loadAsync("/assets/textures/hdr/050.hdr").then((n=>{n.mapping=e.dSO,a.background=n,a.environment=n})),(new c.E).load("/assets/model/yugang.glb",(n=>{console.log(n);const s=n.scene.children[0];s.material.side=e.ehD;const t=n.scene.children[1].geometry,d=new l.B(t,{color:"#ffffff",scale:1,flowDirection:new e.FM8(1,1),textureHeight:1024,textureWidth:1024});a.add(d),a.add(s)}));const s=new e.Mig(16777215);s.intensity=10,a.add(s);const t=new e.Ox3(16777215,.5);a.add(t);const d=new e.CP7({alpha:!0,antialias:!0});d.outputEncoding=e.knz,d.toneMapping=e.LY2,d.setSize(f.value.offsetWidth,f.value.offsetWidth/2),window.addEventListener("resize",(()=>{d.setSize(f.value.offsetWidth,f.value.offsetWidth/2),d.setPixelRatio(window.devicePixelRatio)})),f.value.appendChild(d.domElement),new p.z(n,d.domElement).enableDamping=!0;const i=new e.SUY;!function s(t){i.getElapsedTime(),requestAnimationFrame(s),d.render(a,n)}()})(),(()=>{const a=new e.CP7;a.setSize(k.value.offsetWidth,k.value.offsetWidth/2),a.toneMapping=e.LY2,k.value.appendChild(a.domElement);const s=new e.xsS,t=new e.cPb(55,2,1,2e4);t.position.set(30,30,100);const d=new e.Pa4,o=new e._12(1e4,1e4),c=new i.B(o,{textureWidth:512,textureHeight:512,waterNormals:(new e.dpR).load("textures/waternormals.jpg",(function(a){a.wrapS=a.wrapT=e.rpg})),sunDirection:new e.Pa4,sunColor:16777215,waterColor:7695,distortionScale:3.7,fog:void 0!==s.fog});c.rotation.x=-Math.PI/2,s.add(c);const l=new v.q;l.scale.setScalar(1e4),s.add(l);const r=l.material.uniforms;r.turbidity.value=10,r.rayleigh.value=2,r.mieCoefficient.value=.005,r.mieDirectionalG.value=.8;const u={elevation:2,azimuth:180},b=new e.anP(a);let f;function m(){const a=e.M8C.degToRad(90-u.elevation),n=e.M8C.degToRad(u.azimuth);d.setFromSphericalCoords(1,a,n),l.material.uniforms.sunPosition.value.copy(d),c.material.uniforms.sunDirection.value.copy(d).normalize(),void 0!==f&&f.dispose(),f=b.fromScene(l),s.environment=f.texture}m();const y=new e.DvJ(30,30,30),w=new e.Wid({roughness:0}),h=new e.Kj0(y,w);s.add(h);const g=new p.z(t,a.domElement);g.maxPolarAngle=.495*Math.PI,g.target.set(0,10,0),g.minDistance=40,g.maxDistance=200,g.update();const E=new n.GUI;k.value.appendChild(E.domElement),E.domElement.style.position="absolute",E.domElement.style.top="0px",E.domElement.style.right="0px";const x=E.addFolder("Sky");x.add(u,"elevation",0,90,.1).onChange(m),x.add(u,"azimuth",-180,180,.1).onChange(m),x.open();const T=c.material.uniforms,R=E.addFolder("Water");R.add(T.distortionScale,"value",0,8,.1).name("distortionScale"),R.add(T.size,"value",.1,10,.1).name("size"),R.open(),window.addEventListener("resize",(function(){t.updateProjectionMatrix(),a.setSize(k.offsetWidth,k.offsetWidth/2)})),function n(){requestAnimationFrame(n),function(){const n=.001*performance.now();h.position.y=20*Math.sin(n)+5,h.rotation.x=.5*n,h.rotation.z=.51*n,c.material.uniforms.time.value+=1/60,a.render(s,t)}()}()})()})),(a,n)=>{const s=(0,t.up)("ExternalLinkIcon");return(0,t.wg)(),(0,t.iD)("div",null,[(0,t._)("p",null,[(0,t.Uk)("参考："),(0,t._)("a",r,[(0,t.Uk)("https://threejs.org/"),(0,t.Wm)(s)])]),u,(0,t._)("div",{ref_key:"waterRef",ref:f},null,512),b,(0,t._)("div",{ref_key:"oceanRef",ref:k,class:"ocean"},null,512)])}}},k=(0,s(61935).Z)(f,[["__scopeId","data-v-4b2fd967"]])},5097:(a,n,s)=>{s.r(n),s.d(n,{data:()=>t});const t=JSON.parse('{"key":"v-6c5eb1a9","path":"/threejs/threejs-water.html","title":"ThreeJS中的水","lang":"zh-CN","frontmatter":{"title":"ThreeJS中的水","category":["ThreeJS"],"date":"2022-02-22T00:00:00.000Z","summary":"参考：https://threejs.org/ import {ref,onMounted} from \'vue\' import * as THREE from \\"three\\"; import { OrbitControls } from \\"three/examples/jsm/controls/OrbitControls\\"; import { RGBELo","head":[["meta",{"property":"og:url","content":"https://luxiag.github.io/threejs/threejs-water.html"}],["meta",{"property":"og:title","content":"ThreeJS中的水"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:updated_time","content":"2023-04-27T03:25:07.000Z"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:published_time","content":"2022-02-22T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2023-04-27T03:25:07.000Z"}]]},"excerpt":"","headers":[],"git":{"createdTime":1681886614000,"updatedTime":1682565907000,"contributors":[{"name":"卢祥","email":"example@qq.com","commits":2}]},"readingTime":{"minutes":4.51,"words":1352},"filePathRelative":"threejs/threejs-water.md","localizedDate":"2022年2月22日"}')}}]);