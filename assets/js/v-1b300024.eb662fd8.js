"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[9552],{28707:(a,n,s)=>{s.r(n),s.d(n,{default:()=>m});var d=s(71534),t=s(32049),c=s(86171),e=s(97630),p=s(10628),o=s(84564),l=s(78896),i=s(61583),v=s(53654);const u={href:"https://threejs.org/",target:"_blank",rel:"noopener noreferrer"},f=(0,d.uE)('<div class="language-javascript line-numbers-mode" data-ext="js" data-v-2f8cdd90><pre class="language-javascript" data-v-2f8cdd90><code data-v-2f8cdd90><span class="token comment" data-v-2f8cdd90>//outline pass 创建高亮轮廓</span>\n<span class="token comment" data-v-2f8cdd90>// 创建 Outline Pass，传入轮廓边框的大小，场景以及相机</span>\n<span class="token keyword" data-v-2f8cdd90>const</span> outLinePass <span class="token operator" data-v-2f8cdd90>=</span> <span class="token keyword" data-v-2f8cdd90>new</span> <span class="token class-name" data-v-2f8cdd90>OutlinePass</span><span class="token punctuation" data-v-2f8cdd90>(</span>\n  <span class="token keyword" data-v-2f8cdd90>new</span> <span class="token class-name" data-v-2f8cdd90>THREE<span class="token punctuation" data-v-2f8cdd90>.</span>Vector2</span><span class="token punctuation" data-v-2f8cdd90>(</span>outLine<span class="token punctuation" data-v-2f8cdd90>.</span>value<span class="token punctuation" data-v-2f8cdd90>.</span>offsetWidth<span class="token punctuation" data-v-2f8cdd90>,</span>outLine<span class="token punctuation" data-v-2f8cdd90>.</span>value<span class="token punctuation" data-v-2f8cdd90>.</span>offsetWidth<span class="token operator" data-v-2f8cdd90>/</span><span class="token number" data-v-2f8cdd90>2</span><span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>,</span> <span class="token comment" data-v-2f8cdd90>// 轮廓边框大小</span>\n  scene<span class="token punctuation" data-v-2f8cdd90>,</span> <span class="token comment" data-v-2f8cdd90>// 场景</span>\n  camera <span class="token comment" data-v-2f8cdd90>// 相机</span>\n<span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\n<span class="token comment" data-v-2f8cdd90>// 设置轮廓边框的强度</span>\noutLinePass<span class="token punctuation" data-v-2f8cdd90>.</span>edgeStrength <span class="token operator" data-v-2f8cdd90>=</span> <span class="token number" data-v-2f8cdd90>3</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\n<span class="token comment" data-v-2f8cdd90>// 设置轮廓边框的炫光强度</span>\noutLinePass<span class="token punctuation" data-v-2f8cdd90>.</span>edgeGlow <span class="token operator" data-v-2f8cdd90>=</span> <span class="token number" data-v-2f8cdd90>2</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\n<span class="token comment" data-v-2f8cdd90>// 设置轮廓边框的粗细</span>\noutLinePass<span class="token punctuation" data-v-2f8cdd90>.</span>edgeThickness <span class="token operator" data-v-2f8cdd90>=</span> <span class="token number" data-v-2f8cdd90>3</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\n<span class="token comment" data-v-2f8cdd90>// 设置轮廓边框的动画效果周期（单位为秒）</span>\noutLinePass<span class="token punctuation" data-v-2f8cdd90>.</span>pulsePeriod <span class="token operator" data-v-2f8cdd90>=</span> <span class="token number" data-v-2f8cdd90>2</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\n<span class="token comment" data-v-2f8cdd90>// 设置需要进行轮廓边框高亮的物体，这里只选择了一个 torusKnot</span>\noutLinePass<span class="token punctuation" data-v-2f8cdd90>.</span>selectedObjects <span class="token operator" data-v-2f8cdd90>=</span> <span class="token punctuation" data-v-2f8cdd90>[</span>torusKnot<span class="token punctuation" data-v-2f8cdd90>]</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\n<span class="token comment" data-v-2f8cdd90>// 将 Outline Pass 添加到渲染的 Pass 中</span>\ncomposer<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>addPass</span><span class="token punctuation" data-v-2f8cdd90>(</span>outLinePass<span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\n<span class="token comment" data-v-2f8cdd90>// renderPass</span>\n<span class="token comment" data-v-2f8cdd90>/*\nRenderPass 是 Three.js 中的一个渲染器通道，它用于将场景中的一部分物体单独渲染到屏幕上。RenderPass 可以用于实现多种效果，\n例如描边（Outline）、后期处理（Post-processing）、阴影等。\n\nRenderer 是 Three.js 中的渲染器，它是实现 Three.js 渲染功能的核心组件。\nRenderer 主要负责将场景中的对象转换成可视图像，并输出到屏幕或者图片等媒介上。它支持多种渲染方式，例如 Canvas、WebGL、SVG等。\n\n简单来讲，RenderPass 是 Renderer 的一种子组件，它主要用于实现某些特殊效果的渲染流程，\n而 Renderer 则是 Three.js 的主渲染器，它负责将所有物体渲染到屏幕上或其他媒介上。\n*/</span>\n<span class="token comment" data-v-2f8cdd90>//EffectComposer</span>\n<span class="token comment" data-v-2f8cdd90>/*\nEffectComposer 是 Three.js 中用于实现后期处理（post-processing）效果的函数。\n它可以将场景、相机和渲染器作为参数，并且可以将不同的 RenderPass 串联起来，形成连续的后期处理效果。\n具体来说，EffectComposer 中会包含多个用于控制后期处理流程的渲染通道，如 RenderPass、ShaderPass 等。\n\n实现后期处理效果一般需要多次渲染，其中第一次是将场景渲染到纹理（render-to-texture）中，然后应用渲染通道，最终将结果渲染到屏幕上。\n\n*/</span>\n<span class="token keyword" data-v-2f8cdd90>const</span> composer <span class="token operator" data-v-2f8cdd90>=</span> <span class="token keyword" data-v-2f8cdd90>new</span> <span class="token class-name" data-v-2f8cdd90>EffectComposer</span><span class="token punctuation" data-v-2f8cdd90>(</span>renderer<span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\ncomposer<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>setSize</span><span class="token punctuation" data-v-2f8cdd90>(</span>outLine<span class="token punctuation" data-v-2f8cdd90>.</span>value<span class="token punctuation" data-v-2f8cdd90>.</span>offsetWidth<span class="token punctuation" data-v-2f8cdd90>,</span>outLine<span class="token punctuation" data-v-2f8cdd90>.</span>value<span class="token punctuation" data-v-2f8cdd90>.</span>offsetWidth<span class="token operator" data-v-2f8cdd90>/</span><span class="token number" data-v-2f8cdd90>2</span><span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n<span class="token keyword" data-v-2f8cdd90>const</span> renderPass <span class="token operator" data-v-2f8cdd90>=</span> <span class="token keyword" data-v-2f8cdd90>new</span> <span class="token class-name" data-v-2f8cdd90>RenderPass</span><span class="token punctuation" data-v-2f8cdd90>(</span>scene<span class="token punctuation" data-v-2f8cdd90>,</span> camera<span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\ncomposer<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>addPass</span><span class="token punctuation" data-v-2f8cdd90>(</span>renderPass<span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\ncomposer<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>render</span><span class="token punctuation" data-v-2f8cdd90>(</span><span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n</code></pre><div class="line-numbers" aria-hidden="true" data-v-2f8cdd90><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div></div></div>',1),r=(0,d.uE)('<p data-v-2f8cdd90><code data-v-2f8cdd90>UnrealBloomPass</code> 实现逼真的bloom（即景物周围余晖）效果</p><ul data-v-2f8cdd90><li data-v-2f8cdd90><code data-v-2f8cdd90>new THREE.Vector2( window.innerWidth, window.innerHeight )</code>：表示渲染的分辨率大小。</li><li data-v-2f8cdd90><code data-v-2f8cdd90>strength</code>：效果强度，默认值为1。</li><li data-v-2f8cdd90><code data-v-2f8cdd90>radius</code>：半径大小，默认值为0。</li><li data-v-2f8cdd90><code data-v-2f8cdd90>threshold</code>：阈值大小，影响只有高于这个值的颜色才会产生bloom效果，默认值为0。</li></ul><div class="language-javascript line-numbers-mode" data-ext="js" data-v-2f8cdd90><pre class="language-javascript" data-v-2f8cdd90><code data-v-2f8cdd90><span class="token comment" data-v-2f8cdd90>// 定义两个场景用于渲染全屏普通场景和只有发光效果的场景</span>\n<span class="token keyword" data-v-2f8cdd90>const</span> <span class="token constant" data-v-2f8cdd90>ENTIRE_SCENE</span> <span class="token operator" data-v-2f8cdd90>=</span> <span class="token number" data-v-2f8cdd90>0</span><span class="token punctuation" data-v-2f8cdd90>,</span> <span class="token constant" data-v-2f8cdd90>BLOOM_SCENE</span> <span class="token operator" data-v-2f8cdd90>=</span> <span class="token number" data-v-2f8cdd90>1</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n<span class="token comment" data-v-2f8cdd90>// 定义一个全局变量，用于标识需要渲染发光效果的物体</span>\n<span class="token keyword" data-v-2f8cdd90>const</span> bloomLayer <span class="token operator" data-v-2f8cdd90>=</span> <span class="token keyword" data-v-2f8cdd90>new</span> <span class="token class-name" data-v-2f8cdd90>THREE<span class="token punctuation" data-v-2f8cdd90>.</span>Layers</span><span class="token punctuation" data-v-2f8cdd90>(</span><span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\nbloomLayer<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>set</span><span class="token punctuation" data-v-2f8cdd90>(</span> <span class="token constant" data-v-2f8cdd90>BLOOM_SCENE</span> <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\n<span class="token comment" data-v-2f8cdd90>// 定义一个黑色材质，用于替换发光物体原来的材质</span>\n<span class="token keyword" data-v-2f8cdd90>const</span> darkMaterial <span class="token operator" data-v-2f8cdd90>=</span> <span class="token keyword" data-v-2f8cdd90>new</span> <span class="token class-name" data-v-2f8cdd90>THREE<span class="token punctuation" data-v-2f8cdd90>.</span>MeshBasicMaterial</span><span class="token punctuation" data-v-2f8cdd90>(</span> <span class="token punctuation" data-v-2f8cdd90>{</span> <span class="token literal-property property" data-v-2f8cdd90>color</span><span class="token operator" data-v-2f8cdd90>:</span> <span class="token string" data-v-2f8cdd90>&#39;black&#39;</span> <span class="token punctuation" data-v-2f8cdd90>}</span> <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n<span class="token keyword" data-v-2f8cdd90>const</span> materials <span class="token operator" data-v-2f8cdd90>=</span> <span class="token punctuation" data-v-2f8cdd90>{</span><span class="token punctuation" data-v-2f8cdd90>}</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\n<span class="token comment" data-v-2f8cdd90>// 定义后期处理参数</span>\n<span class="token keyword" data-v-2f8cdd90>const</span> params <span class="token operator" data-v-2f8cdd90>=</span> <span class="token punctuation" data-v-2f8cdd90>{</span>\n\t<span class="token literal-property property" data-v-2f8cdd90>exposure</span><span class="token operator" data-v-2f8cdd90>:</span> <span class="token number" data-v-2f8cdd90>1</span><span class="token punctuation" data-v-2f8cdd90>,</span> <span class="token comment" data-v-2f8cdd90>// 曝光度</span>\n\t<span class="token literal-property property" data-v-2f8cdd90>bloomStrength</span><span class="token operator" data-v-2f8cdd90>:</span> <span class="token number" data-v-2f8cdd90>5</span><span class="token punctuation" data-v-2f8cdd90>,</span> <span class="token comment" data-v-2f8cdd90>// 发光强度</span>\n\t<span class="token literal-property property" data-v-2f8cdd90>bloomThreshold</span><span class="token operator" data-v-2f8cdd90>:</span> <span class="token number" data-v-2f8cdd90>0</span><span class="token punctuation" data-v-2f8cdd90>,</span> <span class="token comment" data-v-2f8cdd90>// 亮度阈值，用于发光对象的选择</span>\n\t<span class="token literal-property property" data-v-2f8cdd90>bloomRadius</span><span class="token operator" data-v-2f8cdd90>:</span> <span class="token number" data-v-2f8cdd90>0</span><span class="token punctuation" data-v-2f8cdd90>,</span> <span class="token comment" data-v-2f8cdd90>// 发光的扩散半径</span>\n\t<span class="token literal-property property" data-v-2f8cdd90>scene</span><span class="token operator" data-v-2f8cdd90>:</span> <span class="token string" data-v-2f8cdd90>&#39;Scene with Glow&#39;</span> <span class="token comment" data-v-2f8cdd90>// 默认场景类型</span>\n<span class="token punctuation" data-v-2f8cdd90>}</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n<span class="token comment" data-v-2f8cdd90>// 创建 UnrealBloomPass 后期处理器，用于实现物体发光效果</span>\n<span class="token keyword" data-v-2f8cdd90>const</span> bloomPass <span class="token operator" data-v-2f8cdd90>=</span> <span class="token keyword" data-v-2f8cdd90>new</span> <span class="token class-name" data-v-2f8cdd90>UnrealBloomPass</span><span class="token punctuation" data-v-2f8cdd90>(</span> <span class="token keyword" data-v-2f8cdd90>new</span> <span class="token class-name" data-v-2f8cdd90>THREE<span class="token punctuation" data-v-2f8cdd90>.</span>Vector2</span><span class="token punctuation" data-v-2f8cdd90>(</span> window<span class="token punctuation" data-v-2f8cdd90>.</span>innerWidth<span class="token punctuation" data-v-2f8cdd90>,</span> window<span class="token punctuation" data-v-2f8cdd90>.</span>innerHeight <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>,</span> <span class="token number" data-v-2f8cdd90>1.5</span><span class="token punctuation" data-v-2f8cdd90>,</span> <span class="token number" data-v-2f8cdd90>0.4</span><span class="token punctuation" data-v-2f8cdd90>,</span> <span class="token number" data-v-2f8cdd90>0.85</span> <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\nbloomPass<span class="token punctuation" data-v-2f8cdd90>.</span>threshold <span class="token operator" data-v-2f8cdd90>=</span> params<span class="token punctuation" data-v-2f8cdd90>.</span>bloomThreshold<span class="token punctuation" data-v-2f8cdd90>;</span>\nbloomPass<span class="token punctuation" data-v-2f8cdd90>.</span>strength <span class="token operator" data-v-2f8cdd90>=</span> params<span class="token punctuation" data-v-2f8cdd90>.</span>bloomStrength<span class="token punctuation" data-v-2f8cdd90>;</span>\nbloomPass<span class="token punctuation" data-v-2f8cdd90>.</span>radius <span class="token operator" data-v-2f8cdd90>=</span> params<span class="token punctuation" data-v-2f8cdd90>.</span>bloomRadius<span class="token punctuation" data-v-2f8cdd90>;</span>\n\n<span class="token comment" data-v-2f8cdd90>// 创建一个普通场景渲染器</span>\n<span class="token keyword" data-v-2f8cdd90>const</span> renderScene <span class="token operator" data-v-2f8cdd90>=</span> <span class="token keyword" data-v-2f8cdd90>new</span> <span class="token class-name" data-v-2f8cdd90>RenderPass</span><span class="token punctuation" data-v-2f8cdd90>(</span> scene<span class="token punctuation" data-v-2f8cdd90>,</span> camera <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\n<span class="token comment" data-v-2f8cdd90>// 创建渲染器，用于渲染只有发光效果的场景</span>\n<span class="token keyword" data-v-2f8cdd90>const</span> bloomComposer <span class="token operator" data-v-2f8cdd90>=</span> <span class="token keyword" data-v-2f8cdd90>new</span> <span class="token class-name" data-v-2f8cdd90>EffectComposer</span><span class="token punctuation" data-v-2f8cdd90>(</span> renderer <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\nbloomComposer<span class="token punctuation" data-v-2f8cdd90>.</span>renderToScreen <span class="token operator" data-v-2f8cdd90>=</span> <span class="token boolean" data-v-2f8cdd90>false</span><span class="token punctuation" data-v-2f8cdd90>;</span>\nbloomComposer<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>addPass</span><span class="token punctuation" data-v-2f8cdd90>(</span> renderScene <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\nbloomComposer<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>addPass</span><span class="token punctuation" data-v-2f8cdd90>(</span> bloomPass <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\n<span class="token comment" data-v-2f8cdd90>// 初始化场景</span>\n<span class="token keyword" data-v-2f8cdd90>function</span> <span class="token function" data-v-2f8cdd90>setupScene</span><span class="token punctuation" data-v-2f8cdd90>(</span><span class="token punctuation" data-v-2f8cdd90>)</span> <span class="token punctuation" data-v-2f8cdd90>{</span>\n\tscene<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>traverse</span><span class="token punctuation" data-v-2f8cdd90>(</span> disposeMaterial <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\tscene<span class="token punctuation" data-v-2f8cdd90>.</span>children<span class="token punctuation" data-v-2f8cdd90>.</span>length <span class="token operator" data-v-2f8cdd90>=</span> <span class="token number" data-v-2f8cdd90>0</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\n\t<span class="token keyword" data-v-2f8cdd90>const</span> geometry <span class="token operator" data-v-2f8cdd90>=</span> <span class="token keyword" data-v-2f8cdd90>new</span> <span class="token class-name" data-v-2f8cdd90>THREE<span class="token punctuation" data-v-2f8cdd90>.</span>IcosahedronGeometry</span><span class="token punctuation" data-v-2f8cdd90>(</span> <span class="token number" data-v-2f8cdd90>1</span><span class="token punctuation" data-v-2f8cdd90>,</span> <span class="token number" data-v-2f8cdd90>15</span> <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\n\t<span class="token keyword" data-v-2f8cdd90>for</span> <span class="token punctuation" data-v-2f8cdd90>(</span> <span class="token keyword" data-v-2f8cdd90>let</span> i <span class="token operator" data-v-2f8cdd90>=</span> <span class="token number" data-v-2f8cdd90>0</span><span class="token punctuation" data-v-2f8cdd90>;</span> i <span class="token operator" data-v-2f8cdd90>&lt;</span> <span class="token number" data-v-2f8cdd90>50</span><span class="token punctuation" data-v-2f8cdd90>;</span> i <span class="token operator" data-v-2f8cdd90>++</span> <span class="token punctuation" data-v-2f8cdd90>)</span> <span class="token punctuation" data-v-2f8cdd90>{</span>\n\t\t<span class="token keyword" data-v-2f8cdd90>const</span> color <span class="token operator" data-v-2f8cdd90>=</span> <span class="token keyword" data-v-2f8cdd90>new</span> <span class="token class-name" data-v-2f8cdd90>THREE<span class="token punctuation" data-v-2f8cdd90>.</span>Color</span><span class="token punctuation" data-v-2f8cdd90>(</span><span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t\tcolor<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>setHSL</span><span class="token punctuation" data-v-2f8cdd90>(</span> Math<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>random</span><span class="token punctuation" data-v-2f8cdd90>(</span><span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>,</span> <span class="token number" data-v-2f8cdd90>0.7</span><span class="token punctuation" data-v-2f8cdd90>,</span> Math<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>random</span><span class="token punctuation" data-v-2f8cdd90>(</span><span class="token punctuation" data-v-2f8cdd90>)</span> <span class="token operator" data-v-2f8cdd90>*</span> <span class="token number" data-v-2f8cdd90>0.2</span> <span class="token operator" data-v-2f8cdd90>+</span> <span class="token number" data-v-2f8cdd90>0.05</span> <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\n\t\t<span class="token keyword" data-v-2f8cdd90>const</span> material <span class="token operator" data-v-2f8cdd90>=</span> <span class="token keyword" data-v-2f8cdd90>new</span> <span class="token class-name" data-v-2f8cdd90>THREE<span class="token punctuation" data-v-2f8cdd90>.</span>MeshBasicMaterial</span><span class="token punctuation" data-v-2f8cdd90>(</span> <span class="token punctuation" data-v-2f8cdd90>{</span> <span class="token literal-property property" data-v-2f8cdd90>color</span><span class="token operator" data-v-2f8cdd90>:</span> color <span class="token punctuation" data-v-2f8cdd90>}</span> <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t\t<span class="token keyword" data-v-2f8cdd90>const</span> sphere <span class="token operator" data-v-2f8cdd90>=</span> <span class="token keyword" data-v-2f8cdd90>new</span> <span class="token class-name" data-v-2f8cdd90>THREE<span class="token punctuation" data-v-2f8cdd90>.</span>Mesh</span><span class="token punctuation" data-v-2f8cdd90>(</span> geometry<span class="token punctuation" data-v-2f8cdd90>,</span> material <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t\tsphere<span class="token punctuation" data-v-2f8cdd90>.</span>position<span class="token punctuation" data-v-2f8cdd90>.</span>x <span class="token operator" data-v-2f8cdd90>=</span> Math<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>random</span><span class="token punctuation" data-v-2f8cdd90>(</span><span class="token punctuation" data-v-2f8cdd90>)</span> <span class="token operator" data-v-2f8cdd90>*</span> <span class="token number" data-v-2f8cdd90>10</span> <span class="token operator" data-v-2f8cdd90>-</span> <span class="token number" data-v-2f8cdd90>5</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t\tsphere<span class="token punctuation" data-v-2f8cdd90>.</span>position<span class="token punctuation" data-v-2f8cdd90>.</span>y <span class="token operator" data-v-2f8cdd90>=</span> Math<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>random</span><span class="token punctuation" data-v-2f8cdd90>(</span><span class="token punctuation" data-v-2f8cdd90>)</span> <span class="token operator" data-v-2f8cdd90>*</span> <span class="token number" data-v-2f8cdd90>10</span> <span class="token operator" data-v-2f8cdd90>-</span> <span class="token number" data-v-2f8cdd90>5</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t\tsphere<span class="token punctuation" data-v-2f8cdd90>.</span>position<span class="token punctuation" data-v-2f8cdd90>.</span>z <span class="token operator" data-v-2f8cdd90>=</span> Math<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>random</span><span class="token punctuation" data-v-2f8cdd90>(</span><span class="token punctuation" data-v-2f8cdd90>)</span> <span class="token operator" data-v-2f8cdd90>*</span> <span class="token number" data-v-2f8cdd90>10</span> <span class="token operator" data-v-2f8cdd90>-</span> <span class="token number" data-v-2f8cdd90>5</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t\tsphere<span class="token punctuation" data-v-2f8cdd90>.</span>position<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>normalize</span><span class="token punctuation" data-v-2f8cdd90>(</span><span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>multiplyScalar</span><span class="token punctuation" data-v-2f8cdd90>(</span> Math<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>random</span><span class="token punctuation" data-v-2f8cdd90>(</span><span class="token punctuation" data-v-2f8cdd90>)</span> <span class="token operator" data-v-2f8cdd90>*</span> <span class="token number" data-v-2f8cdd90>4.0</span> <span class="token operator" data-v-2f8cdd90>+</span> <span class="token number" data-v-2f8cdd90>2.0</span> <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t\tsphere<span class="token punctuation" data-v-2f8cdd90>.</span>scale<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>setScalar</span><span class="token punctuation" data-v-2f8cdd90>(</span> Math<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>random</span><span class="token punctuation" data-v-2f8cdd90>(</span><span class="token punctuation" data-v-2f8cdd90>)</span> <span class="token operator" data-v-2f8cdd90>*</span> Math<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>random</span><span class="token punctuation" data-v-2f8cdd90>(</span><span class="token punctuation" data-v-2f8cdd90>)</span> <span class="token operator" data-v-2f8cdd90>+</span> <span class="token number" data-v-2f8cdd90>0.5</span> <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t\tscene<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>add</span><span class="token punctuation" data-v-2f8cdd90>(</span> sphere <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t\t<span class="token keyword" data-v-2f8cdd90>if</span> <span class="token punctuation" data-v-2f8cdd90>(</span> Math<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>random</span><span class="token punctuation" data-v-2f8cdd90>(</span><span class="token punctuation" data-v-2f8cdd90>)</span> <span class="token operator" data-v-2f8cdd90>&lt;</span> <span class="token number" data-v-2f8cdd90>0.25</span> <span class="token punctuation" data-v-2f8cdd90>)</span> sphere<span class="token punctuation" data-v-2f8cdd90>.</span>layers<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>enable</span><span class="token punctuation" data-v-2f8cdd90>(</span> <span class="token constant" data-v-2f8cdd90>BLOOM_SCENE</span> <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t<span class="token punctuation" data-v-2f8cdd90>}</span>\n\n\t<span class="token function" data-v-2f8cdd90>render</span><span class="token punctuation" data-v-2f8cdd90>(</span><span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n<span class="token punctuation" data-v-2f8cdd90>}</span>\n\n<span class="token comment" data-v-2f8cdd90>// 渲染发光效果</span>\n<span class="token keyword" data-v-2f8cdd90>function</span> <span class="token function" data-v-2f8cdd90>render</span><span class="token punctuation" data-v-2f8cdd90>(</span>  <span class="token punctuation" data-v-2f8cdd90>)</span> <span class="token punctuation" data-v-2f8cdd90>{</span>\n\t\tcamera<span class="token punctuation" data-v-2f8cdd90>.</span>layers<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>set</span><span class="token punctuation" data-v-2f8cdd90>(</span> <span class="token constant" data-v-2f8cdd90>BLOOM_SCENE</span> <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t\tbloomComposer<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>render</span><span class="token punctuation" data-v-2f8cdd90>(</span><span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t\tcamera<span class="token punctuation" data-v-2f8cdd90>.</span>layers<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>set</span><span class="token punctuation" data-v-2f8cdd90>(</span> <span class="token constant" data-v-2f8cdd90>ENTIRE_SCENE</span> <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n<span class="token punctuation" data-v-2f8cdd90>}</span>\n<span class="token keyword" data-v-2f8cdd90>function</span> <span class="token function" data-v-2f8cdd90>onPointerDown</span><span class="token punctuation" data-v-2f8cdd90>(</span> <span class="token parameter" data-v-2f8cdd90>event</span> <span class="token punctuation" data-v-2f8cdd90>)</span> <span class="token punctuation" data-v-2f8cdd90>{</span>\n\tmouse<span class="token punctuation" data-v-2f8cdd90>.</span>x <span class="token operator" data-v-2f8cdd90>=</span> <span class="token punctuation" data-v-2f8cdd90>(</span> event<span class="token punctuation" data-v-2f8cdd90>.</span>clientX <span class="token operator" data-v-2f8cdd90>/</span> window<span class="token punctuation" data-v-2f8cdd90>.</span>innerWidth <span class="token punctuation" data-v-2f8cdd90>)</span> <span class="token operator" data-v-2f8cdd90>*</span> <span class="token number" data-v-2f8cdd90>2</span> <span class="token operator" data-v-2f8cdd90>-</span> <span class="token number" data-v-2f8cdd90>1</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\tmouse<span class="token punctuation" data-v-2f8cdd90>.</span>y <span class="token operator" data-v-2f8cdd90>=</span> <span class="token operator" data-v-2f8cdd90>-</span> <span class="token punctuation" data-v-2f8cdd90>(</span> event<span class="token punctuation" data-v-2f8cdd90>.</span>clientY <span class="token operator" data-v-2f8cdd90>/</span> window<span class="token punctuation" data-v-2f8cdd90>.</span>innerHeight <span class="token punctuation" data-v-2f8cdd90>)</span> <span class="token operator" data-v-2f8cdd90>*</span> <span class="token number" data-v-2f8cdd90>2</span> <span class="token operator" data-v-2f8cdd90>+</span> <span class="token number" data-v-2f8cdd90>1</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\traycaster<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>setFromCamera</span><span class="token punctuation" data-v-2f8cdd90>(</span> mouse<span class="token punctuation" data-v-2f8cdd90>,</span> camera <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t<span class="token keyword" data-v-2f8cdd90>const</span> intersects <span class="token operator" data-v-2f8cdd90>=</span> raycaster<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>intersectObjects</span><span class="token punctuation" data-v-2f8cdd90>(</span> scene<span class="token punctuation" data-v-2f8cdd90>.</span>children<span class="token punctuation" data-v-2f8cdd90>,</span> <span class="token boolean" data-v-2f8cdd90>false</span> <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t<span class="token keyword" data-v-2f8cdd90>if</span> <span class="token punctuation" data-v-2f8cdd90>(</span> intersects<span class="token punctuation" data-v-2f8cdd90>.</span>length <span class="token operator" data-v-2f8cdd90>&gt;</span> <span class="token number" data-v-2f8cdd90>0</span> <span class="token punctuation" data-v-2f8cdd90>)</span> <span class="token punctuation" data-v-2f8cdd90>{</span>\n\t\t<span class="token keyword" data-v-2f8cdd90>const</span> object <span class="token operator" data-v-2f8cdd90>=</span> intersects<span class="token punctuation" data-v-2f8cdd90>[</span> <span class="token number" data-v-2f8cdd90>0</span> <span class="token punctuation" data-v-2f8cdd90>]</span><span class="token punctuation" data-v-2f8cdd90>.</span>object<span class="token punctuation" data-v-2f8cdd90>;</span>\n\t\tobject<span class="token punctuation" data-v-2f8cdd90>.</span>layers<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>toggle</span><span class="token punctuation" data-v-2f8cdd90>(</span> <span class="token constant" data-v-2f8cdd90>BLOOM_SCENE</span> <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t\t<span class="token function" data-v-2f8cdd90>render</span><span class="token punctuation" data-v-2f8cdd90>(</span><span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t<span class="token punctuation" data-v-2f8cdd90>}</span>\n<span class="token punctuation" data-v-2f8cdd90>}</span>\n<span class="token comment" data-v-2f8cdd90>//渲染不同的场景</span>\n<span class="token comment" data-v-2f8cdd90>//</span>\n<span class="token comment" data-v-2f8cdd90>// 渲染函数，根据 params 中定义的场景类型选择不同的渲染方式</span>\n<span class="token keyword" data-v-2f8cdd90>function</span> <span class="token function" data-v-2f8cdd90>render</span><span class="token punctuation" data-v-2f8cdd90>(</span><span class="token punctuation" data-v-2f8cdd90>)</span> <span class="token punctuation" data-v-2f8cdd90>{</span>\n\t<span class="token keyword" data-v-2f8cdd90>switch</span> <span class="token punctuation" data-v-2f8cdd90>(</span> params<span class="token punctuation" data-v-2f8cdd90>.</span>scene <span class="token punctuation" data-v-2f8cdd90>)</span> <span class="token punctuation" data-v-2f8cdd90>{</span>\n\t\t<span class="token keyword" data-v-2f8cdd90>case</span> <span class="token string" data-v-2f8cdd90>&#39;Scene only&#39;</span><span class="token operator" data-v-2f8cdd90>:</span>\n\t\t\trenderer<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>render</span><span class="token punctuation" data-v-2f8cdd90>(</span> scene<span class="token punctuation" data-v-2f8cdd90>,</span> camera <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t\t\t<span class="token keyword" data-v-2f8cdd90>break</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t\t<span class="token keyword" data-v-2f8cdd90>case</span> <span class="token string" data-v-2f8cdd90>&#39;Glow only&#39;</span><span class="token operator" data-v-2f8cdd90>:</span>\n\t\t\t<span class="token function" data-v-2f8cdd90>renderBloom</span><span class="token punctuation" data-v-2f8cdd90>(</span> <span class="token boolean" data-v-2f8cdd90>false</span> <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t\t\t<span class="token keyword" data-v-2f8cdd90>break</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t\t<span class="token keyword" data-v-2f8cdd90>case</span> <span class="token string" data-v-2f8cdd90>&#39;Scene with Glow&#39;</span><span class="token operator" data-v-2f8cdd90>:</span>\n\t\t<span class="token keyword" data-v-2f8cdd90>default</span><span class="token operator" data-v-2f8cdd90>:</span>\n\t\t\t<span class="token comment" data-v-2f8cdd90>// render scene with bloom</span>\n\t\t\t<span class="token function" data-v-2f8cdd90>renderBloom</span><span class="token punctuation" data-v-2f8cdd90>(</span> <span class="token boolean" data-v-2f8cdd90>true</span> <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\n\t\t\t<span class="token comment" data-v-2f8cdd90>// render the entire scene, then render bloom scene on top</span>\n\t\t\tfinalComposer<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>render</span><span class="token punctuation" data-v-2f8cdd90>(</span><span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t\t\t<span class="token keyword" data-v-2f8cdd90>break</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t<span class="token punctuation" data-v-2f8cdd90>}</span>\n<span class="token punctuation" data-v-2f8cdd90>}</span>\n<span class="token comment" data-v-2f8cdd90>// 渲染发光效果</span>\n<span class="token keyword" data-v-2f8cdd90>function</span> <span class="token function" data-v-2f8cdd90>renderBloom</span><span class="token punctuation" data-v-2f8cdd90>(</span> <span class="token parameter" data-v-2f8cdd90>mask</span> <span class="token punctuation" data-v-2f8cdd90>)</span> <span class="token punctuation" data-v-2f8cdd90>{</span>\n\t<span class="token keyword" data-v-2f8cdd90>if</span> <span class="token punctuation" data-v-2f8cdd90>(</span> mask <span class="token operator" data-v-2f8cdd90>===</span> <span class="token boolean" data-v-2f8cdd90>true</span> <span class="token punctuation" data-v-2f8cdd90>)</span> <span class="token punctuation" data-v-2f8cdd90>{</span> <span class="token comment" data-v-2f8cdd90>// 只渲染发光物体</span>\n\t\tscene<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>traverse</span><span class="token punctuation" data-v-2f8cdd90>(</span> darkenNonBloomed <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t\tbloomComposer<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>render</span><span class="token punctuation" data-v-2f8cdd90>(</span><span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t\tscene<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>traverse</span><span class="token punctuation" data-v-2f8cdd90>(</span> restoreMaterial <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t<span class="token punctuation" data-v-2f8cdd90>}</span> <span class="token keyword" data-v-2f8cdd90>else</span> <span class="token punctuation" data-v-2f8cdd90>{</span> <span class="token comment" data-v-2f8cdd90>// 渲染整个场景包括发光效果</span>\n\t\tcamera<span class="token punctuation" data-v-2f8cdd90>.</span>layers<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>set</span><span class="token punctuation" data-v-2f8cdd90>(</span> <span class="token constant" data-v-2f8cdd90>BLOOM_SCENE</span> <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t\tbloomComposer<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>render</span><span class="token punctuation" data-v-2f8cdd90>(</span><span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t\tcamera<span class="token punctuation" data-v-2f8cdd90>.</span>layers<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>set</span><span class="token punctuation" data-v-2f8cdd90>(</span> <span class="token constant" data-v-2f8cdd90>ENTIRE_SCENE</span> <span class="token punctuation" data-v-2f8cdd90>)</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t<span class="token punctuation" data-v-2f8cdd90>}</span>\n<span class="token punctuation" data-v-2f8cdd90>}</span>\n<span class="token keyword" data-v-2f8cdd90>function</span> <span class="token function" data-v-2f8cdd90>darkenNonBloomed</span><span class="token punctuation" data-v-2f8cdd90>(</span> <span class="token parameter" data-v-2f8cdd90>obj</span> <span class="token punctuation" data-v-2f8cdd90>)</span> <span class="token punctuation" data-v-2f8cdd90>{</span>\n\t<span class="token keyword" data-v-2f8cdd90>if</span> <span class="token punctuation" data-v-2f8cdd90>(</span> obj<span class="token punctuation" data-v-2f8cdd90>.</span>isMesh <span class="token operator" data-v-2f8cdd90>&amp;&amp;</span> bloomLayer<span class="token punctuation" data-v-2f8cdd90>.</span><span class="token function" data-v-2f8cdd90>test</span><span class="token punctuation" data-v-2f8cdd90>(</span> obj<span class="token punctuation" data-v-2f8cdd90>.</span>layers <span class="token punctuation" data-v-2f8cdd90>)</span> <span class="token operator" data-v-2f8cdd90>===</span> <span class="token boolean" data-v-2f8cdd90>false</span> <span class="token punctuation" data-v-2f8cdd90>)</span> <span class="token punctuation" data-v-2f8cdd90>{</span>\n\t\tmaterials<span class="token punctuation" data-v-2f8cdd90>[</span> obj<span class="token punctuation" data-v-2f8cdd90>.</span>uuid <span class="token punctuation" data-v-2f8cdd90>]</span> <span class="token operator" data-v-2f8cdd90>=</span> obj<span class="token punctuation" data-v-2f8cdd90>.</span>material<span class="token punctuation" data-v-2f8cdd90>;</span>\n\t\tobj<span class="token punctuation" data-v-2f8cdd90>.</span>material <span class="token operator" data-v-2f8cdd90>=</span> darkMaterial<span class="token punctuation" data-v-2f8cdd90>;</span>\n\t<span class="token punctuation" data-v-2f8cdd90>}</span>\n<span class="token punctuation" data-v-2f8cdd90>}</span>\n<span class="token keyword" data-v-2f8cdd90>function</span> <span class="token function" data-v-2f8cdd90>restoreMaterial</span><span class="token punctuation" data-v-2f8cdd90>(</span> <span class="token parameter" data-v-2f8cdd90>obj</span> <span class="token punctuation" data-v-2f8cdd90>)</span> <span class="token punctuation" data-v-2f8cdd90>{</span>\n\t<span class="token keyword" data-v-2f8cdd90>if</span> <span class="token punctuation" data-v-2f8cdd90>(</span> materials<span class="token punctuation" data-v-2f8cdd90>[</span> obj<span class="token punctuation" data-v-2f8cdd90>.</span>uuid <span class="token punctuation" data-v-2f8cdd90>]</span> <span class="token punctuation" data-v-2f8cdd90>)</span> <span class="token punctuation" data-v-2f8cdd90>{</span>\n\t\tobj<span class="token punctuation" data-v-2f8cdd90>.</span>material <span class="token operator" data-v-2f8cdd90>=</span> materials<span class="token punctuation" data-v-2f8cdd90>[</span> obj<span class="token punctuation" data-v-2f8cdd90>.</span>uuid <span class="token punctuation" data-v-2f8cdd90>]</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t\t<span class="token keyword" data-v-2f8cdd90>delete</span> materials<span class="token punctuation" data-v-2f8cdd90>[</span> obj<span class="token punctuation" data-v-2f8cdd90>.</span>uuid <span class="token punctuation" data-v-2f8cdd90>]</span><span class="token punctuation" data-v-2f8cdd90>;</span>\n\t<span class="token punctuation" data-v-2f8cdd90>}</span>\n<span class="token punctuation" data-v-2f8cdd90>}</span>\n\n\n\n</code></pre><div class="line-numbers" aria-hidden="true" data-v-2f8cdd90><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div><div class="line-number" data-v-2f8cdd90></div></div></div>',3),k={__name:"threejs-luminous.html",setup(a){let n;const k=(0,t.iH)(),m=(0,t.iH)();return(0,d.bv)((async()=>{n=await s.e(464).then(s.bind(s,70464)),(()=>{const a=new c.xsS,n=new c.cPb(75,2,.1,100);n.position.set(0,0,20),a.add(n);const s=new c.xo$(1,32,32),d=new c.vBJ({color:"#ffaa33"}),t=new c.Kj0(s,d);t.position.set(-5,0,0),t.layers.set(1),a.add(t);const l=new c.DvJ(1,1,1),v=new c.Wid({emissive:3407667}),u=new c.Kj0(l,v);u.position.set(5,0,0),a.add(u);const f=new c.FE5(1,.3,100,16),r=new c.Wid({emissive:3407667}),m=new c.Kj0(f,r);m.position.set(0,0,0),a.add(m);const b=new c.CP7;b.setSize(k.value.offsetWidth,k.value.offsetWidth/2),b.shadowMap.enabled=!0,b.physicallyCorrectLights=!0,b.autoClear=!1;const w=new p.xC(b);w.setSize(k.value.offsetWidth,k.value.offsetWidth/2);const h=new o.C(a,n);w.addPass(h);const y=new i.f(new c.FM8(k.value.offsetWidth,k.value.offsetWidth/2),a,n);y.edgeStrength=3,y.edgeGlow=2,y.edgeThickness=3,y.pulsePeriod=2,y.selectedObjects=[m],w.addPass(y),k.value.appendChild(b.domElement);const g=new e.z(n,b.domElement);g.enableDamping=!0;const E=new c.SUY;new c.vBJ({color:"black"}),(new c.S9g).set(0),function s(){E.getDelta(),g.update(),b.clear(),n.layers.set(0),w.render(),b.clearDepth(),n.layers.set(1),b.render(a,n),requestAnimationFrame(s)}(),window.addEventListener("resize",(()=>{b.setSize(k.value.offsetWidth,k.value.offsetWidth/2),b.setPixelRatio(window.devicePixelRatio)})),k.value.addEventListener("click",(()=>{u.layers.set(1)}))})(),(()=>{const a=new c.S9g;a.set(1);const s={exposure:1,bloomStrength:5,bloomThreshold:0,bloomRadius:0,scene:"Scene with Glow"},d=new c.vBJ({color:"black"}),t={},i=new c.CP7({antialias:!0});i.setSize(m.value.offsetWidth,m.value.offsetWidth/2),i.toneMapping=c.CdI,m.value.appendChild(i.domElement);const u=new c.xsS,f=new c.cPb(40,2,1,200);f.position.set(0,0,20),f.lookAt(0,0,0);const r=new e.z(f,i.domElement);r.maxPolarAngle=.5*Math.PI,r.minDistance=1,r.maxDistance=100,r.addEventListener("change",M),u.add(new c.Mig(4210752));const k=new o.C(u,f),b=new l.m(new c.FM8(window.innerWidth,window.innerHeight),1.5,.4,.85);b.threshold=s.bloomThreshold,b.strength=s.bloomStrength,b.radius=s.bloomRadius;const w=new p.xC(i);w.renderToScreen=!1,w.addPass(k),w.addPass(b);const h=new v.T(new c.jyz({uniforms:{baseTexture:{value:null},bloomTexture:{value:w.renderTarget2.texture}},vertexShader:"\n\t\t\t      varying vec2 vUv;\n\n\t\t\t      void main() {\n            \n\t\t\t      \tvUv = uv;\n\n\t\t\t      \tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\n\t\t\t      }          \n          ",fragmentShader:"\n\t\t\t      uniform sampler2D baseTexture;\n\t\t\t      uniform sampler2D bloomTexture;\n\n\t\t\t      varying vec2 vUv;\n\n\t\t\t      void main() {\n            \n\t\t\t      \tgl_FragColor = ( texture2D( baseTexture, vUv ) + vec4( 1.0 ) * texture2D( bloomTexture, vUv ) );\n\n\t\t\t      }          \n          ",defines:{}}),"baseTexture");h.needsSwap=!0;const y=new p.xC(i);y.addPass(k),y.addPass(h);const g=new c.iMs,E=new c.FM8;m.value.addEventListener("pointerdown",(function(a){E.x=a.clientX/window.innerWidth*2-1,E.y=-a.clientY/window.innerHeight*2+1,g.setFromCamera(E,f);const n=g.intersectObjects(u.children,!1);n.length>0&&(n[0].object.layers.toggle(1),M())}));const S=new n.GUI;S.domElement.style.position="absolute",S.domElement.style.top="0px",S.domElement.style.right="0px",m.value.appendChild(S.domElement),S.add(s,"scene",["Scene with Glow","Glow only","Scene only"]).onChange((function(a){switch(a){case"Scene with Glow":w.renderToScreen=!1;break;case"Glow only":w.renderToScreen=!0}M()}));const P=S.addFolder("Bloom Parameters");function C(a){a.material&&a.material.dispose()}function M(){switch(s.scene){case"Scene only":i.render(u,f);break;case"Glow only":T(!1);break;default:T(!0),y.render()}}function T(a){!0===a?(u.traverse(j),w.render(),u.traverse(x)):(f.layers.set(1),w.render(),f.layers.set(0))}function j(n){n.isMesh&&!1===a.test(n.layers)&&(t[n.uuid]=n.material,n.material=d)}function x(a){t[a.uuid]&&(a.material=t[a.uuid],delete t[a.uuid])}P.add(s,"exposure",.1,2).onChange((function(a){i.toneMappingExposure=Math.pow(a,4),M()})),P.add(s,"bloomThreshold",0,1).onChange((function(a){b.threshold=Number(a),M()})),P.add(s,"bloomStrength",0,10).onChange((function(a){b.strength=Number(a),M()})),P.add(s,"bloomRadius",0,1).step(.01).onChange((function(a){b.radius=Number(a),M()})),function(){u.traverse(C),u.children.length=0;const a=new c.cJO(1,15);for(let n=0;n<50;n++){const n=new c.Ilk;n.setHSL(Math.random(),.7,.2*Math.random()+.05);const s=new c.vBJ({color:n}),d=new c.Kj0(a,s);d.position.x=10*Math.random()-5,d.position.y=10*Math.random()-5,d.position.z=10*Math.random()-5,d.position.normalize().multiplyScalar(4*Math.random()+2),d.scale.setScalar(Math.random()*Math.random()+.5),u.add(d),Math.random()<.25&&d.layers.enable(1)}M()}(),window.onresize=function(){const a=m.value.offsetWidth,n=m.value.offsetWidth/2;f.aspect=a/n,f.updateProjectionMatrix(),i.setSize(a,n),w.setSize(a,n),y.setSize(a,n),M()}})()})),(a,n)=>{const s=(0,d.up)("ExternalLinkIcon");return(0,d.wg)(),(0,d.iD)("div",null,[(0,d._)("p",null,[(0,d.Uk)("参考："),(0,d._)("a",u,[(0,d.Uk)("https://threejs.org/"),(0,d.Wm)(s)])]),f,(0,d._)("div",{ref_key:"outLine",ref:k},null,512),r,(0,d._)("div",{ref_key:"bloomRef",ref:m,class:"bloom"},null,512)])}}},m=(0,s(61935).Z)(k,[["__scopeId","data-v-2f8cdd90"]])},68087:(a,n,s)=>{s.r(n),s.d(n,{data:()=>d});const d=JSON.parse('{"key":"v-1b300024","path":"/threejs/threejs-luminous.html","title":"ThreeJS中的效果合成器","lang":"zh-CN","frontmatter":{"title":"ThreeJS中的效果合成器","category":["ThreeJS"],"date":"2022-03-02T00:00:00.000Z","summary":"参考：https://threejs.org/ UnrealBloomPass 实现逼真的bloom（即景物周围余晖）效果 new THREE.Vector2( window.innerWidth, window.innerHeight )：表示渲染的分辨率大小。; strength：效果强度，默认值为1。; radius：半径大小，默认值为0。; thre","head":[["meta",{"property":"og:url","content":"https://luxiag.github.io/threejs/threejs-luminous.html"}],["meta",{"property":"og:title","content":"ThreeJS中的效果合成器"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:updated_time","content":"2023-04-27T03:25:07.000Z"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:published_time","content":"2022-03-02T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2023-04-27T03:25:07.000Z"}]]},"excerpt":"","headers":[],"git":{"createdTime":1681959670000,"updatedTime":1682565907000,"contributors":[{"name":"卢祥","email":"example@qq.com","commits":2}]},"readingTime":{"minutes":7.04,"words":2112},"filePathRelative":"threejs/threejs-luminous.md","localizedDate":"2022年3月2日"}')}}]);